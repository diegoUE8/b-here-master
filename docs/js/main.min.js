/**
 * @license b-here v1.0.0
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("rxcomp"),require("rxcomp-form"),require("rxjs"),require("rxjs/operators"),require("html2canvas")):"function"==typeof define&&define.amd?define(["rxcomp","rxcomp-form","rxjs","rxjs/operators","html2canvas"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp,e.rxcomp.form,e.rxjs,e.rxjs.operators,e.html2canvas)}(this,(function(e,t,n,i,o){"use strict";function r(e,t,n,i,o,r,s){try{var a=e[r](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(i,o)}function s(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function a(e){r(s,i,o,a,u,"next",e)}function u(e){r(s,i,o,a,u,"throw",e)}a(void 0)}))}}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var p=function(){function e(){}return e.merge=function(e,t){var n=this;return t&&"object"==typeof t&&Object.keys(t).forEach((function(i){var o=t[i];"object"!=typeof o||Array.isArray(o)?e[i]=o:e[i]=n.merge(e[i],o)})),e},e}(),f="undefined"!=typeof module&&module.exports,m=null!=(f?{get:function(){}}:new URLSearchParams(window.location.search)).get("debug"),v=f?null:document.querySelector("base").getAttribute("href"),g=!f&&(window&&-1!==window.location.host.indexOf("herokuapp")),y=!f&&(g||window&&("41789"===window.location.port||"5000"===window.location.port||"6443"===window.location.port||"diegoUE8.github.io"===window.location.host)),b=!f&&(window&&-1!==["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0])),w={STATIC:y,DEVELOPMENT:b,PRODUCTION:!b},x=function(){var e=t.prototype;function t(e){e&&Object.assign(this,e)}return e.getAbsoluteUrl=function(e,t){var n=""+window.location.origin+e;return Object.keys(t).forEach((function(e){n=n.replace("$"+e,t[e])})),n},e.getPath=function(e){return this.isLocal(e)?this.href+e:e},e.isLocal=function(e){return-1===e.indexOf("://")},u(t,[{key:"STATIC",get:function(){return w.STATIC},set:function(e){w.STATIC=!0===e||"true"===e,console.log("Environment.STATIC.set",w.STATIC)}},{key:"href",get:function(){return g?this.githubDocs:v}}]),t}(),E={channelName:"BHere",flags:{production:!1,useProxy:!1,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!0,menu:!0,navmaps:!0,chat:!0,ar:!0,like:!0,hideNavInfo:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!0,heroku:g},navs:{iconMinScale:1,iconMaxScale:1.4},url:{},languages:["it","en"],defaultLanguage:"it"},S=window.STATIC?{appKey:"865af1430a854af5b01733ff9b725a2b",channelName:"BHere",flags:{production:!1,useProxy:!1,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!0,editorAssetScreen:!0,menu:!0,menuEmbed:!0,navmaps:!0,chat:!0,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!0,navMoveImportantAnimated:!0,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!0,navTransparentImportantAnimated:!0,useTextureEnvironment:!0,usePaths:!0},navs:{iconMinScale:1.2,iconMaxScale:1.6},profiles:{streamer:"480p_2",publisher:"1080p_2",screen:"1080p_2"},logo:null,background:{video:"/b-here/img/background.mp4"},selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room"],disabledViewItemTypes:["texture"]},assets:"/b-here/",workers:{image:"./js/workers/image.service.worker.js",prefetch:"./js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},githubDocs:"https://raw.githubusercontent.com/diegoUE8/b-here-master/main/docs/",template:{tryInAr:"/try-in-ar.html?viewId=$viewId",modal:{configureFirewall:"/configure-firewall-modal.html",controlRequest:"/control-request-modal.html",supportRequest:"/support-request-modal.html",tryInAr:"/try-in-ar-modal.html",view:{panorama:"/panorama-modal.html","panorama-grid":"/panorama-grid-modal.html","room-3d":"/room-3d-modal.html",model:"/model-modal.html",media:"/media-modal.html"},viewItem:{nav:"/nav-modal.html",plane:"/plane-modal.html","curved-plane":"/curved-plane-modal.html",texture:"/texture-modal.html",model:"/item-model-modal.html"},navmap:"/navmap-modal.html",navmapItem:"/navmap-item-modal.html",pathAdd:"/path-add-modal.html",pathEdit:"/path-edit-modal.html",remove:"/remove-modal.html"},email:{supportRequest:"/email/support-request.html"}}}:{appKey:"865af1430a854af5b01733ff9b725a2b",channelName:"BHere",flags:{production:!0,useProxy:!1,useToken:!1,selfService:!0,guidedTourRequest:!0,editor:!1,editorAssetScreen:!1,menu:!0,menuEmbed:!1,navmaps:!1,chat:!1,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!1,navMoveImportantAnimated:!1,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!1,navTransparentImportantAnimated:!1,useTextureEnvironment:!0,usePaths:!1},navs:{iconMinScale:1.2,iconMaxScale:1.6},profiles:{streamer:"480p_2",publisher:"1080p_2",screen:"720p_2"},logo:null,background:{video:"/Modules/B-Here/Client/docs/img/background.mp4"},selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},assets:"/Modules/B-Here/Client/docs/",workers:{image:"/Modules/B-Here/Client/docs/js/workers/image.service.worker.js",prefetch:"/Modules/B-Here/Client/docs/js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},githubDocs:"https://raw.githubusercontent.com/diegoUE8/b-here-master/main/docs/",template:{tryInAr:"/template/modules/b-here/try-in-ar.cshtml?viewId=$viewId",modal:{configureFirewall:"/template/modules/b-here/configure-firewall-modal.cshtml",controlRequest:"/template/modules/b-here/control-request-modal.cshtml",supportRequest:"/template/modules/b-here/support-request-modal.cshtml",tryInAr:"/template/modules/b-here/try-in-ar-modal.cshtml",view:{panorama:"/template/modules/b-here/panorama-modal.cshtml","panorama-grid":"/template/modules/b-here/panorama-grid-modal.cshtml","room-3d":"/template/modules/b-here/room-3d-modal.cshtml",model:"/template/modules/b-here/model-modal.cshtml",media:"/template/modules/b-here/media-modal.cshtml"},viewItem:{nav:"/template/modules/b-here/nav-modal.cshtml",plane:"/template/modules/b-here/plane-modal.cshtml","curved-plane":"/template/modules/b-here/curved-plane-modal.cshtml",texture:"/template/modules/b-here/texture-modal.cshtml",model:"/template/modules/b-here/item-model-modal.cshtml"},navmap:"/template/modules/b-here/navmap-modal.cshtml",navmapItem:"/template/modules/b-here/navmap-item-modal.cshtml",pathAdd:"/template/modules/b-here/path-add-modal.cshtml",pathEdit:"/template/modules/b-here/path-edit-modal.cshtml",remove:"/template/modules/b-here/remove-modal.cshtml"},email:{supportRequest:"/template/modules/b-here/email/support-request.cshtml"}}},T=Object.assign({port:5e3,fontFamily:"Work Sans, sans-serif",colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},renderOrder:{panorama:0,room:10,plane:20,tile:30,model:40,banner:50,nav:60,panel:70,menu:80,debug:90,pointer:100}},E,S),k=new x(T=p.merge(T,window.bhere));console.log("environment",k);var M=function(){function e(){}return e.has=function(e){return new URLSearchParams(window.location.search).has(e)},e.get=function(e){return new URLSearchParams(window.location.search).get(e)},e.set=function(e,t){var n=new URLSearchParams(window.location.search);"string"==typeof e?n.set(e,t):n.set(e,""),this.pushParams(n)},e.delete=function(e){var t=new URLSearchParams(window.location.search);t.has(e)&&(t.delete(e),this.pushParams(t))},e.pushParams=function(e){if(window.history&&window.history.pushState){var t=document.title,n=window.location.href.split("?")[0]+"?"+e.toString();window.history.pushState(e.toString(),t,n)}},e.replace=function(e,t){var n=window.history;if(n&&n.replaceState){var i=window.location,o=document.title;if("/"===i.pathname){var r=i.origin+t+i.search;n.replaceState(n.state,o,r)}else if(-1!==i.href.indexOf(e)){var s=i.href.replace(e,t);n.replaceState(n.state,o,s)}}},e.deserialize=function(e){var t=this.get("params");return this.decode(e,t)},e.serialize=function(e,t){var n=this.deserialize(),i=this.encode(e,t,n);this.set("params",i)},e.decode=function(e,t){var n=null;if(t){var i=window.atob(t);n=JSON.parse(i)}return e&&n&&(n=n[e]),n||null},e.encode=function(e,t,n){n=n||{};"string"==typeof e?n[e]=t:n=e;var i=JSON.stringify(n);return window.btoa(i)},e}(),I=function(){function e(){}return e.patchState=function(e){e=Object.assign({},this.state,e),this.state=e},u(e,null,[{key:"state",set:function(e){this.state$.next(e)},get:function(){return this.state$.getValue()}}]),e}();c(I,"state$",new n.BehaviorSubject({}));var C={Publisher:"publisher",Attendee:"attendee",Streamer:"streamer",Viewer:"viewer",SmartDevice:"smart-device",SelfService:"self-service",Embed:"embed"},R=function(e){e&&Object.assign(this,e)},A=/^\d{9}-\d{4}-\d{13}(-\d+)?$/,_=function(){function e(t){if(this.userId=I.state.user?I.state.user.id:0,this.role=I.state.role||C.Viewer,this.timestamp=(new Date).valueOf().toString(),this.pathId=null,"string"==typeof t){if(!t.match(A))return console.warn("MeetingId","invalid meetingId",t),null;t=e.decompose(t)}"object"==typeof t&&(t.id&&(this.id=t.id),t.userId&&(this.userId=t.userId),t.role&&(this.role=t.role),t.roleIndex&&(this.roleIndex=t.roleIndex),t.timestamp&&(this.timestamp=t.timestamp),t.pathId&&(this.pathId=t.pathId))}u(e,[{key:"roleIndex",get:function(){return e.getRoleIndex(this.role)},set:function(t){if(e.getRoleIndex(this.role)!==t){var n=Object.keys(C)[t];this.role=C[n]}}}]);var t=e.prototype;return t.toString=function(){return e.compose(this.userId,this.roleIndex,this.timestamp,this.pathId)},t.toRoles=function(){var t=this.userId,n=this.timestamp,i=this.pathId;return{id:e.compose(t,e.getRoleIndex(C.Publisher),n,i),idAttendee:e.compose(t,e.getRoleIndex(C.Attendee),n,i),idStreamer:e.compose(t,e.getRoleIndex(C.Streamer),n,i),idViewer:e.compose(t,e.getRoleIndex(C.Viewer),n,i),idSmartDevice:e.compose(t,e.getRoleIndex(C.SmartDevice),n,i),idSelfService:e.compose(t,e.getRoleIndex(C.SelfService),n,i)}},e.compose=function(t,n,i,o){return e.padded(t,9)+"-"+e.padded(n,4)+"-"+i+(o?"-"+o:"")},e.decompose=function(e){var t=e.split("-");return{userId:parseInt(t[0]),roleIndex:parseInt(t[1]),timestamp:parseInt(t[2]),pathId:t[3]?parseInt(t[3]):null}},e.generateMeetingId=function(){return(new e).toRoles()},e.getRoleIndex=function(e){return Object.keys(C).reduce((function(t,n,i){return C[n]===e?i:t}),-1)},e.padded=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},e}(),L=function(){function e(t){if(this.link=M.get("link")||null,this.name=M.get("name")||null,this.role=M.get("role")||null,this.viewId=M.has("viewId")?parseInt(M.get("viewId")):null,this.pathId=M.has("pathId")?parseInt(M.get("pathId")):null,this.embedViewId=M.has("embedViewId")?parseInt(M.get("embedViewId")):null,this.support=!!M.has("support")&&"true"===M.get("support"),"string"==typeof t&&(t=e.decompose(t)),"object"==typeof t){if(t.link&&(this.link=t.link),t.user){var n=e.getName(t.user);n&&(this.name=n)}t.name&&(this.name=t.name),t.role&&(this.role=t.role),t.viewId&&(this.viewId=t.viewId),t.pathId&&(this.pathId=t.pathId),t.embedViewId&&(this.embedViewId=t.embedViewId),t.support&&(this.support=t.support)}}u(e,[{key:"meetingId",get:function(){return this.link?new _(this.link):null}}]);var t=e.prototype;return t.toString=function(t){return void 0===t&&(t=!1),e.compose(this.link,this.name,t?null:this.role,this.viewId,this.pathId,this.support)},t.toUrl=function(){var t=this.toString();return e.getCurrentUrl(t)},t.toAccessCodeUrl=function(){var t=this.toString();return e.getAccessCodeUrl(t)},t.toGuidedTourUrl=function(){var t=this.toString();return e.getGuidedTourUrl(t)},t.copyToClipBoard=function(t){void 0===t&&(t=!1);var n=document.createElement("input");n.style.position="absolute",n.style.top="1000vh",document.querySelector("body").appendChild(n);var i=this.toString(!0);n.value=t?e.getAccessCodeUrl(i):e.getGuidedTourUrl(i),n.focus(),n.select(),n.setSelectionRange(0,99999),document.execCommand("copy"),n.parentNode.removeChild(n),alert("link copiato!\n "+n.value)},t.replaceUrl=function(){if("history"in window){var t=this.toString(),n=e.getCurrentUrl(t);window.history.replaceState({pageTitle:window.pageTitle},"",n)}},e.replaceWithUser=function(t){var n=new e({user:t});return n.replaceUrl(),n},e.replaceWithName=function(t){var n=new e({name:t});return n.replaceUrl(),n},e.replaceWithLink=function(t){var n=new e({link:t});return n.replaceUrl(),n},e.getCurrentUrl=function(e){return void 0===e&&(e=""),""+window.location.origin+window.location.pathname+e},e.getAccessCodeUrl=function(e){return void 0===e&&(e=""),""+window.location.origin+k.url.accessCode+e},e.getGuidedTourUrl=function(e){return void 0===e&&(e=""),""+window.location.origin+k.url.guidedTour+e},e.getName=function(e){return e&&e.firstName&&e.lastName?e.firstName+" "+e.lastName:null},e.compose=function(e,t,n,i,o,r){var s={link:e,name:t,role:n,viewId:i,pathId:o,support:r};return"?"+(s=Object.keys(s).map((function(e){return{key:e,value:s[e]}})).filter((function(e){return null!=e.value&&!1!==e.value})).map((function(e){return e.key+"="+e.value}))).join("&")},e.decompose=function(e){var t={};return e.split("?")[1].split("&").forEach((function(e){var n=e.split("=")[0],i=e.split("=")[1];t[n]=i})),t},e}(),P=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onInit=function(){this.state={};var t=new L;if(t.link){var n=t.toGuidedTourUrl(),i=e.getContext(this).node;new QRious({element:i.querySelector(".qrcode"),value:n,size:256})}else window.location.href=L.getGuidedTourUrl()},n}(e.Component);P.meta={selector:"[access-code-component]"};var $=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.getControl=function(e){return this.group.get(e)},u(t,[{key:"group",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control}}]),t}(e.Component);function O(e){return new t.FormGroup(function(e){return e.reduce((function(e,n,i){var o=[];if(n.required&&o.push("checkbox"===n.type?t.Validators.RequiredTrueValidator():t.Validators.RequiredValidator()),"email"===n.type&&o.push(t.Validators.EmailValidator()),"url"===n.type&&o.push(t.Validators.PatternValidator("(https?://(?:www.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|www.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|https?://(?:www.|(?!www))[a-zA-Z0-9]+.[^s]{2,}|www.[a-zA-Z0-9]+.[^s]{2,})")),null!=n.pattern&&o.push(t.Validators.PatternValidator(n.pattern)),e[n.name]=new t.FormControl(null!=n.value?n.value:null,o),"select"===n.type||"custom-select"===n.type){var r=(n.options||[]).slice();r.unshift({id:null,name:"select"}),e[n.name].options=r}return e}),{})}(e))}$.meta={selector:"[controls]",inputs:["formGroup","fields"],hosts:{host:t.FormAbstractCollectionDirective},template:'\n\t\t<div *for="let field of fields">\n\t\t\t<div *if="[\'text\', \'email\', \'url\'].indexOf(field.type) !== -1" control-text [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'select\'" control-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'custom-select\'" control-custom-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'textarea\'" control-textarea [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'checkbox\'" control-checkbox [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<input *if="field.type == \'hidden\'" [name]="field.name" [formControl]="getControl(field.name)" value="" type="text" style="display:none !important;" />\n\t\t</div>\n\t'};var H=[["480p_1",640,480,15,500,!0],["480p_2",640,480,30,1e3,!0],["480p_3",480,480,15,400,!0],["480p_4",640,480,30,750,!0],["480p_6",480,480,30,600,!0],["480p_8",848,480,15,610,!0],["480p_9",848,480,30,930,!0],["480p_10",640,480,10,400,!0],["720p_1",1280,720,15,1130,!0],["720p_2",1280,720,30,2e3,!0],["720p_3",1280,720,30,1710,!0],["720p_5",960,720,15,910,!0],["720p_6",960,720,30,1380,!0],["1080p_1",1920,1080,15,2080,!1],["1080p_2",1920,1080,30,3e3,!1],["1080p_3",1920,1080,30,3150,!1],["1080p_5",1920,1080,60,4780,!1]].map((function(e){return{profile:e[0],resolution:{width:e[1],height:e[2]},frameRate:{min:e[3],max:e[3]},bitrate:{min:e[4],max:e[4]},compatible:e[5]}}));function U(e){return e.role===C.Publisher||e.role===C.SmartDevice?H.find((function(e){return e.profile===k.profiles.publisher})):H.find((function(e){return e.profile===k.profiles.streamer}))}var D="idle",F="checklist",V="link",j="login",B="name",N="device",z="should-connect",G="connecting",q="connected",W="agoraEvent",K="channelMembers",X="supportRequest",Y="supportRequestAccepted",Z="supportRequestRejected",J="requestControl",Q="requestControlAccepted",ee="requestControlRejected",te="requestControlDismiss",ne="requestControlDismissed",ie="requestPeerInfo",oe="requestPeerInfoResult",re="requestInfo",se="requestInfoResult",ae="requestInfoDismiss",ue="requestInfoDismissed",ce="requestInfoRejected",le="remoteSilencing",de="controlInfo",he="addLike",pe="showPanel",fe="playMedia",me="zoomMedia",ve="currentTimeMedia",ge="playModel",ye="mode",be="navInfo",we="navToView",xe="navToGrid",Ee="navLink",Se="navLinkClose",Te="vrStarted",ke="vrEnded",Me="vrState",Ie="menuToggle",Ce="chatMessage",Re="chatTypingBegin",Ae="chatTypingEnd",_e="selectItem",Le="virtual-tour",Pe="live-meeting",$e="self-service-tour",Oe="embed",He="none",Ue=function(e){Object.assign(this,e)},De=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),Fe=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),Ve=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),je=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),Be=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),Ne=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),ze=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ue),Ge=function(){function e(){}return e.http$=function(e,t,o,r){var s=this,a=null;return n.from(fetch(t,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(o):void 0}).then((function(e){a=e;try{var t,n=e.headers.get("content-type");return t=n&&-1!==n.indexOf("application/json")?e.json():e.text(),e.ok?t:t.then((function(e){return Promise.reject(e)}))}catch(t){return e.ok?(console.warn("HttpService.http$","Cannot parse response"),Promise.resolve()):Promise.reject(t)}}))).pipe(i.catchError((function(e){return n.throwError(s.getError(e,a))})))},e.get$=function(e,t,n){var i=this.query(t);return this.http$("GET",""+e+i,void 0,n)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getError=function(e,t){var n="object"==typeof e?e:{};return n.status||(n.status=t?t.status:0),n.statusCode||(n.statusCode=t?t.status:0),n.statusMessage||(n.statusMessage=t?t.statusText:e),n},e}(),qe=function(){function e(){}return e.setUser=function(e){this.user$.next(e)},e.me$=function(){var e=this;return Ge.get$("/api/user/me").pipe(i.map((function(t){return e.mapUser(t)})),i.catchError((function(e){if(404===e.status||404===e.statusCode)return n.of(null);throw e})),i.switchMap((function(t){return e.setUser(t),e.user$})))},e.login$=function(e){var t=this;return Ge.post$("/api/user/login",e).pipe(i.map((function(e){return t.mapUser(e)})),i.tap((function(e){return t.setUser(e)})))},e.logout$=function(){var e=this;return Ge.get$("/api/user/logout").pipe(i.map((function(t){return e.mapUser(t)})),i.tap((function(t){return e.setUser(null)})))},e.guidedTour$=function(e){var t=this;return Ge.post$("/api/user/guided-tour",e).pipe(i.map((function(e){return t.mapUser(e)})),i.tap((function(e){return t.setUser(e)})))},e.selfServiceTour$=function(e){var t=this;return Ge.post$("/api/user/self-service-tour",e).pipe(i.map((function(e){return t.mapUser(e)})),i.tap((function(e){return t.setUser(e)})))},e.selfServiceSupportRequest$=function(e,t,n){var o={user:e,meetingId:t,link:n};return Ge.post$("/api/user/self-service-support-request",o).pipe(i.tap((function(t){k.flags.production||fetch(k.template.email.supportRequest).then((function(e){return e.text()})).then((function(t){t=(t=t.replace("{{username}}",L.getName(e))).replace("{{href}}",n);var i=(new DOMParser).parseFromString(t,"text/html");setTimeout((function(){var e=window.open();e.document.head.innerHTML=i.querySelector("head").innerHTML,e.document.body.innerHTML=i.querySelector("body").innerHTML}),3e3)}))})))},e.resolve$=function(e,t){return"login"===t?this.login$(e):"guided-tour"===t?this.guidedTour$(e):"self-service-tour"===t?this.selfServiceTour$(e):void 0},e.log$=function(e){return Ge.post$("/api/user/log",e)},e.temporaryUser$=function(e){var t=this;return void 0===e&&(e=C.Embed),n.of({id:this.uuid(),type:e,username:e,firstName:"Jhon",lastName:"Appleseed"}).pipe(i.map((function(e){return t.mapUser(e)})),i.switchMap((function(e){return t.setUser(e),t.user$})))},e.uuid=function(){return(new Date).getTime()},e.mapUser=function(e){return new R(e)},e.getMode=function(e){var t;switch(e){case C.Publisher:case C.Attendee:case C.Streamer:case C.Viewer:case C.Publisher:case C.Publisher:t=Le;break;case C.SelfService:t=$e;break;case C.SmartDevice:t=Pe;break;case C.Embed:t=Oe;break;default:t=He}return t},e}();qe.user$=new n.BehaviorSubject(null);var We=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){this.state={status:"access"}},o.onSelfServiceTourRequest=function(){this.initRequestForm(),this.state.status="self-service-tour",this.pushChanges(),y&&-1!==window.navigator.userAgent.indexOf("OculusBrowser")&&(this.test(),this.onSubmit())},o.onGuidedTourRequest=function(){this.initRequestForm(),this.state.status="guided-tour",this.pushChanges()},o.onGuidedTourAccess=function(){qe.logout$().pipe(i.first()).subscribe((function(){window.location.href=k.url.guidedTour}))},o.onLogin=function(){this.initLoginForm(),this.state.status="login",this.pushChanges()},o.initRequestForm=function(){var e=this;this.formSubscription&&this.formSubscription.unsubscribe();this.data=window.data||{roles:[{id:1,name:"Show room"},{id:2,name:"Architetto"},{id:3,name:"Interior designer"},{id:4,name:"Privato"},{id:5,name:"Altro"}]};var t=this.fields=window.fields||[{type:"text",name:"firstName",label:"access_first_name",required:!0,test:"Jhon"},{type:"text",name:"lastName",label:"access_last_name",required:!0,test:"Appleseed"},{type:"email",name:"email",label:"access_email",required:!0,test:"jhonappleseed@gmail.com"},{type:"custom-select",name:"role",label:"access_role",required:!0,options:window.data.roles,test:window.data.roles[0].id},{type:"checkbox",name:"privacy",label:"access_privacy_disclaimer",required:!0,test:!0}];t.push({type:"hidden",name:"checkField",value:"",test:""},{type:"none",name:"checkRequest",value:window.antiforgery||"",test:window.antiforgery||""});var n=this.form=O(t);this.controls=n.controls;this.formSubscription=n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),this.error=null},o.initLoginForm=function(){var e=this;this.formSubscription&&this.formSubscription.unsubscribe();var n=this.form=new t.FormGroup({username:new t.FormControl(null,t.Validators.RequiredValidator()),password:new t.FormControl(null,t.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=n.controls;this.formSubscription=n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),this.error=null},o.test=function(){var e,t,n;"login"===this.state.status?this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""}):(e=this.fields,t=this.form,n=e.reduce((function(e,t,n){return t.test&&(e[t.name]=t.test),e}),{}),t.patch(n))},o.reset=function(){this.form.reset()},o.onBack=function(){this.state.status="access",this.pushChanges()},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n=this.state.status;qe.resolve$(t,n).pipe(i.first()).subscribe((function(t){switch(n){case"guided-tour":e.state.status="guided-tour-success",e.pushChanges();break;case"self-service-tour":window.location.href=k.url.selfServiceTour;break;case"login":window.location.href=k.url.guidedTour}e.form.reset()}),(function(t){console.log("AccessComponent.error",t),e.error=t,e.pushChanges()}))}else this.form.touched=!0},o.isValid=function(){var e=this.form.valid;return e},n}(e.Component);We.meta={selector:"[access-component]"};var Ke=function(){function e(){}return e.emoji$=function(){return null!=e.items_?n.of(e.items_):Ge.get$(k.assets+"api/emoji/emoji.json").pipe(i.map((function(t){return e.items_=t,t})))},e}(),Xe=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.items=[],Ke.emoji$().pipe(i.first()).subscribe((function(t){setTimeout((function(){e.items=t,e.pushChanges()}),1)}))},n.onSelect=function(e){this.emoji.next(e)},n.onClose=function(e){this.close.next()},t}(e.Component);Xe.meta={selector:"[agora-chat-emoji]",outputs:["emoji","close"]};var Ye=function(){function e(){}return e.message=function(e){this.message$.next(e)},e.in=function(e){this.in$.next(e)},e.sendBack=function(e){e=Object.assign({},e,{remoteId:e.clientId}),this.in$.next(e)},e.out=function(e){this.out$.next(e)},e}();c(Ye,"message$",new n.ReplaySubject(1)),c(Ye,"in$",new n.ReplaySubject(1)),c(Ye,"send",Ye.in),c(Ye,"out$",new n.ReplaySubject(1));var Ze="unknown",Je="ios",Qe="android",et="windowsPhone",tt="vrHeadset",nt=function(){function e(){}return e.getDevicePlatform=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?et:/android/i.test(e)?Qe:this.isIOS?Je:this.isVRHeadset?tt:Ze},u(e,null,[{key:"platform",get:function(){return this.platform_||(this.platform_=this.getDevicePlatform()),this.platform_}},{key:"isIOS",get:function(){return-1!==["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].indexOf(navigator.platform)||-1!==navigator.userAgent.indexOf("Mac")&&"ontouchend"in document}},{key:"isVRHeadset",get:function(){return-1!==navigator.userAgent.indexOf("VR")||-1!==navigator.userAgent.indexOf("Quest")||-1!==navigator.userAgent.indexOf("Oculus")}}]),e}(),it=function(){function e(){this.events={}}var t=e.prototype;return t.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},t.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},t.once=function(e,t){var n=this,i=function i(o){t(o),n.off(e,i)};this.on(e,i)},t.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t.has=function(e){var t=this.events[e];return t&&t.length},e}(),ot=function(){function e(){}return e.delete=function(e){this.isSessionStorageSupported()&&window.sessionStorage.removeItem(e)},e.exist=function(e){if(this.isSessionStorageSupported())return void 0!==window.sessionStorage[e]},e.get=function(e){var t=null;if(this.isSessionStorageSupported()&&void 0!==window.sessionStorage[e])try{t=JSON.parse(window.sessionStorage[e])}catch(t){console.log("SessionStorageService.get.error parsing",e,t)}return t},e.set=function(e,t){if(this.isSessionStorageSupported())try{var n=[],i=JSON.stringify(t,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}));window.sessionStorage.setItem(e,i)}catch(n){console.log("SessionStorageService.set.error serializing",e,t,n)}},e.isSessionStorageSupported=function(){if(this.supported)return!0;var e=!1;try{(e="sessionStorage"in window&&null!==window.sessionStorage)?(window.sessionStorage.setItem("test","1"),window.sessionStorage.removeItem("test")):e=!1}catch(t){e=!1}return this.supported=e,e},e}(),rt="client",st="editor",at=function(){function e(){}return e.orderedRemotes$=function(){return n.combineLatest([e.remotes$,n.interval(1e3)]).pipe(i.map((function(e){var t=[];return e[0].forEach((function(e){var n=null,i=null,o=null,r=0,s=0,a=0;e.clientInfo&&(r=e.clientInfo.audioLevel=e.getAudioLevel(),s=e.clientInfo.peekAudioLevel=Math.max(e.clientInfo.audioLevel,.2),a=e.clientInfo.order,n=e.clientInfo.role||null,i=e.clientInfo.uid||null,o=e.clientInfo.screenUid||null),t.push({role:n,uid:i,screenUid:o,audioLevel:r,peekAudioLevel:s,order:a,remote:e})})),t.sort((function(e,t){var n=e.role===C.Publisher?2:e.role===C.Attendee?1:0;return(t.role===C.Publisher?2:t.role===C.Attendee?1:0)-n||t.peekAudioLevel-e.peekAudioLevel||(e.order||0)-(t.order||0)})),t.forEach((function(e,t){e.remote.clientInfo&&(e.remote.clientInfo.order=t)})),t})),i.distinctUntilChanged((function(e,t){return e.map((function(e){return e.uid+"-"+e.screenUid})).join("|")===t.map((function(e){return e.uid+"-"+e.screenUid})).join("|")})),i.map((function(e){return e.map((function(e){return e.remote}))})))},e.getEditorStreams$=function(){var e=this;return n.of(null).pipe(i.switchMap((function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&e.mode===st){var t=document.querySelector("body"),n=document.createElement("div"),i=document.createElement("video");n.setAttribute("id","stream-editor"),n.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),n.appendChild(i),t.appendChild(n),navigator.mediaDevices.getUserMedia({video:{width:800,height:450}}).then((function(t){"srcObject"in i?i.srcObject=t:i.src=window.URL.createObjectURL(t),i.oncanplay=function(){var t={getId:function(){return"editor"},clientInfo:{role:C.Publisher,uid:"editor"}},n={getId:function(){return"editor"},clientInfo:{role:C.Attendee,uid:"editor"}},i={getId:function(){return"editor"},clientInfo:{role:C.SmartDevice,uid:"editor"}};e.editorStreams$.next([t,n,n,n,n,i])},i.play()})).catch((function(e){console.log("EditorComponent.getUserMedia.error",e.name,e.message)}))}return e.editorStreams$})),i.shareReplay(1))},e.getEditorScreens$=function(){var e=this;return n.of(null).pipe(i.switchMap((function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&e.mode===st){var t=document.querySelector("body"),n=document.createElement("div"),i=document.createElement("video");n.setAttribute("id","stream-editor-screen"),n.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),n.appendChild(i),t.appendChild(n),navigator.mediaDevices.getDisplayMedia({screen:{width:800,height:450}}).then((function(t){"srcObject"in i?i.srcObject=t:i.src=window.URL.createObjectURL(t),i.oncanplay=function(){var t={getId:function(){return"editor-screen"},clientInfo:{role:C.Publisher,uid:"editor",screenUid:"editor-screen"}},n={getId:function(){return"editor-screen"},clientInfo:{role:C.Attendee,uid:"editor",screenUid:"editor-screen"}};e.editorScreens$.next([t,n])},i.play()})).catch((function(e){console.log("EditorComponent.getUserMedia.error",e.name,e.message)}))}return e.editorScreens$})),i.shareReplay(1))},e.getPublisherStreamId$=function(){var e=this,t=this.publisherStreamId;return t?n.of(t):this.streams$.pipe(i.map((function(){return e.publisherStreamId})),i.filter((function(e){return e})))},e.getRemoteById=function(t){var n=e.remotes.find((function(e){return e.getId()===t}));if(n)return n},e.remoteAdd=function(e){var t=this.remotes.slice();t.push(e),this.remotes=t},e.remoteRemove=function(e){var t=this.remotes.slice(),n=t.find((function(t){return t.getId()===e}));return n&&(n.isPlaying()&&n.stop(),t.splice(t.indexOf(n),1),this.remotes=t),n},e.remoteSetClientInfo=function(e,t){var n=this.remotes,i=n.find((function(t){return t.getId()===e}));i&&(i.clientInfo=t),this.remotes=n},u(e,null,[{key:"editorStreams",set:function(e){this.editorStreams$.next(e)},get:function(){return this.editorStreams$.getValue()}},{key:"editorScreens",set:function(e){this.editorScreens$.next(e)},get:function(){return this.editorScreens$.getValue()}},{key:"local",set:function(e){this.local$.next(e)},get:function(){return this.local$.getValue()}},{key:"screen",set:function(e){this.screen$.next(e)},get:function(){return this.screen$.getValue()}},{key:"remotes",set:function(e){this.remotes$.next(e)},get:function(){return this.remotes$.getValue()}},{key:"peers",set:function(e){this.peers$.next(e)},get:function(){return this.peers$.getValue()}},{key:"publisherStreamId",get:function(){var e=this.remotes.slice(),t=this.local;t&&e.unshift(t);var n=e.find((function(e){return e.clientInfo&&e.clientInfo.role===C.Publisher&&e.clientInfo.uid===e.getId()}));return n?n.getId():null}}]),e}();c(at,"mode",rt),c(at,"editorStreams$",new n.BehaviorSubject(null)),c(at,"editorScreens$",new n.BehaviorSubject(null)),c(at,"local$",new n.BehaviorSubject(null)),c(at,"screen$",new n.BehaviorSubject(null)),c(at,"remotes$",new n.BehaviorSubject([])),c(at,"peers$",new n.BehaviorSubject([])),c(at,"streams$",n.combineLatest([at.local$,at.screen$,at.remotes$,at.getEditorStreams$(),at.getEditorScreens$()]).pipe(i.map((function(e){var t,n,i=e[0],o=e[1],r=e[2],s=e[3],a=e[4],u=r;(i&&(u=u.slice()).push(i),o&&(u=u.slice()).push(o),s)&&(t=u).push.apply(t,s);a&&(n=u).push.apply(n,a);return u})),i.shareReplay(1)));var ut=function(e){function t(n){var i;if(t.AGORA)throw"AgoraService is a singleton";c(h(i=e.call(this)||this),"previousMuteAudio_",!1),i.onStreamPublished=i.onStreamPublished.bind(h(i)),i.onStreamUnpublished=i.onStreamUnpublished.bind(h(i)),i.onStreamAdded=i.onStreamAdded.bind(h(i)),i.onStreamRemoved=i.onStreamRemoved.bind(h(i)),i.onStreamSubscribed=i.onStreamSubscribed.bind(h(i)),i.onMuteVideo=i.onMuteVideo.bind(h(i)),i.onUnmuteVideo=i.onUnmuteVideo.bind(h(i)),i.onMuteAudio=i.onMuteAudio.bind(h(i)),i.onUnmuteAudio=i.onUnmuteAudio.bind(h(i)),i.onVolumeIndicator=i.onVolumeIndicator.bind(h(i)),i.onPeerConnect=i.onPeerConnect.bind(h(i)),i.onPeerLeaved=i.onPeerLeaved.bind(h(i)),i.onConnectionStateChange=i.onConnectionStateChange.bind(h(i)),i.onTokenPrivilegeWillExpire=i.onTokenPrivilegeWillExpire.bind(h(i)),i.onTokenPrivilegeDidExpire=i.onTokenPrivilegeDidExpire.bind(h(i)),i.onMessage=i.onMessage.bind(h(i));var o=I.state;return I.patchState({devices:o.role!==C.Attendee&&n?n:{videos:[],audios:[]},quality:U(o),membersCount:0}),i}d(t,e),t.getSingleton=function(e){if(!m)return this.AGORA||(this.AGORA=new t(e)),this.AGORA};var o=t.prototype;return o.addStreamDevice=function(e){this.removeStreamDevice();var t={deviceId:"video-stream",label:"videostream",kind:"videostream",src:e},n={deviceId:"audio-stream",label:"videostream",kind:"videostream",src:e},i=I.state.devices;i.videos.push(t),i.audios.push(n),I.patchState({devices:i})},o.removeStreamDevice=function(){var e=I.state.devices;e.videos=e.videos.filter((function(e){return"videostream"!==e.kind})),e.audios=e.audios.filter((function(e){return"videostream"!==e.kind})),I.patchState({devices:e})},o.devices$=function(){var e=I.state.devices,i=this.defaultVideos=this.defaultVideos||e.videos.slice(),o=this.defaultAudios=this.defaultAudios||e.videos.slice();return e.videos=i.slice(),e.audios=o.slice(),n.from(new Promise((function(n,i){var o=function(){t.getDevices().then((function(t){r.close();for(var o=0;o<t.length;o++){var s=t[o];"videoinput"===s.kind&&s.deviceId&&e.videos.push({label:s.label||"camera-"+e.videos.length,deviceId:s.deviceId,kind:s.kind}),"audioinput"===s.kind&&s.deviceId&&e.audios.push({label:s.label||"microphone-"+e.audios.length,deviceId:s.deviceId,kind:s.kind})}e.videos.length>0||e.audios.length>0?n(e):i(e)})).catch((function(e){i(e)}))},r=AgoraRTC.createStream({audio:!0,video:!0});r.init((function(){o()}),(function(){o()}))})))},o.connect$=function(e){var n=this,i=I.state.devices;return e&&(i.video=e.video,i.audio=e.audio),I.state.connecting||(I.patchState({status:G,connecting:!0,devices:i}),setTimeout((function(){n.createClient((function(){var e=n.getChannelNameLink();t.rtcToken$(e).subscribe((function(t){n.join(t.token,e)}))}))}),250)),I.state$},o.membersCount$=function(e){var t=this.messageClient;return n.interval(2e3).pipe(i.switchMap((function(){return n.from(t.getChannelMemberCount([e]))})),i.map((function(t){return t[e]})),i.distinctUntilChanged())},o.observeMemberCount=function(){this.unobserveMemberCount(),this.membersCountSubscription=this.membersCount$(I.state.channelNameLink).subscribe((function(e){I.patchState({membersCount:e})}))},o.unobserveMemberCount=function(){this.membersCountSubscription&&(this.membersCountSubscription.unsubscribe(),this.membersCountSubscription=null,I.patchState({membersCount:0}))},o.createClient=function(e){var t=this;this.client&&e(),AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.NONE);var n=this.client=AgoraRTC.createClient({mode:"live",codec:"h264"}),i=function(){k.flags.useProxy&&(n.startProxyServer(3),console.log("AgoraService.client.startProxyServer")),n.init(k.appKey,(function(){e()}),(function(e){t.client=null}))};this.isAudienceRole?n.setClientRole("audience",(function(e){e||i()})):i(),n.on("error",this.onError),n.on("stream-published",this.onStreamPublished),n.on("stream-unpublished",this.onStreamUnpublished),n.on("stream-added",this.onStreamAdded),n.on("stream-removed",this.onStreamRemoved),n.on("stream-subscribed",this.onStreamSubscribed),n.on("mute-video",this.onMuteVideo),n.on("unmute-video",this.onUnmuteVideo),n.on("mute-audio",this.onMuteAudio),n.on("unmute-audio",this.onUnmuteAudio),n.on("peer-online",this.onPeerConnect),n.on("peer-leave",this.onPeerLeaved),n.on("onTokenPrivilegeWillExpire",this.onTokenPrivilegeWillExpire),n.on("onTokenPrivilegeDidExpire",this.onTokenPrivilegeDidExpire),(this.messageClient=AgoraRTM.createInstance(k.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF})).setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF})},o.getChannelNameLink=function(){var e=I.state.link||"",t=e.match(/(\d{9})-(\d{4})-(\d{13})/);return t&&(e=t[1]+"-"+t[3]),I.state.channelName+"-"+e},t.getUniqueUserId=function(){return(1e13*(100*(1+Math.floor(8*Math.random()))+10*(1+Math.floor(8*Math.random()))+1*(1+Math.floor(8*Math.random())))+Date.now()).toString()},o.join=function(e,n){var i=this;this.channel=null;var o=this.client,r=ot.get("bHereClientId")||t.getUniqueUserId();o.join(e,n,r,(function(e){I.patchState({status:q,channelNameLink:n,connected:!0,uid:e}),ot.set("bHereClientId",e),t.rtmToken$(e).subscribe((function(t){i.joinMessageChannel(t.token,e).then((function(t){i.isAudienceRole||i.autoDetectDevice().then((function(t){i.createMediaStream(e,t.video,t.audio)})),i.observeMemberCount()}),(function(e){console.log("joinMessageChannel.error",e)}))}))}),(function(e){console.log("AgoraService.join.error",e),"DYNAMIC_KEY_EXPIRED"===e&&t.rtcToken$(n).subscribe((function(e){i.join(e.token,n)}))}))},o.joinMessageChannel=function(e,t){var n,i=this;return new Promise((function(o,r){var s=i.messageClient;s.login({token:e,uid:t.toString()}).then((function(){return(n=s.createChannel(I.state.channelNameLink)).join()})).then((function(){i.channel=n,n.on("ChannelMessage",i.onMessage),i.emit("channel",n),o(t),n.getMembers().then((function(e){e=e.filter((function(e){return e!==t.toString()}));var n={type:K,members:e};i.broadcastMessage(n)}))})).catch(r)}))},o.detectDevices=function(e){t.getDevices().then((function(t){for(var n=[],i=[],o=0;o<t.length;o++){var r=t[o];"videoinput"==r.kind&&n.push({label:r.label||"camera-"+n.length,deviceId:r.deviceId,kind:r.kind}),"audioinput"==r.kind&&i.push({label:r.label||"microphone-"+n.length,deviceId:r.deviceId,kind:r.kind})}e({videos:n,audios:i})})).catch((function(e){console.log("AgoraService.detectDevices",e)}))},o.getVideoOptions=function(e,t){return new Promise((function(n,i){if(t)if("videostream"===t.kind){var o=document.querySelector("#"+t.deviceId);o.crossOrigin="anonymous";var r=new Hls;r.attachMedia(o),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(t.src),r.on(Hls.Events.MANIFEST_PARSED,(function(t,i){o.play().then((function(t){var i=o.captureStream();e.videoSource=i.getVideoTracks()[0],n(e)}),(function(e){console.log("AgoraService.getVideoOptions.error",e)}))}))}))}else if("videoplayer"===t.kind||"videostream"===t.kind){var s=document.querySelector("#"+t.deviceId);s.crossOrigin="anonymous";var a=s.captureStream();e.videoSource=a.getVideoTracks()[0],n(e)}else e.cameraId=t.deviceId,n(e);else n(e)}))},o.getAudioOptions=function(e,t){return new Promise((function(n,i){if(t)if("videostream"===t.kind){var o=document.querySelector("#"+t.deviceId);o.crossOrigin="anonymous";var r=new Hls;r.attachMedia(o),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(t.src),r.on(Hls.Events.MANIFEST_PARSED,(function(t,i){r.loadLevel=i.levels.length-1,o.play().then((function(t){var i=o.captureStream();e.audioSource=i.getAudioTracks()[0],n(e)}),(function(e){console.log("AgoraService.getAudioOptions.error",e)}))}))}))}else if("videoplayer"===t.kind||"videostream"===t.kind){var s=document.querySelector("#"+t.deviceId);s.crossOrigin="anonymous";var a=s.captureStream();e.audioSource=a.getAudioTracks()[0],n(e)}else e.microphoneId=t.deviceId,n(e);else n(e)}))},o.autoDetectDevice=function(){return new Promise((function(e,n){var i=I.state;i.role===C.SmartDevice?t.getDevices().then((function(t){var n={videos:[],audios:[],video:null,audio:null};t.forEach((function(e){"videoinput"===e.kind?n.videos.push(e):"audioinput"===e.kind&&n.audios.push(e)})),n.video=n.videos[0]||null,n.audio=n.audios[0]||null,I.patchState({devices:n}),e(n)})).catch((function(e){n(e)})):e(i.devices)}))},o.createMediaStream=function(e,t,n){var i=this,o={streamID:e,video:Boolean(t),audio:Boolean(n),screen:!1};Promise.all([this.getVideoOptions(o,t),this.getAudioOptions(o,n)]).then((function(e){var t=Object.assign({},I.state.quality);i.createLocalStreamWithOptions(o,t)}))},o.createLocalStreamWithOptions=function(e,t){var n=this,i=AgoraRTC.createStream(e);t&&i.setVideoProfile(t.profile),i.init((function(){at.local=i,setTimeout((function(){n.publishLocalStream()}),1)}),(function(e){console.log("AgoraService.initLocalStream.init.error",e)}))},o.initLocalStream=function(){var e=this;at.local.init((function(){e.publishLocalStream()}),(function(e){console.log("AgoraService.initLocalStream.init.error",e)}))},o.publishLocalStream=function(){var e=this.client,t=at.local;e.publish(t,(function(e){console.log("AgoraService.publishLocalStream.error",t.getId(),e)})),t.clientInfo={role:I.state.role,name:I.state.name,uid:I.state.uid,screenUid:I.state.screenUid},at.local=t},o.unpublishLocalStream=function(){var e=this.client,t=at.local;t&&e.unpublish(t,(function(e){console.log("AgoraService.unpublishLocalStream.error",t.getId(),e)})),at.local=null},o.leaveChannel=function(){var e=this;return I.patchState({connecting:!1}),this.unpublishLocalStream(),this.unpublishScreenStream(),at.remotes=[],at.peers=[],new Promise((function(t,n){e.leaveMessageChannel().then((function(){Promise.all([e.leaveClient(),e.leaveScreenClient()]).then((function(){t()})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))}))},o.leaveClient=function(){var e=this;return new Promise((function(t,n){var i=e.client;i?i.leave((function(){e.client=null,k.flags.useProxy&&(i.stopProxyServer(),console.log("AgoraService.client.stopProxyServer")),t()}),(function(e){console.log("AgoraService.leaveClient.error",e),n(e)})):t()}))},o.leaveMessageChannel=function(){var e=this;return new Promise((function(t,n){e.unobserveMemberCount();var i=e.channel;if(!i)return t();var o=e.messageClient;i.leave().then((function(){e.channel=null,o.logout().then((function(){e.messageClient=null,t()}),n)}),n)}))},o.toggleCamera=function(){var e=at.local;e&&e.video&&(e.userMuteVideo?(e.unmuteVideo(),I.patchState({cameraMuted:!1}),this.broadcastEvent(new je({streamId:e.getId()}))):(e.muteVideo(),I.patchState({cameraMuted:!0}),this.broadcastEvent(new Ve({streamId:e.getId()}))))},o.toggleAudio=function(){var e=at.local;e&&e.audio&&(e.userMuteAudio?(e.unmuteAudio(),I.patchState({audioMuted:!1}),this.broadcastEvent(new Ne({streamId:e.getId()}))):(e.muteAudio(),I.patchState({audioMuted:!0}),this.broadcastEvent(new Be({streamId:e.getId()}))))},o.setAudio=function(e){var t=at.local;t&&t.audio&&(e?(this.previousMuteAudio_=t.userMuteAudio,t.userMuteAudio||(t.muteAudio(),I.patchState({audioMuted:!0}),this.broadcastEvent(new Be({streamId:t.getId()})))):t.userMuteAudio&&!this.previousMuteAudio_&&(t.unmuteAudio(),I.patchState({audioMuted:!1}),this.broadcastEvent(new Ne({streamId:t.getId()}))))},o.toggleMode=function(){var e=I.state.mode===Le?Pe:Le;I.patchState({mode:e}),Ye.send({type:ye,mode:e})},o.toggleNavInfo=function(){var e=!I.state.showNavInfo;I.patchState({showNavInfo:e}),Ye.send({type:be,showNavInfo:e})},o.dismissControl=function(){var e=this;return new Promise((function(t,n){var i=I.state.controlling;i?e.sendRemoteControlDismiss(i).then((function(){I.patchState({controlling:!1}),t(i)})):t(!1)}))},o.requestControl=function(e){var t=this;return new Promise((function(n,i){t.sendRemoteControlRequest(e).then((function(e){I.patchState({controlling:e}),n(e)}))}))},o.toggleControl=function(e){var t=this;this.dismissSpy().then((function(){t.dismissControl().then((function(n){n!==e&&t.requestControl(e).then((function(e){}))}))}))},o.toggleSilence=function(){var e=!I.state.silencing;this.sendMessage({type:le,silencing:e}),I.patchState({silencing:e})},o.dismissSpy=function(){var e=this;return new Promise((function(t,n){var i=I.state.spying;i?e.sendRemoteSpyDismiss(i).then((function(){I.patchState({spying:!1}),t(i)})):t(!1)}))},o.requestSpy=function(e){var t=this;return new Promise((function(n,i){t.sendSpyRemoteRequestInfo(e).then((function(){I.patchState({spying:e}),n(e)}))}))},o.toggleSpy=function(e){var t=this;this.dismissControl().then((function(){t.dismissSpy().then((function(n){n!==e&&t.requestSpy(e).then((function(e){console.log("AgoraService.toggleSpy",e)}))}))}))},o.sendRemoteRequestPeerInfo=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:ie,messageId:t.newMessageId(),remoteId:e}).then((function(e){if(e.type===oe){if(e.clientInfo.role===C.Publisher){var i={hosted:!0};e.clientInfo.controllingId&&(i.controlling=e.clientInfo.controllingId,i.mode=e.clientInfo.mode,t.sendControlRemoteRequestInfo(e.clientInfo.controllingId)),I.patchState(i)}n(e)}}))}))},o.sendRemoteControlRequest=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:J,messageId:t.newMessageId(),controllingId:e}).then((function(t){t.type===Q?n(e):t.type===ee&&n(!1)}))}))},o.sendRemoteControlDismiss=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:te,messageId:t.newMessageId(),controllingId:e}).then((function(t){t.type===ne?n(e):t.type===ee&&n(!1)}))}))},o.sendControlRemoteRequestInfo=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:re,messageId:t.newMessageId(),remoteId:e}).then((function(t){t.type===se&&(I.patchState({controlling:e}),n(t))}))}))},o.sendSpyRemoteRequestInfo=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:re,messageId:t.newMessageId(),remoteId:e}).then((function(t){t.type===se&&(I.patchState({spying:e}),n(t))}))}))},o.sendRemoteSpyDismiss=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:ae,messageId:t.newMessageId(),remoteId:e}).then((function(t){t.type===ue?n(e):t.type===ce&&n(!1)}))}))},o.newMessageId=function(){return I.state.uid+"-"+Date.now().toString()},o.navToView=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1),I.state.controlling!==I.state.uid&&I.state.spying!==I.state.uid||this.sendMessage({type:we,viewId:e,keepOrientation:t,useLastOrientation:n})},o.getSessionStats=function(){this.client.getSessionStats((function(e){console.log("Current Session Duration: "+e.Duration),console.log("Current Session UserCount: "+e.UserCount),console.log("Current Session SendBytes: "+e.SendBytes),console.log("Current Session RecvBytes: "+e.RecvBytes),console.log("Current Session SendBitrate: "+e.SendBitrate),console.log("Current Session RecvBitrate: "+e.RecvBitrate)}))},o.getSystemStats=function(){this.client.getSystemStats((function(e){console.log("Current battery level: "+e.BatteryLevel)}))},o.sendMessage=function(e){var t=this;return new Promise((function(n,i){if(I.state.connected){switch(e.clientId=I.state.uid,e.type){case de:case xe:case pe:case fe:case me:case ve:case ge:case ye:case be:case Ee:case Se:if(I.state.controlling!==I.state.uid&&I.state.spying!==I.state.uid)return}var o=function(e,i){try{var o=JSON.stringify(e);e.messageId&&t.once("message-"+e.messageId,(function(e){n(e)})),i.sendMessage({text:o}).then((function(){e.messageId||n(e)})).catch((function(e){console.log("AgoraService.sendMessage.error",e)}))}catch(e){console.log("AgoraService.sendMessage.error",e)}},r=t.channel;if(r)o(e,r);else try{t.once("channel",(function(t){o(e,t)}))}catch(e){i(e)}}}))},o.addOrUpdateChannelAttributes=function(e){var t=this.messageClient;if(t){var i={};if(e.forEach((function(e){var t=e.date.toString();i[t]=JSON.stringify(e)})),Object.keys(i).length){var o=t.addOrUpdateChannelAttributes(I.state.channelNameLink,i,{enableNotificationToChannelMembers:!1});return n.from(o)}return n.of(null)}return n.of(null)},o.getChannelAttributes=function(){var e=this.messageClient;if(e){var t=e.getChannelAttributes(I.state.channelNameLink);return n.from(t).pipe(i.map((function(e){return Object.keys(e).map((function(t){return e[t]}))})),i.map((function(e){return e.sort((function(e,t){return e.lastUpdateTs-t.lastUpdateTs})),e.map((function(e){return JSON.parse(e.value)}))})))}return n.of(null)},o.checkBroadcastMessage=function(e){switch(e.type){case te:I.patchState({controlling:!1}),e.controllingId===I.state.uid&&this.unpublishScreenStream(),this.sendMessage({type:ne,messageId:e.messageId});break;case ae:I.patchState({spying:!1}),this.sendMessage({type:ue,messageId:e.messageId,remoteId:e.remoteId});break;case se:(I.state.role===C.Publisher||I.state.controlling&&I.state.controlling!==I.state.uid)&&this.broadcastMessage(e);break;case le:I.state.role===C.Streamer&&this.broadcastMessage(e);break;case de:case pe:case fe:case me:case ve:case ge:case ye:case be:case we:case xe:case Ee:case Se:(I.state.controlling&&I.state.controlling!==I.state.uid||I.state.spying&&I.state.spying!==I.state.uid)&&this.broadcastMessage(e);break;default:this.broadcastMessage(e)}},o.broadcastMessage=function(e){Ye.out(e)},o.broadcastEvent=function(e){Ye.out({type:W,event:e})},o.onMessage=function(e,t){if(t!==I.state.uid){var n=JSON.parse(e.text);if(n.messageId&&this.has("message-"+n.messageId)&&this.emit("message-"+n.messageId,n),n.remoteId&&n.remoteId!==I.state.uid&&n.remoteId!==I.state.screenUid)return;if(n.type===Te){var i=document.createElement("div");i.classList.add("player__vr"),n.container=i}this.checkBroadcastMessage(n)}},o.onError=function(e){console.log("AgoraService.onError",e)},o.onStreamPublished=function(e){var t=at.local;t.clientInfo={role:I.state.role,name:I.state.name,uid:I.state.uid,screenUid:I.state.screenUid},at.local=t},o.onStreamUnpublished=function(e){at.local=null},o.onStreamAdded=function(e){var t=this.client,n=e.stream;if(n){var i=n.getId();i!==I.state.uid&&i!==I.state.screenUid&&t.subscribe(n,(function(e){console.log("AgoraService.onStreamAdded.subscribe.error",e)}))}},o.onStreamRemoved=function(e){var t=e.stream.getId();t!==I.state.uid&&t!==I.state.screenUid&&this.remoteRemove(t)},o.onStreamSubscribed=function(e){this.remoteAdd(e.stream)},o.onPeerConnect=function(e){this.peerAdd(e)},o.onPeerLeaved=function(e){var t=e.uid;if(t!==I.state.uid){var n=this.remoteRemove(t);n.clientInfo&&(n.clientInfo.role===C.Publisher?I.state.role===C.SelfService?I.patchState({hosted:!0,controlling:!1,spying:!1,silencing:!1}):I.patchState({hosted:!1,controlling:!1,spying:!1,silencing:!1}):(I.state.controlling===t&&I.patchState({controlling:!1}),I.state.spying===t&&I.patchState({spying:!1})))}this.peerRemove(t)},o.peerAdd=function(e){var t={uid:e.uid},n=at.peers;n.push(t),at.peers=n,this.broadcastEvent(new De({peer:t}))},o.peerRemove=function(e){var t=at.peers,n=t.find((function(t){return t.uid===e}));n&&(t.splice(t.indexOf(n),1),at.peers=t)},o.remoteAdd=function(e){at.remoteAdd(e),this.broadcastEvent(new Fe({stream:e}));var t=e.getId();this.sendRemoteRequestPeerInfo(t).then((function(e){at.remoteSetClientInfo(t,e.clientInfo)}))},o.remoteRemove=function(e){var t=at.remoteRemove(e);return t&&t.clientInfo&&t.clientInfo.role===C.Publisher&&t.clientInfo.screenUid!==e&&I.patchState({hosted:!1}),t},o.onMuteVideo=function(e){this.broadcastEvent(new Ve({streamId:e.uid}))},o.onUnmuteVideo=function(e){this.broadcastEvent(new je({streamId:e.uid}))},o.onMuteAudio=function(e){this.broadcastEvent(new Be({streamId:e.uid}))},o.onUnmuteAudio=function(e){this.broadcastEvent(new Ne({streamId:e.uid}))},o.onVolumeIndicator=function(e){var t=e.attr.map((function(e){return{streamId:e.uid,level:e.level}}));this.broadcastEvent(new ze({streams:t}))},o.onConnectionStateChange=function(e){console.log("AgoraService.onConnectionStateChange",e)},o.onTokenPrivilegeWillExpire=function(e){console.log("AgoraService.onTokenPrivilegeWillExpire");var n=this.client,i=this.getChannelNameLink();t.rtcToken$(i).subscribe((function(e){e.token&&(n.renewToken(e.token),console.log("AgoraService.onTokenPrivilegeWillExpire.renewed"))}))},o.onTokenPrivilegeDidExpire=function(e){console.log("AgoraService.onTokenPrivilegeDidExpire");var n=this.client,i=this.getChannelNameLink();t.rtcToken$(i).subscribe((function(e){e.token&&(n.renewToken(e.token),console.log("AgoraService.onTokenPrivilegeDidExpire.renewed"))}))},o.toggleScreen=function(){var e=this;at.screen?this.unpublishScreenStream():this.screenClient?this.createScreenStream(I.state.screenUid):this.createScreenClient((function(){var n=e.getChannelNameLink();t.rtcToken$(n).subscribe((function(t){e.screenJoin(t.token,n)}))}))},o.createScreenClient=function(e){var t=this;this.screenClient&&e();var n=this.screenClient=AgoraRTC.createClient({mode:"live",codec:"h264"});k.flags.useProxy&&(n.startProxyServer(3),console.log("AgoraService.screenClient.startProxyServer")),n.init(k.appKey,(function(){e()}),(function(e){t.screenClient=null})),n.on("error",this.onScreenError),n.on("stream-published",this.onScreenStreamPublished),n.on("stream-unpublished",this.onScreenStreamUnpublished)},o.screenJoin=function(e,n){var i=this,o=this.screenClient,r=t.getUniqueUserId();o.join(e,n,r,(function(e){I.patchState({screenUid:e}),i.createScreenStream(e)}),(function(e){console.log("AgoraService.screenJoin.error",e),"DYNAMIC_KEY_EXPIRED"===e&&t.rtcToken$(n).subscribe((function(e){i.screenJoin(e.token,n)}))}))},o.createScreenStream=function(e){var t=this,n={streamID:e,audio:!1,video:!1,screen:!0},i=AgoraRTC.createStream(n);i.setScreenProfile(k.profiles.screen),console.log("AgoraService.createScreenStream",n);var o=function(){t.unpublishScreenStream()};i.init((function(){at.screen=i,i.on("stopScreenSharing",o),i.muteAudio(),setTimeout((function(){t.publishScreenStream()}),1)}),(function(e){console.log("AgoraService.createScreenStream.screen.init.error",e)}))},o.publishScreenStream=function(){var e=this.screenClient,t=at.screen;e.publish(t,(function(e){console.log("AgoraService.publishScreenStream.error",t.getId(),e)})),t.clientInfo={role:I.state.role,name:I.state.name,uid:I.state.uid,screenUid:I.state.screenUid},at.screen=t},o.unpublishScreenStream=function(){var e=this.screenClient,t=at.screen;e&&t&&e.unpublish(t,(function(e){console.log("AgoraService.unpublishScreenStream.error",t.getId(),e)})),at.screen=null},o.leaveScreenClient=function(){var e=this;return new Promise((function(t,n){var i=e.screenClient;i?i.leave((function(){e.screenClient=null,k.flags.useProxy&&(i.stopProxyServer(),console.log("AgoraService.screenClient.stopProxyServer")),t()}),(function(e){console.log("AgoraService.leaveScreenClient.error",e),n(e)})):t()}))},o.onScreenError=function(e){console.log("AgoraService.onScreenError",e)},o.onScreenStreamPublished=function(e){var t=at.screen;t.clientInfo={role:I.state.role,name:I.state.name,uid:I.state.uid,screenUid:I.state.screenUid},at.screen=t},o.onScreenStreamUnpublished=function(e){at.screen=null},t.rtcToken$=function(e){return k.flags.useToken?Ge.post$("/api/token/rtc",{channelName:e,uid:null}):n.of({token:null})},t.rtmToken$=function(e){return k.flags.useToken?Ge.post$("/api/token/rtm",{uid:e}):n.of({token:null})},t.checkRtcConnection=function(){return new Promise((function(e,n){try{var i=AgoraRTC.createClient({mode:"live",codec:"h264"});k.flags.useProxy&&i.startProxyServer(3),i.init(k.appKey,(function(){t.checkRtcTryJoin(i).then((function(t){e(t)})).catch((function(e){n(e)})).finally((function(){i.leave((function(){k.flags.useProxy&&i.stopProxyServer()}),(function(){}))}))}),(function(e){n(e)}))}catch(e){n(e)}}))},t.checkRtcTryJoin=function(e){return new Promise((function(n,i){var o="checkRtcConnection";t.rtcToken$(o).subscribe((function(r){e.join(r.token,o,null,(function(e){n(e)}),(function(n){if("DYNAMIC_KEY_EXPIRED"===n)return t.checkRtcTryJoin(e);console.log("AgoraService.checkRtcConnection.error",n),i(n)}))}),(function(e){return i(e)}))}))},t.checkRtmConnection=function(e){return new Promise((function(n,i){try{var o,r=AgoraRTM.createInstance(k.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF});r.setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF}),t.rtmToken$(e).subscribe((function(t){r.login({token:t.token,uid:e.toString()}).then((function(){(o=r.createChannel("checkRtcConnection")).join().then((function(){n(e),o.leave()})).catch((function(e){i(e)})).finally((function(){o.leave().then((function(){o=null,r.logout().then((function(){r=null})).catch((function(){}))})).catch((function(){}))}))})).catch((function(e){i(e)})).finally((function(){r&&r.logout().then((function(){r=null})).catch((function(){}))}))}),(function(e){return i(e)}))}catch(e){i(e)}}))},t.getDevices=function(){return new Promise((function(e,n){var i=t.devices_;if(i)e(i);else{i=t.devices_=[];var o={audio:!0,video:!0};nt.platform===Je&&(o.video={facingMode:"user"}),nt.platform===tt&&(o.video=!1),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(o).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){t.getTracks().forEach((function(e){e.stop()})),n.forEach((function(e){i.push(e)})),e(i)})).catch((function(e){n(e)}))})).catch((function(e){n(e)})):n("Media device not available")}}))},u(t,[{key:"isAudienceRole",get:function(){return I.state.role===C.Viewer||I.state.role===C.SelfService}}]),t}(it),ct=function(){function e(e,t,n){this.type=Ce,this.clientId_=t,"string"==typeof e?(this.date=Date.now(),this.clientId=t,this.name=n,this.message=e):"object"==typeof e&&(this.date=e.date,this.clientId=e.clientId,this.name=e.name,this.message=e.message);var i=this.name.split(" ");this.shortName=i[0].substr(0,1).toUpperCase()+(i.length>1?i[1]:i[0]).substr(0,1).toUpperCase()}var t=e.prototype;return t.getPayload=function(){return{date:this.date,clientId:this.clientId,name:this.name,message:this.message}},t.getCopy=function(){return new e({date:this.date,clientId:this.clientId,name:this.name,message:this.message},this.clientId_)},u(e,[{key:"me",get:function(){return this.clientId===this.clientId_}}]),e}(),lt=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this;this.rows=1,this.showEmoji=!1,this.demo=-1!==window.location.pathname.indexOf("b-here-layout.html");var n=this.form=new t.FormGroup({message:null});this.controls=n.controls;if(n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.checkTypings(t),e.pushChanges()})),I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){})),Ye.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case Ce:e.pushMessage(new ct(t,I.state.uid,I.state.name));break;case Re:e.typingBegin(t);break;case Ae:e.typingEnd(t)}})),this.messages=[],this.groupedMessages=[],this.demo){var r=o.getFakeList().map((function(e){return new ct(e,I.state.uid,I.state.name)}));this.updateMessages(r.slice(0,5)),Ye.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.clientId=e.clientId||I.state.uid,e.type){case Ce:break;case Re:case Ae:Ye.out(e)}}))}else{var s=this.agora=ut.getSingleton();s&&s.getChannelAttributes().pipe(i.first()).subscribe((function(t){t=t.map((function(e){return new ct(e,I.state.uid,I.state.name)})),e.updateMessages(t)}))}},r.onView=function(){},r.onChanges=function(){},r.onDestroy=function(){o.to&&(clearTimeout(o.to),o.to=null)},r.onSubmit=function(){var e=this.secureText(this.form.value.message),t=this.createMessage(e);this.sendMessage(t),this.form.get("message").value=null,this.demo},r.onKeyDown=function(t){"Enter"===t.key&&(t.shiftKey?(this.rows=Math.min(4,this.rows+1),this.pushChanges()):(t.preventDefault(),this.onSubmit(),this.rows=1),e.getContext(this).node.querySelector("textarea").setAttribute("rows",this.rows))},r.onToggleEmoji=function(){this.showEmoji=!this.showEmoji,this.pushChanges()},r.onSelectEmoji=function(e){this.showEmoji=!1,this.form.get("message").value=(this.form.get("message").value||"")+e.char},r.secureText=function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""},r.createMessage=function(e){return new ct(e,I.state.uid,I.state.name)},r.sendMessage=function(e){this.pushMessage(e);var t=this.agora;t&&t.addOrUpdateChannelAttributes([e.getPayload()]).pipe(i.first()).subscribe(),Ye.send(e)},r.onClose=function(e){this.close.next()},r.scrollToBottom=function(){var t=e.getContext(this).node.querySelector(".group--scrollview");t.scrollTop=t.scrollHeight},r.pushMessage=function(e){var t=this.messages?this.messages.slice():[];this.removeTyping({type:Re,clientId:e.clientId},this.messages),t.push(e),this.updateMessages(t)},r.typingBegin=function(e){var t=this.messages?this.messages.slice():[];t.push(e),this.updateMessages(t)},r.typingEnd=function(e){var t=this.messages?this.messages.slice():[];this.removeTyping({type:Re,clientId:e.clientId},t),this.updateMessages(t)},r.removeTyping=function(e,t,n){void 0===n&&(n=!0);var i=t.reduce((function(t,n,i){return n.type===e.type&&n.clientId===e.clientId?i:t}),-1);return-1!==i&&(t.splice(i,1),!0===n&&this.removeTyping(e,t,!0)),i},r.checkTypings=function(e){var t=e.message&&e.message.length>0;this.typings_!==t&&(this.typings_=t,t?Ye.send({type:Re}):Ye.send({type:Ae}))},r.updateMessages=function(e){var t=this;this.messages=e,this.groupedMessages=[],this.pushChanges();var n=[];e.forEach((function(e){if(e.type===Ce){var t=n.length?n[n.length-1]:null;t&&t.clientId===e.clientId?t.message+="<p>"+e.message+"</p>":n.push(e.getCopy())}else if(e.type===Re){var i=n.reduce((function(t,n,i){return n.clientId===e.clientId?n:t}),null);i&&(i.typing=!0)}})),this.groupedMessages=n,this.pushChanges(),setTimeout((function(){t.scrollToBottom()}),1)},r.isValid=function(){var e=this.form.valid;return e&&this.form.value.message&&this.form.value.message.length>0},r.randomMessage=function(){var e=this;o.to&&(clearTimeout(o.to),o.to=null),o.to=setTimeout((function(){var t=o.createRandomMessage();e.sendMessage(t)}),1e3*(2+6*Math.random()))},o}(e.Component);lt.meta={selector:"[agora-chat]",outputs:["close"]},lt.getFakeList=function(){for(var e=[{date:161459223e4,name:"Jhon Appleseed",message:"Function-based web-enabled benchmark",clientId:"7341614597544882"},{date:161459224e4,name:"Jhon Appleseed",message:"Customizable exuding superstructure",clientId:"7341614597544882"},{date:161459225e4,name:"Gilles Pitkins",message:"Synergistic interactive archive",clientId:"cfe9ff5b-f7da-449d-bf5a-3184b5eba6ea"},{date:161459226e4,name:"Jhon Appleseed",message:"Digitized client-server initiative",clientId:"7341614597544882"},{date:161459227e4,name:"Jhon Appleseed",message:"Quality-focused tertiary open system",clientId:"7341614597544882"},{date:161459228e4,name:"Jhon Appleseed",message:"Exclusive uniform middleware",clientId:"7341614597544882"},{date:161459229e4,name:"John Pruckner",message:"Decentralized disintermediate extranet",clientId:"ae51e846-d043-41e9-bb5c-3189181e5b43"},{date:16145923e5,name:"Lamont Georgievski",message:"Enhanced static approach",clientId:"1961cd9e-93aa-4bd0-b96a-89fcbd36b257"},{date:161459231e4,name:"Jhon Appleseed",message:"Ergonomic clear-thinking info-mediaries",clientId:"7341614597544882"},{date:161459232e4,name:"Jeri Pedroni",message:"Grass-roots dynamic encryption",clientId:"13d69bba-3656-449b-8fe3-d7a87062b044"},{date:161459233e4,name:"Frederik Dechelle",message:"Compatible disintermediate policy",clientId:"9151ebe0-efa8-40b4-a341-b8fd489e9c88"},{date:161459234e4,name:"Jhon Appleseed",message:"Inverse user-facing adapter",clientId:"7341614597544882"},{date:161459235e4,name:"Jhon Appleseed",message:"Future-proofed even-keeled application",clientId:"7341614597544882"},{date:161459236e4,name:"Cassie Jonathon",message:"Profit-focused content-based budgetary management",clientId:"5b3dc6f3-2a3d-493d-aac5-66ddfce2d709"},{date:161459237e4,name:"Jhon Appleseed",message:"Managed intermediate monitoring",clientId:"7341614597544882"},{date:161459238e4,name:"Jhon Appleseed",message:"Exclusive client-server encoding",clientId:"7341614597544882"},{date:161459239e4,name:"Jhon Appleseed",message:"Cross-group system-worthy matrices",clientId:"7341614597544882"},{date:16145924e5,name:"Jhon Appleseed",message:"Upgradable encompassing benchmark",clientId:"7341614597544882"},{date:161459241e4,name:"Emelen Beevors",message:"Function-based full-range knowledge base",clientId:"c93aea47-ebd8-4e5e-88fd-52053dd35cd1"},{date:161459242e4,name:"Jhon Appleseed",message:"Synergistic system-worthy capability",clientId:"7341614597544882"}];e.length<100;)e=e.concat(e);return e},lt.createRandomMessage=function(e){return new ct({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:"Herman frederick",message:"Lorem ipsum dolor"},I.state.uid,I.state.name)},lt.randomMessage=function(e,t){lt.to&&(clearTimeout(lt.to),lt.to=null),lt.to=setTimeout((function(){var n=function(){var e=t.filter((function(e){return"7341614597544882"!==e.id})),n=e[Math.floor(e.length*Math.random())];return new ct({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:n.name,message:n.message},I.state.uid,I.state.name)}();e.sendMessage(n),lt.randomMessage(e,t)}),1e3*(2+6*Math.random()))};var dt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(e.Component);dt.meta={selector:"[agora-check]",inputs:["value"],template:'\n\t\t<svg *if="value == null" class="checkmark idle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t</svg>\n\t\t<svg *if="value === true" class="checkmark success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" stroke-linecap="round"/>\n\t\t</svg>\n\t\t<svg *if="value === false" class="checkmark error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" stroke-linecap="round" fill="none" d="M16 16 36 36 M36 16 16 36"/>\n\t\t</svg>\n\t'};var ht=function(e){this.data=e},pt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(ht),ft=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(ht),mt=function(){function e(){}return e.open$=function(e){var t=this;return(e.iframe?n.of('<div class="iframe-modal" iframe-modal>\n\t\t\t\t\t<div class="modal__header">\n\t\t\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="modal__content">\n\t\t\t\t\t<iframe src="'+e.iframe+'"></iframe>\n\t\t\t\t</div>\n\t\t\t</div>'):this.getTemplate$(e.src)).pipe(i.map((function(n){return{node:t.getNode(n),data:e.data,modal:e}})),i.tap((function(e){t.modal$.next(e),t.hasModal=!0})),i.switchMap((function(e){return t.events$})),i.tap((function(e){return t.hasModal=!1})))},e.load$=function(e){},e.getTemplate$=function(e){return n.from(fetch(e).then((function(e){return e.text()})))},e.getNode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},e.reject=function(e){this.modal$.next(null),this.events$.next(new ft(e))},e.resolve=function(e){this.modal$.next(null),this.events$.next(new pt(e))},e}();c(mt,"hasModal",!1),mt.modal$=new n.Subject,mt.events$=new n.Subject;var vt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){return t.labels_[e]||e},t.getKeys=function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return t.transform(n.map((function(e){return e.replace("-","_")})).join("_"))},t.setLabels=function(){var e,t=p.merge(((e={browse:"Browse",cancel:"Cancel",drag_and_drop_images:"Drag And Drop your images here",error_email:"Invalid email",error_match:"Fields do not match",error_required:"Field is required",loading:"loading",remove:"Remove",required:"Required",select:"Select",select_file:"Select a file...",update:"Update",upload:"Upload",waiting_host:"waiting host",editor_image:"Image",editor_video:"Video",editor_model:"Model",editor_publisher_stream:"Publisher Stream",editor_next_attendee_stream:"Next Attendee Stream",editor_waiting_room:"Waiting Room",editor_panorama:"Panorama",editor_panorama_grid:"Panorama Grid",editor_room_3d:"Room 3D"}).editor_model="Model",e.editor_nav="Nav Tooltip",e.editor_gltf="Gltf Model",e.editor_plane="Plane",e.editor_curved_plane="Curved Plane",e.editor_texture="Texture",e),window.labels);this.labels_=t},t}(e.Pipe);vt.setLabels(),vt.meta={name:"label"};var gt=function(){function e(){}return e.delete=function(e){this.isLocalStorageSupported()&&window.localStorage.removeItem(e)},e.exist=function(e){if(this.isLocalStorageSupported())return void 0!==window.localStorage[e]},e.get=function(e){var t=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[e])try{t=JSON.parse(window.localStorage[e])}catch(t){console.log("LocalStorageService.get.error parsing",e,t)}return t},e.set=function(e,t){if(this.isLocalStorageSupported())try{var n=[],i=JSON.stringify(t,(function(e,t){if("object"==typeof t&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}));window.localStorage.setItem(e,i)}catch(n){console.log("LocalStorageService.set.error serializing",e,t,n)}},e.isLocalStorageSupported=function(){if(this.supported)return!0;var e=!1;try{(e="localStorage"in window&&null!==window.localStorage)?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):e=!1}catch(t){e=!1}return this.supported=e,e},e}(),yt=100,bt=function(){function e(){}return e.checklist$=function(){return I.state$.pipe(i.first(),i.map((function(e){var t={shouldCheckAudio:!0,shouldCheckVideo:!0,key:"checklist_audio_video",uid:null,checklist:{browser:null,https:null,video:null,audio:null,rtc:null,rtm:null},errors:{}};return e.role===C.Viewer&&(t.shouldCheckAudio=!1,t.shouldCheckVideo=!1),nt.platform===tt&&(t.shouldCheckAudio=!0,t.shouldCheckVideo=!1),t.key="checklist"+(t.shouldCheckAudio?"_audio":"")+(t.shouldCheckVideo?"_video":""),t})),i.switchMap((function(e){return!0===gt.get(e.key)&&Object.keys(e.checklist).forEach((function(t){e.checklist[t]=!0})),n.of(e)})))},e.isChecked=function(e){var t=Object.keys(e.checklist).reduce((function(t,n,i){var o=t&&e.checklist[n];switch(n){case"audio":return o||!e.shouldCheckAudio;case"video":return o||!e.shouldCheckVideo;default:return o}}),!0);return t},e.isChecked$=function(){var e=this;return this.checklist$().pipe(i.map((function(t){return e.isChecked(t)})))},e.checkEvent$=function(){var e=this;return this.checklist$().pipe(i.switchMap((function(t){if(!0===Object.keys(t.checklist).reduce((function(e,n,i){return e&&t.checklist[n]}),!0))return n.of(t);gt.set(t.key,!1);var o=new n.Subject,r=n.of(t).pipe(i.delay(1e3),i.switchMap((function(t){return o.next(t),e.checkBrowserEvent$(t)})),i.switchMap((function(t){return o.next(t),e.checkHttpsEvent$(t)})),i.switchMap((function(t){return o.next(t),e.checkAudioEvent$(t)})),i.switchMap((function(t){return o.next(t),e.checkVideoEvent$(t)})),i.switchMap((function(t){return o.next(t),e.checkRtcEvent$(t)})),i.switchMap((function(t){return o.next(t),e.checkRtmEvent$(t)})),i.tap((function(e){gt.set(e.key,!0)})));return n.merge(o,r)})))},e.check$=function(){var e=this;return this.checklist$().pipe(i.switchMap((function(t){return!0===Object.keys(t.checklist).reduce((function(e,n,i){return e&&t.checklist[n]}),!0)?n.of(t):(gt.set(t.key,!1),n.of(t).pipe(i.delay(1e3),i.switchMap((function(t){return e.checkBrowserEvent$(t)})),i.switchMap((function(t){return e.checkHttpsEvent$(t)})),i.switchMap((function(t){return e.checkAudioEvent$(t)})),i.switchMap((function(t){return e.checkVideoEvent$(t)})),i.switchMap((function(t){return e.checkRtcEvent$(t)})),i.switchMap((function(t){return e.checkRtmEvent$(t)})),i.tap((function(e){gt.set(e.key,!0)}))))})))},e.checkBrowser$=function(){var e=AgoraRTC.checkSystemRequirements();return n.of(e)},e.checkBrowserEvent$=function(e){var t=this;return this.checkBrowser$().pipe(i.switchMap((function(o){return e.checklist.browser=o,o?n.of(e).pipe(i.delay(yt)):(e.errors.browser=vt.transform("bhere_browser_error"),t.checkHttpsEvent$(e).pipe(i.switchMap((function(e){return n.throwError(e)}))))})),i.catchError((function(t){return console.log("checkBrowserEvent$.error",t),e.checklist.browser=!1,e.errors.browser=vt.transform("bhere_browser_error"),n.throwError(e)})))},e.checkHttps$=function(){var e="https:"===window.location.protocol;return n.of(e)},e.checkHttpsEvent$=function(e){return this.checkHttps$().pipe(i.switchMap((function(t){return e.checklist.https=t,t?n.of(e).pipe(i.delay(yt)):(e.errors.https=vt.transform("bhere_https_error"),n.throwError(e))})),i.catchError((function(t){return console.log("checkHttpsEvent$.error",t),e.checklist.https=!1,e.errors.https=vt.transform("bhere_https_error"),n.throwError(e)})))},e.checkAudio$=function(){return n.from(ut.getDevices()).pipe(i.map((function(e){return null!=e.find((function(e){return"audioinput"===e.kind&&e.deviceId}))})))},e.checkAudioEvent$=function(e){return e.shouldCheckAudio?this.checkAudio$().pipe(i.switchMap((function(t){return e.checklist.audio=t,t?n.of(e).pipe(i.delay(yt)):(e.errors.audio=vt.transform("bhere_audio_error"),n.throwError(e))})),i.catchError((function(t){return console.log("checkAudioEvent$.error",t),e.checklist.audio=!1,e.errors.audio=vt.transform("bhere_audio_error"),n.throwError(e)}))):n.of(e)},e.checkVideo$=function(){return n.from(ut.getDevices()).pipe(i.map((function(e){return null!=e.find((function(e){return"videoinput"===e.kind&&e.deviceId}))})))},e.checkVideoEvent$=function(e){return e.shouldCheckVideo?this.checkVideo$().pipe(i.switchMap((function(t){return e.checklist.video=t,t?n.of(e).pipe(i.delay(yt)):(e.errors.video=vt.transform("bhere_video_error"),n.throwError(e))})),i.catchError((function(t){return console.log("checkVideoEvent$.error",t),e.checklist.video=!1,e.errors.video=vt.transform("bhere_video_error"),n.throwError(e)}))):n.of(e)},e.checkRtc$=function(){return n.from(ut.checkRtcConnection()).pipe(i.catchError())},e.checkRtcEvent$=function(e){return this.checkRtc$().pipe(i.switchMap((function(t){return e.uid=t,e.checklist.rtc=!1!==t,t?n.of(e).pipe(i.delay(yt)):(e.errors.rtc=vt.transform("bhere_rtc_error"),n.throwError(e))})),i.catchError((function(t){return console.log("checkRtcEvent$.error",t),e.checklist.rtc=!1,e.errors.rtc=vt.transform("bhere_rtc_error"),n.throwError(e)})))},e.checkRtm$=function(e){return n.from(ut.checkRtmConnection(e))},e.checkRtmEvent$=function(e){return this.checkRtm$(e.uid).pipe(i.switchMap((function(t){return e.checklist.rtm=!1!==t,t?n.of(e):(e.errors.rtm=vt.transform("bhere_rtm_error"),n.throwError(e))})),i.catchError((function(t){return console.log("checkRtmEvent$.error",t),e.checklist.rtm=!1,e.errors.rtm=vt.transform("bhere_rtm_error"),n.throwError(e)})))},e}(),wt=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.platform=nt.platform,this.checklist={},this.errors={},this.state={},this.busy=!0,this.shouldCheckAudio=!1,this.shouldCheckVideo=!1,bt.checkEvent$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){console.log("AgoraChecklistService",t,t.errors),e.shouldCheckAudio=t.shouldCheckAudio,e.shouldCheckVideo=t.shouldCheckVideo,e.checklist=t.checklist,e.errors=t.errors;var n=bt.isChecked(t);n?(e.checklist.success=n,e.busy=!1,e.pushChanges(),e.state.role===C.SmartDevice&&e.onNext()):e.pushChanges()}),(function(t){e.errors=t.errors,e.checklist.error=!0,e.busy=!1,e.pushChanges()}))},n.onNext=function(){this.checked.next(this.checklist)},n.openHttps=function(){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")},n.showFirewallConfiguration=function(){mt.open$({src:k.template.modal.configureFirewall}).pipe(i.first()).subscribe()},t}(e.Component);wt.meta={selector:"[agora-checklist]",outputs:["checked"]};var xt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onClose=function(){mt.resolve()},t}(e.Component);xt.meta={selector:"[agora-configure-firewall-modal]"};var Et=function(){function e(){}return e.addSource=function(e){var t=e instanceof MediaStream?e.id:e;return this.sources_[t]||(e instanceof MediaStream?this.sources_[t]=this.context.createMediaStreamSource(e.clone()):this.sources_[t]=this.context.createMediaElementSource(e)),this.sources_[t]},e.removeSource=function(e){var t=e instanceof MediaStream?e.id:e;return this.removeSourceKey(t)},e.removeSourceKey=function(e){var t;return this.sources_[e]&&(t=this.sources_[e],this.analyser&&t.disconnect(this.analyser),t.disconnect(),delete this.sources_[e]),t},e.frequency$=function(t,o){var r=this;if(void 0===o&&(o=64),o%2==1)throw o;var s=new Uint8Array(o/2);if(this.context){var a=this.analyser;if(a)a.fftSize=o,this.addSource(t).connect(a);var u=new n.BehaviorSubject(s);return e.frame$.pipe(i.withLatestFrom(u),i.map((function(e){e[0];var t=e[1];return a&&a.getByteFrequencyData(t),t})),i.tap((function(e){return u.next(e)})),i.finalize((function(){r.removeSource(t)})))}return n.of(s)},e.volume$=function(t){var o=this,r={volume:0,clipped:!1};if(this.context){var s=this.addSource(t),a=e.audioMeterCreate();s.connect(a);var u=new n.BehaviorSubject(r);return e.frame$.pipe(i.withLatestFrom(u),i.map((function(e){e[0];var t=e[1];return t.clipped=a.checkClipping(),t.volume=a.volume,t})),i.tap((function(e){return u.next(e)})),i.finalize((function(){o.removeSource(t)})))}return n.of(r)},e.audioMeterCreate=function(e,t,n){void 0===e&&(e=.98),void 0===t&&(t=.95),void 0===n&&(n=750);var i=this.context;if(i){var o=i.createScriptProcessor(512);return o.onaudioprocess=this.audioMeterProcess,o.checkClipping=this.audioMeterClip,o.dispose=this.audioMeterDispose,o.clipping=!1,o.lastClip=0,o.volume=0,o.clipLevel=e,o.averaging=t,o.clipLag=n,o.connect(i.destination),o}},e.audioMeterProcess=function(e){for(var t,n=e.inputBuffer.getChannelData(0),i=n.length,o=0,r=0;r<i;r++)t=n[r],Math.abs(t)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),o+=t*t;var s=Math.sqrt(o/i);this.volume=Math.max(s,this.volume*this.averaging)},e.audioMeterClip=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},e.audioMeterDispose=function(){this.disconnect(),this.onaudioprocess=null},e.step$=function(e){return n.Observable.create((function(t){requestAnimationFrame((function(n){var i=e?(n-e.startTime)/1e3:0;t.next({startTime:n,deltaTime:i})}))})).pipe(i.map((function(e){return e.deltaTime>1/30&&(e.deltaTime=1/30),e})))},e.dispose=function(){var e=this;Object.keys(this.sources_).forEach((function(t){e.removeSourceKey(t)}));var t=this.analyser;t&&t.disconnect(),this.sources_={}},u(e,null,[{key:"context",get:function(){return!this.context_&&"AudioContext"in window&&(this.context_=new AudioContext),this.context_}},{key:"analyser",get:function(){if(!this.analyser_)try{this.analyser_=this.context.createAnalyser()}catch(e){console.log("AudioStreamService.analyser",e)}return this.analyser_}}]),e}();Et.sources_={},Et.frame$=n.of(void 0).pipe(i.expand((function(e){return Et.step$(e)})),i.filter((function(e){return void 0!==e})),i.map((function(e){return e.deltaTime})),i.share());var St=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){this.init()},o.init=function(){if(!this.initialized_){this.initialized_=!0,this.platform=nt.platform;var t=e.getContext(this).node;this.onLoadedMetadata=this.onLoadedMetadata.bind(this),(this.preview=t.querySelector("video")).addEventListener("loadedmetadata",this.onLoadedMetadata);var n=t.querySelector(".audio");if(this.hasPreview)this.bars=new Array(32).fill(0).map((function(e){var t=document.createElement("div");return t.classList.add("bar"),n.appendChild(t),t}))}},o.onDestroy=function(){this.preview.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.hasPreview&&Et.dispose()},o.initStream=function(){var t=this,n=this.preview;if(this.preview){var i=e.getContext(this).node;if(this.video_||this.audio_){if(i.classList.add("ready"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var o=U(I.state),r={video:!!this.video_&&{deviceId:this.video_,width:{ideal:o.resolution.width},height:{ideal:o.resolution.height},frameRate:{ideal:o.frameRate.min,max:o.frameRate.max}},audio:!!this.audio_&&{deviceId:this.audio_}};this.platform===Je&&(r.video.facingMode="user"),navigator.mediaDevices.getUserMedia(r).then((function(e){t.hasPreview?("srcObject"in n?n.srcObject=e:n.src=window.URL.createObjectURL(e),t.audio_&&t.analyzeData(e),t.loadingStream_=e):t.stream.next(e)})).catch((function(e){console.log("AgoraDevicePreviewComponent.initStream.error",e.name,e.message),t.stream.next(null)}))}}else i.classList.remove("ready"),this.hasPreview&&("srcObject"in n?n.srcObject=null:n.src=null,this.analyzeData(null)),this.stream.next(null)}},o.onLoadedMetadata=function(t){e.getContext(this).node.classList.add("loaded"),this.preview.play(),this.stream.next(this.loadingStream_)},o.analyzeData=function(e){var t=this;this.frequencySubscription&&this.frequencySubscription.unsubscribe(),e&&(this.frequencySubscription=Et.frequency$(e,64).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.bars.forEach((function(t,n){var i=Math.min(100,5+e[n])/100;t.style.left=3.125*n+"%",t.style.transform="scale(1,"+i+")",t.style.opacity=i}))})))},u(n,[{key:"video",get:function(){return this.video_},set:function(e){this.video_!==e&&(this.video_=e,this.change&&(this.change.next(),this.init(),this.initStream()))}},{key:"audio",get:function(){return this.audio_},set:function(e){this.audio_!==e&&(this.audio_=e,this.change&&(this.change.next(),this.init(),this.initStream()))}},{key:"hasPreview",get:function(){return this.platform!==Je&&this.platform!==tt}}]),n}(e.Component);St.meta={selector:"[agora-device-preview]",outputs:["stream","change"],inputs:["video","audio"]};var Tt=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;if(this.platform=nt.platform,this.isHttps="https:"===window.location.protocol,this.state={},this.devices={videos:[],audios:[]},this.stream=null,this.form=null,this.isHttps){var t=this.agora=ut.getSingleton();I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()})),t&&t.devices$().subscribe((function(t){e.devices=t,e.initForm(t),e.pushChanges()}),(function(e){console.log("AgoraDeviceComponent.devices$.error",e)}))}},o.openHttps=function(e){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")},o.initForm=function(e){var n=this,o=this.form=new t.FormGroup({video:new t.FormControl(null,e.videos.length?t.Validators.RequiredValidator():void 0),audio:new t.FormControl(null,e.audios.length?t.Validators.RequiredValidator():void 0)}),r=this.controls=o.controls,s=e.videos.map((function(e){return{id:e.deviceId,name:e.label}}));s.length>0&&s.unshift({id:null,name:"bhere_select_video"}),r.video.options=s;var a=e.audios.map((function(e){return{id:e.deviceId,name:e.label}}));a.length>0&&a.unshift({id:null,name:"bhere_select_audio"}),r.audio.options=a,o.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){n.pushChanges()}))},o.onStreamDidChange=function(e){this.stream=null,this.pushChanges()},o.onStream=function(e){this.stream=e,this.pushChanges()},o.isValid=function(){var e=this.form.valid&&(this.stream||!this.hasPreview);return e},o.onEnter=function(e){var t=this.form.value,n=this.devices;n.video=n.videos.find((function(e){return e.deviceId===t.video})),n.audio=n.audios.find((function(e){return e.deviceId===t.audio})),this.enter.next(n)},u(n,[{key:"hasPreview",get:function(){return this.platform!==Je&&this.platform!==tt}}]),n}(e.Component);Tt.meta={selector:"[agora-device]",outputs:["enter"]};var kt=function(){function e(e){e&&Object.assign(this,e),this.items=this.items||[],this.originalItems=this.items.slice()}return u(e,[{key:"payload",get:function(){var e=this,t={};return Object.keys(this).forEach((function(n){-1!==View.allowedProps.indexOf(n)&&(t[n]=e[n])})),t}}]),e}();function Mt(e){return e=new kt(e)}c(kt,"allowedProps",["id","name","items"]);var It={id:null,name:"Principale",items:[]},Ct=function(){function e(){}return e.getCurrentPath$=function(e){var t=this;return void 0===e&&(e=null),this.pathGet$().pipe(i.switchMap((function(n){t.paths=n;var i=It;if(e){var o=n.find((function(t){return t.id===e}));o&&(i=o)}return t.path=i,t.path$})))},e.pathGet$=function(){return k.flags.usePaths?Ge.get$("/api/path").pipe(i.map((function(e){return e.paths=e.paths.map((function(e){return Mt(e)})),e.paths.unshift(It),e.paths}))):of([])},e.addPath=function(e){var t=this.paths.slice();t.push(e),this.paths=t,this.path=e},e.editPath=function(e){var t=this.paths.slice(),n=t.reduce((function(t,n,i){return n.id===e.id?i:t}),-1);if(n>0){var i=this.path;i.id===e.id&&(i=e),t.splice(n,1,e),this.paths=t,this.path=i}},e.deletePath=function(e){var t=this.paths.slice(),n=t.indexOf(e);if(n>0){t.splice(n,1),this.paths=t;var i=this.path;i.id===e.id&&(i=t[0]),this.path=i}},e.pathCreate$=function(e){return Ge.post$("/api/path",e).pipe(i.map((function(e){return Mt(e)})))},e.pathUpdate$=function(e){return Ge.put$("/api/path/"+e.id,e).pipe(i.map((function(e){return Mt(e)})))},e.pathDelete$=function(e){return Ge.delete$("/api/path/"+e.id)},u(e,null,[{key:"paths",set:function(e){this.paths$.next(e)},get:function(){return this.paths$.getValue()}},{key:"path",set:function(e){this.path$.next(e)},get:function(){return this.path$.getValue()}}]),e}();c(Ct,"paths$",new n.BehaviorSubject([It])),c(Ct,"path$",new n.BehaviorSubject(It));var Rt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){return k.url[e]||"#"+e},t}(e.Pipe);Rt.meta={name:"slug"};var At=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.state={},this.paths=[],this.pathId=null,this.form=null,I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()})),k.flags.usePaths?Ct.getCurrentPath$().pipe(i.first(),i.tap(),i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.paths=Ct.paths,e.pathId=t.id||"",e.onLoad()})):this.onLoad()},o.onLoad=function(){var e=this,n=this.form=new t.FormGroup({path:this.pathId,id:new t.FormControl(null,[t.Validators.PatternValidator(A),t.Validators.RequiredValidator()]),idAttendee:null,idStreamer:null,idViewer:null,idSmartDevice:null}),o=this.controls=n.controls,r=this.paths.map((function(e){return{id:e.id||"",name:e.name}}));r.length>0&&r.unshift({id:null,name:"bhere_select_path"}),o.path.options=r,n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pathId!==t.path&&null!==t.id&&(e.pathId=t.path,e.onGenerateMeetingId()),e.pushChanges()}))},o.onGenerateMeetingId=function(e){var t=this.pathId?String(this.pathId):null;t=t&&t.length?t:null;var n=new _({pathId:t}).toRoles();this.form.patch(n)},o.onInputDidChange=function(e){var t=this;"publisher"===this.state.role&&setTimeout((function(){if(t.form.get("id").valid){var e=t.form.get("id").value,n=new _(e).toRoles();t.form.patch(n)}else t.form.get("idAttendee").reset(),t.form.get("idStreamer").reset(),t.form.get("idViewer").reset(),t.form.get("idSmartDevice").reset()}),1)},o.onCopyToClipBoard=function(e,t){void 0===t&&(t=!1),new L({link:e}).copyToClipBoard(t)},o.onNext=function(e){var t=this.controls.id.value;L.replaceWithLink(t),this.link.next(t)},o.isValid=function(){var e=this.form.valid;return e},u(n,[{key:"selfServiceTourUrl",get:function(){var e=this.form.get("path").value;return Rt.transform("selfServiceTour")+(e?"?pathId="+e:"")}}]),n}(e.Component);At.meta={selector:"[agora-link]",outputs:["link"]};var _t=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this,n=this.form=new t.FormGroup({username:new t.FormControl(null,t.Validators.RequiredValidator()),password:new t.FormControl(null,t.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=n.controls;n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),this.error=null},o.test=function(){this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""})},o.reset=function(){this.form.reset()},o.onSubmit=function(){var e=this;if(this.form.valid){var t=this.form.value;this.form.submitted=!0,this.error=null,this.pushChanges(),qe.login$(t).pipe(i.first()).subscribe((function(t){I.state.role===t.type?(e.onNext(t),e.form.reset()):(e.error={friendlyMessage:vt.transform("error_credentials")},e.pushChanges())}),(function(t){console.log("AccessComponent.error",t),e.error=t,e.pushChanges()}))}else this.form.touched=!0},o.isValid=function(){var e=this.form.valid;return e},o.onNext=function(e){L.replaceWithUser(e),this.login.next(e)},n}(e.Component);_t.meta={selector:"[agora-login]",outputs:["login"]};var Lt=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this,n=(new L).name;this.state={};var o=this.form=new t.FormGroup({name:new t.FormControl(n,[t.Validators.PatternValidator(/^\w{2,}\s\w{2,}/),t.Validators.RequiredValidator()])});this.controls=o.controls;o.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()}))},o.isValid=function(){var e=this.form.valid;return e},o.onNext=function(e){var t=this.controls.name.value;L.replaceWithName(t),this.name.next(t)},n}(e.Component);Lt.meta={selector:"[agora-name]",outputs:["name"]};var Pt=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var e=this;this.videoMuted=!1,this.audioMuted=!1,this.shouldUseResumeGesture=!1,this.state={},I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()})),Ye.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case W:var n=t.event;e.streamId&&n.streamId===e.streamId&&(n instanceof Ve&&(e.videoMuted=!0),n instanceof je&&(e.videoMuted=!1),n instanceof Be&&(e.audioMuted=!0),n instanceof Ne&&(e.audioMuted=!1));break;case Te:e.streamId===t.clientId&&(e.vrContainer=t.container);break;case ke:e.streamId===t.clientId&&(e.vrContainer=null)}}))},o.setMediaStream=function(e){var t=this.videoNode;"srcObject"in t?t.srcObject=e:t.src=e?window.URL.createObjectURL(e):null},o.onLoadedMetadata=function(e){this.videoNode.play().then((function(e){}),(function(e){console.log("AgoraStreamComponent.play.error",e)}))},o.onToggleControl=function(e){this.toggleControl.next(e)},o.onToggleSpy=function(e){this.toggleSpy.next(e)},u(n,[{key:"videoMuted",set:function(t){if(this.videoMuted_!==t){this.videoMuted_=t;var n=e.getContext(this).node;t?n.classList.add("video--muted"):n.classList.remove("video--muted")}}},{key:"audioMuted",set:function(t){if(this.audioMuted_!==t){this.audioMuted_=t;var n=e.getContext(this).node;t?n.classList.add("audio--muted"):n.classList.remove("audio--muted")}}},{key:"streamId",get:function(){return this.streamId_},set:function(e){this.streamId_=e}},{key:"stream",get:function(){return this.stream_},set:function(t){if(this.stream_!==t){for(var n=e.getContext(this).node,i=this.player=n.querySelector(".agora-stream__player");i.childElementCount>0;)i.removeChild(i.firstElementChild);this.stream_&&this.stream_.isPlaying()&&this.stream_.player.div.parentNode===i&&(console.log("AgoraStreamComponent stopping stream",this.stream_.getId(),"on",this.stream_.player.div.parentNode),this.stream_.stop()),this.stream_=t,t&&(this.videoMuted=t.userMuteVideo,this.audioMuted=t.userMuteAudio);var o=t?t.getId():null;if(this.streamId=o,o){var r="stream-"+o;i.setAttribute("id",r);var s=this;t.isPlaying()?i.appendChild(t.player.div):(this.shouldUseResumeGesture=!1,t.play(r,{fit:"cover"},(function(e){e&&"aborted"!==e.status&&(s.shouldUseResumeGesture=!0,s.pushChanges())})))}else i.removeAttribute("id")}}},{key:"vrContainer",set:function(e){this.vrContainer_!==e&&(this.vrContainer_=e,e?(this.stream_.vrContainer=e,this.player.appendChild(e)):this.stream_.vrContainer&&this.stream_.vrContainer.parentNode&&(this.stream_.vrContainer.parentNode.removeChild(this.stream_.vrContainer),this.stream_.vrContainer=null))}},{key:"videoNode",get:function(){var t=this.videoNode_;if(!t){var n=e.getContext(this).node.querySelector(".agora-stream__player");t=document.createElement("video"),this.onLoadedMetadata=this.onLoadedMetadata.bind(this),t.addEventListener("loadedmetadata",this.onLoadedMetadata),n.appendChild(t),this.videoNode_=t}return t}}]),n}(e.Component);Pt.meta={selector:"[agora-stream]",outputs:["toggleControl","toggleSpy"],inputs:["stream"]};var $t={WaitingRoom:{id:1,name:"waiting-room"},Panorama:{id:2,name:"panorama"},PanoramaGrid:{id:3,name:"panorama-grid"},Room3d:{id:4,name:"room-3d"},Model:{id:5,name:"model"},Media:{id:6,name:"media"}},Ot={Nav:{id:1,name:"nav"},Plane:{id:2,name:"plane"},CurvedPlane:{id:3,name:"curved-plane"},Model:{id:4,name:"model"},Texture:{id:5,name:"texture"}},Ht=function(){function e(e){e&&(Object.assign(this,e),this.updateIndices(e.items)),this.items=(this.items||[]).filter((function(e){return function(e){var t;switch(e.type.name){case Ot.Nav.name:t=null==e.viewId||function(e){return!Kt(e.title)&&!Kt(e.abstract)}(e)||I.state.navigable;break;default:t=!0}return t}(e)})).map((function(e){return qt(e)})),this.tiles&&(this.tiles=this.tiles.map((function(e){return Wt(e)}))),this.originalItems=this.items.slice(),this.lastOrientation={latitude:0,longitude:0}}return e.prototype.updateIndices=function(e){if(e){var t=0,n=0,i=0,o=0,r=0;e.forEach((function(e,s){if(e.index=s,e.asset)switch(e.asset.file){case"publisherStream":e.asset.index=t++;break;case"nextAttendeeStream":e.asset.index=n++;break;case"smartDeviceStream":e.asset.index=i++;break;case"publisherScreen":e.asset.index=o++;break;case"attendeeScreen":e.asset.index=r++}}))}},u(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){if(-1!==e.allowedProps.indexOf(i))switch(i){case"items":n[i]=t[i].map((function(e){return qt(e).payload}));break;case"tiles":n[i]=t[i].map((function(e){return Wt(e).payload}));break;default:n[i]=t[i]}})),n}},{key:"pathItems",get:function(){return this.items.filter((function(e){return e.path}))}},{key:"shortType",get:function(){return this.type?this.type.split("-").map((function(e){return e.substring(0,1).toUpperCase()})).join(""):"??"}}]),e}();c(Ht,"allowedProps",["id","type","name","hidden","likes","asset","items","orientation","zoom","ar","tiles","invertAxes","flipAxes"]);var Ut=function(e){function t(t){return e.call(this,t)||this}return d(t,e),t}(Ht),Dt=function(e){function t(i){var o;return i.tiles=t.mapTiles(i.tiles,i.flipAxes,i.invertAxes,i.asset?i.asset.folder:""),(o=e.call(this,i)||this).index_=0,o.index$=new n.Subject,o.tiles.forEach((function(e,t){return e.selected=0===t})),o.tiles.length&&(o.items=o.originalItems.concat(o.tiles[0].navs),o.asset=o.tiles[0].asset),o}d(t,e),t.mapTiles=function(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i="");var o=t?-1:1;return e.map((function(e,t){var r=new THREE.Vector2;return(e="string"==typeof e?{id:t+1,asset:{folder:i,file:e},navs:[]}:e).asset.file.replace(/_x([-|\d]+)_y([-|\d]+)/g,(function(e,t,i){n?(r.y=parseInt(t),r.x=parseInt(i)*o):(r.x=parseInt(t),r.y=parseInt(i)*o)})),{id:e.id,type:Object.assign({},$t.PanoramaGrid),asset:e.asset,navs:e.navs||[],indices:r}}))},u(t,[{key:"index",set:function(e){this.index_!==e&&(this.index_=e,this.tiles.forEach((function(t,n){return t.selected=n===e})),this.updateCurrentItems(),this.index$.next(e))},get:function(){return this.index_}}]);var i=t.prototype;return i.updateCurrentItems=function(){this.items=this.originalItems.concat(this.tiles[this.index_].navs)},i.getTileIndex=function(e,t){return this.tiles.reduce((function(n,i,o){return i.indices.x===e&&i.indices.y===t?o:n}),-1)},i.hasTile=function(e,t){return-1!==this.getTileIndex(e,t)},i.getTile=function(e,t){var n=this.getTileIndex(e,t);if(-1!==n)return this.index=n,this.tiles[n]},t}(Ht),Ft=function(e){function t(t){return e.call(this,t)||this}return d(t,e),t}(Ht),Vt=function(e){function t(t){return e.call(this,t)||this}return d(t,e),t}(Ht),jt=function(e){function t(t){return e.call(this,t)||this}return d(t,e),t}(Ht),Bt=function(){function e(e){e&&Object.assign(this,e)}return u(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){-1!==e.allowedProps.indexOf(i)&&(n[i]=t[i])})),!n.link||n.link.title&&n.link.href||delete n.link,n}},{key:"hasPanel",get:function(){return this.type.name===Ot.Nav.name&&(this.title&&""!==this.title||this.abstract&&""!==this.abstract||this.asset||this.link)}}]),e}();c(Bt,"allowedProps",["id","type","title","abstract","asset","link","viewId","hook","hookExtra","keepOrientation","important","transparent","position","rotation","scale","radius","height","arc"]);var Nt=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Bt),zt=function(){function e(e){e&&Object.assign(this,e),this.navs=(this.navs||[]).map((function(e){return qt(e)})),this.originalItems=this.navs.slice()}return u(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){if(-1!==e.allowedProps.indexOf(i))switch(i){case"navs":n[i]=t[i].map((function(e){return qt(e).payload}));break;default:n[i]=t[i]}})),n}}]),e}();function Gt(e){switch(e.type.name){case $t.Panorama.name:e=new Ut(e);break;case $t.PanoramaGrid.name:e=new Dt(e);break;case $t.Room3d.name:e=new Ft(e);break;case $t.Model.name:e=new Vt(e);break;case $t.Media.name:e=new jt(e);break;default:e=new Ht(e)}return e}function qt(e){switch(e.type.name){case Ot.Nav.name:e=new Nt(e);break;default:e=new Bt(e)}return e}function Wt(e){return new zt(e)}function Kt(e){return e&&e.length>0}c(zt,"allowedProps",["id","asset","navs"]);var Xt=function(){function e(e){e&&Object.assign(this,e),this.items=(this.items||[]).map((function(e){return qt(e)})),this.originalItems=this.items.slice()}return u(e,[{key:"payload",get:function(){var e=this,t={};return Object.keys(this).forEach((function(n){if(-1!==View.allowedProps.indexOf(n))switch(n){case"items":t[n]=e[n].map((function(e){return qt(e).payload}));break;default:t[n]=e[n]}})),t}}]),e}();function Yt(e){return e=new Xt(e)}c(Xt,"allowedProps",["id","name","asset","items"]);var Zt=function(){function e(){}return e.navmapGet$=function(){return Ge.get$("/api/navmap").pipe(i.map((function(e){return e.navmaps.map((function(e){return Yt(e)})),e.navmaps})))},e.navmapCreate$=function(e){return Ge.post$("/api/navmap",e).pipe(i.map((function(e){return Yt(e)})))},e.navmapUpdate$=function(e){return Ge.put$("/api/navmap/"+e.id,e).pipe(i.map((function(e){return Yt(e)})))},e.navmapDelete$=function(e){return Ge.delete$("/api/navmap/"+e.id)},e.itemCreate$=function(e,t){return Ge.post$("/api/navmap/"+e.id+"/item",t).pipe(i.map((function(e){return qt(e)})))},e.itemUpdate$=function(e,t){return t=qt(t),Ge.put$("/api/navmap/"+e.id+"/item/"+t.id,t.payload).pipe(i.map((function(e){return qt(e)})))},e.itemDelete$=function(e,t){return Ge.delete$("/api/navmap/"+e.id+"/item/"+t.id)},u(e,null,[{key:"active",set:function(e){this.active$.next(e)},get:function(){return this.active$.getValue()}}]),e}();c(Zt,"active$",new n.BehaviorSubject(!1));var Jt=function(){function e(){}return e.push=function(e){return function(e){(window.dataLayer||[]).push(e),console.log("GtmService.dataLayer",e)}(e)},e}(),Qt="info",en="alert",tn="dialog",nn="centered",on="bottom-right",rn=function(e){this.toast=e},sn=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(rn),an=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(rn),un=function(){function e(){}return e.open$=function(e){var t=this;switch(e.id=(new Date).getTime(),e.type=e.type||Qt,e.position=e.position||nn,e.type){case en:e.acceptMessage=e.acceptMessage||"Ok";break;case tn:e.acceptMessage=e.acceptMessage||"Accept",e.rejectMessage=e.rejectMessage||"Reject"}return this.toast$.next(e),e.type===Qt&&setTimeout((function(){t.resolve(e)}),e.duration||4e3),this.events$},e.resolve=function(e){this.toast$.next(null),this.events$.next(new sn(e))},e.reject=function(e){this.toast$.next(null),this.events$.next(new an(e))},e}();un.toast$=new n.Subject,un.events$=new n.Subject;var cn=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var t=this,n=e.getContext(this).node;this.modalNode=n.querySelector(".modal-outlet__modal"),mt.modal$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.modal=e}))},o.reject=function(e){mt.reject()},u(n,[{key:"modal",get:function(){return this.modal_},set:function(t){var n=e.getContext(this).module;if(this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),t&&t.node){this.modal_=t,this.modalNode.appendChild(t.node);n.compile(t.node)}this.modal_=t,this.pushChanges()}}]),n}(e.Component);cn.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t</div>\n\t'};var ln=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this);var i=e.getContext(this),o=i.parentInstance,r=i.node;if(o instanceof cn){var s=this.data=o.modal.data;if(s&&s.ar){var a=n.getUrl(s);new QRious({element:r.querySelector(".qrcode"),value:a,size:256})}}},i.onClose=function(){mt.reject()},n.getUrl=function(e){var t=k.getAbsoluteUrl(k.template.tryInAr,{viewId:e.id});return console.log("TryInARModalComponent.getUrl",t),t},n.openInAR=function(e){var t=this.getUrl(e);window.open(t,"_blank")},n}(e.Component);ln.meta={selector:"[try-in-ar-modal]"};var dn=["jpeg","jpg","png","hdr"],hn=["mp4","webm"],pn=["fbx","gltf","glb","usdz"],fn={Image:{id:1,name:"image"},Video:{id:2,name:"video"},Model:{id:3,name:"model"},PublisherStream:{id:4,name:"publisher-stream",file:"publisherStream"},AttendeeStream:{id:5,name:"next-attendee-stream",file:"nextAttendeeStream"},PublisherScreen:{id:6,name:"publisher-screen",file:"publisherScreen"},AttendeeScreen:{id:7,name:"attendee-screen",file:"attendeeScreen"},SmartDeviceStream:{id:8,name:"smart-device-stream",file:"smartDeviceStream"}},mn={ImageOrVideo:{id:1,name:"Image or Video",ids:[1,2]},Publisher:{id:3,name:"Publisher",ids:[4]},Attendee:{id:4,name:"Attendee",ids:[5]}};k.flags.editorAssetScreen&&(mn.PublisherScreen={id:5,name:"PublisherScreen",ids:[6]},mn.AttendeeScreen={id:6,name:"AttendeeScreen",ids:[7]}),mn.SmartDevice={id:7,name:"Smart Device",ids:[8]};var vn=[fn.PublisherStream.name,fn.AttendeeStream.name,fn.PublisherScreen.name,fn.AttendeeScreen.name,fn.SmartDeviceStream.name];function gn(e){return e&&-1!==vn.indexOf(e.type.name)}function yn(e){var t;return e&&e.asset&&(t=Object.keys(mn).find((function(t){return-1!==mn[t].ids.indexOf(e.asset.type.id)}))),mn[t||"ImageOrVideo"]}function bn(e){var t,n=function(e){return Object.keys(fn).reduce((function(t,n){var i=fn[n];return i.id===e?i:t}),null)}((t=e,Object.keys(mn).reduce((function(e,n){var i=mn[n];return i.id===t?i:e}),null)).ids[0]),i=n.file;return new xn({type:n,folder:"",file:i})}function wn(e){var t=e.split(".").pop().toLowerCase();return-1!==dn.indexOf(t)?fn.Image:-1!==hn.indexOf(t)?fn.Video:-1!==pn.indexOf(t)?fn.Model:void 0}var xn=function(){function e(e){e&&Object.assign(this,e)}return e.fromUrl=function(t){var n=t.split("/"),i=n.pop(),o=n.join("/")+"/";return new e({type:wn(i),folder:o,file:i})},u(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){-1!==e.allowedProps.indexOf(i)&&(n[i]=t[i])})),n}}],[{key:"defaultMediaAsset",get:function(){return{id:-1,type:{id:fn.Image,name:"image"},folder:"/textures/grid/",file:"grid.jpg"}}}]),e}();function En(e){return e.type.name,e=new xn(e)}c(xn,"allowedProps",["id","type","folder","file","linkedPlayId","chromaKeyColor","autoplay","loop"]);var Sn=function(){function e(){}return e.getDefaultLanguages=function(){return k.alternates||[]},e.getDefaultLanguage=function(){return k.defaultLanguage||(this.languages?this.languages[0].lang:null)},e.setLanguage=function(e){this.selectedLanguage=e.lang},e.setLanguage$=function(e){var t=this;return n.from(fetch(e.href).then((function(e){return e.text()}))).pipe(i.tap((function(n){var i=/(window\.labels[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*=[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\n*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\{((\{[\s\S]+?\})|[\s\S])+?\})/gm.exec(n);i&&(new Function(i[0]).call(window),vt.setLabels());var o=/(window\.bhere[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*=[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\n*[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*\{((\{[\s\S]+?\})|[\s\S])+?\})/gm.exec(n);if(o){var r={};new Function(o[0].replace("window","this")).call(r),r.bhere&&p.merge(k,r.bhere)}M.replace(t.activeLanguage.href,e.href),t.selectedLanguage=e.lang})))},e.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},u(e,null,[{key:"hasLanguages",get:function(){return this.languages.length>1}},{key:"activeLanguage",get:function(){var e=this;return this.languages.find((function(t){return t.lang===e.selectedLanguage}))}}]),e}();c(Sn,"languages",Sn.getDefaultLanguages()),c(Sn,"defaultLanguage",Sn.getDefaultLanguage()),c(Sn,"selectedLanguage",Sn.defaultLanguage);var Tn={id:"waiting-room",type:{id:1,name:"waiting-room"},name:"Waiting Room",likes:0,liked:!1,asset:{type:{id:1,name:"image"},folder:"/textures/waiting-room/",file:"waiting-room.jpg"},items:[],orientation:{latitude:0,longitude:0}},kn=function(){function e(){}return e.getDataView=function(e){return this.dataViews.find((function(t){return t.id===e}))},e.getValidPathId=function(e){return e?null==this.validPathViews.find((function(t){return t.id===e}))?null:void 0:null},e.getFirstPathId=function(){var e=this.editor&&null===this.path.id?this.dataViews:this.pathViews;return e.length?e[0].id:null},e.data$=function(){var e=this;if(!this.data$_){var t=(k.flags.production?"/api/view":"./api/data.json")+"?lang="+Sn.selectedLanguage;this.data$_=Ge.get$(t).pipe(i.map((function(t){t.views=t.views.map((function(e){return Gt(e)})),e.data=t;var n=t.views;return e.views=n,t})),i.shareReplay(1))}return this.data$_},e.view$=function(){var e=this,t=new L,n=this.getValidPathId(t.viewId),o=this.getValidPathId(t.embedViewId)||n||this.getFirstPathId();return this.action$_.next({viewId:o}),this.action$_.pipe(i.distinctUntilChanged((function(e,t){return e.viewId===t.viewId})),i.map((function(t){var n=e.dataViews.find((function(e){return e.id===t.viewId}));return n&&(n.keepOrientation=t.keepOrientation||!1,n.useLastOrientation=t.useLastOrientation||!1),n||e.getWaitingRoom()})))},e.setDataAndPath=function(e,t){this.data=e,e.views.forEach((function(e){e.path=!t||-1===t.items.indexOf(e.id),e.items.forEach((function(e){var n=!0;t&&(e.type.name===Ot.Nav.name&&(n=-1===t.items.indexOf(e.viewId)),e.path=n)}))})),this.views=e.views,this.path=t},e.hostedView$=function(t,o){var r=this;this.setDataAndPath(t,o),this.editor=!1;var s=this.getWaitingRoom();return n.combineLatest([this.view$(),this.hosted$()]).pipe(i.map((function(e){var t=e[0];return e[1]?t:s})),i.distinctUntilChanged((function(e,t){return e.id===t.id})),i.tap((function(t){if(r.view=t,t.id!==s.id){M.set("viewId",t.id);var n=e.getPrefetchAssets(t);t.prefetchAssets=n}})))},e.editorView$=function(e,t){var n=this;this.setDataAndPath(e,t),this.editor=!0;var o=this.getWaitingRoom();return this.view$().pipe(i.map((function(e){return n.view=e,e.id!==o.id&&M.set("viewId",e.id),t&&null!==t.id?M.set("pathId",t.id):M.delete("pathId"),e})))},e.hosted$=function(){return I.state$.pipe(i.map((function(e){return e.hosted})),i.distinctUntilChanged())},e.viewById$=function(e){var t=this;return this.data$().pipe(i.map((function(n){return t.views.find((function(t){return t.id===e}))})))},e.viewLike$=function(e){return e.liked?n.of(null):(e.liked=!0,k.flags.production?Ge.get$("/api/view/"+e.id+"/like"):(e.likes=e.likes||0,e.likes++,n.of(e)))},e.setViewLike$=function(e){return this.viewById$(e.viewId).pipe(i.tap((function(t){t&&(t.likes=e.likes)})))},e.getWaitingRoom=function(){return this.dataViews.find((function(e){return e.type.name===$t.WaitingRoom.name}))||Tn},e.getPrefetchAssets=function(e){var t=this.views;return e.items.filter((function(e){return e.type.name===Ot.Nav.name&&null!=e.viewId})).map((function(e){return t.find((function(t){return t.id===e.viewId}))})).filter((function(e){return e&&e.asset&&e.asset.type.name===fn.Image.name})).map((function(e){return k.getPath(e.asset.folder+e.asset.file)}))},e.addView=function(e){var t=this.data,n=t.views.slice();n.push(e),t.views=n,this.views=n,this.viewId=e.id},e.deleteView=function(t){var n=this.data,i=n.views.slice(),o=i.reduce((function(e,n,i){return n.id===t.id?i:e}),-1);o>0&&(i.splice(o,1),n.paths=i),e.viewId=this.dataViews[0].id},u(e,null,[{key:"views",set:function(e){this.views$_.next(e)},get:function(){return this.views$_.getValue()}},{key:"view",set:function(e){this.view$_.next(e)},get:function(){return this.view$_.getValue()}},{key:"dataViews",get:function(){return this.data?this.data.views:[]}},{key:"validViews",get:function(){return this.data?this.data.views.filter((function(e){return e.type.name!==$t.WaitingRoom.name})):[]}},{key:"pathViews",get:function(){return this.validViews.filter((function(e){return e.path}))}},{key:"validPathViews",get:function(){return(this.editor?this.data.views:this.validViews).filter((function(e){return e.path}))}},{key:"action",set:function(e){this.action$_.next(e)},get:function(){return this.action$_.getValue()}},{key:"viewId",set:function(e){this.action$_.next({viewId:e,keepOrientation:!1,useLastOrientation:!1})},get:function(){var e=this.action$_.getValue();return e?e.viewId:null}}]),e}();c(kn,"views$_",new n.BehaviorSubject([])),c(kn,"view$_",new n.BehaviorSubject(null)),c(kn,"action$_",new n.BehaviorSubject(null));var Mn=0,In=function(){function e(e){e&&Object.assign(this,e)}return e.prototype.toJson=function(){return JSON.stringify(this)},e.newEvent=function(t,n,i){console.log("WebhookEvent.newEvent",t,n,i);var o=new e;o.action=t,o.data=n,o.extra="string"==typeof i?JSON.parse(i):i,o.meetingId=I.state.link,o.userSessionId=I.state.uid,o.userRole=I.state.role,o.fullName=I.state.name;var r=(new Date).getTime();return o.timestamp=r,o.id=r+"-"+ ++Mn,o},e.parseEvent=function(t){if(t&&"data"in t){var n="string"==typeof t.data?JSON.parse(t.data):t.data;return"action"in n?new e(n):null}return null},e}(),Cn=function(){function e(){}return e.internal$_=function(e){var t=this;return n.of(e).pipe(i.tap((function(e){console.log("WebhookService.internal$_.postMessage",e),window.parent&&window.parent.postMessage(e.action,e.toJson())})),i.switchMap((function(e){return t.event$_.pipe(i.filter((function(e){return e.id==e.id})),i.first())})),i.map((function(n){return console.log("WebhookService.internal$_.handleResponse_",e,n),t.handleResponse_(e,n)})),i.catchError((function(n){return t.handleError_(e,n)})))},e.send$_=function(e,t){var n=this;Ge.post$(e,t).pipe(i.map((function(e){return n.handleResponse_(t,e)})),i.catchError((function(e){return n.handleError_(t,e)})))},e.send$=function(e,t,i){var o=this;if(console.log("WebhookService.send$",e,t,i),this.enabled){var r=In.newEvent(e,t,i),s=k.webhook.uris.map((function(e){return"internal"===e?o.internal$_(r):o.send$_(e,r)}));return n.forkJoin(s)}return n.of(n.EMPTY)},e.handleResponse_=function(e,t){console.log("WebhookService.handleResponse_",t);var n=Object.assign({},e);return n.remoteStatus=1,n.remoteResponse=t,n},e.handleError_=function(e,t){var i=Object.assign({},e);return i.remoteStatus=0,i.remoteError=t,n.of(i)},u(e,null,[{key:"enabled",get:function(){return k.webhook&&k.webhook.uris&&k.webhook.uris.length>0}}]),e}();c(Cn,"event$_",n.fromEvent(window,"message").pipe(i.map((function(e){return In.parseEvent(e)})),i.filter((function(e){return null!==e})),i.shareReplay(1)));var Rn=null,An=function(){function e(){}return e.getItems=function(){return this.items$.getValue()},e.indexOf=function(e){return this.getItems().reduce((function(t,n,i){return-1===t&&n.viewId===e.viewId&&n.itemId===e.itemId?i:t}),-1)},e.has=function(e){return-1!==this.indexOf(e)},e.add$=function(e){var t=this.getItems();return this.has(e)||(t.push(e),gt.set("wishlist",t),this.items$.next(t)),this.items$},e.remove$=function(e){var t=this.getItems(),n=this.indexOf(e);return-1!==n&&(t.splice(n,1),gt.set("wishlist",t),this.items$.next(t)),this.items$},e.toggle$=function(e){var t=this.getItems(),n=this.indexOf(e);return-1!==n?(t.splice(n,1),gt.set("wishlist",t),this.items$.next(t)):(t.push(e),gt.set("wishlist",t),this.items$.next(t)),this.items$},u(e,null,[{key:"items$",get:function(){if(!Rn){var e=gt.get("wishlist")||[];Rn=new n.BehaviorSubject(e)}return Rn}}]),e}(),_n=function(e){this.loader=e},Ln=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(_n),Pn=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(_n),$n=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(_n),On=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(_n),Hn=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(_n),Un=function(){function e(e){var t=this;this.item=e,this.toggle=this.toggle.bind(this),this.muted_=!1,this.subscription=I.state$.subscribe((function(e){return t.muted=e.volumeMuted}))}e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getPath=function(e){return k.getPath(e.asset.folder+e.asset.file)},e.loadTexture=function(t,n){var i=e.getPath(t);return e.getLoader().load(i,n)},e.isVideo=function(e){return e.asset&&e.asset.file&&(-1!==e.asset.file.indexOf(".mp4")||-1!==e.asset.file.indexOf(".webm"))},e.isStream=function(e){return gn(e.asset)},e.isMutedStream=function(e){var t=!1;switch(e.asset.type.name){case fn.PublisherStream.name:t=I.state.role===C.Publisher;break;case fn.AttendeeStream.name:t=I.state.role===C.Attendee;break;case fn.PublisherScreen.name:case fn.AttendeeScreen.name:t=!0;break;case fn.SmartDeviceStream.name:t=I.state.role===C.SmartDevice}return t},e.isPublisherStream=function(e){return e.asset&&e.asset.type.name===fn.PublisherStream.name},e.isAttendeeStream=function(e){return e.asset&&e.asset.type.name===fn.AttendeeStream.name},e.isSmartDeviceStream=function(e){return e.asset&&e.asset.type.name===fn.SmartDeviceStream.name},e.isPublisherScreen=function(e){return e.asset&&e.asset.type.name===fn.PublisherScreen.name},e.isAttendeeScreen=function(e){return e.asset&&e.asset.type.name===fn.AttendeeScreen.name},u(e,[{key:"isVideo",get:function(){return e.isVideo(this.item)}},{key:"isStream",get:function(){return e.isStream(this.item)}},{key:"isMutedStream",get:function(){return e.isMutedStream(this.item)}},{key:"isPublisherStream",get:function(){return e.isPublisherStream(this.item)}},{key:"isAttendeeStream",get:function(){return e.isAttendeeStream(this.item)}},{key:"isSmartDeviceStream",get:function(){return e.isSmartDeviceStream(this.item)}},{key:"isPublisherScreen",get:function(){return e.isPublisherScreen(this.item)}},{key:"isAttendeeScreen",get:function(){return e.isAttendeeScreen(this.item)}},{key:"isPlayableVideo",get:function(){return this.isVideo}},{key:"isAutoplayVideo",get:function(){return this.isStream}},{key:"muted",get:function(){return this.muted_},set:function(e){this.muted_=e,this.video&&this.isVideo&&(this.video.muted=!0===e)}}]);var t=e.prototype;return t.load=function(t){var n,i=this,o=this.item;if(this.isStream&&o.streamId){var r=o.streamId,s=document.querySelector("#stream-"+r+" video");if(!s)return;var a=function e(){i.disposed||(s.removeEventListener("canplay",e),(n=i.texture=new THREE.VideoTexture(s)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,"function"==typeof t&&t(n,i))},u=this.isMutedStream;s.crossOrigin="anonymous",s.volume=u?0:1,s.muted=u,s.readyState>=s.HAVE_FUTURE_DATA?a():s.addEventListener("canplay",a)}else if(this.isVideo){var c=o.asset&&o.asset.autoplay||!1,l=o.asset&&o.asset.loop||!1,d=this.video=document.createElement("video");d.crossOrigin="anonymous",d.preload="metadata",d.volume=.8,d.muted=c,d.playsInline=!0,d.loop=l;d.oncanplay=function(){i.disposed||(d.oncanplay=null,(n=new THREE.VideoTexture(d)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,"function"==typeof t&&t(n,i),c?i.play(o.silent):d.pause())},d.ontimeupdate=function(){i.disposed||e.events$.next(new On(i))},d.onended=function(){i.disposed||l||e.events$.next(new Pn(i))},d.src=e.getPath(o),d.load()}else o.asset?e.loadTexture(o,(function(e){i.disposed||(e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,"function"==typeof t&&t(e,i))})):t(null,this);return this},t.play=function(t){var n=this;this.video&&(this.video.muted=this.muted_,this.video.play().then((function(){t||e.events$.next(new Ln(n))}),(function(e){console.log("MediaLoader.play.error",n.item.asset.file,e)})))},t.pause=function(t){this.video&&this.isVideo&&(this.video.muted=!0,this.video.pause(),t||e.events$.next(new Pn(this)))},t.toggle=function(){if(this.video&&this.isVideo)return this.video.paused?(this.video.muted=this.muted_,this.play(),!0):(this.pause(),!1)},t.dispose=function(){this.subscription.unsubscribe(),this.pause(!0),this.isVideo&&this.video&&(this.video.ontimeupdate=null,this.video.onended=null,e.events$.next(new $n(this))),this.disposed=!0,delete this.video},u(e,[{key:"progress",get:function(){return this.video?this.video.currentTime/this.video.duration:0},set:function(t){if(this.video){var n=this.video.duration*t;this.video.seekable.length>t&&this.video.currentTime!==n&&(this.video.currentTime=n,e.events$.next(new Hn(this)))}}}]),e}();Un.events$=new n.ReplaySubject(1);var Dn=function(){function e(){}return u(e,null,[{key:"defaultGeometry",get:function(){return e.defaultGeometry_||(e.defaultGeometry_=new THREE.BoxBufferGeometry(1,1,1))}},{key:"planeGeometry",get:function(){return e.planeGeometry_||(e.planeGeometry_=new THREE.PlaneBufferGeometry(1,1,2,2))}},{key:"sphereGeometry",get:function(){return e.sphereGeometry_||(e.sphereGeometry_=new THREE.SphereBufferGeometry(3,12,12))}},{key:"panoramaGeometry",get:function(){return e.panoramaGeometry_||(e.panoramaGeometry_=new THREE.SphereBufferGeometry(101,36,36))}}]),e}(),Fn=(new THREE.Vector3,function(){function e(){}return e.getDistanceToCamera=function(e,t,n,i,o){void 0===o&&(o=.88);var r=2*Math.atan(Math.PI*t/360),s=i.y*e.zoom/r,a=i.x*e.zoom/r/n;return o*Math.max(s,a)},u(e,null,[{key:"origin",get:function(){var e=this.host;if(e){var t=this.origin_;t.set(0,0,0),(e.renderer.xr.isPresenting?e.renderer.xr.getCamera(e.camera):e.camera).localToWorld(t)}return this.origin_}}]),e}());c(Fn,"origin_",new THREE.Vector3);var Vn=function(){};Vn.items=[],Vn.hittest=function(e,t,n){var i=this;void 0===t&&(t=!1);var o=!1;this.down!==t&&(this.down=t,this.lock=!1,o=!0);var r,s,a=this.items.filter((function(e){return e.parent&&!e.freezed})),u=e.intersectObjects(a),c={};u.forEach((function(e,t){var n=e.object;r=n.uuid,0===t&&(i.lastIntersectedObject!==n||o?(i.lastIntersectedObject=n,s=n):n.intersection&&(Math.abs(n.intersection.point.x-e.point.x)>.01||Math.abs(n.intersection.point.y-e.point.y)>.01)&&(n.intersection=e,n.emit("move",n))),c[r]=e})),0===u.length&&(this.lastIntersectedObject=null);return a.forEach((function(e){e.intersection=c[e.uuid],e.over=e===i.lastIntersectedObject||e.intersection&&!e.depthTest&&(!i.lastIntersectedObject||i.lastIntersectedObject.depthTest),e.down=t&&e.over&&!i.lock,e.down&&(i.lock=!0)})),s}.bind(Vn),Vn.dispose=function(e){if(e){var t=this.items.indexOf(e);-1!==t&&this.items.splice(t,1)}}.bind(Vn);var jn=function(e){function t(t,n){var i;return t=t||Dn.defaultGeometry,n=n||new THREE.MeshBasicMaterial({color:16711935}),(i=e.call(this,t,n)||this).freezed=!1,i}d(t,e),u(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){this.freezed_=e,this.children.filter((function(e){return e.__lookupGetter__("freezed")})).forEach((function(t){return t.freezed=e}))}}]);var n=t.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},t}(THREE.Mesh),Bn=function(e){function t(t,n){var i;return t=t||Dn.defaultGeometry,n=n||new THREE.MeshBasicMaterial({color:16711935}),(i=e.call(this,t,n)||this).events={},i}d(t,e);var n=t.prototype;return n.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},n.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},n.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t}(jn),Nn=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).depthTest=!0,i.over_=!1,i.down_=!1,Vn.items.push(h(i)),i}return d(t,e),u(t,[{key:"isInteractiveMesh",get:function(){return!0}},{key:"over",get:function(){return this.over_},set:function(e){this.over_!=e&&(this.over_=e,e?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(e){e=e&&this.over,this.down_!=e&&(this.down_=e,e?this.emit("down",this):this.emit("up",this))}}]),t}(Bn),zn=function(){function e(){}return e.keydown$=function(){return this.keydown$_||(this.keydown$_=n.fromEvent(window,"keydown").pipe(i.shareReplay(1))),this.keydown$_},e.keyup$=function(){return this.keyup$_||(this.keyup$_=n.fromEvent(window,"keyup").pipe(i.shareReplay(1))),this.keyup$_},e.keys$=function(){var e=this;return this.keys$_||(this.keys$_=n.merge(this.keydown$(),this.keyup$()).pipe(i.map((function(t){var n=e.keys;return"keydown"===t.type?n[t.key]=!0:delete n[t.key],e.keys})),i.startWith(this.keys),i.shareReplay(1))),this.keys$_},e.key$=function(){if(!this.key$_){var e=/\w/;this.key$_=this.keydown$().pipe(i.filter((function(t){return t.key&&t.key.match(e)})),i.map((function(e){return e.key})),i.shareReplay(1))}return this.key$_},e.typing$=function(){if(!this.typing$_){var e,t="";this.typing$_=this.key$().pipe(i.map((function(n){return e&&clearTimeout(e),t+=n,e=setTimeout((function(){t=""}),1500),t})),i.shareReplay(1))}return this.typing$_},e}();c(zn,"keys",{});var Gn=0,qn=function(){function e(){}return e.switchLoaders=function(){var e=this,t=Object.keys(this.items).map((function(t){return e.items[t]})),i=t.length?n.combineLatest(t):n.of(t);this.progress$.next(i)},e.getRef=function(){var e=++Gn;return this.items[e]=new n.BehaviorSubject({loaded:0,total:1}),this.switchLoaders(),e},e.setProgress=function(e,t,n){var i=this;void 0===n&&(n=1);var o=this.items[e];o&&o.next({loaded:t,total:n}),t>=n&&setTimeout((function(){delete i.items[e],i.switchLoaders()}),300),this.switchLoaders()},e}();c(qn,"progress",{value:0,loaded:0,total:0,count:0,title:""}),c(qn,"items",{}),c(qn,"progress$",new n.ReplaySubject(1).pipe(i.switchAll(),i.map((function(){var e=Object.keys(qn.items).map((function(e){return qn.items[e]})),t=e.reduce((function(e,t,n,i){var o=t.getValue(),r=o.loaded||0,s=o.total||1,a=r/s;return e.value+=a,e.loaded+=r,e.total+=s,e}),{value:0,loaded:0,total:0});return t.count=e.length,e.length&&(t.value/=t.count),t.title=Math.round(100*t.value)+"%",qn.progress=t,t}))));var Wn,Kn=0,Xn="complete",Yn=function(){function e(){}return e.worker=function(){return this.worker_||(this.worker_=new Worker(k.workers.prefetch)),this.worker_},e.events$=function(e){if(!("Worker"in window))return n.of({type:Xn,data:e});var t=this.worker();t.postMessage({id:Kn});var o=++Kn;return t.postMessage({id:o,assets:e}),n.fromEvent(t,"message").pipe(i.map((function(e){return e.data})),i.filter((function(t){return t.assets===e})),i.tap((function(e){})),i.takeWhile((function(e){return e.type!==Xn}),!0),i.finalize((function(){t.postMessage({id:o})})))},e.load$=function(e){return this.events$(e).pipe(i.filter((function(e){return e.type===Xn})),i.map((function(e){return e.data})))},e.prefetch=function(e){this.load$(e).subscribe((function(e){console.log("PrefetchService.prefetch",e)}))},e.cancel=function(){if(!("Worker"in window))return null;var e=this.worker();return e.postMessage({id:Kn}),e},e}(),Zn=function(){function e(e){this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.set(e)}e.contains=function(e,t,n){return e.top<=n&&n<=e.bottom&&e.left<=t&&t<=e.right},e.intersectRect=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},e.fromNode=function(t){if(t){var n=t.rect_||(t.rect_=new e);if(!t.getClientRects().length)return n;var i=t.getBoundingClientRect();return n.x=i.left,n.y=i.top,n.top=i.top,n.left=i.left,n.width=i.width,n.height=i.height,n.right=n.left+n.width,n.bottom=n.top+n.height,n.setCenter(),n}};var t=e.prototype;return t.set=function(e){e&&(Object.assign(this,e),this.right=this.left+this.width,this.bottom=this.top+this.height),this.setCenter()},t.setSize=function(e,t){this.width=e,this.height=t,this.right=this.left+this.width,this.bottom=this.top+this.height,this.setCenter()},t.setCenter=function(){var e=this.center||(this.center={});e.top=this.top+this.height/2,e.left=this.left+this.width/2,e.x=e.left,e.y=e.top},t.contains=function(t,n){return e.contains(this,t,n)},t.intersect=function(t){return e.intersectRect(this,t)},t.intersection=function(e){var t=this.intersection_||(this.intersection_={left:0,top:0,width:0,height:0,x:0,y:0,pow:{x:-1,y:-1},offset:function(e){return e=e||0,(this.top-this.rect.height/2+e)/-this.height},scroll:function(e){return e=e||0,(this.top-this.rect.height/2+e)/-this.height}});t.left=this.left,t.top=this.top,t.width=this.width,t.height=this.height,t.x=this.left+this.width/2,t.y=this.top+this.height/2,t.rect=e;var n=t.offset(0);return t.pow.y=n,t},e}(),Jn=[16763904,65484,52479,13434624,13369599,16777215],Qn=function(){function e(e){var t=this.clientId=e.clientId,n=this.container=e.container,i=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0});i.setClearColor(0,1),i.setPixelRatio(window.devicePixelRatio),i.setSize(320,240),i.toneMapping=THREE.ACESFilmicToneMapping,i.toneMappingExposure=.8,i.outputEncoding=THREE.sRGBEncoding,n.appendChild(i.domElement);var o=this.camera=new THREE.PerspectiveCamera(70,320/240,.01,1e3);o.position.set(0,0,-.5),o.target=new THREE.Vector3,o.lookAt(o.target);var r=this.scene=new THREE.Scene,s=this.light=new THREE.PointLight(16777215,1,100);s.position.set(0,2,-2),r.add(s);var a=this.head=this.addHead();r.add(a);this.remote=at.getRemoteById(t)}u(e,null,[{key:"headGeometry",get:function(){return this.headGeometry_||(this.headGeometry_=new THREE.SphereBufferGeometry(.2,36,24)),this.headGeometry_}}]);var t=e.prototype;return t.addHead=function(){var t=e.headGeometry,n=this.canvas=document.createElement("canvas");n.width=1024,n.height=512;this.ctx=this.canvas.getContext("2d");var i=this.map=new THREE.CanvasTexture(n);i.offset.x=-.25;var o=Jn[this.clientId%Jn.length],r=new THREE.MeshStandardMaterial({map:i,color:o});return this.chalk(0),new THREE.Mesh(t,r)},t.render=function(){this.tick_?++this.tick_:this.tick_=1;if(this.remote){var e=12*this.remote.getAudioLevel();this.chalk(e)}var t=this.renderer,n=this.scene,i=this.camera;t.render(n,i)},t.update=function(e){var t=e.camera;this.head.quaternion.set(t[3],t[4],t[5],t[6])},t.dispose=function(){this.subscription&&this.subscription.unsubscribe()},t.chalk=function(e){e=(e+.5*Math.PI)%(2*Math.PI);var t=30*Math.sin(e),n=10*Math.cos(e),i=256,o=this.ctx;o.fillStyle="#888888",o.fillRect(0,0,1024,512),o.fillStyle="white",o.beginPath(),o.arc(472,206,7,0,2*Math.PI),o.arc(552,206,7,0,2*Math.PI),o.closePath(),o.fill(),o.beginPath(),o.moveTo(472-n,286),o.bezierCurveTo(472-n,316,552+n,316,552+n,286),o.bezierCurveTo(552+n,i+t,472-n,i+t,472-n,286),o.closePath(),o.fill(),this.map.needsUpdate=!0},e}(),ei=THREE,ti=ei.DataTextureLoader,ni=ei.DataUtils,ii=ei.FloatType,oi=ei.HalfFloatType,ri=ei.LinearEncoding,si=ei.LinearFilter,ai=ei.NearestFilter,ui=ei.RGBEEncoding,ci=ei.RGBEFormat,li=ei.RGBFormat,di=ei.UnsignedByteType,hi=function(e){function t(t){var n;return(n=e.call(this,t)||this).type=di,n}d(t,e);var n=t.prototype;return n.parse=function(e){var t=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},n=function(e,t,n){t=t||1024;for(var i=e.pos,o=-1,r=0,s="",a=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));0>(o=a.indexOf("\n"))&&r<t&&i<e.byteLength;)s+=a,r+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return-1<o&&(!1!==n&&(e.pos+=r+o+1),s+a.slice(0,o))},i=function(e,t,n,i){var o=e[t+3],r=Math.pow(2,o-128)/255;n[i+0]=ni.toHalfFloat(e[t+0]*r),n[i+1]=ni.toHalfFloat(e[t+1]*r),n[i+2]=ni.toHalfFloat(e[t+2]*r)},o=new Uint8Array(e);o.pos=0;var r,s,a,u,c,l,d=function(e){var i,o,r=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*FORMAT=(\S+)\s*$/,u=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(i=n(e)))return t(1,"no header found");if(!(o=i.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(c.valid|=1,c.programtype=o[1],c.string+=i+"\n";!1!==(i=n(e));)if(c.string+=i+"\n","#"!==i.charAt(0)){if((o=i.match(r))&&(c.gamma=parseFloat(o[1],10)),(o=i.match(s))&&(c.exposure=parseFloat(o[1],10)),(o=i.match(a))&&(c.valid|=2,c.format=o[1]),(o=i.match(u))&&(c.valid|=4,c.height=parseInt(o[1],10),c.width=parseInt(o[2],10)),2&c.valid&&4&c.valid)break}else c.comments+=i+"\n";return 2&c.valid?4&c.valid?c:t(3,"missing image size specifier"):t(3,"missing format specifier")}(o);if(-1!==d){var h=d.width,p=d.height,f=function(e,n,i){var o=n;if(o<8||o>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(o!==(e[2]<<8|e[3]))return t(3,"wrong scanline width");var r=new Uint8Array(4*n*i);if(!r.length)return t(4,"unable to allocate buffer space");for(var s=0,a=0,u=4*o,c=new Uint8Array(4),l=new Uint8Array(u),d=i;d>0&&a<e.byteLength;){if(a+4>e.byteLength)return t(1);if(c[0]=e[a++],c[1]=e[a++],c[2]=e[a++],c[3]=e[a++],2!=c[0]||2!=c[1]||(c[2]<<8|c[3])!=o)return t(3,"bad rgbe scanline format");for(var h=0,p=void 0;h<u&&a<e.byteLength;){var f=(p=e[a++])>128;if(f&&(p-=128),0===p||h+p>u)return t(3,"bad scanline data");if(f)for(var m=e[a++],v=0;v<p;v++)l[h++]=m;else l.set(e.subarray(a,a+p),h),h+=p,a+=p}for(var g=o,y=0;y<g;y++){var b=0;r[s]=l[y+b],b+=o,r[s+1]=l[y+b],b+=o,r[s+2]=l[y+b],b+=o,r[s+3]=l[y+b],s+=4}d--}return r}(o.subarray(o.pos),h,p);if(-1!==f){var m,v,g,y;switch(this.type){case di:m=f,v=ci,g=di;break;case ii:y=f.length/4*3;for(var b=new Float32Array(y),w=0;w<y;w++)a=b,u=3*w,c=void 0,l=void 0,c=(r=f)[(s=4*w)+3],l=Math.pow(2,c-128)/255,a[u+0]=r[s+0]*l,a[u+1]=r[s+1]*l,a[u+2]=r[s+2]*l;m=b,v=li,g=ii;break;case oi:y=f.length/4*3;for(var x=new Uint16Array(y),E=0;E<y;E++)i(f,4*E,x,3*E);m=x,v=li,g=oi;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:h,height:p,data:m,header:d.string,gamma:d.gamma,exposure:d.exposure,format:v,type:g}}}return null},n.setDataType=function(e){return this.type=e,this},n.load=function(t,n,i,o){return e.prototype.load.call(this,t,(function(e,t){switch(e.type){case di:e.encoding=ui,e.minFilter=ai,e.magFilter=ai,e.generateMipmaps=!1,e.flipY=!0;break;case ii:case oi:e.encoding=ri,e.minFilter=si,e.magFilter=si,e.generateMipmaps=!1,e.flipY=!0}n&&n(e,t)}),i,o)},t}(ti),pi=function(){function e(){}return u(e,null,[{key:"defaultTexture",get:function(){return e.defaultTexture_||(e.defaultTexture_=(new THREE.TextureLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDA2IDc5LjE2NDc1MywgMjAyMS8wMi8xNS0xMTo1MjoxMyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjMgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjcyODFGQkE0QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjcyODFGQkE1QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NzI4MUZCQTJBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NzI4MUZCQTNBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz55AlN+AAAAZUlEQVR42uzQAQEAAAQDMPTvfD3YIqyT1GdTzwkQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAgAtWgAEAVbYDfaostxgAAAAASUVORK5CYII="))}},{key:"gridTexture",get:function(){return e.gridTexture_||(e.gridTexture_=(new THREE.TextureLoader).load(k.getPath(k.textures.grid)))}}]),e}(),fi=function(e){function t(n){var i,o=Dn.planeGeometry,r=t.getMaterial();return c(h(i=e.call(this,o,r)||this),"playing_",!1),i.material=r,i.host=n,i.colorOff=new THREE.Color(r.color.getHex()),i.colorOn=new THREE.Color("#888888"),i.addEventListener(),i}d(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTextureOff=function(){return t.textureOff||(t.textureOff=t.getLoader().load(k.getPath("textures/ui/play-off.png")))},t.getTextureOn=function(){return t.textureOn||(t.textureOn=t.getLoader().load(k.getPath("textures/ui/play-on.png")))},t.getMaterial=function(){return new THREE.MeshBasicMaterial({map:t.getTextureOff(),color:16777215,opacity:1,transparent:!0})},u(t,[{key:"playing",get:function(){return this.playing_},set:function(e){this.playing_!==e&&(this.playing_=e,this.material.map=e?t.getTextureOn():t.getTextureOff(),this.onOut())}}]);var n=t.prototype;return n.update=function(e){var t=this.scale,n=e.scale.x/e.scale.y;t.set(.3/n,.3,1)},n.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},n.dispose=function(){this.removeEventListener(),this.disposeMaterial()},n.onOver=function(){var e=this.material.color,t=this.colorOn,n=this.material;gsap.to(e,{r:t.r,g:t.g,b:t.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:1,duration:.2,ease:Power2.easeInOut})},n.onOut=function(){var e=this.material.color,t=this.colorOff,n=this.material;gsap.to(e,{r:t.r,g:t.g,b:t.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:this.playing?0:1,duration:.2,ease:Power2.easeInOut})},n.addEventListener=function(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.on("over",this.onOver),this.on("out",this.onOut)},n.removeEventListener=function(){this.off("over",this.onOver),this.off("out",this.onOut)},t}(Nn),mi=function(e){function t(n){var i,o=Dn.planeGeometry,r=t.getMaterial();return c(h(i=e.call(this,o,r)||this),"zoomed_",!1),i.material=r,i.host=n,i.colorOff=new THREE.Color(r.color.getHex()),i.colorOn=new THREE.Color("#888888"),i.object=new THREE.Object3D,i.addEventListener(),i}d(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTextureOff=function(){return t.textureOff||(t.textureOff=t.getLoader().load(k.getPath("textures/ui/zoom-off.png")))},t.getTextureOn=function(){return t.textureOn||(t.textureOn=t.getLoader().load(k.getPath("textures/ui/zoom-on.png")))},t.getMaterial=function(){return new THREE.MeshBasicMaterial({map:t.getTextureOff(),color:16777215,opacity:1,transparent:!0})},u(t,[{key:"zoomed",get:function(){return this.zoomed_},set:function(e){this.zoomed_!==e&&(this.zoomed_=e,this.material.map=e?t.getTextureOn():t.getTextureOff())}}]);var n=t.prototype;return n.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},n.dispose=function(){this.removeEventListener(),this.disposeMaterial()},n.onOver=function(){var e=this.material.color,t=this.colorOn;this.material;gsap.to(e,{r:t.r,g:t.g,b:t.b,duration:.2,ease:Power2.easeInOut})},n.onOut=function(){var e=this.material.color,t=this.colorOff;this.material;gsap.to(e,{r:t.r,g:t.g,b:t.b,duration:.2,ease:Power2.easeInOut})},n.onToggle=function(){this.emit("zoomed",!this.zoomed)},n.addEventListener=function(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.onToggle=this.onToggle.bind(this),this.on("over",this.onOver),this.on("out",this.onOut),this.on("down",this.onToggle)},n.removeEventListener=function(){this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)},t}(Nn),vi="\nvarying vec2 vUvShader;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\tvUvShader = uv;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",gi="\n#define USE_MAP\n#define threshold 0.55\n#define padding 0.05\n\nvarying vec2 vUvShader;\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform vec3 chromaKeyColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(vec3(1.0), opacity);\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tvec4 chromaKey = vec4(chromaKeyColor, 1.0);\n    vec3 chromaKeyDiff = mapRgba.rgb - chromaKey.rgb;\n    float chromaKeyValue = smoothstep(threshold - padding, threshold + padding, dot(chromaKeyDiff, chromaKeyDiff));\n\tmapRgba = mapTexelToLinear(mapRgba);\n\t/*\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tplayMapRgba = mapTexelToLinear(playMapRgba);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity * chromaKeyValue);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\t}\n\t*/\n\t// diffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\tdiffuseColor = vec4(mapRgba.rgb, opacity * chromaKeyValue);\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapRgba = texture2D(lightMap, vUv2);\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear(lightMapRgba).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3(1.0);\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",yi=function(e){function t(n,i,o,r){var s,a=t.getMaterialByItem(n);c(h(s=e.call(this,o,a)||this),"zoomed_",!1),s.item=n,s.view=i,s.items=i.items,s.host=r,s.uniforms=t.getUniformsByItem(n),s.object=new THREE.Object3D,s.tempPosition=new THREE.Vector3,s.tempRotation=new THREE.Vector3,n.silent=s.isAutoplayLoop;s.mediaLoader=new Un(n);return s.onOver=s.onOver.bind(h(s)),s.onOut=s.onOut.bind(h(s)),s.onToggle=s.onToggle.bind(h(s)),s.onZoomed=s.onZoomed.bind(h(s)),s.addPlayBtn(),s.addZoomBtn(),s.userData.render=function(e,t){s.render(h(s),e,t)},s}d(t,e),t.getMaterial=function(e){return new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,vertexShader:vi,fragmentShader:e?gi:"\n#define USE_MAP\n\nvarying vec2 vUvShader;\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(vec3(1.0), opacity);\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tmapRgba = mapTexelToLinear(mapRgba);\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tplayMapRgba = mapTexelToLinear(playMapRgba);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity);\n\t}\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapRgba = texture2D(lightMap, vUv2);\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear(lightMapRgba).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3(1.0);\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",uniforms:{map:{type:"t",value:pi.defaultTexture},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},playMap:{type:"t",value:pi.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}})},t.getChromaKeyMaterial=function(e){void 0===e&&(e=[0,1,0]);var t=new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,vertexShader:vi,fragmentShader:gi,uniforms:{map:{type:"t",value:null},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},chromaKeyColor:{value:new THREE.Color(e[0],e[1],e[2])},playMap:{type:"t",value:pi.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}});return t.map=!0,t},t.isPublisherStream=function(e){return e.clientInfo&&e.clientInfo.role===C.Publisher&&e.clientInfo.uid===e.getId()},t.isAttendeeStream=function(e){return e.clientInfo&&e.clientInfo.role===C.Attendee&&e.clientInfo.uid===e.getId()},t.isSmartDeviceStream=function(e){return e.clientInfo&&e.clientInfo.role===C.SmartDevice&&e.clientInfo.uid===e.getId()},t.isPublisherScreen=function(e){return e.clientInfo&&e.clientInfo.role===C.Publisher&&e.clientInfo.screenUid===e.getId()},t.isAttendeeScreen=function(e){return e.clientInfo&&e.clientInfo.role===C.Attendee&&e.clientInfo.screenUid===e.getId()},t.getTypeMatcher=function(e){var t;switch(e.name){case fn.PublisherStream.name:t=this.isPublisherStream;break;case fn.AttendeeStream.name:t=this.isAttendeeStream;break;case fn.SmartDeviceStream.name:t=this.isSmartDeviceStream;break;case fn.PublisherScreen.name:t=this.isPublisherScreen;break;case fn.AttendeeScreen.name:t=this.isAttendeeScreen;break;default:t=function(e){return!1}}return t},t.getStreamId$=function(e){var t=this;if(!e.asset)return n.of(null);var o=e.asset.type,r=e.asset.file;return gn(e.asset)?at.streams$.pipe(i.map((function(n){var i,r=0,s=t.getTypeMatcher(o);return n.forEach((function(t){s(t)&&(r===e.asset.index&&(i=t),r++)})),i?i.getId():null}))):n.of(r)},t.getMaterialByItem=function(e){return e.asset&&e.asset.chromaKeyColor?t.getChromaKeyMaterial(e.asset.chromaKeyColor):(e.asset,new THREE.MeshBasicMaterial({color:8947848}))},t.getUniformsByItem=function(e){var t=null;return e.asset&&(t={mapTween:1,playMapTween:0,opacity:0}),t},u(t,[{key:"editing",get:function(){return this.editing_},set:function(e){this.editing_!==e&&(this.editing_=e,this.zoomed="media"===this.view.type.name||!e&&this.zoomed)}}]);var o=t.prototype;return o.load=function(e){var t=this;if(this.playBtn&&this.remove(this.playBtn),this.zoomBtn&&this.remove(this.zoomBtn),!this.item.asset)return this.onAppear(),void("function"==typeof e&&e(this));var n=this.material;this.mediaLoader.load((function(i){var o=t.mediaLoader;o&&(i&&(i.encoding=THREE.sRGBEncoding,n.map=i,n.uniforms&&(n.uniforms.map.value=i,n.uniforms.mapResolution.value=new THREE.Vector2(i.image.width||i.image.videoWidth,i.image.height||i.image.videoHeight),o.isPlayableVideo&&t.makePlayMap(i,(function(e){e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,n.uniforms.playMap.value=e,n.uniforms.playMapResolution.value=new THREE.Vector2(e.image.width,e.image.height),n.needsUpdate=!0})))),n.needsUpdate=!0,t.onAppear(),o.isPlayableVideo&&t.playBtn&&(n.uniforms&&(n.uniforms.isVideo.value=!0),t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",t.onToggle),t.add(t.playBtn)),t.zoomBtn&&t.add(t.zoomBtn),"function"==typeof e&&e(t))}))},o.makePlayMap=function(e,t){var n=e.image.width||e.image.videoWidth,i=e.image.height||e.image.videoHeight,o=n/i,r=document.createElement("canvas");r.width=n,r.height=i;var s=r.getContext("2d");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high";var a=new Image;a.onload=function(){var e,u,c=a.width/a.height;o>c?u=(e=.32*i)/c:e=(u=.32*n)*c,s.drawImage(a,n/2-e/2,i/2-u/2,e,u);var l=new THREE.CanvasTexture(r);"function"==typeof t&&t(l)},a.crossOrigin="anonymous",a.src=k.getPath("textures/ui/play.png")},o.events$=function(){var e=this,t=this.item,n=this.items;return t.asset&&t.asset.linkedPlayId&&this.freeze(),Un.events$.pipe(i.filter((function(e){return e.loader.item&&e.loader.item.id===t.id})),i.map((function(i){(i instanceof Ln?(e.playing=!0,e.isAutoplayLoop||(e.playBtn&&(e.playBtn.playing=!0),e.emit("playing",!0)),e.onOut()):i instanceof Pn?(e.playing=!1,e.playBtn&&(e.playBtn.playing=!1),e.emit("playing",!1),e.onOut()):i instanceof Hn&&e.emit("currentTime",i.loader.video.currentTime),t.asset&&t.asset.linkedPlayId)&&(n.find((function(e){return e.asset&&-1!==i.src.indexOf(e.asset.file)&&i.id===t.asset.linkedPlayId}))&&(i instanceof Ln?e.play():i instanceof Pn&&e.pause()));return i})))},o.onAppear=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,opacity:1,ease:Power2.easeInOut,onUpdate:function(){t.uniforms.opacity.value=e.opacity}}),this.zoomed="media"===this.view.type.name||!this.editing&&this.zoomed},o.onDisappear=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,opacity:0,ease:Power2.easeInOut,onUpdate:function(){t.uniforms.opacity.value=e.opacity}})},o.onOver=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,mapTween:this.playing?0:1,playMapTween:1,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){t.uniforms.mapTween.value=e.mapTween,t.uniforms.playMapTween.value=e.playMapTween,t.uniforms.opacity.value=e.opacity}}),this.playBtn&&this.playBtn.onOver()},o.onOut=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,mapTween:this.playing?0:1,playMapTween:0,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){t.uniforms.mapTween.value=e.mapTween,t.uniforms.playMapTween.value=e.playMapTween,t.uniforms.opacity.value=e.opacity}}),this.playBtn&&this.playBtn.onOut()},o.onToggle=function(){this.playing=this.mediaLoader.toggle(),this.playBtn&&(this.playBtn.playing=this.playing),this.emit("playing",this.playing),this.onOut()},o.play=function(){this.mediaLoader.play()},o.pause=function(){this.mediaLoader.pause()},o.setPlayingState=function(e){this.playing!==e&&(this.playing=e,e?this.mediaLoader.play():this.mediaLoader.pause(),this.onOut(),this.playBtn&&(this.playBtn.playing=e))},o.setZoomedState=function(e){this.zoomed=e},o.setCurrentTime=function(e){this.mediaLoader.video&&(this.mediaLoader.video.currentTime=e)},o.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())},o.disposeMediaLoader=function(){var e=this.mediaLoader;e&&(e.isPlayableVideo&&(this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)),e.dispose(),this.mediaLoader=null)},o.dispose=function(){this.removePlayBtn(),this.removeZoomBtn(),this.disposeMediaLoader()},o.addPlayBtn=function(){if(this.removePlayBtn(),!this.isAutoplayLoop){var e=this.playBtn=new fi(this.host);e.on("over",this.onOver),e.on("out",this.onOut),e.on("down",this.onToggle),e.position.z=.01}},o.removePlayBtn=function(){this.playBtn&&(this.remove(this.playBtn),this.playBtn.off("over",this.onOver),this.playBtn.off("out",this.onOut),this.playBtn.off("down",this.onToggle),this.playBtn.dispose(),delete this.playBtn)},o.onZoomed=function(e){this.zoomed=e,this.emit("zoomed",e)},o.addZoomBtn=function(){(this.removeZoomBtn(),"media"===this.view.type.name||this.item.asset&&this.item.asset.chromaKeyColor)||(this.zoomBtn=new mi(this.host)).on("zoomed",this.onZoomed)},o.removeZoomBtn=function(){this.zoomBtn&&(this.remove(this.zoomBtn),this.zoomBtn.off("zoomed",this.onZoomed),this.zoomBtn.dispose(),this.zoomBtn=null,delete this.zoomBtn)},o.updateByItem=function(e){this.disposeMaterial(),this.disposeMediaLoader(),this.material=t.getMaterialByItem(e),this.uniforms=t.getUniformsByItem(e),this.addPlayBtn(),this.addZoomBtn(),e.silent=this.isAutoplayLoop,this.mediaLoader=new Un(e)},o.updateFromItem=function(e){e.position&&this.position.fromArray(e.position),e.rotation&&this.rotation.fromArray(e.rotation),e.scale&&this.scale.fromArray(e.scale),this.playBtn&&this.playBtn.update(this),this.updateZoom()},o.updateZoom=function(){if(this.originalPosition=this.position.clone(),this.originalScale=this.scale.clone(),this.originalQuaternion=this.quaternion.clone(),this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion),this.zoomBtn){var e=this.zoomBtn.scale,t=this.zoomBtn.position,n=this.scale.x/this.scale.y,i=.1;e.set(i/n,i,1),t.x=.5-i/n/2,t.y=-.45,t.z=.01}},o.render=function(e,t){if(!this.editing){var n=this.object;this.zoomed&&!this.host.renderer.xr.isPresenting&&this.updateObjectMatrix(),this.position.copy(n.position),this.scale.copy(n.scale),this.quaternion.copy(n.quaternion)}},o.updateObjectMatrix=function(){var e=this.object,t=this.host;if(this.zoomed){var n,i=this.originalScale,o=t.camera,r=o.fov,s=o.aspect,a=this.tempPosition,u=this.tempRotation;n=.01;var c=t.renderer.xr;if(c.isPresenting){var l=(o=c.getCamera(o)).projectionMatrix.elements,d=l[0],h=l[5];s=h/d;r=2*Math.atan(1/h)*57.29577951308232,n=1}e.scale.copy(i).multiplyScalar(n);var p=Fn.getDistanceToCamera(o,r,s,e.scale);o.getWorldDirection(u),u.multiplyScalar(p),a.set(0,0,0),o.localToWorld(a),a.add(u),e.position.copy(a),e.lookAt(Fn.origin),c.isPresenting&&(e.position.y-=e.scale.y/2)}},u(t,[{key:"isAutoplayLoop",get:function(){return"media"!==this.view.type.name&&this.item.asset&&this.item.asset.autoplay&&this.item.asset.loop}},{key:"zoomed",get:function(){return this.zoomed_},set:function(e){this.zoomed_!==e&&(this.zoomed_=e,e?(this.renderOrder=k.renderOrder.panel+5,this.material.depthTest=!0):(this.renderOrder=0,this.material.depthTest=!0,this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion)),this.material.needsUpdate=!0,this.updateObjectMatrix(),this.zoomBtn&&(this.zoomBtn.zoomed=e))}}]),t}(Nn),bi=function(){this.x=0,this.y=0},wi=function(e){e&&Object.assign(this,e)},xi=function(e){function t(t){var n;return(n=e.call(this,t)||this).distance=new bi,n.strength=new bi,n.speed=new bi,n}return d(t,e),t}(wi),Ei=function(e){function t(t){var n;return(n=e.call(this,t)||this).distance=new bi,n.strength=new bi,n.speed=new bi,n}return d(t,e),t}(wi),Si=function(e){function t(t){return e.call(this,t)||this}return d(t,e),t}(wi),Ti=function(){function e(){}return e.getPosition=function(e,t){return e instanceof MouseEvent?t?(t.x=e.clientX,t.y=e.clientY):t={x:e.clientX,y:e.clientY}:window.TouchEvent&&e instanceof TouchEvent&&e.touches.length>0&&(t?(t.x=e.touches[0].pageX,t.y=e.touches[0].pageY):t={x:e.touches[0].pageX,y:e.touches[0].pageY}),t},e.down$=function(e,t){var o,r=this;return n.merge(n.fromEvent(e,"mousedown").pipe(i.filter((function(e){return 0===e.button}))),n.fromEvent(e,"touchstart")).pipe(i.map((function(n){if((o=o||new xi).node=e,o.target=n.target,o.originalEvent=n,o.down=r.getPosition(n,o.down),o.down)return o.distance=new bi,o.strength=new bi,o.speed=new bi,t.next(o),o})),i.filter((function(e){return void 0!==e})))},e.move$=function(e,t,o,r){var s,a=this;return n.fromEvent(document,r.originalEvent instanceof MouseEvent?"mousemove":"touchmove").pipe(i.startWith(r),i.map((function(n){if((s=s||new Ei).node=e,s.target=n.target,s.originalEvent=n,s.position=a.getPosition(n,s.position),void 0!==r.down&&void 0!==s.position)return s.distance.x=s.position.x-r.down.x,s.distance.y=s.position.y-r.down.y,s.strength.x=s.distance.x/window.innerWidth*2,s.strength.y=s.distance.y/window.innerHeight*2,s.speed.x=r.speed.x+.1*(s.strength.x-r.strength.x),s.speed.y=r.speed.y+.1*(s.strength.y-r.strength.y),r.distance.x=s.distance.x,r.distance.y=s.distance.y,r.speed.x=s.speed.x,r.speed.y=s.speed.y,r.strength.x=s.strength.x,r.strength.y=s.strength.y,t.next(s),s})))},e.dismissEvent=function(e,t,n,i){return Wn=Wn||new Si,t.next(Wn),n.next(),i&&Math.abs(i.distance.x)>10&&(e.preventDefault(),e.stopImmediatePropagation()),Wn},e.up$=function(e,t,o,r){var s=this;return n.fromEvent(document,r.originalEvent instanceof MouseEvent?"mouseup":"touchend").pipe(i.map((function(e){return s.dismissEvent(e,t,o,r)})))},e.observe$=function(t){var o=this;t=t||document;var r=e.events$=new n.ReplaySubject(1),s=e.dismiss$=new n.Subject;return this.down$(t,r).pipe(i.switchMap((function(a){return e.downEvent=a,n.merge(o.move$(t,r,s,a),o.up$(t,r,s,a)).pipe(i.takeUntil(s))})),i.switchMap((function(){return r})))},e}(),ki="panorama",Mi="model",Ii=function(){},Ci=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ii),Ri=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ii),Ai=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ii),_i=new Ai,Li=new Ci,Pi=new Ri,$i=function(){var e=t.prototype;function t(e){this.mode_=t.mode=ki,this.dolly_=70,this.zoom_=70,this.longitude=0,this.latitude=0,this.direction=1,this.radius=101,this.position=new THREE.Vector3,this.inertia=new THREE.Vector2,this.rotation=new THREE.Euler(0,0,0,"XYZ"),this.target=new THREE.Vector3,this.updatePosition=new THREE.Vector3,this.updateTarget=new THREE.Vector3,this.camera=e,this.setLongitudeLatitude(0,0),this.events$=new n.ReplaySubject(1)}return e.getDollyValue=function(){return 1-(this.dolly_-15)/60-.5},e.getZoomValue=function(){return 2-(this.zoom_-15)/60},u(t,[{key:"dolly",get:function(){return this.dolly_},set:function(e){var t=THREE.Math.clamp(e,15,75);this.dolly_!==t&&(this.dolly_=t,this.markAsDirty())}},{key:"zoom",get:function(){return this.zoom_},set:function(e){var t=THREE.Math.clamp(e,15,75);this.zoom_!==t&&(this.zoom_=t,this.markAsDirty())}},{key:"mode",get:function(){return this.mode_},set:function(e){this.mode_!==e&&(this.mode_=e,t.mode=e,this.markAsDirty())}},{key:"controlled",get:function(){return I.state.controlling&&I.state.controlling!==I.state.uid}},{key:"controlling",get:function(){return I.state.controlling&&I.state.controlling===I.state.uid}},{key:"silencing",get:function(){return I.state.silencing}},{key:"silenced",get:function(){return I.state.silencing&&I.state.role===C.Streamer}},{key:"spyed",get:function(){return I.state.spying&&I.state.spying===I.state.uid}},{key:"spying",get:function(){return I.state.spying&&I.state.spying!==I.state.uid}},{key:"isMediaView",get:function(){return kn.view&&kn.view.type.name===$t.Media.name}},{key:"locked",get:function(){return this.controlled||this.spying||this.isMediaView}}]),e.setOrientation=function(e){e&&(this.setLongitudeLatitude(e.longitude,e.latitude),this.markAsDirty())},e.getOrientation=function(){return{latitude:this.latitude,longitude:this.longitude}},e.setLongitudeLatitude=function(e,t){t=Math.max(-80,Math.min(80,t)),this.longitude=(e<0?360+e:e)%360,this.latitude=t;var n=THREE.Math.degToRad(90-t),i=THREE.Math.degToRad(e);this.phi=n,this.theta=i},e.observe$=function(e){var t,o,r=this;return n.combineLatest([zn.keys$(),Ti.observe$(e)]).pipe(i.filter((function(e){return!r.locked})),i.map((function(e){var n=e[0],i=e[1];if(i instanceof xi)t=r.latitude,o=r.longitude;else if(i instanceof Ei)if(n.Shift)r.events$.next(Li);else if(n.Control)r.events$.next(Pi);else{var s=r.mode_===Mi?-1:1;r.setLongitudeLatitude(o-.1*i.distance.x*s,t+.1*i.distance.y)}return i})),i.filter((function(e){return e instanceof Ei})),i.startWith({latitude:this.latitude,longitude:this.longitude}),i.tap((function(e){return r.markAsDirty()})),i.switchMap((function(e){return r.events$})))},e.walk=function(e,t){var n,i=this;switch(this.mode_){case Mi:n=3;break;default:n=this.radius}var o=new THREE.Vector2(e.x,e.y).normalize().multiplyScalar(n),r=Math.atan2(o.y,o.x),s=THREE.MathUtils.radToDeg(r);s=(s<0?360+s:s)%360;var a=this.latitude,u=this.longitude,c=s-u;c=Math.abs(c)>180?c-c/Math.abs(c)*360:c;var l=0-a;l=Math.abs(l)>90?l-l/Math.abs(l)*90:l;var d={tween:0};gsap.to(d,{duration:.7,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){i.setLongitudeLatitude(u+c*d.tween,a+l*d.tween),i.position.set(e.x*d.tween,0,e.y*d.tween),i.markAsDirty()},onComplete:function(){"function"==typeof t&&t(s,0)}})},e.walkComplete=function(e,t){this.setLongitudeLatitude(e,t),this.position.set(0,0,0),this.markAsDirty()},e.lookAt=function(e){if(e){var t,n=e.position.clone();switch(n=this.camera.parent.worldToLocal(n),this.mode_){case Mi:t=3;break;default:t=this.radius}var i=new THREE.Vector3(n.x,n.z,n.y).normalize().multiplyScalar(t),o=Math.atan2(i.y,i.x),r=Math.acos(i.z/t),s=THREE.MathUtils.radToDeg(o);s=(s<0?360+s:s)%360;var a=90-THREE.MathUtils.radToDeg(r);a=Math.max(-80,Math.min(80,a)),this.setLongitudeLatitude(s,a),this.markAsDirty()}},e.setVRCamera=function(e){if(e){var t=this.radius,n=new THREE.Vector3(0,0,-t),i=new THREE.Quaternion(e[3],e[4],e[5],e[6]);n.applyQuaternion(i);var o=new THREE.Vector3(n.x,n.z,n.y).normalize().multiplyScalar(t),r=Math.atan2(o.y,o.x),s=Math.acos(o.z/t),a=THREE.MathUtils.radToDeg(r);a=(a<0?360+a:a)%360;var u=90-THREE.MathUtils.radToDeg(s);u=Math.max(-80,Math.min(80,u)),this.setLongitudeLatitude(a,u),this.markAsDirty()}},e.render=function(){I.state.hosted||(this.longitude+=.025,this.isDirty=!0),this.isDirty&&(this.isDirty=!1,this.update())},e.markAsDirty=function(){this.isDirty=!0},e.update=function(){var e,t=this.updatePosition,n=this.updateTarget,i=this.getZoomValue(),o=(this.getDollyValue(),THREE.MathUtils.degToRad(90-this.latitude)),r=THREE.MathUtils.degToRad(this.longitude),s=this.camera,a=s.parent;switch(this.mode_){case Mi:e=3,t.copy(this.position),n.x=this.position.x+e*Math.sin(o)*Math.cos(r),n.y=this.position.y+e*Math.cos(o),n.z=this.position.z+e*Math.sin(o)*Math.sin(r),n=a.worldToLocal(n),s.target.copy(t),s.position.copy(n);break;default:e=this.radius,n.x=this.position.x+e*Math.sin(o)*Math.cos(r),n.y=this.position.y+e*Math.cos(o),n.z=this.position.z+e*Math.sin(o)*Math.sin(r),t.copy(this.position),n=a.worldToLocal(n),s.target.copy(n),s.position.copy(t)}s.zoom=i,s.lookAt(s.target),s.updateProjectionMatrix(),kn.view&&(kn.view.lastOrientation.longitude=this.longitude,kn.view.lastOrientation.latitude=this.latitude),this.events$.next(_i)},t}();$i.orbitMoveEvent=_i;var Oi=0,Hi="progress",Ui="complete",Di=function(){function e(){}return e.worker=function(){return this.worker_||(this.worker_=new Worker(k.workers.image)),this.worker_},e.events$=function(e,t){if(!("Worker"in window)||this.isBlob(e)||this.isCors(e))return n.of({type:Ui,data:e});var o=++Oi,r=this.worker();return r.postMessage({src:e,id:o,size:t}),n.fromEvent(r,"message").pipe(i.map((function(e){return e.data})),i.filter((function(t){return t.src===e})),i.auditTime(100),i.map((function(e){if(e.type===Ui&&e.data instanceof Blob){var t=URL.createObjectURL(e.data);e.data=t}return e})),i.takeWhile((function(e){return e.type!==Ui}),!0),i.finalize((function(){r.postMessage({id:o})})))},e.load$=function(e,t){return this.events$(e,t).pipe(i.filter((function(e){return e.type===Ui})),i.map((function(e){return e.data})))},e.isCors=function(e){return!1},e.isBlob=function(e){return 0===e.indexOf("blob:")},e}(),Fi=function(){function e(){}return e.load=function(e,t,n){if(Un.events$.next(new $n(this)),this.video=null,e)return e.type.name===fn.PublisherStream.name?this.loadPublisherStreamBackground(t,n):-1!==e.file.indexOf(".mp4")||-1!==e.file.indexOf(".webm")?this.loadVideoBackground(k.getPath(e.folder),e.file,t,n):-1!==e.file.indexOf(".m3u8")?this.loadHlslVideoBackground(e.file,t,n):-1!==e.file.indexOf(".hdr")?this.loadRgbeBackground(k.getPath(e.folder),e.file,t,n):this.loadBackgroundImageService(k.getPath(e.folder),e.file,t,n)},e.loadBackground=function(e,t,n,i){var o=qn.getRef(),r=new THREE.TextureLoader;return r.setPath(e).load(t,(function(e){e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof i&&i(e),qn.setProgress(o,1)}),(function(e){qn.setProgress(o,e.loaded,e.total)})),r},e.loadBackgroundImageService=function(e,t,o,r){var s=qn.getRef(),a=new Image;Di.events$(e+t).pipe(i.tap((function(e){e.type===Hi&&qn.setProgress(s,e.data.loaded,e.data.total)})),i.filter((function(e){return e.type===Ui})),i.switchMap((function(e){var t=n.fromEvent(a,"load");return a.crossOrigin="anonymous",a.src=e.data,t})),i.takeWhile((function(e){return e.type!==Ui}),!0)).subscribe((function(e){var t=new THREE.Texture(a);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.format=THREE.RGBFormat,t.needsUpdate=!0,"function"==typeof r&&(r(t),URL.revokeObjectURL(e.data)),qn.setProgress(s,1)}))},e.loadRgbeBackground=function(e,t,n,i){var o=qn.getRef(),r=new hi;return r.setDataType(THREE.UnsignedByteType).setPath(e).load(t,(function(e){"function"==typeof i&&i(e,!0),qn.setProgress(o,1)}),(function(e){qn.setProgress(o,e.loaded,e.total)})),r},e.loadHlslVideoBackground=function(e,t,n){var i=qn.getRef(),o=document.createElement("video");if(o.oncanplay=function(){!function(){o.oncanplay=null;var e=new THREE.VideoTexture(o);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof n&&n(e),qn.setProgress(i,1)}()},Hls.isSupported()){var r=new Hls;r.attachMedia(o),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(e),r.on(Hls.Events.MANIFEST_PARSED,(function(e,t){o.play()}))}))}},e.play=function(e){var t=this,n=this.video;n&&(n.muted=this.muted_,n.play().then((function(){e||Un.events$.next(new Ln(t))}),(function(e){console.log("PanoramaLoader.play.error",n.src,e)})))},e.pause=function(e){var t=this.video;t&&(t.muted=!0,t.pause(),e||Un.events$.next(new Pn(this)))},e.loadVideoBackground=function(e,t,n,i){var o=this,r=qn.getRef();this.video=!0;var s=this.video;s.oncanplay=function(){s.oncanplay=null;var e=new THREE.VideoTexture(s);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof i&&i(e),qn.setProgress(r,1),o.play()},s.ontimeupdate=function(){Un.events$.next(new On(o))},s.onended=function(){},s.crossOrigin="anonymous",s.src=e+t,s.load()},e.loadPublisherStreamBackground=function(e,t){var n=this;at.getPublisherStreamId$().pipe(i.first()).subscribe((function(e){return function(e){var i=document.querySelector("#stream-"+e+" video");if(i){var o=function(){var e=n.texture=new THREE.VideoTexture(i);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof t&&t(e)};i.crossOrigin="anonymous",i.readyState>=i.HAVE_FUTURE_DATA?o():i.oncanplay=function(){o()}}}(e)}))},u(e,null,[{key:"video",get:function(){return this.video_},set:function(e){if(this.video_&&(this.video_.muted=!0,this.video_.pause(),this.video_.parentNode&&this.video_.parentNode.removeChild(this.video_),this.video_=null),e){var t=this.video_=document.createElement("video");t.loop=!0,t.playsInline=!0,t.crossOrigin="anonymous"}}},{key:"muted",get:function(){return this.muted_},set:function(e){this.muted_=e,this.video&&(this.video.muted=!0===e)}},{key:"cubeRenderTarget",set:function(e){this.cubeRenderTarget_&&(this.cubeRenderTarget_.texture.dispose(),this.cubeRenderTarget_.dispose()),this.cubeRenderTarget_=e}},{key:"texture",set:function(e){this.texture_&&this.texture_.dispose(),this.texture_=e}},{key:"progress",get:function(){var e=this.video;return e?e.currentTime/e.duration:0},set:function(e){var t=this.video;if(t){var n=t.duration*e;t.seekable.length>e&&t.currentTime!==n&&(t.currentTime=n,Un.events$.next(new Hn(this)))}}}]),e}(),Vi=function(){function e(e){this.muted_=!1,this.subscription=I.state$.subscribe((function(e){return Fi.muted=e.volumeMuted})),this.tween=0,this.create(e)}var t=e.prototype;return t.create=function(e){var t=this;this.renderer=e,this.onCubeMapDispose=this.onCubeMapDispose.bind(this);var n=new THREE.BoxGeometry(202,202,202),i=this.getBlackMaterial(),o=new Nn(n,i);o.userData={render:function(e,n,i,r,s){o.matrixWorld.copyPosition(s.matrixWorld);var a=t.cubeMap,u=t.texture;a&&u&&u.isVideoTexture&&t.updateCubeMapEquirectangularTexture(a,i,u)}},o.name="[panorama]",this.mesh=o},t.getBlackMaterial=function(){return new THREE.MeshBasicMaterial({name:"PanoramaStandardMaterial",color:0,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1})},t.getShaderMaterial=function(e){var t=new THREE.ShaderMaterial({name:"PanoramaCubeMaterial",uniforms:this.cloneUniforms(THREE.ShaderLib.cube.uniforms),vertexShader:THREE.ShaderLib.cube.vertexShader,fragmentShader:THREE.ShaderLib.cube.fragmentShader,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1});e.mapping=THREE.EquirectangularReflectionMapping;var n=this.toCubeMap(e,this.renderer);return t.map=n,t.uniforms.envMap.value=n,t.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.needsUpdate=!0,this.mesh.geometry.deleteAttribute("normal"),this.mesh.geometry.deleteAttribute("uv"),Object.defineProperty(t,"envMap",{get:function(){return this.uniforms.envMap.value},configurable:!0}),t},t.makeEnvMap=function(e){var t=this.mesh.material;if(t.uniforms){e.mapping=THREE.EquirectangularReflectionMapping;var n=this.toCubeMap(e,this.renderer);t.map=n,t.uniforms.envMap.value=n,t.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,t.needsUpdate=!0}else t.dispose(),t=this.getShaderMaterial(e),this.mesh.material=t},t.toCubeMap=function(e,t){this.cubeMap&&this.cubeMap.dispose();var n=e.image,i=n.height||n.videoHeight,o=new THREE.WebGLCubeRenderTarget(i/2,{generateMipmaps:!0,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.CubeUVReflectionMapping,format:THREE.RGBFormat});return o.addEventListener("dispose",this.onCubeMapDispose),this.setCubeMapEquirectangularTexture(o,e),this.updateCubeMapEquirectangularTexture(o,t,e),this.cubeMap=o,this.texture=e,this.mapTextureMapping(o.texture,e.mapping)},t.setCubeMapEquirectangularTexture=function(e,t){e.texture.type=t.type,e.texture.format=THREE.RGBFormat,e.texture.encoding=THREE.sRGBEncoding,e.texture.generateMipmaps=t.generateMipmaps,e.texture.minFilter=t.minFilter,e.texture.magFilter=t.magFilter,e.texture.needsUpdate=!0;var n={tEquirect:{value:null}},i="\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\t\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\t\t\t\t\t}\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\t\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t\t#include <project_vertex>\n\t\t\t\t\t}\n\t\t\t\t",o="\n\t\t\t\t\tuniform sampler2D tEquirect;\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\t#include <common>\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\t\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\t\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t\t\t\t\t}\n\t\t\t\t",r=new THREE.BoxGeometry(5,5,5),s=new THREE.ShaderMaterial({name:"CubemapFromEquirect",uniforms:this.cloneUniforms(n),vertexShader:i,fragmentShader:o,side:THREE.BackSide,blending:THREE.NoBlending});s.uniforms.tEquirect.value=t;var a=new THREE.Mesh(r,s),u=new THREE.CubeCamera(1,10,e);return e.camera=u,e.mesh=a,e},t.updateCubeMapEquirectangularTexture=function(e,t,n){var i=n.minFilter;n.minFilter===THREE.LinearMipmapLinearFilter&&(n.minFilter=THREE.LinearFilter),e.camera.update(t,e.mesh),n.minFilter=i},t.cloneUniforms=function(e){var t={};for(var n in e)for(var i in t[n]={},e[n]){var o=e[n][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?t[n][i]=o.clone():Array.isArray(o)?t[n][i]=o.slice():t[n][i]=o}return t},t.mapTextureMapping=function(e,t){return t===THREE.EquirectangularReflectionMapping?e.mapping=THREE.CubeReflectionMapping:t===THREE.EquirectangularRefractionMapping&&(e.mapping=THREE.CubeRefractionMapping),e},t.onCubeMapDispose=function(){var e=this.cubeMap;e&&(e.removeEventListener("dispose",this.onCubeMapDispose),e.texture.dispose(),e.mesh.geometry.dispose(),e.mesh.material.dispose(),void 0!==e&&(this.cubeMap=null))},t.change=function(e,t,n,i){var o=e instanceof Dt?e.tiles[e.index_]:e,r=this.mesh.material;this.load(o,t,(function(t){"function"==typeof i&&i(e),r.uniforms&&r.uniforms.uTween&&(r.uniforms.uTween.value=1,r.needsUpdate=!0),"function"==typeof n&&n(t)}))},t.crossfade=function(e,t,n){var i=this.mesh.material;this.load(e,t,(function(e){i.uniforms&&i.uniforms.uTween&&(i.uniforms.uTween.value=1,i.needsUpdate=!0),"function"==typeof n&&n(e)}))},t.load=function(e,t,n){var i=this,o=e.type.name===$t.Media.name?xn.defaultMediaAsset:e.asset;o&&(o.type.name!==fn.Model.name?(this.currentAsset=o.folder+o.file,Fi.load(o,t,(function(e,t){if(o.folder+o.file===i.currentAsset){var r=i.makeEnvMap(e);"function"==typeof n&&n(r)}else e.dispose()}))):"function"==typeof n&&n(null))},t.dispose=function(){this.subscription.unsubscribe(),this.cubeMap&&this.cubeMap.dispose()},e}(),ji=4/3,Bi=[16777215,16763904,65484,52479,13434624,13369599],Ni=function(){var e=t.prototype;function t(){var e=t.geometry,n=new THREE.MeshBasicMaterial({color:16777215});this.plane=new THREE.Mesh(e,n)}return e.setRemote=function(e,t,n){var i=this;this.remote=e;var o,r,s,a,u,c,l;n<4?(r=0,s=t,c=0,l=(u=(a=.12*(o=1))/ji)/2-n*u/2,this.plane.position.set(c,l+u*t,.005)):(o=.5,r=t%2,s=Math.floor(t/2),c=-(a=.12*o)/2,l=(u=a/ji)/2-Math.ceil(n/2)*u/2,this.plane.position.set(c+r*a,l+s*u,.005)),this.plane.scale.set(o,o,o),"number"==typeof e?this.plane.material.color.set(Bi[t%Bi.length]):e.texture?(this.plane.material.map=e.texture,this.plane.material.needsUpdate=!0):this.addStreamTexture(e.getId(),(function(t){e.texture=t,i.plane.material.map=t,i.plane.material.needsUpdate=!0}))},e.addStreamTexture=function(e,t){var n="#stream-"+e,i=document.querySelector(n+" video");if(i){var o=function(){var e=new THREE.VideoTexture(i);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.encoding=THREE.sRGBEncoding,e.needsUpdate=!0,"function"==typeof t&&t(e)};i.crossOrigin="anonymous",i.readyState>=i.HAVE_FUTURE_DATA?o():i.oncanplay=function(){o()}}},u(t,null,[{key:"geometry",get:function(){return new THREE.PlaneBufferGeometry(.12,.09,2,2)}}]),t}(),zi=function(){function e(){var e=this,t=this.mesh=new THREE.Group,n=this.phone=this.create();t.add(n);this.streams=[];at.remotes$.subscribe((function(t){e.remotes=t}))}return u(e,[{key:"remotes",set:function(e){var t=this;e.forEach((function(n,i){var o=t.streams[i];o||(o=new Ni),o.setRemote(n,i,e.length),t.phone.add(o.plane),t.streams[i]=o}));for(var n=e.length;n<this.streams.length;n++)this.phone.remove(this.streams[n].plane);this.streams.length=e.length}}]),e.prototype.create=function(){var e=new THREE.BoxBufferGeometry(.12,.27,.005,2,2,1),t=new THREE.MeshStandardMaterial({color:0,transparent:!0,opacity:.6}),n=new THREE.Mesh(e,t);return n.rotation.set(-Math.PI/4,0,0),n},e}(),Gi=function(){function e(e){void 0===e&&(e="#ffffff");this.position=new THREE.Vector3;var t=Dn.planeGeometry,n=(new THREE.TextureLoader).load(k.getPath("textures/ui/nav-point.png")),i=new THREE.MeshBasicMaterial({color:new THREE.Color(e),depthTest:!1,depthWrite:!1,map:n,transparent:!0,opacity:.9}),o=this.mesh=new THREE.Mesh(t,i);o.renderOrder=k.renderOrder.pointer,o.position.set(-1e5,-1e5,-1e5)}var t=e.prototype;return t.update=function(e){if(Vn.lastIntersectedObject){var t=this.position;t.copy(Vn.lastIntersectedObject.intersection.point),t.multiplyScalar(.99);var n=this.mesh;n.position.set(t.x,t.y,t.z),t.sub(e.position);var i=t.length()/80;n.scale.set(i,i,i),n.lookAt(Fn.origin)}},t.setPosition=function(e,t,n,i){var o=this.position;o.set(e,t,n).multiplyScalar(80);var r=this.mesh;r.position.copy(o),o.sub(i.position);var s=o.length()/80;r.scale.set(s,s,s),r.lookAt(Fn.origin)},e}(),qi=function(){function e(){this.gravity=new THREE.Vector3(0,-9.8,0),this.controllerPosition=new THREE.Vector3,this.controllerDirection=new THREE.Vector3,this.currentPosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3;var e=new THREE.BufferGeometry,t=this.vertices=new Float32Array(33);t.fill(0);var n=new Float32Array(33);n.fill(.5),e.setAttribute("position",new THREE.BufferAttribute(t,3)),e.setAttribute("color",new THREE.BufferAttribute(n,3));var i=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),o=(this.line=new THREE.Line(e,i),(new THREE.TextureLoader).load(k.getPath("textures/ui/nav-point.png")));(this.target=new THREE.Mesh(new THREE.PlaneBufferGeometry(.3,.3,1,1),new THREE.MeshBasicMaterial({map:o,blending:THREE.AdditiveBlending,color:5592405,transparent:!0}))).rotation.x=-Math.PI/2}var t=e.prototype;return t.addToController=function(e,t){this.currentController=e,e.add(this.line),t.add(this.target)},t.removeFromController=function(e,t,n,i,o){var r=this.currentController;if(r===e){var s=this.gravity,a=this.currentPosition,u=this.controllerPosition,c=this.controllerDirection;n.xr.getCamera(i).getWorldPosition(a),a.y=0,r.getWorldPosition(u),r.getWorldDirection(c),c.multiplyScalar(6);var l=(-c.y+Math.sqrt(Math.pow(c.y,2)-2*u.y*s.y))/s.y,d=this.getPositionT(this.targetPosition,l,u,c,s);d.addScaledVector(a,-1),o.position.add(d),this.currentController=null,r.remove(this.line),t.remove(this.target)}},t.update=function(){var e=this.currentController;if(e){var t=this.gravity,n=this.controllerPosition,i=this.controllerDirection,o=this.targetPosition;e.getWorldPosition(n),e.getWorldDirection(i),i.multiplyScalar(6);for(var r=(-i.y+Math.sqrt(Math.pow(i.y,2)-2*n.y*t.y))/t.y,s=o.set(0,0,0),a=1;a<=10;a++)this.getPositionT(s,a*r/10,n,i,t),e.worldToLocal(s),s.toArray(this.vertices,3*a);this.line.geometry.attributes.position.needsUpdate=!0,this.getPositionT(this.target.position,.98*r,n,i,t)}},t.getPositionT=function(e,t,n,i,o){return e.copy(n),e.addScaledVector(i,t),e.addScaledVector(o,.5*Math.pow(t,2)),e},e}(),Wi="waiting",Ki="enabled",Xi="ended",Yi="started",Zi="disabled",Ji="needs-https",Qi="unavailable",eo=function(){function e(){var t=this;if(e.service_)throw"VRService is a singleton class!";var i=this.state_={camera:{position:new THREE.Vector3,quaternion:new THREE.Quaternion,scale:new THREE.Vector3,array:new Array(10).fill(0)}};this.onSessionStarted=this.onSessionStarted.bind(this),this.onSessionEnded=this.onSessionEnded.bind(this),this.status$=new n.BehaviorSubject(Wi),this.session$=new n.Subject,this.state$=new n.BehaviorSubject(i),this.currentSession=null,"xr"in navigator?navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?t.status$.next(Ki):t.status$.next(Zi)})):!1===window.isSecureContext?this.status$.next(Ji):this.status$.next(Qi)}e.getService=function(){return this.service_||(this.service_=new e),this.service_},u(e,[{key:"status",get:function(){return this.status$.getValue()}},{key:"state",get:function(){return this.state$.getValue()}}]);var t=e.prototype;return t.onSessionStarted=function(e){e.addEventListener("end",this.onSessionEnded),this.currentSession=e,this.session$.next(e),this.status$.next(Yi)},t.onSessionEnded=function(){this.currentSession.removeEventListener("end",this.onSessionEnded),this.currentSession=null,this.session$.next(null),this.status$.next(Xi)},t.toggleVR=function(e){if(null===this.currentSession){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(this.onSessionStarted)}else this.currentSession.end()},t.isDisabled=function(){switch(this.status$.getValue()){case Wi:case Zi:case Ji:case Qi:return!0;default:return!1}},t.getLabel=function(){var e;switch(this.status$.getValue()){case Wi:e="Waiting VR";break;case Ki:case Xi:e="Enter VR";break;case Yi:e="Exit VR";break;case Zi:e="VR Disabled";break;case Ji:e="VR Needs Https";break;case Qi:e="VR Unavailable"}return e},t.updateState=function(e){if(this.status===Yi){e.renderer,e.scene;var t=e.camera,n=this.state_;t.matrixWorld.decompose(n.camera.position,n.camera.quaternion,n.camera.scale),n.camera.array[0]=n.camera.position.x,n.camera.array[1]=n.camera.position.y,n.camera.array[2]=n.camera.position.z,n.camera.array[3]=n.camera.quaternion.x,n.camera.array[4]=n.camera.quaternion.y,n.camera.array[5]=n.camera.quaternion.z,n.camera.array[6]=n.camera.quaternion.w,n.camera.array[7]=n.camera.scale.x,n.camera.array[8]=n.camera.scale.y,n.camera.array[9]=n.camera.scale.z,this.state$.next(n)}},e}(),to=function(e){function t(t){var n;return(n=e.call(this)||this).gamepad=t,n.buttons={},n.axes={},n}d(t,e);var n=t.prototype;return n.update=function(){this.updateButtons(),this.updateAxes()},n.updateButtons=function(){var e=this;this.gamepad.buttons.forEach((function(t,n){var i=t.pressed,o=e.buttons[n]||(e.buttons[n]=new no(n,e));o.pressed!==i&&(o.pressed=i,i?e.emit("press",o):void 0!==status&&e.emit("release",o))}))},n.updateAxes=function(){for(var e=this.gamepad.axes,t=0;t<e.length;t+=2){var n=Math.floor(t/2),i=this.axes[n]||(this.axes[n]=new io(n,this)),o=e[t],r=e[t+1];if(i.x!==o||i.y!==r){if(i.x=o,i.y=r,Math.abs(o)>Math.abs(r)){var s=o<-.85,a=o>.85;i.left!==s&&(i.left=s,this.emit(s?"left":"none",i)),i.right!==a&&(i.right=a,this.emit(a?"right":"none",i))}else{var u=r<-.85,c=r>.85;i.up!==u&&(i.up=u,this.emit(u?"up":"none",i)),i.down!==c&&(i.down=c,this.emit(c?"down":"none",i))}this.emit("axis",i)}}},n.feedback=function(e,t){void 0===e&&(e=.1),void 0===t&&(t=50);var n=this.gamepad.hapticActuators;return n&&n.length?n[0].pulse(e,t):Promise.reject()},t}(function(){function e(){this.events={}}var t=e.prototype;return t.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},t.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},t.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},e}()),no=function(e,t){this.index=e,this.gamepad=t,this.pressed=!1},io=function(e){function t(t,n){var i;return(i=e.call(this)||this).index=t,i.gamepad=n,i.left=i.right=i.up=i.down=!1,i}return d(t,e),t}(THREE.Vector2),oo=THREE,ro=oo.AnimationClip,so=oo.Bone,ao=oo.Box3,uo=oo.BufferAttribute,co=oo.BufferGeometry,lo=oo.CanvasTexture,ho=oo.ClampToEdgeWrapping,po=oo.Color,fo=oo.DirectionalLight,mo=oo.DoubleSide,vo=oo.FileLoader,go=oo.FrontSide,yo=oo.Group,bo=oo.ImageBitmapLoader,wo=oo.InterleavedBuffer,xo=oo.InterleavedBufferAttribute,Eo=oo.Interpolant,So=oo.InterpolateDiscrete,To=oo.InterpolateLinear,ko=oo.Line,Mo=oo.LineBasicMaterial,Io=oo.LineLoop,Co=oo.LineSegments,Ro=oo.LinearFilter,Ao=oo.LinearMipmapLinearFilter,_o=oo.LinearMipmapNearestFilter,Lo=oo.Loader,Po=oo.LoaderUtils,$o=oo.Material,Oo=oo.MathUtils,Ho=oo.Matrix4,Uo=oo.Mesh,Do=oo.MeshBasicMaterial,Fo=oo.MeshPhysicalMaterial,Vo=oo.MeshStandardMaterial,jo=oo.MirroredRepeatWrapping,Bo=oo.NearestFilter,No=oo.NearestMipmapLinearFilter,zo=oo.NearestMipmapNearestFilter,Go=oo.NumberKeyframeTrack,qo=oo.Object3D,Wo=oo.OrthographicCamera,Ko=oo.PerspectiveCamera,Xo=oo.PointLight,Yo=oo.Points,Zo=oo.PointsMaterial,Jo=oo.PropertyBinding,Qo=oo.QuaternionKeyframeTrack,er=oo.RGBFormat,tr=oo.RepeatWrapping,nr=oo.Skeleton,ir=oo.SkinnedMesh,or=oo.Sphere,rr=oo.SpotLight,sr=oo.TangentSpaceNormalMap,ar=oo.TextureLoader,ur=oo.TriangleFanDrawMode,cr=oo.TriangleStripDrawMode,lr=oo.Vector2,dr=oo.Vector3,hr=oo.VectorKeyframeTrack,pr=oo.sRGBEncoding,fr=function(e){function t(t){var n;return(n=e.call(this,t)||this).dracoLoader=null,n.ktx2Loader=null,n.meshoptDecoder=null,n.pluginCallbacks=[],n.register((function(e){return new br(e)})),n.register((function(e){return new xr(e)})),n.register((function(e){return new Er(e)})),n.register((function(e){return new wr(e)})),n.register((function(e){return new gr(e)})),n.register((function(e){return new Sr(e)})),n}d(t,e);var n=t.prototype;return n.load=function(e,t,n,i){var o,r=this;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:Po.extractUrlBase(e),this.manager.itemStart(e);var s=function(t){i?i(t):console.error(t),r.manager.itemError(e),r.manager.itemEnd(e)},a=new vo(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(n){try{r.parse(n,o,(function(n){t(n),r.manager.itemEnd(e)}),s)}catch(e){s(e)}}),n,s)},n.setDRACOLoader=function(e){return this.dracoLoader=e,this},n.setDDSLoader=function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},n.setKTX2Loader=function(e){return this.ktx2Loader=e,this},n.setMeshoptDecoder=function(e){return this.meshoptDecoder=e,this},n.register=function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},n.unregister=function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},n.parse=function(e,t,n,i){var o,r={},s={};if("string"==typeof e)o=e;else if(Po.decodeText(new Uint8Array(e,0,4))===Tr){try{r[vr.KHR_BINARY_GLTF]=new Ir(e)}catch(e){return void(i&&i(e))}o=r[vr.KHR_BINARY_GLTF].content}else o=Po.decodeText(new Uint8Array(e));var a=JSON.parse(o);if(void 0===a.asset||a.asset.version[0]<2)i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var u=new is(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(var c=0;c<this.pluginCallbacks.length;c++){var l=this.pluginCallbacks[c](u);s[l.name]=l,r[l.name]=!0}if(a.extensionsUsed)for(var d=0;d<a.extensionsUsed.length;++d){var h=a.extensionsUsed[d],p=a.extensionsRequired||[];switch(h){case vr.KHR_MATERIALS_UNLIT:r[h]=new yr;break;case vr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[h]=new _r;break;case vr.KHR_DRACO_MESH_COMPRESSION:r[h]=new Cr(a,this.dracoLoader);break;case vr.KHR_TEXTURE_TRANSFORM:r[h]=new Rr;break;case vr.KHR_MESH_QUANTIZATION:r[h]=new Lr;break;default:p.indexOf(h)>=0&&void 0===s[h]&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}u.setExtensions(r),u.setPlugins(s),u.parse(n,i)}},t}(Lo);function mr(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}var vr={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"},gr=function(){function e(e){this.parser=e,this.name=vr.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}var t=e.prototype;return t._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,i=t.length;n<i;n++){var o=t[n];o.extensions&&o.extensions[this.name]&&void 0!==o.extensions[this.name].light&&e._addNodeRef(this.cache,o.extensions[this.name].light)}},t._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var o,r=t.json,s=((r.extensions&&r.extensions[this.name]||{}).lights||[])[e],a=new po(16777215);void 0!==s.color&&a.fromArray(s.color);var u=void 0!==s.range?s.range:0;switch(s.type){case"directional":(o=new fo(a)).target.position.set(0,0,-1),o.add(o.target);break;case"point":(o=new Xo(a)).distance=u;break;case"spot":(o=new rr(a)).distance=u,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,o.angle=s.spot.outerConeAngle,o.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return o.position.set(0,0,0),o.decay=2,void 0!==s.intensity&&(o.intensity=s.intensity),o.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(o),t.cache.add(n,i),i},t.createNodeAttachment=function(e){var t=this,n=this.parser,i=n.json.nodes[e],o=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===o?null:this._loadLight(o).then((function(e){return n._getNodeRef(t.cache,o,e)}))},e}(),yr=function(){function e(){this.name=vr.KHR_MATERIALS_UNLIT}var t=e.prototype;return t.getMaterialType=function(){return Do},t.extendParams=function(e,t,n){var i=[];e.color=new po(1,1,1),e.opacity=1;var o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){var r=o.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}void 0!==o.baseColorTexture&&i.push(n.assignTexture(e,"map",o.baseColorTexture))}return Promise.all(i)},e}(),br=function(){function e(e){this.parser=e,this.name=vr.KHR_MATERIALS_CLEARCOAT}var t=e.prototype;return t.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fo:null},t.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],r=i.extensions[this.name];if(void 0!==r.clearcoatFactor&&(t.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&o.push(n.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(o.push(n.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){var s=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new lr(s,-s)}return Promise.all(o)},e}(),wr=function(){function e(e){this.parser=e,this.name=vr.KHR_MATERIALS_TRANSMISSION}var t=e.prototype;return t.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?Fo:null},t.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var o=[],r=i.extensions[this.name];return void 0!==r.transmissionFactor&&(t.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&o.push(n.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(o)},e}(),xr=function(){function e(e){this.parser=e,this.name=vr.KHR_TEXTURE_BASISU}return e.prototype.loadTexture=function(e){var t=this.parser,n=t.json,i=n.textures[e];if(!i.extensions||!i.extensions[this.name])return null;var o=i.extensions[this.name],r=n.images[o.source],s=t.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,r,s)},e}(),Er=function(){function e(e){this.parser=e,this.name=vr.EXT_TEXTURE_WEBP,this.isSupported=null}var t=e.prototype;return t.loadTexture=function(e){var t=this.name,n=this.parser,i=n.json,o=i.textures[e];if(!o.extensions||!o.extensions[t])return null;var r=o.extensions[t],s=i.images[r.source],a=n.textureLoader;if(s.uri){var u=n.options.manager.getHandler(s.uri);null!==u&&(a=u)}return this.detectSupport().then((function(o){if(o)return n.loadTextureImage(e,s,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},t.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},e}(),Sr=function(){function e(e){this.name=vr.EXT_MESHOPT_COMPRESSION,this.parser=e}return e.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var i=n.extensions[this.name],o=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([o,r.ready]).then((function(e){var t=i.byteOffset||0,n=i.byteLength||0,o=i.count,s=i.byteStride,a=new ArrayBuffer(o*s),u=new Uint8Array(e[0],t,n);return r.decodeGltfBuffer(new Uint8Array(a),o,s,u,i.mode,i.filter),a}))}return null},e}(),Tr="glTF",kr=1313821514,Mr=5130562,Ir=function(e){this.name=vr.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:Po.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Tr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var n=this.header.length-12,i=new DataView(e,12),o=0;o<n;){var r=i.getUint32(o,!0);o+=4;var s=i.getUint32(o,!0);if(o+=4,s===kr){var a=new Uint8Array(e,12+o,r);this.content=Po.decodeText(a)}else if(s===Mr){var u=12+o;this.body=e.slice(u,u+r)}o+=r}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")},Cr=function(){function e(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=vr.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}return e.prototype.decodePrimitive=function(e,t){var n=this.json,i=this.dracoLoader,o=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,s={},a={},u={};for(var c in r){var l=Gr[c]||c.toLowerCase();s[l]=r[c]}for(var d in e.attributes){var h=Gr[d]||d.toLowerCase();if(void 0!==r[d]){var p=n.accessors[e.attributes[d]],f=jr[p.componentType];u[h]=f,a[h]=!0===p.normalized}}return t.getDependency("bufferView",o).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var n in e.attributes){var i=e.attributes[n],o=a[n];void 0!==o&&(i.normalized=o)}t(e)}),s,u)}))}))},e}(),Rr=function(){function e(){this.name=vr.KHR_TEXTURE_TRANSFORM}return e.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},e}(),Ar=function(e){function t(t){var n;(n=e.call(this)||this).isGLTFSpecularGlossinessMaterial=!0;var i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),u={specular:{value:(new po).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};return n._extraUniforms=u,n.onBeforeCompile=function(e){for(var t in u)e.uniforms[t]=u[t];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(h(n),{specular:{get:function(){return u.specular.value},set:function(e){u.specular.value=e}},specularMap:{get:function(){return u.specularMap.value},set:function(e){u.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return u.glossiness.value},set:function(e){u.glossiness.value=e}},glossinessMap:{get:function(){return u.glossinessMap.value},set:function(e){u.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete n.metalness,delete n.roughness,delete n.metalnessMap,delete n.roughnessMap,n.setValues(t),n}return d(t,e),t.prototype.copy=function(t){return e.prototype.copy.call(this,t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},t}(Vo),_r=function(){function e(){this.name=vr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}var t=e.prototype;return t.getMaterialType=function(){return Ar},t.extendParams=function(e,t,n){var i=t.extensions[this.name];e.color=new po(1,1,1),e.opacity=1;var o=[];if(Array.isArray(i.diffuseFactor)){var r=i.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(void 0!==i.diffuseTexture&&o.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new po(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new po(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",s)),o.push(n.assignTexture(e,"specularMap",s))}return Promise.all(o)},t.createMaterial=function(e){var t=new Ar(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=sr,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t},e}(),Lr=function(){this.name=vr.KHR_MESH_QUANTIZATION},Pr=function(e){function t(t,n,i,o){return e.call(this,t,n,i,o)||this}return d(t,e),t.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=e*i*3+i,r=0;r!==i;r++)t[r]=n[o+r];return t},t}(Eo);Pr.prototype.beforeStart_=Pr.prototype.copySampleValue_,Pr.prototype.afterEnd_=Pr.prototype.copySampleValue_,Pr.prototype.interpolate_=function(e,t,n,i){for(var o=this.resultBuffer,r=this.sampleValues,s=this.valueSize,a=2*s,u=3*s,c=i-t,l=(n-t)/c,d=l*l,h=d*l,p=e*u,f=p-u,m=-2*h+3*d,v=h-d,g=1-m,y=v-d+l,b=0;b!==s;b++){var w=r[f+b+s],x=r[f+b+a]*c,E=r[p+b+s],S=r[p+b]*c;o[b]=g*w+y*x+m*E+v*S}return o};var $r=0,Or=1,Hr=2,Ur=3,Dr=4,Fr=5,Vr=6,jr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Br={9728:Bo,9729:Ro,9984:zo,9985:_o,9986:No,9987:Ao},Nr={33071:ho,33648:jo,10497:tr},zr={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Gr={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},qr={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Wr={CUBICSPLINE:void 0,LINEAR:To,STEP:So},Kr="OPAQUE",Xr="MASK",Yr="BLEND";function Zr(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function Jr(e,t,n){for(var i in n.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=n.extensions[i])}function Qr(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function es(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,i=t.weights.length;n<i;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var o=t.extras.targetNames;if(e.morphTargetInfluences.length===o.length){e.morphTargetDictionary={};for(var r=0,s=o.length;r<s;r++)e.morphTargetDictionary[o[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ts(e){for(var t="",n=Object.keys(e).sort(),i=0,o=n.length;i<o;i++)t+=n[i]+":"+e[n[i]]+";";return t}function ns(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}var is=function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t={}),this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new mr,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new bo(this.options.manager):this.textureLoader=new ar(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new vo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}var t=e.prototype;return t.setExtensions=function(e){this.extensions=e},t.setPlugins=function(e){this.plugins=e},t.parse=function(e,t){var n=this,i=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all(this._invokeAll((function(e){return e.beforeRoot&&e.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(t){var r={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:n,userData:{}};Jr(o,r,i),Qr(r,i),Promise.all(n._invokeAll((function(e){return e.afterRoot&&e.afterRoot(r)}))).then((function(){e(r)}))})).catch(t)},t._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],i=0,o=t.length;i<o;i++)for(var r=t[i].joints,s=0,a=r.length;s<a;s++)e[r[s]].isBone=!0;for(var u=0,c=e.length;u<c;u++){var l=e[u];void 0!==l.mesh&&(this._addNodeRef(this.meshCache,l.mesh),void 0!==l.skin&&(n[l.mesh].isSkinnedMesh=!0)),void 0!==l.camera&&this._addNodeRef(this.cameraCache,l.camera)}},t._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},t._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var i=n.clone();return i.name+="_instance_"+e.uses[t]++,i},t._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var i=e(t[n]);if(i)return i}return null},t._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],i=0;i<t.length;i++){var o=e(t[i]);o&&n.push(o)}return n},t.getDependency=function(e,t){var n=e+":"+t,i=this.cache.get(n);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this.loadNode(t);break;case"mesh":i=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":i=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":i=this.loadSkin(t);break;case"animation":i=this.loadAnimation(t);break;case"camera":i=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,i)}return i},t.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return n.getDependency(e,i)}))),this.cache.add(e,t)}return t},t.loadBuffer=function(e){var t=this.json.buffers[e],n=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[vr.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,o){n.load(Zr(t.uri,i.path),e,void 0,(function(){o(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},t.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+n)}))},t.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var o=[];return void 0!==i.bufferView?o.push(this.getDependency("bufferView",i.bufferView)):o.push(null),void 0!==i.sparse&&(o.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(o).then((function(e){var o,r,s=e[0],a=zr[i.type],u=jr[i.componentType],c=u.BYTES_PER_ELEMENT,l=c*a,d=i.byteOffset||0,h=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(h&&h!==l){var f=Math.floor(d/h),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+f+":"+i.count,v=t.cache.get(m);v||(o=new u(s,f*h,i.count*h/c),v=new wo(o,h/c),t.cache.add(m,v)),r=new xo(v,a,d%h/c,p)}else o=null===s?new u(i.count*a):new u(s,d,i.count*a),r=new uo(o,a,p);if(void 0!==i.sparse){var g=zr.SCALAR,y=jr[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,w=i.sparse.values.byteOffset||0,x=new y(e[1],b,i.sparse.count*g),E=new u(e[2],w,i.sparse.count*a);null!==s&&(r=new uo(r.array.slice(),r.itemSize,r.normalized));for(var S=0,T=x.length;S<T;S++){var k=x[S];if(r.setX(k,E[S*a]),a>=2&&r.setY(k,E[S*a+1]),a>=3&&r.setZ(k,E[S*a+2]),a>=4&&r.setW(k,E[S*a+3]),a>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return r}))},t.loadTexture=function(e){var t=this.json,n=this.options,i=t.textures[e],o=t.images[i.source],r=this.textureLoader;if(o.uri){var s=n.manager.getHandler(o.uri);null!==s&&(r=s)}return this.loadTextureImage(e,o,r)},t.loadTextureImage=function(e,t,n){var i=this,o=this.json,r=this.options,s=o.textures[e],a=self.URL||self.webkitURL,u=t.uri,c=!1,l=!0;if("image/jpeg"===t.mimeType&&(l=!1),void 0!==t.bufferView)u=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);l=6===n||4===n||3===n}c=!0;var i=new Blob([e],{type:t.mimeType});return u=a.createObjectURL(i)}));else if(void 0===t.uri)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");return Promise.resolve(u).then((function(e){return new Promise((function(t,i){var o=t;!0===n.isImageBitmapLoader&&(o=function(e){t(new lo(e))}),n.load(Zr(e,r.path),o,void 0,i)}))})).then((function(t){!0===c&&a.revokeObjectURL(u),t.flipY=!1,s.name&&(t.name=s.name),l||(t.format=er);var n=(o.samplers||{})[s.sampler]||{};return t.magFilter=Br[n.magFilter]||Ro,t.minFilter=Br[n.minFilter]||Ao,t.wrapS=Nr[n.wrapS]||tr,t.wrapT=Nr[n.wrapT]||tr,i.associations.set(t,{type:"textures",index:e}),t}))},t.assignTexture=function(e,t,n){var i=this;return this.getDependency("texture",n.index).then((function(o){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===t&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),i.extensions[vr.KHR_TEXTURE_TRANSFORM]){var r=void 0!==n.extensions?n.extensions[vr.KHR_TEXTURE_TRANSFORM]:void 0;if(r){var s=i.associations.get(o);o=i.extensions[vr.KHR_TEXTURE_TRANSFORM].extendTexture(o,r),i.associations.set(o,s)}}e[t]=o}))},t.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,o=void 0!==t.attributes.color,r=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,a=Object.keys(t.morphAttributes).length>0,u=a&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,l=this.cache.get(c);l||(l=new Zo,$o.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(c,l)),n=l}else if(e.isLine){var d="LineBasicMaterial:"+n.uuid,h=this.cache.get(d);h||(h=new Mo,$o.prototype.copy.call(h,n),h.color.copy(n.color),this.cache.add(d,h)),n=h}if(i||o||r||s||a){var p="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),s&&(p+="skinning:"),i&&(p+="vertex-tangents:"),o&&(p+="vertex-colors:"),r&&(p+="flat-shading:"),a&&(p+="morph-targets:"),u&&(p+="morph-normals:");var f=this.cache.get(p);f||(f=n.clone(),s&&(f.skinning=!0),o&&(f.vertexColors=!0),r&&(f.flatShading=!0),a&&(f.morphTargets=!0),u&&(f.morphNormals=!0),i&&(f.vertexTangents=!0,f.normalScale&&(f.normalScale.y*=-1),f.clearcoatNormalScale&&(f.clearcoatNormalScale.y*=-1)),this.cache.add(p,f),this.associations.set(f,this.associations.get(n))),n=f}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},t.getMaterialType=function(){return Vo},t.loadMaterial=function(e){var t,n=this,i=this.json,o=this.extensions,r=i.materials[e],s={},a=r.extensions||{},u=[];if(a[vr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=o[vr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=c.getMaterialType(),u.push(c.extendParams(s,r,n))}else if(a[vr.KHR_MATERIALS_UNLIT]){var l=o[vr.KHR_MATERIALS_UNLIT];t=l.getMaterialType(),u.push(l.extendParams(s,r,n))}else{var d=r.pbrMetallicRoughness||{};if(s.color=new po(1,1,1),s.opacity=1,Array.isArray(d.baseColorFactor)){var h=d.baseColorFactor;s.color.fromArray(h),s.opacity=h[3]}void 0!==d.baseColorTexture&&u.push(n.assignTexture(s,"map",d.baseColorTexture)),s.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,s.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(u.push(n.assignTexture(s,"metalnessMap",d.metallicRoughnessTexture)),u.push(n.assignTexture(s,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),u.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,s)}))))}!0===r.doubleSided&&(s.side=mo);var p=r.alphaMode||Kr;return p===Yr?(s.transparent=!0,s.depthWrite=!1):(s.transparent=!1,p===Xr&&(s.alphaTest=void 0!==r.alphaCutoff?r.alphaCutoff:.5)),void 0!==r.normalTexture&&t!==Do&&(u.push(n.assignTexture(s,"normalMap",r.normalTexture)),s.normalScale=new lr(1,-1),void 0!==r.normalTexture.scale&&s.normalScale.set(r.normalTexture.scale,-r.normalTexture.scale)),void 0!==r.occlusionTexture&&t!==Do&&(u.push(n.assignTexture(s,"aoMap",r.occlusionTexture)),void 0!==r.occlusionTexture.strength&&(s.aoMapIntensity=r.occlusionTexture.strength)),void 0!==r.emissiveFactor&&t!==Do&&(s.emissive=(new po).fromArray(r.emissiveFactor)),void 0!==r.emissiveTexture&&t!==Do&&u.push(n.assignTexture(s,"emissiveMap",r.emissiveTexture)),Promise.all(u).then((function(){var i;return i=t===Ar?o[vr.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(s):new t(s),r.name&&(i.name=r.name),i.map&&(i.map.encoding=pr),i.emissiveMap&&(i.emissiveMap.encoding=pr),Qr(i,r),n.associations.set(i,{type:"materials",index:e}),r.extensions&&Jr(o,i,r),i}))},t.createUniqueName=function(e){for(var t=Jo.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n},t.loadGeometries=function(e){var t=this,n=this.extensions,i=this.primitiveCache;function o(e){return n[vr.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return rs(n,e,t)}))}for(var r,s,a=[],u=0,c=e.length;u<c;u++){var l=e[u],d=(s=void 0,(s=(r=l).extensions&&r.extensions[vr.KHR_DRACO_MESH_COMPRESSION])?"draco:"+s.bufferView+":"+s.indices+":"+ts(s.attributes):r.indices+":"+ts(r.attributes)+":"+r.mode),h=i[d];if(h)a.push(h.promise);else{var p=void 0;p=l.extensions&&l.extensions[vr.KHR_DRACO_MESH_COMPRESSION]?o(l):rs(new co,l,t),i[d]={primitive:l,promise:p},a.push(p)}}return Promise.all(a)},t.loadMesh=function(e){for(var t,n=this,i=this.json,o=this.extensions,r=i.meshes[e],s=r.primitives,a=[],u=0,c=s.length;u<c;u++){var l=void 0===s[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new Vo({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:go})),t.DefaultMaterial):this.getDependency("material",s[u].material);a.push(l)}return a.push(n.loadGeometries(s)),Promise.all(a).then((function(t){for(var i=t.slice(0,t.length-1),a=t[t.length-1],u=[],c=0,l=a.length;c<l;c++){var d=a[c],h=s[c],p=void 0,f=i[c];if(h.mode===Dr||h.mode===Fr||h.mode===Vr||void 0===h.mode)!0!==(p=!0===r.isSkinnedMesh?new ir(d,f):new Uo(d,f)).isSkinnedMesh||p.geometry.attributes.skinWeight.normalized||p.normalizeSkinWeights(),h.mode===Fr?p.geometry=ss(p.geometry,cr):h.mode===Vr&&(p.geometry=ss(p.geometry,ur));else if(h.mode===Or)p=new Co(d,f);else if(h.mode===Ur)p=new ko(d,f);else if(h.mode===Hr)p=new Io(d,f);else{if(h.mode!==$r)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+h.mode);p=new Yo(d,f)}Object.keys(p.geometry.morphAttributes).length>0&&es(p,r),p.name=n.createUniqueName(r.name||"mesh_"+e),Qr(p,r),h.extensions&&Jr(o,p,h),n.assignFinalMaterial(p),u.push(p)}if(1===u.length)return u[0];for(var m=new yo,v=0,g=u.length;v<g;v++)m.add(u[v]);return m}))},t.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new Ko(Oo.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new Wo(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Qr(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},t.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},t.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],o=[],r=[],s=[],a=0,u=t.channels.length;a<u;a++){var c=t.channels[a],l=t.samplers[c.sampler],d=c.target,h=void 0!==d.node?d.node:d.id,p=void 0!==t.parameters?t.parameters[l.input]:l.input,f=void 0!==t.parameters?t.parameters[l.output]:l.output;n.push(this.getDependency("node",h)),i.push(this.getDependency("accessor",p)),o.push(this.getDependency("accessor",f)),r.push(l),s.push(d)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(o),Promise.all(r),Promise.all(s)]).then((function(n){for(var i=n[0],o=n[1],r=n[2],s=n[3],a=n[4],u=[],c=function(e,t){var n=i[e],c=o[e],l=r[e],d=s[e],h=a[e];if(void 0===n)return"continue";n.updateMatrix(),n.matrixAutoUpdate=!0;var p=void 0;switch(qr[h.path]){case qr.weights:p=Go;break;case qr.rotation:p=Qo;break;case qr.position:case qr.scale:default:p=hr}var f=n.name?n.name:n.uuid,m=void 0!==d.interpolation?Wr[d.interpolation]:To,v=[];qr[h.path]===qr.weights?n.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&v.push(e.name?e.name:e.uuid)})):v.push(f);var g=l.array;if(l.normalized){for(var y=ns(g.constructor),b=new Float32Array(g.length),w=0,x=g.length;w<x;w++)b[w]=g[w]*y;g=b}for(var E=0,S=v.length;E<S;E++){var T=new p(v[E]+"."+qr[h.path],c.array,g,m);"CUBICSPLINE"===d.interpolation&&(T.createInterpolant=function(e){return new Pr(this.times,this.values,this.getValueSize()/3,e)},T.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(T)}},l=0,d=i.length;l<d;l++)c(l);var h=t.name?t.name:"animation_"+e;return new ro(h,void 0,u)}))},t.createNodeMesh=function(e){var t=this.json,n=this,i=t.nodes[e];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(e){var t=n._getNodeRef(n.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=i.weights.length;t<n;t++)e.morphTargetInfluences[t]=i.weights[t]})),t}))},t.loadNode=function(e){var t,n,i=this.json,o=this.extensions,r=this,s=i.nodes[e],a=s.name?r.createUniqueName(s.name):"";return(t=[],n=r._invokeOne((function(t){return t.createNodeMesh&&t.createNodeMesh(e)})),n&&t.push(n),void 0!==s.camera&&t.push(r.getDependency("camera",s.camera).then((function(e){return r._getNodeRef(r.cameraCache,s.camera,e)}))),r._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)).then((function(t){var n;if((n=!0===s.isBone?new so:t.length>1?new yo:1===t.length?t[0]:new qo)!==t[0])for(var i=0,u=t.length;i<u;i++)n.add(t[i]);if(s.name&&(n.userData.name=s.name,n.name=a),Qr(n,s),s.extensions&&Jr(o,n,s),void 0!==s.matrix){var c=new Ho;c.fromArray(s.matrix),n.applyMatrix4(c)}else void 0!==s.translation&&n.position.fromArray(s.translation),void 0!==s.rotation&&n.quaternion.fromArray(s.rotation),void 0!==s.scale&&n.scale.fromArray(s.scale);return r.associations.set(n,{type:"nodes",index:e}),n}))},t.loadScene=function(e){var t=this.json,n=this.extensions,i=this.json.scenes[e],o=new yo;i.name&&(o.name=this.createUniqueName(i.name)),Qr(o,i),i.extensions&&Jr(n,o,i);for(var r=i.nodes||[],s=[],a=0,u=r.length;a<u;a++)s.push(os(r[a],o,t,this));return Promise.all(s).then((function(){return o}))},e}();function os(e,t,n,i){var o=n.nodes[e];return i.getDependency("node",e).then((function(e){return void 0===o.skin?e:i.getDependency("skin",o.skin).then((function(e){for(var n=[],o=0,r=(t=e).joints.length;o<r;o++)n.push(i.getDependency("node",t.joints[o]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],o=[],r=0,s=n.length;r<s;r++){var a=n[r];if(a){i.push(a);var u=new Ho;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*r),o.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[r])}e.bind(new nr(i,o),e.matrixWorld)}})),e}));var t})).then((function(e){t.add(e);var r=[];if(o.children)for(var s=o.children,a=0,u=s.length;a<u;a++){var c=s[a];r.push(os(c,e,n,i))}return Promise.all(r)}))}function rs(e,t,n){var i=t.attributes,o=[];function r(t,i){return n.getDependency("accessor",t).then((function(t){e.setAttribute(i,t)}))}for(var s in i){var a=Gr[s]||s.toLowerCase();a in e.attributes||o.push(r(i[s],a))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));o.push(u)}return Qr(e,t),function(e,t,n){var i=t.attributes,o=new ao;if(void 0!==i.POSITION){var r=n.json.accessors[i.POSITION],s=r.min,a=r.max;if(void 0!==s&&void 0!==a){if(o.set(new dr(s[0],s[1],s[2]),new dr(a[0],a[1],a[2])),r.normalized){var u=ns(jr[r.componentType]);o.min.multiplyScalar(u),o.max.multiplyScalar(u)}var c=t.targets;if(void 0!==c){for(var l=new dr,d=new dr,h=0,p=c.length;h<p;h++){var f=c[h];if(void 0!==f.POSITION){var m=n.json.accessors[f.POSITION],v=m.min,g=m.max;if(void 0!==v&&void 0!==g){if(d.setX(Math.max(Math.abs(v[0]),Math.abs(g[0]))),d.setY(Math.max(Math.abs(v[1]),Math.abs(g[1]))),d.setZ(Math.max(Math.abs(v[2]),Math.abs(g[2]))),m.normalized){var y=ns(jr[m.componentType]);d.multiplyScalar(y)}l.max(d)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(l)}e.boundingBox=o;var b=new or;o.getCenter(b.center),b.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=b}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(o).then((function(){return void 0!==t.targets?function(e,t,n){for(var i=!1,o=!1,r=0,s=t.length;r<s;r++){var a=t[r];if(void 0!==a.POSITION&&(i=!0),void 0!==a.NORMAL&&(o=!0),i&&o)break}if(!i&&!o)return Promise.resolve(e);for(var u=[],c=[],l=0,d=t.length;l<d;l++){var h=t[l];if(i){var p=void 0!==h.POSITION?n.getDependency("accessor",h.POSITION):e.attributes.position;u.push(p)}if(o){var f=void 0!==h.NORMAL?n.getDependency("accessor",h.NORMAL):e.attributes.normal;c.push(f)}}return Promise.all([Promise.all(u),Promise.all(c)]).then((function(t){var n=t[0],r=t[1];return i&&(e.morphAttributes.position=n),o&&(e.morphAttributes.normal=r),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function ss(e,t){var n=e.getIndex();if(null===n){var i=[],o=e.getAttribute("position");if(void 0===o)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var r=0;r<o.count;r++)i.push(r);e.setIndex(i),n=e.getIndex()}var s=n.count-2,a=[];if(t===ur)for(var u=1;u<=s;u++)a.push(n.getX(0)),a.push(n.getX(u)),a.push(n.getX(u+1));else for(var c=0;c<s;c++)c%2==0?(a.push(n.getX(c)),a.push(n.getX(c+1)),a.push(n.getX(c+2))):(a.push(n.getX(c+2)),a.push(n.getX(c+1)),a.push(n.getX(c)));a.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var l=e.clone();return l.setIndex(a),l}var as={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})},us={xAxis:0,yAxis:0,button:0,state:as.ComponentState.DEFAULT};function cs(e){return ls.apply(this,arguments)}function ls(){return(ls=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=7;break}throw new Error(n.statusText);case 7:return e.abrupt("return",n.json());case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ds(e){return hs.apply(this,arguments)}function hs(){return(hs=s(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No basePath supplied");case 2:return"profilesList.json",e.next=5,cs(t+"/profilesList.json");case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ps(){return(ps=s(regeneratorRuntime.mark((function e(t,n,i,o){var r,s,a,u,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i&&(i=null),void 0===o&&(o=!0),t){e.next=4;break}throw new Error("No xrInputSource supplied");case 4:if(n){e.next=6;break}throw new Error("No basePath supplied");case 6:return e.next=8,ds(n);case 8:if(r=e.sent,t.profiles.some((function(e){var t=r[e];return t&&(s={profileId:e,profilePath:n+"/"+t.path,deprecated:!!t.deprecated}),!!s})),s){e.next=17;break}if(i){e.next=13;break}throw new Error("No matching profile name found");case 13:if(a=r[i]){e.next=16;break}throw new Error('No matching profile name found and default profile "'+i+'" missing.');case 16:s={profileId:i,profilePath:n+"/"+a.path,deprecated:!!a.deprecated};case 17:return e.next=19,cs(s.profilePath);case 19:if(u=e.sent,!o){e.next=25;break}if(l="any"===t.handedness?u.layouts[Object.keys(u.layouts)[0]]:u.layouts[t.handedness]){e.next=24;break}throw new Error("No matching handedness, "+t.handedness+", in profile "+s.profileId);case 24:l.assetPath&&(c=s.profilePath.replace("profile.json",l.assetPath));case 25:return e.abrupt("return",{profile:u,assetPath:c});case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fs=function(){function e(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===as.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(us)}return e.prototype.updateFromComponent=function(e){var t=e.xAxis,n=e.yAxis,i=e.button,o=e.state,r=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var n=e,i=t;if(Math.sqrt(e*e+t*t)>1){var o=Math.atan2(t,e);n=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(t,n),s=r.normalizedXAxis,a=r.normalizedYAxis;switch(this.componentProperty){case as.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?s:.5;break;case as.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?a:.5;break;case as.ComponentProperty.BUTTON:this.value=this.states.includes(o)?i:0;break;case as.ComponentProperty.STATE:this.valueNodeProperty===as.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty "+this.componentProperty)}},e}(),ms=function(){function e(e,t){var n=this;if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((function(e){var i=new fs(t.visualResponses[e]);n.visualResponses[e]=i})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:as.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}return e.prototype.updateFromGamepad=function(e){var t=this;if(this.values.state=as.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){var n=e.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||1===this.values.button?this.values.state=as.ComponentState.PRESSED:(n.touched||this.values.button>as.ButtonTouchThreshold)&&(this.values.state=as.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===as.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>as.AxisTouchThreshold&&(this.values.state=as.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===as.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>as.AxisTouchThreshold&&(this.values.state=as.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((function(e){e.updateFromComponent(t.values)}))},u(e,[{key:"data",get:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:this.id},this.values)}}]),e}(),vs=function(){function e(e,t,n){var i=this;if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((function(e){var t=i.layoutDescription.components[e];i.components[e]=new ms(e,t)})),this.updateFromGamepad()}return e.prototype.updateFromGamepad=function(){var e=this;Object.values(this.components).forEach((function(t){t.updateFromGamepad(e.xrInputSource.gamepad)}))},u(e,[{key:"gripSpace",get:function(){return this.xrInputSource.gripSpace}},{key:"targetRaySpace",get:function(){return this.xrInputSource.targetRaySpace}},{key:"data",get:function(){var e=[];return Object.values(this.components).forEach((function(t){e.push(t.data)})),e}}]),e}(),gs=function(e){function t(){var t;return(t=e.call(this)||this).motionController=null,t.envMap=null,t}d(t,e);var n=t.prototype;return n.setEnvironmentMap=function(e){var t=this;return this.envMap==e||(this.envMap=e,this.traverse((function(e){e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)}))),this},n.updateMatrixWorld=function(t){e.prototype.updateMatrixWorld.call(this,t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((function(e){Object.values(e.visualResponses).forEach((function(e){var t=e.valueNode,n=e.minNode,i=e.maxNode,o=e.value,r=e.valueNodeProperty;t&&(r===as.VisualResponseProperty.VISIBILITY?t.visible=o:r===as.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(n.quaternion,i.quaternion,o),t.position.lerpVectors(n.position,i.position,o)))}))})))},t}(THREE.Object3D);function ys(e,t){!function(e,t){Object.values(e.components).forEach((function(e){var n=e.type,i=e.touchPointNodeName,o=e.visualResponses;if(n===as.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){var r=new THREE.SphereGeometry(.001),s=new THREE.MeshBasicMaterial({color:255}),a=new THREE.Mesh(r,s);e.touchPointNode.add(a)}else console.warn("Could not find touch dot, "+e.touchPointNodeName+", in touchpad component "+e.id);Object.values(o).forEach((function(e){var n=e.valueNodeName,i=e.minNodeName,o=e.maxNodeName;if(e.valueNodeProperty===as.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(i),e.maxNode=t.getObjectByName(o),!e.minNode)return void console.warn("Could not find "+i+" in the model");if(!e.maxNode)return void console.warn("Could not find "+o+" in the model")}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn("Could not find "+n+" in the model")}))}))}(e.motionController,t),e.envMap&&t.traverse((function(t){t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}var bs=function(){function e(e){void 0===e&&(e=null),this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new fr)}return e.prototype.createControllerModel=function(e){var t=this,n=new gs,i=null;return e.addEventListener("connected",(function(e){var o=e.data;"tracked-pointer"===o.targetRayMode&&o.gamepad&&function(e,t,n,i){return ps.apply(this,arguments)}(o,t.path,"generic-trigger").then((function(e){var r=e.profile,s=e.assetPath;n.motionController=new vs(o,r,s);var a=t._assetCache[n.motionController.assetUrl];if(a)i=a.scene.clone(),ys(n,i);else{if(!t.gltfLoader)throw new Error("GLTFLoader not set.");t.gltfLoader.setPath(""),t.gltfLoader.load(n.motionController.assetUrl,(function(e){t._assetCache[n.motionController.assetUrl]=e,i=e.scene.clone(),ys(n,i)}),null,(function(){throw new Error("Asset "+n.motionController.assetUrl+" missing or malformed.")}))}})).catch((function(e){console.warn(e)}))})),e.addEventListener("disconnected",(function(){n.motionController=null,n.remove(i),i=null})),n},e}(),ws=new THREE.Vector3,xs=new THREE.Vector3(0,-1,0),Es={type:de,orientation:{latitude:0,longitude:0},zoom:1,cameraGroup:{position:[0,0,0],rotation:[0,0,0]},pointer:[0,0,0]},Ss=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var e=this;Fn.host=this,this.defaultTexture=pi.gridTexture,this.index=0,this.error_=null,this.loading=null,this.waiting=null,this.avatars={},this.createScene(),this.setView(),this.addListeners(),this.animate(),zn.keys$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.keys=t}))},r.onDestroy=function(){this.removeListeners(),this.renderer.setAnimationLoop((function(){}))},r.createScene=function(){var t=this,n=e.getContext(this).node;this.size={left:0,top:0,width:0,height:0,aspect:0},this.mouse=new THREE.Vector2,this.controllerMatrix_=new THREE.Matrix4,this.controllerWorldPosition_=new THREE.Vector3,this.controllerWorldDirection_=new THREE.Vector3;var o=this.container=n,r=(this.info=n.querySelector(".world__info"),this.worldRect=Zn.fromNode(o),this.cameraRect=new Zn,this.cameraGroup=new THREE.Group),s=this.camera=new THREE.PerspectiveCamera(70,o.offsetWidth/o.offsetHeight,.01,1e3);s.target=new THREE.Vector3,r.add(s);this.orbitService=new $i(s);var a=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0});a.setClearColor(0,1),a.setPixelRatio(window.devicePixelRatio),a.setSize(o.offsetWidth,o.offsetHeight),a.xr.enabled=!0,a.outputEncoding=THREE.sRGBEncoding,a.toneMapping=THREE.NoToneMapping,a.toneMappingExposure=1,o.childElementCount>0?o.insertBefore(a.domElement,o.children[0]):o.appendChild(a.domElement),(this.raycaster=new THREE.Raycaster).setFromCamera(this.mouse,s);var u=this.scene=new THREE.Scene;u.add(r),k.flags.useTextureEnvironment&&this.addEnvironment();var c=this.objects=new THREE.Group;c.name="[objects]",u.add(c);var l=this.panorama=new Vi(a);this.panoramaIntersectObjects=[l.mesh],this.intersectObjects=this.panoramaIntersectObjects,c.add(l.mesh);this.indicator=new Gi,this.pointer=new Gi("#ff4332");var d=this.ambient=new THREE.AmbientLight(16777215,0);c.add(d);var h=this.direct=new THREE.DirectionalLight(16777215,1);h.position.set(50,50,50),h.target.position.set(-50,-50,-50),c.add(h);var p=this.direct=new THREE.DirectionalLight(16777215,.5);p.position.set(-50,50,50),p.target.position.set(50,-50,-50),c.add(p);var f=this.direct=new THREE.DirectionalLight(16777215,.5);f.position.set(0,50,-50),f.target.position.set(0,-50,50),c.add(f);var m=this.direct=new THREE.DirectionalLight(16777215,.5);m.position.set(0,-50,-5),m.target.position.set(0,50,5),c.add(m);var v=this.direct=new THREE.DirectionalLight(16777215,.5);v.position.set(0,50,50),v.target.position.set(0,-50,-50),c.add(v),this.addControllers(),this.resize(),qn.progress$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){var n=0===e.count,i=t.view_;i.items&&i.items.forEach((function(e){e.visible=n}))}))},r.addEnvironment=function(){var e=this,t=k.textures.envMap.split("/"),n=t.pop(),i=t.join("/")+"/",o=-1!==n.indexOf(".hdr");(o?new hi:new THREE.TextureLoader).setPath(k.getPath(i)).load(n,(function(t){o&&t?(t.mapping=THREE.EquirectangularReflectionMapping,e.scene.environment=t):e.setBackground(t)}))},r.addOffCanvasScene=function(e){var t=new Qn(e);this.avatars[e.clientId]=t},r.removeOffCanvasScene=function(e){this.avatars[e.clientId];delete this.avatars[e.clientId]},r.updateOffCanvasScene=function(e){var t=this.avatars[e.clientId];t&&t.update(e)},r.setBackground=function(e){var t=e||this.defaultTexture;t.mapping=THREE.EquirectangularReflectionMapping,t.encoding=THREE.sRGBEncoding,this.scene.environment=t},r.setView=function(){var t=this;if(this.renderer&&this.panorama){var n=this.view_;if(n){null!=I.state.zoomedId&&I.patchState({zoomedId:null}),this.views&&this.views.forEach((function(e){return delete e.onUpdateAsset}));var i=this.requestInfoResult;i&&n instanceof Dt&&void 0!==i.gridIndex&&(n.index_=i.gridIndex),n.ready=!1,this.cameraGroup.position.set(0,0,0),this.cameraGroup.rotation.set(0,0,0),n.type.name===$t.Room3d.name?(this.renderer.setClearColor(0,1),this.objects.remove(this.panorama.mesh),this.ambient.visible=!1,this.direct.visible=!1):(this.renderer.setClearColor(0,1),this.objects.add(this.panorama.mesh),this.ambient.visible=!0,this.direct.visible=!0),this.pushChanges(),Yn.cancel(),this.panorama.change(n,this.renderer,(function(i){k.flags.useTextureEnvironment||t.setBackground(i),n.ready=!0,n.onUpdateAsset=function(){t.onViewAssetDidChange()},e.getContext(t)&&t.pushChanges()}),(function(e){t.setViewOrientation(e),Yn.prefetch(e.prefetchAssets)}))}}},r.onViewAssetDidChange=function(){var e=this;this.panorama&&this.panorama.crossfade(this.view,this.renderer,(function(t){k.flags.useTextureEnvironment||e.setBackground(t)}))},r.setViewOrientation=function(e){var t,n=this.requestInfoResult;(this.requestInfoResult=null,this.orbitService)&&(this.orbitService.mode=e.type.name,this.renderer.xr.isPresenting||(n?(t=n.orientation,this.orbitService.setOrientation(t),this.orbitService.zoom=n.zoom,this.camera.updateProjectionMatrix()):e.keepOrientation||(t=e.useLastOrientation?e.lastOrientation:e.orientation,this.orbitService.setOrientation(t),this.orbitService.zoom=e.zoom,this.camera.updateProjectionMatrix())))},r.addControllers=function(){var e=this.controllerGroup=new THREE.Group;this.teleport=new qi;this.controllers=[],this.controllerModelFactory=new bs,this.addController(0),this.addController(1),this.cameraGroup.add(e)},r.addController=function(e){var t=this,n=I.state.live,i=this.renderer,o=this.controllerGroup,r=i.xr.getController(e),s=this.controllerModelFactory,a=this.teleport,u=this.scene,c=this.camera,l=this.cameraGroup;r.name="[controller"+(e+1)+"]",o.add(r);var d=function(e){switch(e.index){case 0:case 1:break;case 4:Ye.send({type:Ie})}},h=function(e){t.onModelUp()},p=function(e){t.cameraGroup.rotation.y+=Math.PI/180*45},f=function(e){t.cameraGroup.rotation.y-=Math.PI/180*45},m=function(e){t.onModelDistance(e.y)};r.userData.update=function(){},r.addEventListener("selectstart",(function(e){r.userData.isSelecting=!0,function(e){t.controller=e}(r)})),r.addEventListener("selectend",(function(e){r.userData.isSelecting=!1})),r.addEventListener("connected",(function(a){if(r.add(t.buildController(a.data)),n&&"left"===a.data.handedness){var u=t.phone=new zi;r.add(u.mesh)}if(!n||"right"===a.data.handedness){var c=i.xr.getControllerGrip(e);c.name="[controller-grip"+(e+1)+"]";var l=s.createControllerModel(c);r.userData.model=l,c.add(l),o.add(c)}var v=new to(a.data.gamepad);v.on("press",d),v.on("release",h),v.on("left",p),v.on("right",f),v.on("axis",m),r.userData.gamepad=v,r.userData.update=function(){v.update()}})),r.addEventListener("disconnected",(function(t){for(;r.children.length;)r.remove(r.children[0]);for(var n=i.xr.getControllerGrip(e);n.children.length;)n.remove(n.children[0]);o.remove(n),r.userData.update=function(){};var s=r.userData.gamepad;s&&(s.off("press",d),s.off("release",h),s.off("left",p),s.off("right",f),s.off("axis",m),delete r.userData.gamepad),a.removeFromController(r,u,i,c,l)})),r.addEventListener("squeezestart",(function(e){t.view&&t.view.type.name===$t.Room3d.name&&(a.addToController(r,u),t.indicator.mesh.visible=!1,r.children[0].visible=!1)})),r.addEventListener("squeezeend",(function(e){a.removeFromController(r,u,i,c,l),t.indicator.mesh.visible=!0,r.children[0].visible=!0})),this.controllers.push(r)},r.buildController=function(e){var t,n;switch(e.targetRayMode){case"tracked-pointer":return(t=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new THREE.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),new THREE.Line(t,n);case"gaze":return t=new THREE.RingBufferGeometry(.02,.04,32).translate(0,0,-1),n=new THREE.MeshBasicMaterial({opacity:.5,transparent:!0}),new THREE.Mesh(t,n)}},r.onModelDown=function(e){var t=this.controller;if(t&&this.renderer.xr.isPresenting){var n=this.tempTarget=e.mesh,i=(this.tempParent=n.parent,new THREE.Vector3);n.localToWorld(i),t.worldToLocal(i),t.add(n),n.position.copy(i)}},r.onModelDistance=function(e){var t=this.controller,n=this.tempTarget;if(t&&n&&this.renderer.xr.isPresenting){var i=new THREE.Vector3;i=i.copy(n.position);var o=Math.max(1,Math.min(8,i.distanceTo(ws)+.02*e));i.normalize(),i=i.multiplyScalar(o),n.position.copy(i)}},r.onModelUp=function(){var e=this.tempTarget,t=this.tempParent;if(e&&t){var n=new THREE.Vector3;e.localToWorld(n),t.worldToLocal(n),t.add(e),e.position.copy(n),this.tempTarget=null,this.tempParent=null}},r.updateRaycasterXR=function(e,t){if(e)return this.controllerMatrix_.identity().extractRotation(e.matrixWorld),t.ray.origin.setFromMatrixPosition(e.matrixWorld),t.ray.direction.set(0,0,-1).applyMatrix4(this.controllerMatrix_),t},r.repos=function(e,t){var n=this.worldRect;e.scale.set(.8,.8,.8);var i=(t.x+t.width/2-n.width/2)/n.width*2*this.camera.aspect,o=(t.y+t.height/2-n.height/2)/n.height*2*this.camera.aspect;e.position.set(i,-o,0)},r.render=function(e){try{var t=this.renderer,n=this.scene,i=this.camera,o=this.avatars,r=t.xr.isPresenting;if(!r&&I.state.mode===Pe)return;r?(gsap.ticker.tick(),this.controllers.forEach((function(e){return e.userData.update()})),this.teleport.update()):this.navWithKeys(),this.orbitService.render();var s=performance.now(),a=this.tick_?++this.tick_:this.tick_=1;n.traverse((function(e){var o=e.userData.render;"function"==typeof o&&o(s,a,t,n,i)})),Object.keys(o).forEach((function(e){o[e].render()})),this.vrService.updateState(this),this.raycasterXRHitTest(),t.render(n,i)}catch(e){this.error=e}},r.navWithKeys=function(){if(this.view&&this.view.type.name===$t.Room3d.name&&this.view.mesh&&!this.locked&&!mt.hasModal){this.intersectObjects=this.view.intersectObjects;var e=this.velocity||(this.velocity=new THREE.Vector3),t=this.direction||(this.direction=new THREE.Vector3),n=this.camera,i=.1;if(this.keys.w||this.keys.ArrowUp)n.getWorldDirection(t),t.multiplyScalar(i),e.copy(t);else if(this.keys.s||this.keys.ArrowDown)n.getWorldDirection(t),t.multiplyScalar(-.1),e.copy(t);else if(this.keys.d||this.keys.ArrowRight){n.getWorldDirection(t),t.multiplyScalar(i);var o=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),r=-Math.PI/2;t.applyAxisAngle(o,r),e.copy(t)}else if(this.keys.a||this.keys.ArrowLeft){n.getWorldDirection(t),t.multiplyScalar(-.1);var s=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),a=-Math.PI/2;t.applyAxisAngle(s,a),e.copy(t)}if(e.manhattanLength()>1e-5){t.copy(this.cameraGroup.position),t.add(e),t.y=0;var u=this.raycaster;u.set(t,xs),u.intersectObjects(this.view.navIntersectObjects).length&&(this.cameraGroup.position.add(e),this.cameraGroup.position.y=0,this.orbitService.markAsDirty()),e.lerp(ws,.1)}else e.set(0,0,0)}else this.intersectObjects=this.panoramaIntersectObjects},r.animate=function(){this.renderer.setAnimationLoop(this.render)},r.resize=function(){try{var e=this.container,t=this.renderer,n=this.camera,i=this.size,o=e.getBoundingClientRect();if(i.left=Math.floor(o.left),i.top=Math.floor(o.top),i.width=Math.ceil(o.width),i.height=Math.ceil(o.height),i.aspect=i.width/i.height,this.worldRect.setSize(i.width,i.height),!t.xr.isPresenting&&(t.setSize(i.width,i.height),n)){n.aspect=i.width/i.height;var r=n.fov*Math.PI/180,s=Math.abs(n.position.z*Math.tan(r/2)*2),a=this.cameraRect;a.width=s*n.aspect,a.height=s,n.updateProjectionMatrix()}}catch(e){this.error=e}},r.updateRaycasterMouse=function(e){var t=this.size.width/2,n=this.size.height/2;this.mouse.x=(e.clientX-this.size.left-t)/t,this.mouse.y=-(e.clientY-this.size.top-n)/n;var i=this.raycaster;return i.setFromCamera(this.mouse,this.camera),i},r.raycasterXRHitTest=function(){if(this.renderer.xr.isPresenting&&!this.locked){var e=this.updateRaycasterXR(this.controller,this.raycaster);if(e){Vn.hittest(e,this.controller.userData.isSelecting);this.indicator.update(this.renderer.xr.getCamera(this.camera))}}},r.raycasterDesktopHitTest=function(e){var t=this.updateRaycasterMouse(e);if(!this.lockedOrXR)if(this.dragItem){if("function"==typeof this.dragItem.onDragMove){var n=t.intersectObjects(this.intersectObjects);if(n.length){var i=n[0],o=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),r=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),s=o.copy(i.point),a=r.copy(i.face.normal);this.dragItem.onDragMove(s,a,this.intersectObjects===this.panoramaIntersectObjects)}}}else if(this.resizeItem);else{Vn.hittest(t);this.controlEvent$.next(Es)}},r.onMouseDown=function(e){try{if(this.locked)return;if(0!==e.button)return;var t=this.updateRaycasterMouse(e);Vn.hittest(t,!0);if(this.editor||m)if(this.keys.Shift||this.keys.Control);else{this.select.next({item:null});var n=t.intersectObjects(this.intersectObjects);if(n.length){var i=n[0],o=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),r=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),s=o.copy(i.point),a=r.copy(i.face.normal);this.viewHit.next({position:s,normal:a,spherical:this.intersectObjects===this.panoramaIntersectObjects})}}}catch(e){this.error=e}},r.onMouseMove=function(e){try{this.raycasterDesktopHitTest(e)}catch(e){this.error=e}},r.onMouseUp=function(e){try{if(this.lockedOrXR)return;this.dragItem&&"function"==typeof this.dragItem.onDragEnd&&(this.dragItem.onDragEnd(),this.dragEnd.next(this.dragItem)),this.dragItem=null,this.resizeItem&&"function"==typeof this.resizeItem.onResizeEnd&&(this.resizeItem.onResizeEnd(),this.resizeEnd.next(this.resizeItem)),this.resizeItem=null;var t=this.updateRaycasterMouse(e);Vn.hittest(t,!1);this.checkSelectedItem()}catch(e){this.error=e}},r.onMouseWheel=function(e){try{if(this.lockedOrXR)return;var t=e.deltaY*(void 0!==e.wheelDeltaY?1:37),n=this.orbitService;gsap.to(n,{duration:.5,zoom:n.zoom+.1*t,ease:Power4.easeOut,overwrite:!0})}catch(e){this.error=e}},r.onOrientationDidChange=function(){this.controlEvent$.next(Es)},r.checkSelectedItem=function(){if(this.view){var e=this.view.items.find((function(e){return e.selected}));e&&e.mesh&&"model"!==this.view.type.name&&this.orbitService.lookAt(e.mesh)}},r.onVRStarted=function(){this.objects.position.y=1.3,this.scene.add(this.indicator.mesh),Ye.send({type:Te})},r.onVREnded=function(){this.objects.position.y=0,this.cameraGroup.rotation.y=0,this.cameraGroup.position.y=0,this.scene.remove(this.indicator.mesh),this.orbitService.markAsDirty(),Ye.send({type:ke})},r.onVRStateDidChange=function(e){Ye.send({type:Me,camera:e.camera.array})},r.onMenuNav=function(e){this.menu=void 0,this.navTo.next({viewId:e.id})},r.onMenuToggle=function(e){this.locked||(this.menu=e,this.view.items.forEach((function(e){return e.showPanel=!1})),this.pushChanges())},r.onNavOver=function(e){this.menu||(this.view.items.forEach((function(e){return e.showPanel=!1})),e.item.to&&clearTimeout(e.item.to),e.item.showPanel=e.shouldShowPanel(),this.pushChanges(),Ye.send({type:pe,itemId:e.item.showPanel?e.item.id:null}))},r.onNavOut=function(e){var t=this;e.item.to=setTimeout((function(){e.item.showPanel=!1,t.pushChanges()}),4e3),this.pushChanges()},r.onNavDown=function(e){e.item.showPanel=!1,this.locked||(this.editor&&this.keys.Shift?(this.dragItem=e,this.select.next(e)):this.editor&&this.keys.Control?(this.resizeItem=e,this.select.next(e)):this.navTo.next(e.item))},r.onNavLink=function(e){this.locked||(k.flags.useIframe?(Ye.send({type:Ee,itemId:e.id}),this.navLink.next(e)):window.open(e.link.href,"_blank"))},r.onPanelDown=function(e){this.locked||(k.flags.useIframe?(Ye.send({type:Ee,itemId:e.id}),this.navLink.next(e)):window.open(e.link.href,"_blank"))},r.onObjectDown=function(e){this.lockedOrXR||(this.editor&&this.keys.Shift?(this.dragItem=e,this.select.next(e)):this.editor&&this.keys.Control&&(this.resizeItem=e,this.select.next(e)))},r.onPlayMedia=function(e){Ye.send({type:fe,itemId:e.itemId,playing:e.playing})},r.onZoomMedia=function(e){e.zoomed&&this.view.items.forEach((function(t){t.mesh instanceof yi&&t.id!==e.itemId&&t.mesh.setZoomedState(!1)})),this.view.items.forEach((function(e){return e.showPanel=!1})),I.patchState({zoomedId:e.zoomed?e.itemId:null}),Ye.send({type:me,itemId:e.itemId,zoomed:e.zoomed})},r.onCurrentTimeMedia=function(e){Ye.send({type:ve,itemId:e.itemId,currentTime:e.currentTime})},r.onPlayModel=function(e){Ye.send({type:ge,itemId:e.itemId,actionIndex:e.actionIndex})},r.onGridMove=function(e){var t=this;this.view.items=[],this.pushChanges(),this.orbitService.walk(e.position,(function(n,i){var o=t.view.getTile(e.indices.x,e.indices.y);o&&t.panorama.crossfade(o,t.renderer,(function(e){k.flags.useTextureEnvironment||t.setBackground(e),t.orbitService.walkComplete(n,i),t.view.updateCurrentItems(),t.pushChanges()}))}))},r.onGridNav=function(e){this.locked||(Ye.send({type:xe,viewId:this.view.id,gridIndex:e}),this.pushChanges())},r.control$=function(){var e=this;return this.controlEvent$.pipe(i.filter((function(){return e.controlling||e.spyed||e.editor})),i.auditTime(40),i.tap((function(t){t.orientation.latitude=e.orbitService.latitude,t.orientation.longitude=e.orbitService.longitude,t.zoom=e.orbitService.zoom,t.cameraGroup={position:e.cameraGroup.position.toArray(),rotation:e.cameraGroup.rotation.toArray()};var n=e.raycaster.intersectObjects(e.intersectObjects),i=n.length?n[0].point.normalize():null;i&&(t.pointer[0]=i.x,t.pointer[1]=i.y,t.pointer[2]=i.z),Ye.send(t)})))},r.addListeners=function(){var e=this;this.controlEvent$=new n.ReplaySubject(1),this.control$().pipe(i.takeUntil(this.unsubscribe$)).subscribe();var t=this.vrService=eo.getService();t.session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.renderer.xr.setSession(t),t?e.onVRStarted():e.onVREnded()})),t.state$.pipe(i.takeUntil(this.unsubscribe$),i.auditTime(Math.floor(1e3/15))).subscribe((function(t){e.onVRStateDidChange(t)})),this.orbitService.observe$(this.container).pipe(i.shareReplay(1)).pipe(i.filter((function(e){return e instanceof Ai})),i.auditTime(Math.floor(1e3/15))).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.onOrientationDidChange()})),Ye.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case re:t.type=se,t.viewId=e.view.id,t.orientation=e.orbitService.getOrientation(),t.zoom=e.orbitService.zoom,t.cameraGroup={position:e.cameraGroup.position.toArray(),rotation:e.cameraGroup.rotation.toArray()},e.view instanceof Dt&&(t.gridIndex=e.view.index),Ye.sendBack(t),I.state.role!==C.Publisher&&I.patchState({spying:t.remoteId});break;case se:kn.viewId!==t.viewId?(kn.viewId=t.viewId,e.requestInfoResult=t):(e.renderer.xr.isPresenting||(e.orbitService.setOrientation(t.orientation),e.orbitService.zoom=t.zoom,e.cameraGroup.position.set(t.cameraGroup.position[0],t.cameraGroup.position[1],t.cameraGroup.position[2]),e.cameraGroup.rotation.set(t.cameraGroup.rotation[0],t.cameraGroup.rotation[1],t.cameraGroup.rotation[2])),e.view instanceof Dt&&t.gridIndex&&(e.view.index=t.gridIndex),e.view&&e.view.ready||(e.requestInfoResult=t));break;case pe:e.menu&&e.menu.removeMenu(),e.view.items.forEach((function(e){return e.showPanel=e.id===t.itemId})),e.pushChanges();break;case Ee:var n=e.view.items.find((function(e){return e.id===t.itemId}));n&&e.navLink.next(n);break;case Se:e.view.items.find((function(e){return e.id===t.itemId}))&&mt.resolve();break;case fe:var i=e.view.items.find((function(e){return e.id===t.itemId}));i&&i.mesh instanceof yi&&i.mesh.setPlayingState(t.playing);break;case me:e.view.items.forEach((function(e){e.mesh instanceof yi&&(e.id===t.itemId?e.mesh.setZoomedState(t.zoomed):e.mesh.setZoomedState(!1))})),I.patchState({zoomedId:t.zoomed?t.itemId:null});break;case ve:var o=e.view.items.find((function(e){return e.id===t.itemId}));o&&o.mesh instanceof yi&&o.mesh.setCurrentTime(t.currentTime);break;case ge:var r=e.view.items.find((function(e){return e.id===t.itemId}));r&&r.onMessage(t);break;case xe:e.view.id===t.viewId&&(e.view.index=t.gridIndex);break;case Te:e.addOffCanvasScene(t);break;case ke:e.removeOffCanvasScene(t);break;case Me:e.updateOffCanvasScene(t),I.state.spying!==t.clientId&&I.state.controlling!==t.clientId||e.orbitService.setVRCamera(t.camera);break;case de:e.renderer.xr.isPresenting||(e.orbitService.setOrientation(t.orientation),e.orbitService.zoom=t.zoom,e.cameraGroup.position.set(t.cameraGroup.position[0],t.cameraGroup.position[1],t.cameraGroup.position[2]),e.cameraGroup.rotation.set(t.cameraGroup.rotation[0],t.cameraGroup.rotation[1],t.cameraGroup.rotation[2])),e.pointer.setPosition(t.pointer[0],t.pointer[1],t.pointer[2],e.camera)}})),Ye.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case _e:e.checkSelectedItem()}})),I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.showPointer=e.locked})),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),window.addEventListener("resize",this.resize,!1),this.container.addEventListener("wheel",this.onMouseWheel,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1),this.container.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1)},r.removeListeners=function(){window.removeEventListener("resize",this.resize,!1),window.removeEventListener("resize",this.resize,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("wheel",this.onMouseWheel,!1),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("mouseup",this.onMouseUp,!1)},u(o,[{key:"error",get:function(){return this.error_},set:function(e){this.error_!==e&&(this.error_=e,this.pushChanges())}},{key:"view",get:function(){return this.view_},set:function(e){this.view_!==e&&(this.view_=e,this.setView())}},{key:"debugging",get:function(){return m}},{key:"controlled",get:function(){return I.state.controlling&&I.state.controlling!==I.state.uid}},{key:"controlling",get:function(){return I.state.controlling&&I.state.controlling===I.state.uid}},{key:"silencing",get:function(){return I.state.silencing}},{key:"silenced",get:function(){return I.state.silencing&&I.state.role===C.Streamer}},{key:"spyed",get:function(){return I.state.spying&&I.state.spying===I.state.uid}},{key:"spying",get:function(){return I.state.spying&&I.state.spying!==I.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"lockedOrXR",get:function(){return this.locked||this.renderer.xr.isPresenting}},{key:"showMenu",get:function(){return I.state.hosted&&I.state.navigable&&("embed"!==I.state.mode||k.flags.menuEmbed)}},{key:"showPointer",get:function(){return null!=this.pointer.mesh.parent},set:function(e){this.showPointer!==e&&(e?this.scene.add(this.pointer.mesh):this.scene.remove(this.pointer.mesh))}},{key:"menu",set:function(e){this.menu_!==e&&(this.menu_=e,this.scene.traverse((function(t){(t instanceof yi||t instanceof fi)&&(t.freezed=null!=e)})))},get:function(){return this.menu_}}]),o}(e.Component);Ss.meta={selector:"[world]",inputs:["view","views","editor"],outputs:["navTo","navLink","viewHit","dragEnd","resizeEnd","select"]};var Ts=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var e=this;if(!this.host)throw"ModelComponent host is undefined";this.scale=new THREE.Vector3(1,1,1),this.position=new THREE.Vector3;var t=this.group=new THREE.Group;t.name=this.getName(),t.userData.render=function(t,n){e.render(e,t,n)},this.getContainer().add(t),this.onCreate((function(t,n){return e.onMount(t,n)}),(function(t,n){return e.onDismount(t,n)}))},i.onDestroy=function(){var e=this.group;this.getContainer().remove(e),delete e.userData.render,this.disposeObject(e),this.group=null},i.getContainer=function(){return this.host.objects},i.getName=function(e){return this.constructor.meta.selector+"-"+this.rxcompId+(e?"-"+e:"")},i.onCreate=function(e,t){var n=new THREE.MeshStandardMaterial({color:new THREE.Color("#ffcc00"),roughness:.4,metalness:.01,flatShading:!0,transparent:!0,opacity:.9}),i=new THREE.Mesh(Dn.defaultGeometry,n);return"function"==typeof e&&e(i),i},i.onMount=function(e,t){var n=this;this.mesh&&this.onDismount(this.mesh),e.name=this.getName("mesh"),this.mesh=e,t&&(t.mesh=e,Object.defineProperty(t,"visible",{get:function(){return e.visible},set:function(e){n.setVisible(e)},configurable:!0}),t.onUpdate=function(){n.onUpdate(t,e)},t.onUpdateAsset=function(){n.onUpdateAsset(t,e)},t.onMessage=function(e){n.onMessage(e)}),this.group&&this.group.add(e)},i.onDismount=function(e,t){this.group.remove(e),"function"==typeof e.dispose&&e.dispose(),this.disposeObject(e),this.mesh=null,t&&(delete t.mesh,delete t.onUpdate,delete t.onUpdateAsset,delete t.onMessage)},i.disposeObject=function(e){e.traverse((function(e){(e.isInteractiveMesh||e.isInteractiveSprite)&&Vn.dispose(e),e.isMesh?(e.material.map&&!1!==e.material.map.disposable&&e.material.map.dispose(),e.material.dispose(),e.geometry.dispose()):e.isSprite&&(e.material.map&&!1!==e.material.map.disposable&&e.material.map.dispose(),e.material.dispose())}))},i.calculateScaleAndPosition=function(){var t=e.getContext(this).node;this.host.repos(this,t.getBoundingClientRect())},i.render=function(e,t){},i.setVisible=function(e){this.mesh&&(this.mesh.visible=e)},i.getScroll=function(e){return this.intersection.scroll(e)},i.getTween=function(e){var t=Math.min(0,this.intersection.offset(e))+1;return t=Math.max(0,t),t-=1},i.onUpdate=function(e,t){},i.onUpdateAsset=function(e,t){},i.onMessage=function(e){},u(n,[{key:"renderOrder",set:function(e){this.group.renderOrder=e}}]),n}(e.Component);Ts.meta={selector:"[model]",hosts:{host:Ss},inputs:["item"]};var ks=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this),this.RADIUS=100},n.onDestroy=function(){this.editing=!1,e.prototype.onDestroy.call(this)},n.setHelper=function(e){e?(this.helper||(this.helper=new THREE.BoxHelper(this.mesh,65280)),this.host.scene.add(this.helper)):this.helper&&this.host.scene.remove(this.helper)},n.updateHelper=function(){this.helper&&this.helper.setFromObject(this.mesh)},u(t,[{key:"editing",get:function(){return this.editing_},set:function(e){this.editing_!==e&&(this.editing_=e,this.setHelper(e))}}]),t}(Ts);ks.meta={selector:"[model-editable]",hosts:{host:Ss},inputs:["item"]};var Ms="none",Is="move",Cs="info",Rs="point",As="title",_s="transparent",Ls="wishlist",Ps=function(e){function t(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return c(h(t=e.call.apply(e,[this].concat(i))||this),"hidden_",!1),t}d(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTexturePoint=function(){return t.texturePoint||(t.texturePoint=t.getLoader().load(k.getPath("textures/ui/nav-point.png")))},t.getTexturePointImportant=function(){return t.texturePointImportant||(t.texturePointImportant=t.getLoader().load(k.getPath("textures/ui/nav-point-important.png")))},t.getTextureMove=function(){return t.textureMove||(t.textureMove=t.getLoader().load(k.getPath("textures/ui/nav-more.png")))},t.getTextureMoveImportant=function(){return t.textureMoveImportant||(t.textureMoveImportant=t.getLoader().load(k.getPath("textures/ui/nav-more-important.png")))},t.getTextureInfo=function(){return t.textureInfo||(t.textureInfo=t.getLoader().load(k.getPath("textures/ui/nav-info.png")))},t.getTextureInfoImportant=function(){return t.textureInfoImportant||(t.textureInfoImportant=t.getLoader().load(k.getPath("textures/ui/nav-info-important.png")))},t.getTextureWishlist=function(){return t.textureWishlist||(t.textureWishlist=t.getLoader().load(k.getPath("textures/ui/nav-wishlist-off.png")))},t.getTextureWishlistAdded=function(){return t.textureWishlistAdded||(t.textureWishlistAdded=t.getLoader().load(k.getPath("textures/ui/nav-wishlist-on.png")))},t.getTexture=function(e,t){var n;switch(e){case Is:n=t.important?this.getTextureMoveImportant():this.getTextureMove();break;case Cs:n=t.important?this.getTextureInfoImportant():this.getTextureInfo();break;case Rs:case As:n=t.important?this.getTexturePointImportant():this.getTexturePoint();break;case Ls:n=t.added?this.getTextureWishlistAdded():this.getTextureWishlist()}return n.disposable=!1,n.encoding=THREE.sRGBEncoding,n},t.getTitleTexture=function(e,t){var n;if(t===As){var i=e.title,o=document.createElement("canvas");o.width=512,o.height=32;var r=o.getContext("2d");r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.font="24px "+k.fontFamily;var s=r.measureText(i).width+8,a=(s=Math.pow(2,Math.ceil(Math.log(s)/Math.log(2))))/2;o.width=s,r.font="24px "+k.fontFamily,r.textAlign="center",r.textBaseline="middle",r.strokeStyle="rgba(0, 0, 0, 0.5)",r.lineWidth=6,r.lineJoin="round",r.miterLimit=2,r.strokeText(i,a,16),r.fillStyle="white",r.fillText(i,a,16),n=new THREE.CanvasTexture(o)}return n},t.getNavMode=function(e,t){var n=Ms;return e.hook&&"ToggleWishlist"===e.hook?n=Ls:e.transparent?n=_s:e.viewId!==t.id?(n=Is,this.isValidText(e.title)&&(n=As),(this.isValidText(e.abstract)||e.asset&&e.asset.id||e.link&&e.link.href)&&(n=Rs)):(this.isValidText(e.title)||this.isValidText(e.abstract)||e.asset&&e.asset.id||e.link&&e.link.href)&&(n=Cs),n},t.hasNavInfo=function(e){var t=this;return null!=e.items.find((function(n){return t.getNavMode(n,e)===Cs}))},t.isValidText=function(e){return e&&e.length>0};var n=t.prototype;return n.shouldShowPanel=function(){return!this.editing&&this.mode!==Is&&this.mode!==As&&this.mode!==Ls&&(this.mode!==_s||t.isValidText(this.item.title))},n.updateVisibility=function(e){this.mesh&&(this.mesh.visible=e),this.sphere&&(this.sphere.freezed=!e),!e&&this.item&&(this.item.showPanel=!1)},n.setVisible=function(e){this.mesh&&(this.mesh.visible=e&&!this.hidden_)},n.onInit=function(){e.prototype.onInit.call(this)},n.onChanges=function(){var e=this.view,n=this.item;(this.mode=t.getNavMode(n,this.view))===Ls&&(n.added=An.has({viewId:e.id,itemId:n.id}),this.onCreateSprites(this.mesh,1)),this.editing=n.selected,this.hidden=this.isHidden},n.onCreate=function(e,n){var i=this,o=this.view,r=this.item,s=this.mode=t.getNavMode(r,this.view);if(s!==Ms){s===Ls&&(r.added=An.has({viewId:o.id,itemId:r.id}));var a=this.isAnimated,u=new THREE.Group;if(s===_s){var c=this.editor?.1:0;u.position.fromArray(r.position),u.rotation.fromArray(r.rotation),u.scale.fromArray(r.scale);var l=Dn.planeGeometry,d=this.plane=new Nn(l,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:c,color:new THREE.Color(k.colors.menuOverBackground)}));if(d.name="[nav] "+r.id,d.depthTest=!1,u.add(d),a){var h={pow:0};gsap.to(h,{pow:1,duration:.6,delay:.5+.1*r.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:function(){d.material.opacity=.3*h.pow}})}d.on("over",(function(){a||(d.material.opacity=.2),i.over.next(i)})),d.on("out",(function(){a||(d.material.opacity=c),i.out.next(i)})),d.on("down",(function(){a||(d.material.opacity=.3),i.down.next(i),!i.editor&&!i.shouldShowPanel()&&i.item.link&&i.item.link.href&&(i.shouldNavToLink=i.item.link.href)})),d.on("up",(function(){a||(d.material.opacity=c),null!=i.shouldNavToLink&&(i.shouldNavToLink=null,i.link.next(i.item))}))}else{var p=new THREE.Vector3(r.position[0],r.position[1],r.position[2]),f=new THREE.Vector3(r.position[0],r.position[1],r.position[2]).normalize();p.distanceToSquared(f)<1e-4&&p.multiplyScalar(t.RADIUS),u.position.copy(p),this.onCreateSprites(u);var m=Dn.sphereGeometry,v=this.sphere=new Nn(m,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0,color:65535}));v.name="[nav] "+r.id,v.depthTest=!1,u.add(v);var g={pow:0};gsap.to(g,{pow:1,duration:.7,delay:.5+.1*r.index,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){i.materials.forEach((function(e){e.opacity=g.pow}))},onComplete:function(){if(a){var e=i.icon;g.pow=0,gsap.to(g,{pow:1,duration:.6,delay:.5+.1*r.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:function(){var t=i.iconMinScale+g.pow*(i.iconMaxScale-i.iconMinScale);e.scale.set(t,t,t),e.material.opacity=g.pow}})}}}),v.on("over",(function(){if(i.over.next(i),!a){var e=i.icon,t={scale:e.scale.x};gsap.to(t,{duration:.35,scale:i.iconMaxScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){e.scale.set(t.scale,t.scale,t.scale)}})}})),v.on("out",(function(){if(i.out.next(i),!a){var e=i.icon,t={scale:e.scale.x};gsap.to(t,{duration:.35,scale:i.iconMinScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){e.scale.set(t.scale,t.scale,t.scale)}})}})),v.on("down",(function(){i.down.next(i)}))}"function"==typeof e&&e(u,r)}},n.onCreateSprites=function(e,n){void 0===n&&(n=0),this.onRemoveSprite(this.icon),this.onRemoveSprite(this.title);var i=this.item,o=this.mode=t.getNavMode(i,this.view);if(o!==Ms)if(o===_s)this.materials=[];else{var r,s=t.getTexture(o,i),a=new THREE.SpriteMaterial({map:s,depthTest:!1,depthWrite:!1,transparent:!0,sizeAttenuation:!1,opacity:n}),u=[a],c=this.iconMinScale,l=this.icon=new THREE.Sprite(a);l.renderOrder=k.renderOrder.nav,l.scale.set(c,c,c),e.add(l);var d=t.getTitleTexture(i,o);if(d){r=new THREE.SpriteMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:d,sizeAttenuation:!1,opacity:n});var h=d.image,p=this.title=new THREE.Sprite(r);p.scale.set(c*h.width/h.height,c,c),p.position.set(0,-3.5,0),e.add(p),u.push(r)}this.materials=u}},n.onRemoveSprite=function(e){e&&(e.parent&&e.parent.remove(e),e.material.map&&!1!==e.material.map.disposable&&e.material.map.dispose(),e.material.dispose())},n.onDestroy=function(){Vn.dispose(this.sphere),e.prototype.onDestroy.call(this)},n.onUpdate=function(e,t){this.item=e,this.onCreateSprites(t,1),this.mode===_s?(e.position&&t.position.fromArray(e.position),e.rotation&&t.rotation.fromArray(e.rotation),e.scale&&t.scale.fromArray(e.scale)):(t.position.fromArray(e.position),t.rotation.set(0,0,0),t.scale.set(1,1,1)),this.updateHelper()},n.onDragMove=function(e,n,i){var o=this.item,r=this.mesh;this.editing=!0,o.showPanel=!1,this.mode===_s?i?(e.normalize().multiplyScalar(t.RADIUS),r.position.set(e.x,e.y,e.z),r.lookAt(Fn.origin)):(r.position.set(0,0,0),r.lookAt(n),r.position.set(e.x,e.y,e.z),r.position.add(n.multiplyScalar(.01))):i?(e.normalize().multiplyScalar(t.RADIUS),r.position.set(e.x,e.y,e.z)):(r.position.set(e.x,e.y,e.z),r.position.add(n.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var e=this.item,t=this.mesh;this.mode===_s?(e.position=t.position.toArray(),e.rotation=t.rotation.toArray(),e.scale=t.scale.toArray()):e.position=t.position.toArray(),this.editing=!1},u(t,[{key:"hidden",get:function(){return this.hidden_},set:function(e){this.hidden_!==e&&(this.hidden_=e,this.updateVisibility(!e))}},{key:"isHidden",get:function(){return null!=I.state.zoomedId||k.flags.hideNavInfo&&!this.editor&&!I.state.showNavInfo&&!(this.host.renderer.xr.isPresenting||I.state.role===C.SelfService||I.state.role===C.Embed)&&this.mode===Cs}},{key:"isAnimated",get:function(){var e=!1,t=this.mode,n=this.item.important;switch(t){case Cs:e=n?k.flags.navInfoImportantAnimated:k.flags.navInfoAnimated;break;case Is:e=n?k.flags.navMoveImportantAnimated:k.flags.navMoveAnimated;break;case Rs:e=n?k.flags.navPointImportantAnimated:k.flags.navPointAnimated;break;case As:e=n?k.flags.navTitleImportantAnimated:k.flags.navTitleAnimated;break;case _s:e=n?k.flags.navTransparentImportantAnimated:k.flags.navTransparentAnimated}return e}},{key:"iconMinScale",get:function(){return.03*(k.navs.iconMinScale||1)}},{key:"iconMaxScale",get:function(){return.03*(k.navs.iconMaxScale||1.5)}}]),t}(ks);Ps.RADIUS=100,Ps.meta={selector:"[model-nav]",hosts:{host:Ss},outputs:["over","out","down","link"],inputs:["item","view","editor"]};var $s=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this;e.getContext(this).node.classList.remove("hidden"),this.platform=nt.platform,this.state={},this.hosted=null,this.view=null,this.previousView=null,this.form=null,this.local=null,this.screen=null,this.remoteScreen_=null,this.navmaps=[],this.navmap=null,this.hasScreenViewItem=!1,this.remotes=[],(this.vrService=eo.getService()).status$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.pushChanges()})),this.resolveUser()},r.getName=function(e){return I.state.name||L.getName(e)},r.getLinkRole=function(){var e=null;if(window.location.pathname===k.url.selfServiceTour)return e=C.SelfService;var t=(M.get("link")||"").match(/\d{9}-(\d{4})-\d{13}/);if(t){var n=parseInt(t[1]);e=Object.keys(C).reduce((function(e,t,i){return i===n?C[t]:e}),null)}return e},r.resolveUser=function(){var e=this;this.isEmbed?qe.temporaryUser$(C.Embed).pipe(i.first()).subscribe((function(t){e.initWithUser(t)})):qe.me$().pipe(i.first()).subscribe((function(t){e.initWithUser(t)}))},r.userGuard=function(e){var t=this.getLinkRole();!e||t&&e.type!==t?this.initWithUser({type:t}):this.initWithUser(e)},r.userGuardRedirect=function(e){var t=this.getLinkRole();!e||t&&t!==e.type?t===C.Publisher||t===C.Attendee?window.location.href=k.url.access:this.initWithUser({type:t}):this.initWithUser(e)},r.setNextStatus=function(){var e=D,t=I.state;return t.role===C.SmartDevice&&(t.name=t.name||"Smart Device"),e=t.checklist?t.link?t.user.id||t.role!==C.Publisher&&t.role!==C.Attendee?t.name?t.role!==C.Viewer&&t.role!==C.SmartDevice?N:z:B:j:V:F,I.patchState({status:e}),e},r.getPathId=function(){var e=M.get("pathId")||null;if(e)return console.log("AgoraComponent.getPathId",e),parseInt(e);var t=M.get("link")||null;t&&(e=new _(t).pathId);return console.log("AgoraComponent.getPathId",e),e},r.initWithUser=function(e){var t=this,n=M.get("link")||null,o=this.getPathId(),r=this.getLinkRole()||(e?e.type:null);switch(r){case C.SelfService:if(!e||e.type!==C.SelfService&&e.type!==C.Publisher)return void(window.location.href=k.url.access);e=Object.assign({},e,{type:C.SelfService});break;default:r!==(e=e||{type:r}).type&&(e={type:r})}var s=qe.getMode(r),a=M.get("name")||(e.firstName&&e.lastName?e.firstName+" "+e.lastName:null),u=r===C.Publisher,c=r!==C.SelfService&&r!==C.Embed&&!m,l=this.isNavigable,d={user:e,role:r,mode:s,name:a,checklist:null,pathId:o,link:n,channelName:k.channelName,uid:null,status:D,connecting:!1,connected:!1,controlling:!1,spying:!1,silencing:!1,hosted:u,live:c,navigable:l,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};I.state=d,I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.hosted=e.hosted,t.pushChanges(),t.locked?document.body.classList.add("locked"):document.body.classList.remove("locked")})),this.initAgora()},r.viewObserver$=function(){var e=this;return kn.data$().pipe(i.switchMap((function(e){return console.log("AgoraComponent.viewObserver$","pathId",I.state.pathId),Ct.getCurrentPath$(I.state.pathId).pipe(i.switchMap((function(t){return kn.hostedView$(e,t)})))})),i.map((function(t){return e.agora&&e.agora.navToView(t.id,t.keepOrientation,t.useLastOrientation),e.previousView=e.view,e.view=t,e.setNavmap(t),e.hasScreenViewItem=null!=t.items.find((function(e){return Un.isPublisherScreen(e)||Un.isAttendeeScreen(e)})),e.pushChanges(),t})))},r.load=function(e){this.loadNavmaps(),this.viewObserver$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){"function"==typeof e&&(e(),e=null)}))},r.loadNavmaps=function(){var e=this;k.flags.navmaps&&Zt.navmapGet$().pipe(i.first()).subscribe((function(t){e.navmaps=t}))},r.setNavmap=function(e){var t=(this.navmaps||[]).find((function(t){return null!=(t.items||[]).find((function(t){return t.viewId===e.id}))}))||null;this.navmap=t},r.toggleNavmap=function(){I.patchState({showNavmap:!I.state.showNavmap})},r.onNavmapItem=function(e){I.patchState({showNavmap:!1}),this.onNavTo(e)},r.loadAndConnect=function(e){var t=this;this.load((function(){t.connect(e)}))},r.initAgora=function(){var e=this;this.state.role===C.SelfService||this.state.role===C.Embed||m?(this.load((function(){I.patchState({status:q,hosted:!0})})),this.checkSelfServiceProposition(),this.checkSelfServiceAudio()):bt.isChecked$().pipe(i.first()).subscribe((function(t){I.patchState({checklist:t}),e.agora=ut.getSingleton();e.getLinkRole(),e.setNextStatus()})),at.local$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.local=t,e.pushChanges()})),at.screen$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.screen===e.remoteScreen&&(e.remoteScreen=null),e.screen=t,e.remoteScreen=t||e.remoteScreen,e.pushChanges()})),at.orderedRemotes$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.remotes=[],e.remoteScreen=e.screen,t.forEach((function(t){t.clientInfo&&t.clientInfo.screenUid===t.getId()?e.remoteScreen=t:e.remotes.push(t)})),e.pushChanges()})),Ye.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case K:if(e.isSelfServiceSupport)t.members.length>0?(un.open$({message:vt.transform("bhere_support_request_sent"),type:en,position:on}),Ye.send({type:X})):un.open$({message:vt.transform("bhere_support_request_leaved"),type:en,position:on});break;case X:e.isSelfServiceProposition&&e.openSupportRequestDialog(t.clientInfo);break;case ie:t.type=oe,t.clientInfo={role:I.state.role,name:I.state.name,uid:I.state.uid,screenUid:I.state.screenUid,controllingId:I.state.controlling,mode:I.state.mode},Ye.sendBack(t);break;case Y:un.open$({message:vt.transform("bhere_support_request_accepted"),type:en,position:on});break;case Z:un.open$({message:vt.transform("bhere_support_request_rejected"),type:en,position:on});break;case J:t.type=Q,Ye.sendBack(t),I.patchState({controlling:t.controllingId}),e.agora&&e.agora.sendControlRemoteRequestInfo(t.controllingId);break;case le:I.patchState({silencing:t.silencing}),e.setAudio(t.silencing);break;case we:e.onRemoteNavTo(t);break;case ye:I.patchState({mode:t.mode}),window.dispatchEvent(new Event("resize"));break;case be:e.hidePanels(),I.patchState({showNavInfo:t.showNavInfo});break;case he:kn.setViewLike$(t).pipe(i.first()).subscribe((function(t){return e.showLove(t)}));break;case Ce:I.state.chat||I.patchState({chatDirty:!0})}})),Ye.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.agora&&e.agora.sendMessage(t)})),this.fullscreen$().pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.agora&&I.state.status===z&&this.loadAndConnect()},r.onChecked=function(e){I.patchState({checklist:!0}),this.setNextStatus()},r.onLink=function(e){var t=new _(e).pathId,n=this.getLinkRole(),i=qe.getMode(n),o=I.state.user;n!==C.Publisher&&n!==C.Attendee||o.id&&o.type===n?I.state.name?n===C.Viewer||n===C.SmartDevice?(I.patchState({link:e,pathId:t,role:n,mode:i}),this.loadAndConnect()):I.patchState({link:e,pathId:t,role:n,mode:i,status:N}):I.patchState({link:e,pathId:t,role:n,mode:i,status:B}):I.patchState({link:e,pathId:t,role:n,mode:i,status:j})},r.onLogin=function(e){var t=this.getName(e);t?I.patchState({user:e,name:t,status:N}):I.patchState({user:e,status:B})},r.onName=function(e){I.state.role===C.Viewer||I.state.role===C.SmartDevice?(I.patchState({name:e}),this.loadAndConnect()):I.patchState({name:e,status:N})},r.onEnter=function(e){this.loadAndConnect(e)},r.connect=function(e){if(this.agora.connect$(e).pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.state.role===C.SelfService)Jt.push({action:"b-here-tour",userType:this.state.role});else if(this.state.role===C.Embed)Jt.push({action:"b-here-embed",userType:this.state.role});else{var t=this.state.link.replace(/-\d+-/,"-"),n={meetingId:this.state.link,sharedMeetingId:t,fullName:this.state.name,userType:this.state.role};qe.log$(n).pipe(i.first()).subscribe(),Jt.push({action:"b-here-meeting",meetingId:this.state.link,sharedMeetingId:t,userType:this.state.role})}},r.disconnect=function(){this.agora?this.agora.leaveChannel().then((function(){window.location.reload()}),console.log):this.patchState({connecting:!1,connected:!1})},r.onNavTo=function(e){var t=e.viewId,n=this.pathViews.find((function(e){return e.id===t}));n&&(kn.action={viewId:t,keepOrientation:e.keepOrientation,useLastOrientation:e.useLastOrientation},this.onHandleHook(n,e))},r.onNavLink=function(e){mt.open$({iframe:e.link.href}).pipe(i.first()).subscribe((function(t){Ye.send({type:Se,itemId:e.id})}))},r.onRemoteNavTo=function(e){var t=e.viewId,n=e.gridIndex;if(t&&kn.viewId!==t){var i=this.pathViews.find((function(e){return e.id===t}));i&&(kn.action={viewId:t,keepOrientation:e.keepOrientation,useLastOrientation:e.useLastOrientation},null!=n&&i instanceof Dt&&(i.index=n))}},r.onHandleHook=function(e,t){var n=this;switch(t.hook){case"ToggleWishlist":var o={viewId:e.id,itemId:t.id};An.toggle$(o).pipe(i.switchMap((function(e){return o.added=An.has(o),Cn.send$(t.hook,o,t.extra)})),i.first()).subscribe((function(e){console.log("AgoraComponent.onHandleHook",e),t.added=o.added,n.pushChanges()}))}},r.patchState=function(e){this.state=Object.assign({},this.state,e),this.pushChanges()},r.toggleCamera=function(){this.agora?this.agora.toggleCamera():this.patchState({cameraMuted:!this.state.cameraMuted})},r.toggleAudio=function(){this.agora?this.agora.toggleAudio():this.patchState({audioMuted:!this.state.audioMuted})},r.setAudio=function(e){this.agora?this.agora.setAudio(e):this.patchState({audioMuted:e})},r.toggleScreen=function(){this.agora?this.agora.toggleScreen():this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))},r.toggleVolume=function(){var e=!this.state.volumeMuted;I.patchState({volumeMuted:e});var t=this.selfServiceAudio;t&&(t.volume=e?0:.5)},r.toggleMode=function(){if(this.agora&&I.state.role===C.Publisher)this.agora.toggleMode();else{var e=this.state.mode===Le?Pe:Le;I.patchState({mode:e})}window.dispatchEvent(new Event("resize"))},r.toggleFullScreen=function(){var t=e.getContext(this).node;!this.state.fullScreen?t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},r.fullscreen$=function(){return n.fromEvent(document,"fullscreenchange").pipe(i.tap((function(e){var t=null!=document.fullscreenElement;I.patchState({fullScreen:t})})))},r.toggleChat=function(){I.patchState({chat:!I.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))},r.onChatClose=function(){I.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))},r.toggleNavInfo=function(){this.hidePanels(),this.agora?this.agora.toggleNavInfo():this.patchState({showNavInfo:!this.state.showNavInfo})},r.onBack=function(){this.previousView&&this.view&&this.previousView.id!==this.view.id&&(kn.action={viewId:this.previousView.id,useLastOrientation:!0})},r.hidePanels=function(){this.view.items.forEach((function(e){return e.showPanel=!1}))},r.onToggleControl=function(e){if(this.agora)this.agora.toggleControl(e);else{var t=this.state.controlling===e?null:e;this.patchState({controlling:t,spying:!1})}},r.onToggleSilence=function(){this.agora?this.agora.toggleSilence():this.patchState({silencing:!this.state.silencing})},r.onToggleSpy=function(e){if(this.agora)this.agora.toggleSpy(e);else{var t=this.state.spying===e?null:e;this.patchState({spying:t,controlling:!1})}},r.addLike=function(){var e=this;kn.viewLike$(this.view).pipe(i.first()).subscribe((function(t){t&&(e.view.liked=!0,e.showLove(t),Ye.send({type:he,viewId:e.view.id,likes:e.view.likes}))}))},r.showLove=function(e){var t=this;if(e&&this.view.id===e.id){var n=this.view.showLove;this.view.likes=e.likes,this.view.showLove=!0,this.pushChanges(),n||setTimeout((function(){t.view.showLove=!1,t.pushChanges()}),3100)}},r.tryInAr=function(){this.platform===Je||this.platform===Qe?ln.openInAR(this.view):mt.open$({src:k.template.modal.tryInAr,data:this.view}).pipe(i.first()).subscribe((function(e){}))},r.checkSelfServiceProposition=function(){var e=this;this.isSelfServiceProposition&&bt.check$().pipe(i.first()).subscribe((function(t){var n=new _({pathId:I.state.pathId}).toRoles(),o=new L({link:n.id,support:!0}).toGuidedTourUrl();qe.selfServiceSupportRequest$(I.state.user,n.id,o).pipe(i.first()).subscribe((function(t){var i=e.getName(I.state.user);I.patchState({checklist:!0,link:n.idSelfService,name:i}),e.agora=ut.getSingleton(),e.connect()}))}),(function(e){console.log("AgoraComponent.initAgora.isSelfServiceProposition.error",e,name)}))},r.checkSelfServiceAudio=function(){if(I.state.role===C.SelfService&&k.selfServiceAudio){var t=document.createElement("audio");t.setAttribute("playsinline","true"),t.setAttribute("autoplay","true"),t.setAttribute("loop","true"),t.volume=.5,t.src=k.selfServiceAudio,e.getContext(this).node.parentNode.appendChild(t),this.selfServiceAudio=t,Un.events$.pipe(i.tap((function(e){e instanceof Ln?t.pause():(e instanceof Pn||e instanceof $n)&&t.play()})),i.takeUntil(this.unsubscribe$)).subscribe()}},r.openSupportRequestDialog=function(e){un.open$({message:vt.transform("bhere_support_request_dialog"),acceptMessage:vt.transform("bhere_support_request_dialog_accept"),rejectMessage:vt.transform("bhere_support_request_dialog_reject"),type:tn,position:on}).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){if(e instanceof sn){Ye.send({type:Y});var t=I.state.name,n=new _(I.state.link);n.role=C.Streamer;var i=new L({link:n.toString(),name:t}).toGuidedTourUrl();setTimeout((function(){window.location.href=i}),1e3)}else Ye.send({type:Z})}))},u(o,[{key:"meetingUrl",get:function(){return this.meetingUrl_||(this.meetingUrl_=new L),this.meetingUrl_}},{key:"isVirtualTourUser",get:function(){return-1!==[C.Publisher,C.Attendee,C.Streamer,C.Viewer].indexOf(I.state.role)}},{key:"isEmbed",get:function(){return-1!==window.location.href.indexOf(k.url.embed)}},{key:"isNavigable",get:function(){return null==this.meetingUrl.embedViewId}},{key:"isBackButtonVisible",get:function(){return this.view&&(this.view.type.name===$t.Media.name||this.view.type.name===$t.Model.name)}},{key:"isSelfServiceProposition",get:function(){return I.state.role===C.SelfService&&k.flags.selfServiceProposition}},{key:"isSelfServiceSupport",get:function(){return I.state.role===C.Publisher&&k.flags.selfServiceProposition&&this.meetingUrl.support}},{key:"showNavInfoToggler",get:function(){return k.flags.hideNavInfo&&this.state.mode!==Pe&&this.view&&Ps.hasNavInfo(this.view)}},{key:"uiClass",get:function(){var e={};return e[this.state.role]=!0,e.chat=this.state.chat,e.remotes=this.state.mode===Pe,e.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,e.locked=this.locked,e}},{key:"remoteClass",get:function(){return"group--remote--"+Math.min(9,this.remotes.length)}},{key:"controlled",get:function(){return I.state.controlling&&I.state.controlling!==I.state.uid}},{key:"controlling",get:function(){return I.state.controlling&&I.state.controlling===I.state.uid}},{key:"silencing",get:function(){return I.state.silencing}},{key:"silenced",get:function(){return I.state.silencing&&I.state.role===C.Streamer}},{key:"spyed",get:function(){return I.state.spying&&I.state.spying===I.state.uid}},{key:"spying",get:function(){return I.state.spying&&I.state.spying!==I.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"remoteScreen",get:function(){return this.remoteScreen_},set:function(e){this.remoteScreen_!==e&&(this.remoteScreen_=e,setTimeout((function(){window.dispatchEvent(new Event("resize"))}),1))}},{key:"pathViews",get:function(){return kn.pathViews}}]),o}(e.Component);$s.meta={selector:"[agora-component]"};var Os=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onInit=function(){e.getContext(this).node.classList.remove("hidden")},n}(e.Component);Os.meta={selector:"[app-component]"};var Hs=["bmp","gif","ico","jpeg","jpg","png","svg","tif","tiff","webp","hdr"],Us=["mp4","avi","mpeg","ogv","ts","webm","3gp","3g2"],Ds=["fbx","gltf","glb","obj","usdz"],Fs=["publisherStream","nextAttendeeStream","publisherScreen","attendeeScreen"];var Vs=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e,t){if(void 0===t&&(t=null),null!=t&&(e=e.type.name===t?e:null),e){if("string"==typeof e)return k.getPath(e);switch(e.type.name){case fn.Image.name:case fn.Video.name:case fn.Model.name:e=e.folder+e.file,e=k.getPath(e);break;case fn.PublisherStream.name:case fn.AttendeeStream.name:case fn.PublisherScreen.name:case fn.AttendeeScreen.name:case fn.SmartDeviceStream.name:e=k.getPath(e.file);break;default:n=e.file,new RegExp("/.("+Hs.join("|")+")$/i").test(n)||function(e){return new RegExp("/.("+Us.join("|")+")$/i").test(e)}(e.file)?(e=e.folder+e.file,e=k.getPath(e)):!function(e){return new RegExp("/.("+Ds.join("|")+")$/i").test(e)}(e.file)?function(e){return-1!==Fs.indexOf(e)}(e.file)&&(e=e.file):(e=e.folder+e.file,e=k.getPath(e))}e=e}else e=null;var n;return e},t}(e.Pipe);Vs.meta={name:"asset"};var js=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this);var n=e.getContext(this).parentInstance;n instanceof cn&&(this.data=n.modal.data)},i.onAccept=function(e){mt.resolve()},i.onReject=function(e){mt.reject()},i.onClose=function(){mt.reject()},n}(e.Component);js.meta={selector:"[control-request-modal]"};var Bs=function(t){function o(){return t.apply(this,arguments)||this}return d(o,t),o.prototype.onInit=function(){var t=e.getContext(this),o=t.module,r=t.node,s=t.parentInstance,a=(t.selector,"drop"),u=n.fromEvent(r,a).pipe(i.shareReplay(1)),c=r.getAttribute("(drop)");if(c){var l=o.makeFunction(c,["$event"]);u.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){o.resolve(l,s,e)})),n.fromEvent(r,"dragover").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return e.preventDefault()}))}else s.drop$=u},o}(e.Directive);Bs.meta={selector:"[(drop)]"};var Ns=1e6,zs=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var t=this,o=e.getContext(this).node,r=o.getAttribute("dropdown-trigger");this.trigger=r?o.querySelector(r):o,this.opened=null,this.onClick=this.onClick.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this),this.openDropdown=this.openDropdown.bind(this),this.closeDropdown=this.closeDropdown.bind(this),this.addListeners(),n.dropdown$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.id===e?o.classList.add("dropped"):o.classList.remove("dropped")}))},o.onClick=function(t){var n=e.getContext(this).node;null===this.opened?this.openDropdown():n.querySelector("[dropdown-item]")||this.closeDropdown()},o.onDocumentClick=function(t){var n=e.getContext(this).node;n===t.target||n.contains(t.target)||this.closeDropdown()},o.openDropdown=function(){null===this.opened&&(this.opened=!0,this.addDocumentListeners(),n.dropdown$.next(this.id),this.dropped.next(this.id))},o.closeDropdown=function(){null!==this.opened&&(this.removeDocumentListeners(),this.opened=null,n.dropdown$.getValue()===this.id&&(n.dropdown$.next(null),this.dropped.next(null)))},o.addListeners=function(){this.trigger.addEventListener("click",this.onClick)},o.addDocumentListeners=function(){document.addEventListener("click",this.onDocumentClick)},o.removeListeners=function(){this.trigger.removeEventListener("click",this.onClick)},o.removeDocumentListeners=function(){document.removeEventListener("click",this.onDocumentClick)},o.onDestroy=function(){this.removeListeners(),this.removeDocumentListeners()},n.nextId=function(){return Ns++},u(n,[{key:"id",get:function(){return this.dropdown||this.id_||(this.id_=n.nextId())}}]),n}(e.Directive);zs.meta={selector:"[dropdown]",inputs:["dropdown","dropdown-trigger"],outputs:["dropped"]},zs.dropdown$=new n.BehaviorSubject(null);var Gs=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onInit=function(){var t=this,n=e.getContext(this).node;n.classList.add("dropdown-item"),zs.dropdown$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.id===e?n.classList.add("dropped"):n.classList.remove("dropped")}))},u(n,[{key:"id",get:function(){return this["dropdown-item"]}}]),n}(e.Directive);Gs.meta={selector:"[dropdown-item], [[dropdown-item]]",inputs:["dropdown-item"]};var qs=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.toast=null,this.lastToast=null,un.toast$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){t&&(e.lastToast=t),e.toast=t,e.pushChanges()}))},n.getClass=function(){var e={};return this.toast&&(e.active=!0),this.lastToast&&(e[this.lastToast.type]=!0,e[this.lastToast.position]=!0),e},n.onClose=function(){un.reject(this.toast)},n.onAccept=function(){un.resolve(this.toast)},n.onReject=function(){un.reject(this.toast)},t}(e.Component);qs.meta={selector:"[toast-outlet]",template:'\n\t<div class="toast-outlet__container" [class]="getClass()">\n\t\t<div class="toast-outlet__toast" *if="lastToast">\n\t\t\t<span class="toast-outlet__message" [innerHTML]="lastToast.message"></span>\n\t\t\t<div class="group--cta" *if="lastToast.type != \'info\'">\n\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t<span [innerHTML]="lastToast.acceptMessage"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()" *if="lastToast.type == \'dialog\'">\n\t\t\t\t\t<span [innerHTML]="lastToast.rejectMessage"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button type="button" class="btn--close" (click)="onClose()" *if="lastToast.type != \'info\'">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'};var Ws=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){this.mode=1,this.viewTypes=Object.keys($t).map((function(e){var t=$t[e];return{type:t,name:vt.getKeys("editor",t.name),disabled:-1!==k.editor.disabledViewTypes.indexOf(t.name)}})),this.viewItemTypes=Object.keys(Ot).map((function(e){var t=Ot[e];return{type:t,name:vt.getKeys("editor",t.name),disabled:-1!==k.editor.disabledViewItemTypes.indexOf(t.name)}})),this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.onChanges=function(){this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.setSupportedViewTypes=function(){var e=this;this.supportedViewTypes=this.viewTypes.filter((function(t){return e.supportedViewType(t.type.name)})).sort((function(e,t){return e.disabled===t.disabled?0:e.disabled?1:-1}))},n.setSupportedViewItemTypes=function(){var e=this;this.view?this.supportedViewItemTypes=this.viewItemTypes.filter((function(t){return e.supportedViewItemType(e.view.type.name,t.type.name)})).sort((function(e,t){return e.disabled===t.disabled?0:e.disabled?1:-1})):this.supportedViewItemTypes=[]},n.setMode=function(e){this.mode!==e&&(this.mode=e,this.pushChanges())},n.supportedViewType=function(e){return-1!==[$t.Panorama.name,$t.PanoramaGrid.name,$t.Room3d.name,$t.Model.name,$t.Media.name].indexOf(e)},n.supportedViewItemType=function(e,t){var n;switch(e){case $t.WaitingRoom.name:n=!1;break;case $t.Panorama.name:case $t.PanoramaGrid.name:n=-1!==[Ot.Nav.name,Ot.Model.name,Ot.Plane.name,Ot.CurvedPlane.name].indexOf(t);break;case $t.Room3d.name:n=-1!==[Ot.Nav.name,Ot.Model.name,Ot.Plane.name,Ot.Texture.name].indexOf(t);break;case $t.Model.name:n=-1!==[Ot.Nav.name,Ot.Model.name,Ot.Plane.name,Ot.CurvedPlane.name].indexOf(t);break;case $t.Media.name:n=-1!==[].indexOf(t)}return n},n.onSelect=function(e){this.select.next(e)},n.onUpdate=function(e){this.update.next(e)},n.onDelete=function(e){this.delete.next(e)},t}(e.Component);Ws.meta={selector:"[aside]",outputs:["select","update","delete"],inputs:["view"]};var Ks=function(){function e(){}return e.assetCreate$=function(e){return Ge.post$("/api/asset",e).pipe(i.map((function(e){return En(e)})))},e.assetUpdate$=function(e){return Ge.put$("/api/asset/"+e.id,e).pipe(i.map((function(e){return En(e)})))},e.assetDelete$=function(e){return e&&e.id?Ge.delete$("/api/asset/"+e.id).pipe(i.map((function(){return null}))):n.of(null)},e.localizedAssetCreate$=function(e,t){return Ge.post$("/api/"+e+"/asset",t).pipe(i.map((function(e){return En(e)})))},e.localizedAssetUpdate$=function(e,t){return Ge.put$("/api/"+e+"/asset/"+t.id,t).pipe(i.map((function(e){return En(e)})))},e.upload$=function(e){var t=new FormData;e.forEach((function(e){return t.append("file",e,e.name)}));var o=new XMLHttpRequest,r=n.merge(n.fromEvent(o.upload,"loadstart"),n.fromEvent(o.upload,"progress"),n.fromEvent(o.upload,"load"),n.fromEvent(o,"readystatechange")).pipe(i.map((function(e){switch(e.type){case"readystatechange":return 4===o.readyState?JSON.parse(o.responseText):null;default:return null}})),i.filter((function(e){return null!==e})));return o.open("POST","/api/upload/",!0),o.send(t),r},e.createOrUpdateAsset$=function(t,n){var i=t[0],o=xn.fromUrl(i.url);return n.value&&n.value.id?(o.id=n.value.id,e.assetUpdate$(o)):e.assetCreate$(o)},e.createOrUpdateLocalizedAsset$=function(t,n,i){var o=t[0],r=xn.fromUrl(o.url);return n.value&&n.value.id?(r.id=n.value.id,e.localizedAssetUpdate$(i,r)):e.localizedAssetCreate$(i,r)},e.assetDidChange=function(e,t){var n=null,i=null,o=null,r=null;return e&&(n=e.id,i=e.file),t&&(o=t.id,r=t.file),n!==o||i!==r},e}(),Xs=function(){function e(){}return e.data$=function(){return this.data$_||(this.data$_=Ge.get$("/api/view").pipe(i.map((function(e){return e.views=e.views.map((function(e){return Gt(e)})),e})),i.shareReplay(1))),this.data$_},e.viewIdOptions$=function(){return this.data$().pipe(i.map((function(e){var t=e.views.map((function(e){return{id:e.id,name:e.name}}));return t.unshift({id:null,name:"select"}),t})))},e.viewCreate$=function(e){return Ge.post$("/api/view",e).pipe(i.map((function(e){return Gt(e)})))},e.viewUpdate$=function(e){return Ge.put$("/api/view/"+e.id,e.payload).pipe(i.map((function(e){return Gt(e)})))},e.viewDelete$=function(e){return Ge.delete$("/api/view/"+e.id)},e.getTile=function(e){var t;return e.type.name===$t.PanoramaGrid.name&&(t=e.tiles[e.index]),t},e.inferItemCreate$=function(e,t){var n=this.getTile(e);return n?this.tileItemCreate$(e,n,t):this.itemCreate$(e,t)},e.inferItemUpdate$=function(e,t){var n=this.getTile(e);return n?this.tileItemUpdate$(e,n,t):this.itemUpdate$(e,t)},e.inferItemDelete$=function(e,t){var n=this.getTile(e);return n?this.tileItemDelete$(e,n,t):this.itemDelete$(e,t)},e.inferItemUpdateResult$=function(e,t){var n,i=this.getTile(e);(n=i?i.navs.find((function(e){return e.id===t.id})):e.items.find((function(e){return e.id===t.id})))&&Object.assign(n,t)},e.inferItemDeleteResult$=function(e,t){var n,i=this.getTile(e);if(n=i?i.navs:e.items){var o=n.indexOf(t);-1!==o&&n.splice(o,1),i&&e.updateCurrentItems()}},e.itemCreate$=function(e,t){return Ge.post$("/api/view/"+e.id+"/item",t).pipe(i.map((function(e){return qt(e)})))},e.itemUpdate$=function(e,t){return Ge.put$("/api/view/"+e.id+"/item/"+t.id,t.payload).pipe(i.map((function(e){return qt(e)})))},e.itemDelete$=function(e,t){return Ge.delete$("/api/view/"+e.id+"/item/"+t.id)},e.tileItemCreate$=function(e,t,n){return Ge.post$("/api/view/"+e.id+"/tile/"+t.id+"/item",n).pipe(i.map((function(e){return qt(e)})))},e.tileItemUpdate$=function(e,t,n){return Ge.put$("/api/view/"+e.id+"/tile/"+t.id+"/item/"+n.id,n.payload).pipe(i.map((function(e){return qt(e)})))},e.tileItemDelete$=function(e,t,n){return Ge.delete$("/api/view/"+e.id+"/tile/"+t.id+"/item/"+n.id)},e}(),Ys={menu:[{id:"menu",title:"editor_menu",active:!0},{id:"navmaps",title:"editor_navmaps",active:!0}],current:null,active:!1},Zs=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this;e.getContext(this).node.classList.remove("hidden"),this.settings=this.getSettings(),this.aside=!1,this.state={},this.view=null,this.paths=null,this.path=null,this.form=null,this.local=null,this.remotes=[],this.viewHit=new n.Subject,(this.vrService=eo.getService()).status$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.pushChanges()})),this.resolveUser()},r.resolveUser=function(){var e=this;qe.me$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){t&&t.type===C.Publisher?(e.user=t,e.initState()):window.location.href=k.url.access}))},r.initState=function(){var e=this,t=this.user,n={user:t,role:t.type,name:t.firstName&&t.lastName?t.firstName+" "+t.lastName:null,mode:Le,link:null,channelName:k.channelName,uid:null,status:q,connecting:!1,connected:!0,controlling:!1,spying:!1,silencing:!1,hosted:!0,live:!1,navigable:!0,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};I.state=n,I.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.hosted=t.hosted,e.pushChanges()})),this.viewObserver$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){})),at.mode=st},r.viewObserver$=function(){var e=this;return Xs.data$().pipe(i.switchMap((function(t){var n=M.has("pathId")?parseInt(M.get("pathId")):null;return Ct.getCurrentPath$(n).pipe(i.switchMap((function(n){return e.paths=Ct.paths,e.path=n,kn.editorView$(t,n)})))})),i.tap((function(t){e.view=null,e.pushChanges()})),i.delay(1),i.tap((function(t){e.view=t,e.pushChanges()})))},r.onAddPath=function(){mt.open$({src:k.template.modal.pathAdd}).pipe(i.first()).subscribe((function(e){e instanceof pt&&Ct.addPath(e.data)}))},r.onEditPath=function(e){mt.open$({src:k.template.modal.pathEdit,data:{item:e,views:kn.validViews}}).pipe(i.first()).subscribe((function(e){e instanceof pt&&Ct.editPath(e.data)}))},r.onDuplicatePath=function(e){mt.open$({src:k.template.modal.pathAdd,data:{item:e}}).pipe(i.first()).subscribe((function(e){e instanceof pt&&Ct.addPath(e.data)}))},r.onDeletePath=function(e){mt.open$({src:k.template.modal.remove,data:{item:e}}).pipe(i.first()).subscribe((function(t){t instanceof pt&&Ct.pathDelete$(e).pipe(i.first()).subscribe((function(t){Ct.deletePath(e)}))}))},r.onSelectPath=function(e){Ct.path=e},r.isPathSelected=function(e){return Ct.path.id===e.id},r.onNavTo=function(e){var t=e.viewId;kn.pathViews.find((function(e){return e.id===t}))&&(kn.action={viewId:t,keepOrientation:e.keepOrientation,useLastOrientation:e.useLastOrientation})},r.onNavLink=function(e){mt.open$({iframe:e.link.href}).pipe(i.first()).subscribe((function(t){Ye.send({type:Se,itemId:e.id})}))},r.patchState=function(e){this.state=Object.assign({},this.state,e),this.pushChanges()},r.tryInAr=function(){mt.open$({src:k.template.modal.tryInAr,data:this.view}).pipe(i.first()).subscribe((function(e){}))},r.replaceUrl=function(){if("history"in window){var e=new URLSearchParams(window.location.search),t=e.get("debug")||null,n=e.get("editor")||null,i=e.get("role")||null,o=e.get("link")||null,r=e.get("name")||null,s=""+window.location.origin+window.location.pathname+"?link="+o+(r?"&name="+r:"")+(i?"&role="+i:"")+(t?"&debug":"")+(n?"&editor":"");window.history.replaceState({pageTitle:window.pageTitle},"",s)}},r.onToggleAside=function(){this.aside=!this.aside,this.pushChanges(),window.dispatchEvent(new Event("resize"))},r.getSettings=function(){var e=Object.assign({},Ys);return e.menu=e.menu.filter((function(e){return k.flags[e.id]})),e.current=e.menu.length?e.menu[0].id:null,e},r.onToggleSettings=function(){var e=this.settings;e.active=!e.active,this.pushChanges()},r.onSelectSetting=function(e){this.settings.current=e.id,this.pushChanges()},r.onViewHit=function(e){this.viewHit.next(e)},r.onViewHitted=function(e){this.viewHitSubscription&&(this.viewHitSubscription.unsubscribe(),this.viewHitSubscription=null),"function"==typeof e&&(this.viewHitSubscription=this.viewHit.pipe(i.first()).subscribe((function(t){return e(t)})))},r.onDragEnd=function(e){var t=this;Xs.inferItemUpdate$(this.view,e.item).pipe(i.first()).subscribe((function(e){t.pushChanges()}),(function(e){return console.log("EditorComponent.onDragEnd.inferItemUpdate$.error",e)}))},r.onResizeEnd=function(e){},r.onWorldSelect=function(e){var t;this.view&&(this.view.items.forEach((function(e){return e.showPanel=!1})),this.view.items.forEach((function(n){n.selected=n===e.item,t=n.selected?n:t})),this.view.selected=!t,this.pushChanges(),t&&(this.aside=!0,this.pushChanges(),window.dispatchEvent(new Event("resize"))))},r.onOpenModal=function(e,t){var n=this;mt.open$({src:k.template.modal[e.type][e.value],data:t}).pipe(i.first()).subscribe((function(t){if(t instanceof pt)switch(e.type){case"view":switch(e.value){case $t.Panorama.name:case $t.PanoramaGrid.name:case $t.Model.name:case $t.Room3d.name:case $t.Media.name:kn.addView(t.data)}break;case"viewItem":switch(e.value){case Ot.Nav.name:case Ot.Plane.name:case Ot.CurvedPlane.name:case Ot.Model.name:var i=Object.assign({},t.data),o=Xs.getTile(n.view);if(o){var r=o.navs||[];r.push(i),o.navs=r,n.view.updateCurrentItems()}else{i.path=!0;var s=n.view.items||[];s.push(i),n.view.items=s}n.pushChanges()}}n.pushChanges()}))},r.onAsideSelect=function(e){var t=this;if(e.value)switch(e.value){case Ot.Nav.name:case Ot.Plane.name:case Ot.CurvedPlane.name:this.onViewHitted((function(n){t.onOpenModal(e,{view:t.view,hit:n})})),un.open$({message:"Click a point on the view"});break;case Ot.Model.name:if("viewItem"===e.type){if(this.view.type.name===$t.Model.name)return;this.onViewHitted((function(n){t.onOpenModal(e,{view:t.view,hit:n})})),un.open$({message:"Click a point on the view"})}else this.onOpenModal(e,{view:this.view});break;default:this.onOpenModal(e,{view:this.view})}else if(e.view&&(e.item||null===e.item))e.view.selected=!1,e.view.items.forEach((function(t){return t.selected=t===e.item})),Ye.send({type:_e}),this.pushChanges();else if(e.view&&(e.tile||null===e.tile))e.view.selected=!1,e.view.tiles.forEach((function(t){return t.selected=t===e.tile})),Ye.send({type:_e}),this.pushChanges();else if(e.view||null===e.view){this.view.selected=this.view===e.view,this.view.items.forEach((function(e){return e.selected=!1}));var n=Xs.getTile(this.view);n&&this.view.tiles.forEach((function(e){return e.selected=e===n})),Ye.send({type:_e}),this.pushChanges()}},r.onAsideUpdate=function(e){if(e.item&&e.view)this.pushChanges();else if(e.tile&&e.view);else if(e.view)if(kn.viewId!==e.view.id)kn.viewId=e.view.id;else{var t=Ks.assetDidChange(this.view.asset,e.view.asset);Object.assign(this.view,e.view),t&&"function"==typeof this.view.onUpdateAsset&&this.view.onUpdateAsset(),this.pushChanges()}},r.onAsideDelete=function(e){var t=this;e.item&&e.view?Xs.inferItemDelete$(e.view,e.item).pipe(i.first()).subscribe((function(n){Xs.inferItemDeleteResult$(e.view,e.item),t.pushChanges()}),(function(e){return console.log("EditorComponent.onAsideDelete.inferItemDelete$.error",e)})):e.view&&Xs.viewDelete$(e.view).pipe(i.first()).subscribe((function(t){kn.deleteView(e.view)}),(function(e){return console.log("EditorComponent.onAsideDelete.viewDelete$.error",e)}))},u(o,[{key:"dataViews",get:function(){return kn.dataViews}},{key:"pathViews",get:function(){return kn.pathViews}}]),o}(e.Component);Zs.meta={selector:"[editor-component]"};var Js=0,Qs=function(){function e(){}return e.menu$=function(){var e=this;return this.getMenu$().pipe(i.switchMap((function(t){return e.menu$_.next(t),e.menu$_})))},e.getMenu$=function(){return Ge.get$("/api/menu").pipe(i.map((function(e){return e.menu.sort((function(e,t){return e.order-t.order})),e.menu})))},e.updateMenu$=function(e){return Ge.put$("/api/menu",e)},e.createMenuItem$=function(e,t){void 0===e&&(e=null),void 0===t&&(t=0);var n={parentId:e,viewId:null,order:10*t,name:"Folder "+ ++Js};return Ge.post$("/api/menu",n)},e.updateMenuItem$=function(e){return Ge.put$("/api/menu/"+e.id,e)},e.deleteMenuItem$=function(e){return Ge.delete$("/api/menu/"+e.id)},e.getModelMenu$=function(e,t){var n=this;return void 0===t&&(t=!1),this.menu$().pipe(i.map((function(i){if(i&&i.length)return i=i.filter((function(t){return null==t.viewId||null!=e.find((function(e){return e.id===t.viewId}))})),n.mapMenuItems(i);var o={};return e.forEach((function(e){if(e.type.name!==$t.WaitingRoom.name&&(!e.hidden||t)){var n=o[e.type.name];n||(n=o[e.type.name]=[]),n.push(e)}})),Object.keys(o).map((function(n){var i="Button";switch(n){case $t.WaitingRoom.name:i="Waiting Room";break;case $t.Panorama.name:i="Experience";break;case $t.PanoramaGrid.name:i="Virtual Tour";break;case $t.Room3d.name:i="Stanze 3D";break;case $t.Model.name:i="Modelli 3D";break;case $t.Media.name:i="Media"}return{name:i,type:{name:"menu-group"},items:e.filter((function(e){return e.type.name===n&&(!e.hidden||t)}))}}))})))},e.mapMenuItem=function(e,t){return e.viewId?{id:e.viewId,name:e.name,type:{name:"panorama"}}:{name:e.name,type:{name:"menu-group"},items:this.mapMenuItems(t,e.id)}},e.mapMenuItems=function(e,t){var n=this;return void 0===t&&(t=null),e.filter((function(e){return(e.parentId||null)===t})).map((function(t){return n.mapMenuItem(t,e)})).filter((function(e){return null!=e.id||e.items.length>0}))},u(e,null,[{key:"active",set:function(e){this.active$.next(e)},get:function(){return this.active$.getValue()}}]),e}();c(Qs,"active$",new n.BehaviorSubject(!1)),c(Qs,"menu$_",new n.BehaviorSubject([]));var ea=function(){function t(){}return t.drop$=function(t){if(e.isPlatformBrowser&&t){var o=document.querySelector("body");return n.merge(n.fromEvent(o,"drop"),n.fromEvent(o,"dragover")).pipe(i.map((function(e){e.preventDefault(),e.target===t&&(t.files=e.dataTransfer.files)})))}return n.EMPTY},t.change$=function(t){return e.isPlatformBrowser&&t?n.fromEvent(t,"change").pipe(i.filter((function(e){return t.files&&t.files.length})),i.map((function(e){return Array.from(t.files)}))):n.EMPTY},t.asset$=function(e,t){var o=this;return void 0===t&&(t=[]),this.change$(e).pipe(i.switchMap((function(e){t.length=e.length,t.fill(null);var r=e.map((function(e,n){return o.read$(e,n,t).pipe(i.map((function(){return e})),i.switchMap((function(e){return Ks.upload$([e])})),i.switchMap((function(e){var t=e[0],n=xn.fromUrl(t.url);return Ks.assetCreate$(n)})))}));return n.combineLatest(r)})))},t.read$=function(e,t,o){var r=this;void 0===o&&(o=[]);var s=new FileReader,a=n.fromEvent(s,"load").pipe(i.switchMap((function(e){var t=e.target.result;return r.resize$(t)})),i.tap((function(e){o[t]=e})));return s.readAsDataURL(e),a},t.resize$=function(e){return n.from(this.resize_(e))},t.resize_=function(e){return new Promise((function(t,n){var i=document.createElement("img");i.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d"),o=i.width,r=i.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,n.drawImage(i,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},i.onerror=function(){n(e)},i.src=e}))},t}(),ta=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onChanges=function(){var t=e.getContext(this).node,n=this.control.flags;Object.keys(n).forEach((function(e){n[e]?t.classList.add(e):t.classList.remove(e)}))},n}(e.Component);ta.meta={selector:"[control]",inputs:["control"]};var na=function(t){function o(){return t.apply(this,arguments)||this}return d(o,t),o.prototype.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg";var o=e.getContext(this).node.querySelector("input");o.setAttribute("accept",this.accept),ea.drop$(o).pipe(i.takeUntil(this.unsubscribe$)).subscribe(),ea.change$(o).pipe(i.switchMap((function(e){var o=e.map((function(e,n){return Ks.upload$([e]).pipe(i.switchMap((function(e){return Ks.createOrUpdateAsset$(e,t.control)})))}));return n.combineLatest(o)})),i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.control.value=e[0]}))},o}(ta);na.meta={selector:"[control-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="control.value | asset" [size]="{ width: 320, height: 240 }" *if="control.value && control.value.type.name === \'image\'" />\n\t\t\t\t<video [src]="control.value | asset" *if="control.value && control.value.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var ia=function(e){function n(){return e.apply(this,arguments)||this}d(n,e),n.itemToFormGroup=function(e){return new t.FormGroup({id:e.id,parentId:e.parentId,viewId:e.viewId,name:e.name,items:new t.FormArray})};var o=n.prototype;return o.onInit=function(){var e=this;this.dropdownId=zs.nextId(),this.controls=this.control.controls,Xs.viewIdOptions$().pipe(i.first()).subscribe((function(t){e.controls.viewId.options=t}))},o.onAddItem=function(){var e=this;Qs.createMenuItem$(this.controls.id.value,this.controls.items.length).pipe(i.first()).subscribe((function(t){e.controls.items.push(n.itemToFormGroup(t))}))},o.onRemoveItem=function(){this.remove.next(this.control)},o.onRemoveControl=function(e){var t=this;Qs.deleteMenuItem$(e.value).pipe(i.first()).subscribe((function(){t.controls.items.remove(e)}))},o.onLinkItem=function(){this.link.next(this.control)},o.onLinkControl=function(e){this.link.next(e)},o.onItemUp=function(){this.up.next(this.control)},o.onItemDown=function(){this.down.next(this.control)},o.onUpControl=function(e){var t=this.controls.items,n=t.controls.length,i=t.controls.indexOf(e);t.controls.splice(i,1),i>0?i--:i=n-1,t.insert(e,i)},o.onDownControl=function(e){var t=this.controls.items,n=t.controls.length,i=t.controls.indexOf(e);t.controls.splice(i,1),i<n-1?i++:i=0,t.insert(e,i)},o.setView=function(e){var t=this,n=Object.assign({},this.control.value);n.viewId=e.id,e.id&&(n.name=e.name),Qs.updateMenuItem$(n).pipe(i.first()).subscribe((function(){t.controls.viewId.value=e.id,e.id&&(t.controls.name.value=e.name,t.controls.items.controls=[],t.controls.items.switchSubjects_())}))},o.onTextDidChange=function(e){Qs.updateMenuItem$(this.control.value).pipe(i.first()).subscribe()},o.hasOption=function(e){return this.controls.viewId.value===e.id},o.onDropped=function(e){},n}(na);ia.meta={selector:"[control-menu]",outputs:["remove","link","up","down"],inputs:["control"],template:'\n\t\t<div class="group--form">\n\t\t\t<button type="button" class="control-menu__link" [class]="{ active: control.controls.viewId.value }" (click)="onLinkItem($event)" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#link"></use></svg>\n\t\t\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t\t\t<div class="category">View</div>\n\t\t\t\t\t<ul class="nav--dropdown">\n\t\t\t\t\t\t<li (click)="setView(item)" [class]="{ empty: item.id == null }" *for="let item of control.controls.viewId.options">\n\t\t\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<input type="text" class="control--text" [formControl]="control.controls.name" placeholder="Name" (change)="onTextDidChange($event)" />\n\t\t\t\x3c!--\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)">\n\t\t\t\t<span [innerHTML]="control.controls.viewId.value"></span>\n\t\t\t</button>\n\t\t\t--\x3e\n\t\t\t\x3c!--\n\t\t\t<select class="control--select" [formControl]="control.controls.viewId">\n\t\t\t\t<option [value]="item.id" *for="let item of control.controls.viewId.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t--\x3e\n\t\t\t<button type="button" class="control-menu__up" (click)="onItemUp($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#up"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__down" (click)="onItemDown($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#down"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)" *if="!control.controls.viewId.value">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#add"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__remove" (click)="onRemoveItem($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#remove"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="group--items">\n\t\t\t<div control-menu *for="let sub of control.controls.items.controls" [control]="sub" (remove)="onRemoveControl($event)" (link)="onLinkControl($event)" (up)="onUpControl($event)" (down)="onDownControl($event)"></div>\n\t\t</div>\n\t'};var oa=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.changes=0,this.form=null,Qs.getMenu$().pipe(i.first()).subscribe((function(t){return e.initForm(t)}))},o.initForm=function(e){var n=this;void 0===e&&(e=[]);var o=this.menuToControls(e),r=this.form=new t.FormGroup({items:o});this.controls=r.controls;r.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){n.changes++,n.pushChanges()}))},o.onLinkControl=function(e){},o.onUpControl=function(e){var t=this.controls.items,n=t.controls.length,i=t.controls.indexOf(e);t.controls.splice(i,1),i>0?i--:i=n-1,t.insert(e,i)},o.onDownControl=function(e){var t=this.controls.items,n=t.controls.length,i=t.controls.indexOf(e);t.controls.splice(i,1),i<n-1?i++:i=0,t.insert(e,i)},o.onAddItem=function(){var e=this;Qs.createMenuItem$(null,this.controls.items.length).pipe(i.first()).subscribe((function(t){e.controls.items.push(ia.itemToFormGroup(t))}))},o.onRemoveControl=function(e){var t=this;Qs.deleteMenuItem$(e.value).pipe(i.first()).subscribe((function(){t.controls.items.remove(e)}))},o.isValid=function(){var e=this.form.valid;return e},o.onSubmit=function(e){if(this.form.valid){var t=this.form.value,n=this.controlsToMenu(t);Qs.updateMenu$(n)}else this.form.touched=!0},o.menuToControls=function(e,n){var i=this;return void 0===n&&(n=null),new t.FormArray(e.filter((function(e){return(e.parentId||null)===n})).map((function(n){var o=i.menuToControls(e,n.id);return new t.FormGroup({id:n.id,parentId:n.parentId,viewId:n.viewId,name:n.name,items:o})})))},o.controlsToMenu=function(e){var t=[];return function e(n){n&&n.forEach((function(n,i){var o=Object.assign({},n);o.order=10*i,delete o.items,t.push(o),e(n.items)}))}(e.items),t},n}(e.Component);oa.meta={selector:"[menu-builder]",inputs:["views"]};var ra=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this,n=this.object,i=this.form=new t.FormGroup({type:Ot.CurvedPlane,position:new t.FormControl(n.position.toArray(),t.RequiredValidator()),rotation:new t.FormControl(n.rotation.toArray(),t.RequiredValidator()),scale:new t.FormControl([1,1,1],t.RequiredValidator()),radius:new t.FormControl(35,t.RequiredValidator()),height:new t.FormControl(20,t.RequiredValidator()),arc:new t.FormControl(90,t.RequiredValidator()),asset:null});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()}))},r.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);Xs.inferItemCreate$(this.view,e).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(e){return console.log("CurvedPlaneModalComponent.onSubmit.error",e)}))}else this.form.touched=!0},r.onClose=function(){mt.reject()},u(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"object",get:function(){var e=new THREE.Object3D,t=this.data;if(t){var n=t.hit.position.clone(),i=t.hit.normal.clone();t.hit.spherical?(n.normalize().multiplyScalar(20),e.position.copy(n),e.lookAt(Fn.origin)):(e.lookAt(i),e.position.set(n.x,n.y,n.z),e.position.add(i.multiplyScalar(.01)))}return e}}]),o}(e.Component);ra.meta={selector:"[curved-plane-modal]"};var sa=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this,n=this.object,i=this.form=new t.FormGroup({type:Ot.Model,position:new t.FormControl(n.position.toArray(),t.RequiredValidator()),rotation:new t.FormControl([0,0,0],t.RequiredValidator()),scale:new t.FormControl([1,1,1],t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()}))},r.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);Xs.inferItemCreate$(this.view,e).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(e){return console.log("ItemModelModalComponent.onSubmit.error",e)}))}else this.form.touched=!0},r.onClose=function(){mt.reject()},u(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"object",get:function(){var e=new THREE.Object3D,t=this.data;if(t){var n=t.hit.position.clone(),i=t.hit.normal.clone();t.hit.spherical?(n.normalize().multiplyScalar(4),e.position.copy(n),e.lookAt(Fn.origin)):(e.lookAt(i),e.position.set(n.x,n.y,n.z),e.position.add(i.multiplyScalar(.01)))}return e}}]),o}(e.Component);sa.meta={selector:"[item-model-modal]"};var aa=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:$t.Media,name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return Xs.viewCreate$(n).pipe(i.switchMap((function(e){var n={type:Ot.Plane,position:[20,0,0],rotation:[0,-Math.PI/2,0],scale:[12,6.75,1],asset:t.asset};return Xs.itemCreate$(e,n).pipe(i.map((function(t){return e.items=[t],e})))})),i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("MediaModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);aa.meta={selector:"[media-modal]"};var ua=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:$t.Model,name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator()),model:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return Xs.viewCreate$(n).pipe(i.switchMap((function(e){var n={type:Ot.Model,asset:t.model};return Xs.itemCreate$(e,n).pipe(i.map((function(t){return e.items=[t],e})))})),i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("ModelModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);ua.meta={selector:"[model-modal]"};var ca=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this,n=this.object;this.error=null,this.useHooks=Cn.enabled;var o=this.form=new t.FormGroup({type:Ot.Nav,title:null,abstract:null,viewId:null,hook:null,hookExtra:null,keepOrientation:!1,important:!1,transparent:!1,position:new t.FormControl(n.position.toArray(),t.RequiredValidator()),rotation:new t.FormControl(n.rotation.toArray(),t.RequiredValidator()),scale:new t.FormControl([20,5,1],t.RequiredValidator()),asset:null,link:new t.FormGroup({title:new t.FormControl(null),href:new t.FormControl(null),target:"_blank"})});if(this.controls=o.controls,Cn.enabled){var r=k.webhook.methods.map((function(e){return{id:e,name:e}}));r.unshift({id:null,name:"select"}),this.controls.hook.options=r}o.changes$.subscribe((function(t){e.pushChanges()})),Xs.viewIdOptions$().pipe(i.first()).subscribe((function(t){e.controls.viewId.options=t,e.pushChanges()}))},r.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=Object.assign({},this.form.value);t.viewId=t.viewId?parseInt(t.viewId):this.view.id,!t.link||t.link.title&&t.link.href||(t.link=null),Xs.inferItemCreate$(this.view,t).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("NavModalComponent.onSubmit.error",t),e.error=t,e.form.submitted=!1}))}else this.form.touched=!0},r.onViewIdDidChange=function(e){if(null!=e){var t=this.controls.viewId.options,n=t.find((function(t){return t.id===e}));if(null!=n){var i=n.name,o=this.form.value.title;o&&!t.find((function(e){return e.name===o}))||this.form.patch({title:i})}}},r.onClose=function(){mt.reject()},u(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"position",get:function(){var e=null,t=this.data;return t&&(e=t.hit.position),e}},{key:"object",get:function(){var e=new THREE.Object3D,t=this.data;if(t){var n=t.hit.position.clone(),i=t.hit.normal.clone();t.hit.spherical?(n.normalize().multiplyScalar(Ps.RADIUS),e.position.copy(n),e.lookAt(Fn.origin)):(e.lookAt(i),e.position.set(n.x,n.y,n.z),e.position.add(i.multiplyScalar(.01)))}return e}}]),o}(e.Component);ca.meta={selector:"[nav-modal]"};var la=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this,n=this.position;this.error=null;var o=this.form=new t.FormGroup({type:Ot.Nav,title:null,abstract:null,viewId:new t.FormControl(null,t.RequiredValidator()),keepOrientation:!1,important:!1,transparent:!1,position:new t.FormControl(n,t.RequiredValidator()),asset:null});this.controls=o.controls,o.changes$.subscribe((function(t){e.pushChanges()})),Xs.viewIdOptions$().pipe(i.first()).subscribe((function(t){e.controls.viewId.options=t,e.pushChanges()}))},r.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=Object.assign({},this.form.value);t.viewId=parseInt(t.viewId),Zt.itemCreate$(this.navmap,t).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("NavmapItemModalComponent.onSubmit.error",t),e.error=t,e.form.submitted=!1}))}else this.form.touched=!0},r.onClose=function(){mt.reject()},u(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"navmap",get:function(){var e=null,t=this.data;return t&&(e=t.navmap),e}},{key:"position",get:function(){var e=[0,0,0],t=this.data;return t&&(e=[t.hit.x,t.hit.y,0]),e}}]),o}(e.Component);la.meta={selector:"[navmap-item-modal]"};var da=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={name:t.name,asset:t.asset};return Zt.navmapCreate$(n).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("NavmapModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);da.meta={selector:"[navmap-modal]"};var ha=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:$t.PanoramaGrid,name:new t.FormControl(null,t.RequiredValidator()),assets:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value.assets,n=Dt.mapTiles(t.map((function(e){return{asset:e,navs:[]}})),!1,!0);n.sort((function(e,t){return 1e4*e.indices.x+e.indices.y-(1e4*t.indices.x+t.indices.y)}));var o=n[0].asset,r={type:this.form.value.type,name:this.form.value.name,asset:o,tiles:n,invertAxes:!0,flipAxes:!1,orientation:{latitude:0,longitude:0},zoom:75};Xs.viewCreate$(r).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("PanoramaGridModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}else this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);ha.meta={selector:"[panorama-grid-modal]"};var pa=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:$t.Panorama,name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return Xs.viewCreate$(n).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("PanoramaModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);pa.meta={selector:"[panorama-modal]"};var fa=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var n=this,i=e.getContext(this).parentInstance;i instanceof cn&&(this.data=i.modal.data),this.error=null;var o=this.form=new t.FormGroup({name:new t.FormControl(null,t.RequiredValidator())});this.controls=o.controls,o.changes$.subscribe((function(e){n.pushChanges()}))},r.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t={name:this.form.value.name,items:this.data?this.data.item.items:[]};return Ct.pathCreate$(t).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("PathAddModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},r.onClose=function(){mt.reject()},o}(e.Component);fa.meta={selector:"[path-add-modal]"};var ma=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var n=this;this.item=null,this.views=null;var i=e.getContext(this).parentInstance;if(i instanceof cn){var o=i.modal.data;o&&(this.item=o.item?o.item:null,this.views=this.parseViews(o.views,this.item))}this.error=null;var r=this.form=new t.FormGroup({name:new t.FormControl(this.item?this.item.name:null,t.RequiredValidator())});this.controls=r.controls,r.changes$.subscribe((function(e){n.pushChanges()}))},r.parseViews=function(e,t){return e&&t?e.map((function(e){return{id:e.id,name:e.name,type:e.type,active:-1===t.items.indexOf(e.id)}})):[]},r.onToggleView=function(e){e.active=!e.active,this.pushChanges()},r.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={id:this.item.id,name:t.name,items:this.views.filter((function(e){return!e.active})).map((function(e){return e.id}))};return Ct.pathUpdate$(n).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("PathEditModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},r.onSelectAll=function(){this.views.forEach((function(e){return e.active=!0})),this.pushChanges()},r.onSelectNone=function(){this.views.forEach((function(e){return e.active=!1})),this.pushChanges()},r.onClose=function(){mt.reject()},o}(e.Component);ma.meta={selector:"[path-edit-modal]"};var va=function(n){function o(){return n.apply(this,arguments)||this}d(o,n);var r=o.prototype;return r.onInit=function(){var e=this,n=this.object,i=this.form=new t.FormGroup({type:Ot.Plane,position:new t.FormControl(n.position.toArray(),t.RequiredValidator()),rotation:new t.FormControl(n.rotation.toArray(),t.RequiredValidator()),scale:new t.FormControl([12,6.75,1],t.RequiredValidator()),asset:null});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()}))},r.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);console.log("PlaneModalComponent.onSubmit",this.view,e),Xs.inferItemCreate$(this.view,e).pipe(i.first()).subscribe((function(e){console.log("PlaneModalComponent.onSubmit.success",e),mt.resolve(e)}),(function(e){return console.log("PlaneModalComponent.onSubmit.error",e)}))}else this.form.touched=!0},r.onClose=function(){mt.reject()},u(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"object",get:function(){var e=new THREE.Object3D,t=this.data;if(t){var n=t.hit.position.clone(),i=t.hit.normal.clone();t.hit.spherical?(n.normalize().multiplyScalar(20),e.position.copy(n),e.lookAt(Fn.origin)):(e.lookAt(i),e.position.set(n.x,n.y,n.z),e.position.add(i.multiplyScalar(.01)))}return e}}]),o}(e.Component);va.meta={selector:"[plane-modal]"};var ga=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onRemove=function(){mt.resolve()},i.onCancel=function(){mt.reject()},i.onClose=function(){mt.reject()},u(n,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof cn&&(t=n.modal.data),t}},{key:"item",get:function(){var e=null,t=this.data;return t&&(e=t.item),e}}]),n}(e.Component);ga.meta={selector:"[remove-modal]"};var ya=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:$t.Room3d,name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return Xs.viewCreate$(n).pipe(i.first()).subscribe((function(e){mt.resolve(e)}),(function(t){console.log("Room3DModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.onClose=function(){mt.reject()},n}(e.Component);ya.meta={selector:"[room-3d-modal]"};var ba=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.navmap=null,this.navmaps=[],Zt.navmapGet$().pipe(i.first()).subscribe((function(t){e.navmaps=t,e.pushChanges()}))},n.onBack=function(e){this.navmap=null,this.pushChanges()},n.onAdd=function(){var e=this;mt.open$({src:k.template.modal.navmap}).pipe(i.first()).subscribe((function(t){t instanceof pt&&(e.navmaps.push(t.data),e.navmap=t.data,e.pushChanges())}))},n.onSet=function(e){this.navmap=this.navmaps.find((function(t){return t.id===e.id})),this.pushChanges()},n.onAddItem=function(e,t){var n=this;mt.open$({src:k.template.modal.navmapItem,data:{navmap:e,hit:t}}).pipe(i.first()).subscribe((function(t){if(t instanceof pt){var i=e.items||[];i.push(t.data),Object.assign(e,{items:i}),n.pushChanges()}}))},n.onDelete=function(e){var t=this.navmaps.indexOf(e);-1!==t&&this.navmaps.splice(t,1),this.navmap=null,this.pushChanges()},t}(e.Component);ba.meta={selector:"[navmap-builder]",inputs:["views"]};var wa="idle",xa="insert",Ea="remove",Sa="move",Ta=function(e,t){var n=e.getBoundingClientRect();this.x=(t.clientX-n.x)/n.width,this.y=(t.clientY-n.y)/n.height},ka=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ta),Ma=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ta),Ia=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Ta),Ca=function(o){function r(){return o.apply(this,arguments)||this}d(r,o);var s=r.prototype;return s.onInit=function(){var e=this;this.mode=wa,this.error=null;var n=this.navmap,o=this.form=new t.FormGroup({name:new t.FormControl(n.name,t.RequiredValidator()),asset:new t.FormControl(n.asset,t.RequiredValidator())});this.controls=o.controls,o.changes$.subscribe((function(t){e.pushChanges()})),this.insert$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){var o=t;mt.open$({src:k.template.modal.navmapItem,data:{navmap:n,hit:o}}).pipe(i.first()).subscribe((function(t){if(t instanceof pt){var i=n.items||[];i.push(t.data),Object.assign(n,{items:i}),e.pushChanges()}}))}))},s.insert$=function(){var t=this,o=e.getContext(this).node.querySelector(".navmap-control__image");return n.fromEvent(o,"pointerdown").pipe(i.filter((function(e){return t.mode===xa})),i.map((function(e){return new ka(o,e)})))},s.onToggleMode=function(e){this.mode=this.mode===e?wa:e,this.pushChanges()},s.onMoveItem=function(t,o){var r=this,s=this.navmap;switch(this.mode){case Sa:var a=e.getContext(this).node.querySelector(".navmap-control__image"),u=o.position.slice(),c=new ka(a,t),l=n.fromEvent(a,"mousemove").pipe(i.map((function(e){return new Ma(a,e)})),i.tap((function(e){var t=e.x-c.x,n=e.y-c.y;o.position=[Math.max(0,Math.min(1,u[0]+t)),Math.max(0,Math.min(1,u[1]+n)),0],r.pushChanges()}))),d=n.fromEvent(a,"mouseup").pipe(i.map((function(e){return new Ia(a,e)})),i.tap((function(e){var t=e.x-c.x,n=e.y-c.y;o.position=[Math.max(0,Math.min(1,u[0]+t)),Math.max(0,Math.min(1,u[1]+n)),0],Zt.itemUpdate$(s,o).pipe(i.first()).subscribe((function(e){Object.assign(o,e),r.pushChanges()}))})));l.pipe(i.takeUntil(d)).subscribe()}},s.onRemoveItem=function(e){var t=this,n=this.navmap;switch(this.mode){case Ea:Zt.itemDelete$(n,e).pipe(i.first()).subscribe((function(i){var o=n.items||[],r=o.indexOf(e);-1!==r&&o.splice(r,1),Object.assign(n,{items:o}),t.pushChanges()}))}},s.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,n=Object.assign({items:[]},this.navmap,{name:t.name});Zt.navmapUpdate$(n).pipe(i.first()).subscribe((function(t){Object.assign(e.navmap,t),e.pushChanges()}),(function(t){e.error=t,e.form.reset()}))}else this.form.touched=!0},s.onRemove=function(){var e=this,t=this.navmap;mt.open$({src:k.template.modal.remove,data:{item:t}}).pipe(i.first()).subscribe((function(n){n instanceof pt&&Zt.navmapDelete$(t).pipe(i.first()).subscribe((function(n){e.delete.next(t)}))}))},r}(e.Component);Ca.meta={selector:"[navmap-edit]",outputs:["delete"],inputs:["navmap"]};var Ra=function(e){function o(){return e.apply(this,arguments)||this}d(o,e);var r=o.prototype;return r.onInit=function(){var e=this;this.busy=!1,this.active=!1,this.useHooks=Cn.enabled;var n=this.form=new t.FormGroup;this.controls=n.controls;var i=this.item;this.originalItem=Object.assign({},i),i.hasChromaKeyColor=!(!i.asset||!i.asset.chromaKeyColor),i.autoplay=i.asset&&i.asset.type.name===fn.Video.name?i.asset.autoplay:void 0,i.loop=i.asset&&i.asset.type.name===fn.Video.name?i.asset.loop:void 0,i.assetType=yn(i).id,this.doUpdateForm(),n.changes$.subscribe((function(t){e.doUpdateItem(t),e.pushChanges()}))},r.getFlagsDidChange=function(e,t){return["hasChromaKeyColor","autoplay","loop"].reduce((function(n,i){var o=t[i]||!1,r=e[i]||!1;return n||o!==r}),!1)},r.getAssetDidChange=function(e,t){return Ks.assetDidChange(e.asset,t.asset)},r.doUpdateItem=function(e){var t=this,o=this.item,r=this.getAssetDidChange(o,e),s=this.getFlagsDidChange(o,e);(Object.assign(o,e),o.asset&&(o.asset.chromaKeyColor=o.hasChromaKeyColor?[0,1,0]:null,o.asset.autoplay=o.autoplay,o.asset.loop=o.loop),r||s)&&((o.asset?Ks.assetUpdate$(o.asset):n.of(null)).pipe(i.switchMap((function(){return Xs.inferItemUpdate$(t.view,o)})),i.first()).subscribe(),this.view.updateIndices(this.view.items),"function"==typeof o.onUpdateAsset&&o.onUpdateAsset());"function"==typeof o.onUpdate&&o.onUpdate()},r.doUpdateForm=function(){var e=this,n=this.item,o=this.form;if(this.type&&this.type.name===n.type.name)Object.keys(this.controls).forEach((function(t){switch(t){case"link":var i=n.link?n.link.title:null,o=n.link?n.link.href:null;e.controls[t].value={title:i,href:o,target:"_blank"};break;case"hasChromaKeyColor":e.controls[t].value=!(!n.asset||!n.asset.chromaKeyColor);break;case"autoplay":e.controls[t].value=!(!n.asset||!n.asset.autoplay);break;case"loop":e.controls[t].value=!(!n.asset||!n.asset.loop);break;case"assetType":e.controls[t].value=yn(n).id;break;default:e.controls[t].value=null!=n[t]?n[t]:null}}));else{var r;switch(this.type=n.type,Object.keys(this.controls).forEach((function(e){o.removeKey(e)})),n.type.name){case Ot.Nav.name:r=this.useHooks?["id","type","title?","abstract?","viewId?","hook?","hookExtra?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?"]:["id","type","title?","abstract?","viewId?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?"];break;case Ot.Plane.name:r=["id","type","position","rotation","scale","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case Ot.CurvedPlane.name:r=["id","type","position","rotation","scale","radius","height","arc","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case Ot.Texture.name:r=["id","type","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case Ot.Model.name:r=this.view.type.name===$t.Model?["id","type","asset?"]:["id","type","position","rotation","asset?"];break;default:r=["id","type"]}r.forEach((function(r){var s=-1!==r.indexOf("?");r=r.replace("?","");var a,u=null!=n[r]?n[r]:null;switch(r){case"viewId":a=new t.FormControl(u,s?void 0:t.RequiredValidator()),Xs.viewIdOptions$().pipe(i.first()).subscribe((function(t){a.options=t,a.value=a.value||null,e.pushChanges()}));break;case"hook":if(a=new t.FormControl(u,s?void 0:t.RequiredValidator()),Cn.enabled){var c=k.webhook.methods.map((function(e){return{id:e,name:e}}));c.unshift({id:null,name:"select"}),a.options=c}a.value=a.value||null,e.pushChanges();break;case"assetType":(a=new t.FormControl(u,s?void 0:t.RequiredValidator())).options=Object.keys(mn).map((function(e){return mn[e]}));break;case"link":var l=n.link?n.link.title:null,d=n.link?n.link.href:null;a=new t.FormGroup({title:new t.FormControl(l),href:new t.FormControl(d),target:"_blank"});break;default:a=new t.FormControl(u,s?void 0:t.RequiredValidator())}o.add(a,r)})),this.controls=o.controls}},r.onAssetTypeDidChange=function(e){var t=this,o=this.item,r=yn(o).id;if(e!==r){o.assetType=e;var s=n.of(null);e!==mn.ImageOrVideo.id&&(s=s.pipe(i.switchMap((function(){var t=bn(e);return Ks.assetCreate$(t)})))),s.pipe(i.first()).subscribe((function(e){t.controls.asset.value=e}))}},r.onChanges=function(e){this.doUpdateForm()},r.onSubmit=function(){var e=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var t=this.form.value,n=Object.assign({},t);this.item.type.name===Ot.Nav.name&&(n.viewId=n.viewId||this.view.id);var o=this.view,r=new Bt(n);Xs.inferItemUpdate$(o,r).pipe(i.first()).subscribe((function(t){Xs.inferItemUpdateResult$(o,r),e.update.next({view:o,item:r}),e.setTimeout((function(){e.busy=!1,e.pushChanges()}))}),(function(e){return console.log("UpdateViewItemComponent.onSubmit.inferItemUpdate$.error",e)}))}else this.form.touched=!0},r.onRemove=function(e){var t=this;mt.open$({src:k.template.modal.remove,data:{item:this.item}}).pipe(i.first()).subscribe((function(e){e instanceof pt&&t.delete.next({view:t.view,item:t.item})}))},r.onSelect=function(e){this.select.next({view:this.view,item:this.item.selected?null:this.item})},r.getTitle=function(e){return vt.getKeys("editor",e.type.name)},r.clearTimeout=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.to&&clearTimeout(this.to)})),r.setTimeout=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){void 0===t&&(t=300),this.clearTimeout(),"function"==typeof e&&(this.to=setTimeout(e,t))})),r.onDestroy=function(){this.clearTimeout()},o}(e.Component);Ra.meta={selector:"update-view-item",outputs:["select","update","delete"],inputs:["view","item"],template:'\n\t\t<div class="group--headline" [class]="{ active: item.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="item.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(item)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="item.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'nav\'">\n\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView"></div>\n\t\t\t\t<div control-checkbox [control]="controls.keepOrientation" label="Keep Orientation"></div>\n\t\t\t\t<div control-checkbox [control]="controls.important" label="Important"></div>\n\t\t\t\t<div control-checkbox [control]="controls.transparent" label="Transparent"></div>\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3"></div>\n\t\t\t\t<div *if="controls.transparent.value == true">\n\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t</div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\t\t\t\t<div control-text [control]="controls.link.controls.title" label="Link Title"></div>\n\t\t\t\t<div control-text [control]="controls.link.controls.href" label="Link Url"></div>\n\t\t\t\t<div *if="useHooks">\n\t\t\t\t\t<div control-custom-select [control]="controls.hook" label="Hook"></div>\n\t\t\t\t\t<div control-text [control]="controls.hookExtra" label="Hook Extra"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name != \'media\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name == \'media\'">\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'curved-plane\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\x3c!-- <div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-number [control]="controls.radius" label="Radius" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.height" label="Height" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.arc" label="Arc" [precision]="0"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'texture\'">\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'model\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var Aa=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.busy=!1,this.active=!1;var n=this.form=new t.FormGroup({id:new t.FormControl(this.tile.id,t.RequiredValidator()),asset:new t.FormControl(this.tile.asset,t.RequiredValidator()),navs:new t.FormControl(this.tile.navs,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){var n=e.tile;Object.assign(n,t),"function"==typeof n.onUpdate&&n.onUpdate(),e.pushChanges()}))},o.onSubmit=function(){var e=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var t=Object.assign({},this.form.value),n=this.view,i=t;this.update.next({view:n,tile:i}),this.setTimeout((function(){e.busy=!1,e.pushChanges()}))}else this.form.touched=!0},o.onRemove=function(e){var t=this;mt.open$({src:k.template.modal.remove,data:{tile:this.tile}}).pipe(i.first()).subscribe((function(e){e instanceof pt&&t.delete.next({view:t.view,tile:t.tile})}))},o.onSelect=function(e){this.select.next({view:this.view,tile:this.tile.selected?null:this.tile})},o.clearTimeout=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.to&&clearTimeout(this.to)})),o.setTimeout=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){void 0===t&&(t=300),this.clearTimeout(),"function"==typeof e&&(this.to=setTimeout(e,t))})),o.onDestroy=function(){this.clearTimeout()},n}(e.Component);Aa.meta={selector:"update-view-tile",outputs:["select","update","delete"],inputs:["view","tile"],template:'\n\t\t<div class="group--headline" [class]="{ active: tile.selected }" (click)="onSelect($event)">\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon name="tile"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title">Tile {{tile.id}}</div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="tile.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t\x3c!--\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t</form>\n\t'};var _a=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var o=n.prototype;return o.onInit=function(){var e=this;this.busy=!1;var n=this.form=new t.FormGroup;this.controls=n.controls,this.doUpdateForm(),n.changes$.subscribe((function(t){e.doUpdateView(t),e.pushChanges()})),this.orbit$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(e.view.type.name){case $t.WaitingRoom.name:case $t.Panorama.name:case $t.PanoramaGrid.name:case $t.Room3d.name:case $t.Model.name:case $t.Media.name:e.form.patch({latitude:t.orientation.latitude,longitude:t.orientation.longitude,zoom:t.zoom})}}))},o.orbit$=function(){var e,t,n=null;return Ye.in$.pipe(i.filter((function(e){return e.type===de})),i.auditTime(65),i.distinctUntilChanged((function(i,o){var r=e!==o.orientation.latitude||t!==o.orientation.longitude||n!==o.zoom;return e=o.orientation.latitude,t=o.orientation.longitude,n=o.zoom,!r})))},o.getAssetDidChange=function(e){var t=this.view;if(t.type.name===$t.PanoramaGrid.name)return!1;var n=Ks.assetDidChange(t.asset,e.asset),i=Ks.assetDidChange(t.ar?t.ar.usdz:null,e.usdz),o=Ks.assetDidChange(t.ar?t.ar.gltf:null,e.gltf);return!!(n||i||o)},o.doUpdateView=function(e){this.getAssetDidChange(e)&&this.onSubmit()},o.doUpdateForm=function(){var e=this.view;if(!this.type||this.type.name!==e.type.name){this.type=e.type;var n,i=this.form;switch(Object.keys(this.controls).forEach((function(e){i.removeKey(e)})),e.type.name){case $t.WaitingRoom.name:n=["id","type","name","latitude","longitude","zoom","asset"];break;case $t.Panorama.name:n=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case $t.PanoramaGrid.name:n=["id","type","name","hidden?","latitude","longitude","zoom"];break;case $t.Room3d.name:case $t.Model.name:n=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case $t.Media.name:n=["id","type","name","hidden?","asset"];break;default:n=["id","type","name"]}e.type.name!==$t.WaitingRoom.name&&k.flags.ar&&(n.push("usdz?"),n.push("gltf?")),n.forEach((function(n){var o=-1!==n.indexOf("?");switch(n=n.replace("?","")){case"latitude":case"longitude":var r=e.orientation||{latitude:0,longitude:0};i.add(new t.FormControl(r[n],t.RequiredValidator()),n);break;case"usdz":case"gltf":i.add(new t.FormControl(e.ar&&e.ar[n]||null,o?void 0:t.RequiredValidator()),n);break;default:i.add(new t.FormControl(null!=e[n]?e[n]:null,o?void 0:t.RequiredValidator()),n)}})),this.controls=i.controls}},o.onChanges=function(e){this.doUpdateForm()},o.onSubmit=function(){var e=this;if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();var t=Object.assign({},this.form.value);null!=t.latitude&&(t.orientation={latitude:t.latitude,longitude:t.longitude},delete t.latitude,delete t.longitude);var n=t.usdz||null,o=t.gltf||null;delete t.usdz,delete t.gltf,t.ar=n||o?{usdz:n,gltf:o}:null;var r=new Ht(Object.assign({},this.view,t));Xs.viewUpdate$(r).pipe(i.first()).subscribe((function(t){e.update.next({view:r}),e.setTimeout((function(){e.busy=!1,e.pushChanges()}))}),(function(e){return console.log("UpdateViewComponent.onSubmit.viewUpdate$.error",e)}))}else this.form.touched=!0},o.onRemove=function(e){var t=this;mt.open$({src:k.template.modal.remove,data:{item:this.item}}).pipe(i.first()).subscribe((function(e){e instanceof pt&&t.delete.next({view:t.view})}))},o.onSelect=function(e){this.select.next({view:this.view.selected?null:this.view})},o.getTitle=function(e){return vt.getKeys("editor",e.type.name)},o.clearTimeout=function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){this.to&&clearTimeout(this.to)})),o.setTimeout=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){void 0===t&&(t=300),this.clearTimeout(),"function"==typeof e&&(this.to=setTimeout(e,t))})),o.onDestroy=function(){this.clearTimeout()},n}(e.Component);_a.meta={selector:"update-view",outputs:["select","update","delete"],inputs:["view"],template:'\n\t\t<div class="group--headline" [class]="{ active: view.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="view.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(view)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="view.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'waiting-room\'">\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'room-3d\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'model\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name != \'waiting-room\' && (\'ar\' | flag)">\n\t\t\t\t<div control-model [control]="controls.usdz" label="AR IOS (.usdz)" accept=".usdz"></div>\n\t\t\t\t<div control-model [control]="controls.gltf" label="AR Android (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" *if="view.type.name != \'waiting-room\'" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var La=[Ws,ra,Zs,sa,ba,Ca,da,la,aa,oa,ua,ca,pa,ha,fa,ma,va,ga,ya,qs,Ra,Aa,_a],Pa=[],$a=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(e.Module);$a.meta={imports:[],declarations:[].concat(La,Pa),exports:[].concat(La,Pa)};var Oa=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onClose=function(){mt.reject()},t}(e.Component);Oa.meta={selector:"[iframe-modal]"};var Ha=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){for(var t=k,n=e.split("."),i=n.shift();n.length>0&&t[i];)t=t[i],i=n.shift();return t[i]||null},t}(e.Pipe);Ha.meta={name:"env"};var Ua=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){return k.flags[e]||!1},t}(e.Pipe);Ua.meta={name:"flag"};var Da=function(e){this.file=e,this.name=e.name,this.type=wn(e.name),this.progress=0,this.size=e.size,this.uploading=!1,this.paused=!1,this.success=!1,this.complete=!1,this.error=null,this.preview=null},Fa=function(e){e&&Object.assign(this,e)},Va=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Fa),ja=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Fa),Ba=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(Fa),Na=function(){function t(){this.concurrent$=new n.BehaviorSubject(0),this.items$=new n.BehaviorSubject([]),this.events$=new n.ReplaySubject(1)}var o=t.prototype;return o.upload$=function(){var e=this,t=this.items$.getValue().filter((function(e){return!e.uploading}));return n.combineLatest(t.map((function(t){return e.uploadItem$(t)})))},o.uploadItem$=function(e){var t=this;e.uploading=!0,this.events$.next(new Va({item:e}));var o=[e.file];return n.of(o).pipe(i.delayWhen((function(){return t.concurrent$.pipe(i.filter((function(e){return e<4})))})),i.tap((function(){return t.concurrent$.next(t.concurrent$.getValue()+1)})),i.first(),i.switchMap((function(e){return Ks.upload$(e)})),i.switchMap((function(n){var o=n[0];e.uploading=!1,e.complete=!0;var r=xn.fromUrl(o.url);return t.events$.next(new ja({item:e,asset:r})),Ks.assetCreate$(r).pipe(i.tap((function(n){t.remove(e),t.events$.next(new Ba({item:e,asset:n})),t.concurrent$.next(t.concurrent$.getValue()-1)})))})))},o.addItems=function(e){if(e&&e.length){var t=this.items$.getValue(),n=Array.from(e).map((function(e){return new Da(e)}));t.push.apply(t,n),this.items$.next(t)}},o.remove=function(e){var t=this.items$.getValue(),n=t.indexOf(e);-1!==n&&t.splice(n,1),this.items$.next(t)},o.removeAll=function(){this.items$.next([])},o.drop$=function(t,o){var r=this;if(e.isPlatformBrowser&&t){o=o||t;var s=document.querySelector("body");return n.merge(n.fromEvent(s,"drop"),n.fromEvent(s,"dragover")).pipe(i.map((function(e){return e.preventDefault(),e.target===o&&r.addItems(e.dataTransfer.files),r.items$})))}return n.EMPTY},o.change$=function(t){var o=this;return e.isPlatformBrowser&&t?n.fromEvent(t,"change").pipe(i.switchMap((function(e){return t.files.length&&(o.addItems(t.files),t.value=""),o.items$}))):n.EMPTY},o.files$=function(e){var t=this;return n.combineLatest(Array.from(e).map((function(e,n){return t.file$(e,n)})))},o.file$=function(e,t){var n=this;return this.read$(e,t).pipe(i.switchMap((function(){return n.uploadFile$(e)})))},o.read$=function(e,t){var o=this,r=new FileReader,s=n.fromEvent(r,"load").pipe(i.tap((function(e){var n=e.target.result;o.resize(n,(function(e){o.previews[t]=e,o.pushChanges()}))})));return r.readAsDataURL(e),s},o.uploadFile$=function(e){return Ks.upload$([e]).pipe(i.switchMap((function(e){var t=e[0],n=xn.fromUrl(t.url);return Ks.assetCreate$(n)})))},o.resize=function(e,t){if("function"==typeof t){var n=document.createElement("img");n.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d"),o=n.width,r=n.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,i.drawImage(n,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},n.src=e}},o.supported=function(){return(t=document.createElement("input")).type="file","files"in t&&!!((e=new XMLHttpRequest)&&"upload"in e&&"onprogress"in e.upload)&&!!window.FormData;var e,t},t}(),za=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var t=this;this.label=this.label||"label",this.accept=this.accept||"image/png, image/jpeg",this.multiple=!1!==this.multiple,this.items=[],this.assets=this.control.value||[],this.hasFiles=!1;var n=e.getContext(this).node,o=n.querySelector("input");o.setAttribute("accept",this.accept);var r=n.querySelector(".upload-drop"),s=this.service=new Na;s.drop$(o,r).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()})),s.change$(o).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()})),s.events$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof Ba&&(t.assets.push(e.asset),t.control.value=t.assets),t.items=t.items,t.pushChanges()}))},o.onUpload=function(){this.service.upload$().pipe(i.first()).subscribe()},o.onCancel=function(){this.service.removeAll()},o.onItemPause=function(e){},o.onItemResume=function(e){},o.onItemCancel=function(e){},o.onItemRemove=function(e){this.service.remove(e)},u(n,[{key:"items",get:function(){return this.items_},set:function(e){this.items_=e,this.uploadCount=e.reduce((function(e,t){return e+(t.uploading||t.completed?0:1)}),0)}}]),n}(ta);za.meta={selector:"[control-assets]",inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="listing--assets">\n\t\t\t\t<div class="listing__item" *for="let item of assets">\n\t\t\t\t\t<div class="upload-item">\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<img [lazy]="item | asset" [size]="{ width: 320, height: 240 }" *if="item.type.name === \'image\'" />\n\t\t\t\t\t\t\t<video [src]="item | asset" *if="item.type.name === \'video\'"></video>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="name" [innerHTML]="item.file"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="listing__item" *for="let item of items">\n\t\t\t\t\t<div upload-item [item]="item" (pause)="onItemPause($event)" (resume)="onItemResume($event)" (cancel)="onItemCancel($event)" (remove)="onItemRemove($event)"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<div class="btn--browse">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t\t<input type="file" accept="image/jpeg" multiple />\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--upload" (click)="onUpload()" *if="uploadCount > 0" [innerHTML]="\'upload\' | label"></div>\n\t\t\t\t<div class="btn--cancel" (click)="onCancel()" *if="uploadCount > 0" [innerHTML]="\'cancel\' | label"></div>\n\t\t\t</div>\n\t\t\t<div class="upload-drop">\n    \t\t\t<span [innerHTML]="\'drag_and_drop_images\' | label"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Ga=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onInit=function(){this.label=this.label||"label"},t}(ta);Ga.meta={selector:"[control-checkbox]",inputs:["control","label"],template:'\n\t\t<div class="group--form--checkbox" [class]="{ required: control.validators.length }">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox" class="control--checkbox" [formControl]="control" [value]="true" />\n\t\t\t\t<span [innerHTML]="label | html"></span>\n\t\t\t</label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var qa=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var e=this;this.label=this.label||"label",this.dropped=!1,this.dropdownId=zs.nextId(),zn.typing$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.scrollToWord(t)}))},o.scrollToWord=function(t){for(var n=this.control.options||[],i=-1,o=0;o<n.length;o++){if(0===n[o].name.toLowerCase().indexOf(t.toLowerCase())){i=o;break}}if(-1!==i){var r=e.getContext(this).node,s=r.querySelector(".dropdown"),a=r.querySelector(".nav--dropdown").children[i];a&&s.scrollTo(0,a.offsetTop)}},o.setOption=function(e){var t;if(this.isMultiple){var n=this.control.value||[],i=n.indexOf(e.id);-1!==i?n.splice(i,1):n.push(e.id),function(e){throw new Error('"'+e+'" is read-only')}("value"),n=n.length?n.slice():null}else t=e.id;this.control.value=t,this.change.next(t)},o.hasOption=function(e){return this.isMultiple?-1!==(this.control.value||[]).indexOf(e.id):this.control.value===e.id},o.getLabel=function(){var e=this.control.value,t=this.control.options||[];if(this.isMultiple)return(e=e||[]).length?e.map((function(e){var n=t.find((function(t){return t.id===e||t.name===e}));return n?n.name:""})).join(", "):"select";var n=t.find((function(t){return t.id===e||t.name===e}));return n?n.name:"select"},o.onDropped=function(e){this.dropped&&null===e&&(this.control.touched=!0),this.dropped=e===this.dropdownId},u(n,[{key:"isMultiple",get:function(){return this.multiple&&!1!==this.multiple&&"false"!==this.multiple}}]),n}(ta);qa.meta={selector:"[control-custom-select]",outputs:["change"],inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length, multiple: isMultiple }" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="control--custom-select" [innerHTML]="getLabel() | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t<div class="category" [innerHTML]="label"></div>\n\t\t\t<ul class="nav--dropdown" [class]="{ multiple: isMultiple }">\n\t\t\t\t<li (click)="setOption(item)" [class]="{ empty: item.id == null }" *for="let item of control.options">\n\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name | label"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t'};var Wa=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.label=this.label||"label",this.disabled=this.disabled||!1;var t=getContext(this).node,n=this.input=t.querySelector("input");merge(fromEvent(n,"input")).pipe(takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidChange(t)})),fromEvent(n,"blur").pipe(takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidBlur(t)}))},n.onInputDidChange=function(e){console.log("ControlLinkComponent.onInputDidChange",e.target.value)},n.onInputDidBlur=function(e){this.control.touched=!0,this.value=this.input.value},t}(ta);Wa.meta={selector:"[control-link]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Ka=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg",this.languages=k.languages,this.currentLanguage=k.defaultLanguage;var o=e.getContext(this).node.querySelector("input");o.setAttribute("accept",this.accept),ea.drop$(o).pipe(i.takeUntil(this.unsubscribe$)).subscribe(),ea.change$(o).pipe(i.switchMap((function(e){var o=e.map((function(e,n){return Ks.upload$([e]).pipe(i.switchMap((function(e){return(t.languages.length>1?Ks.createOrUpdateLocalizedAsset$:Ks.createOrUpdateAsset$)(e,t.control,t.currentLanguage)})))}));return n.combineLatest(o)})),i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.control.value=e[0]}))},r.setLanguage=function(e){this.currentLanguage=e,this.pushChanges()},u(o,[{key:"localizedValue",get:function(){var e=this.control.value;if(e&&e.locale){var t=e.locale[this.currentLanguage];t&&(e=t)}return e}}]),o}(ta);Ka.meta={selector:"[control-localized-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="localizedValue | asset" [size]="{ width: 320, height: 240 }" *if="localizedValue && localizedValue.type.name === \'image\'" />\n\t\t\t\t<video [src]="localizedValue | asset" *if="localizedValue && localizedValue.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="localizedValue" [innerHTML]="localizedValue.file"></div>\n\t\t\t<ul class="nav--languages" *if="languages.length > 1">\n\t\t\t\t<li class="nav__item" [class]="{ active: lang == currentLanguage }" (click)="setLanguage(lang)" [innerHTML]="lang" *for="let lang of languages"></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Xa=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||".glb";var o=e.getContext(this).node,r=this.input=o.querySelector("input");r.setAttribute("accept",this.accept),ea.change$(r).pipe(i.switchMap((function(e){var o=e.map((function(e,n){return Ks.upload$([e]).pipe(i.switchMap((function(e){return Ks.createOrUpdateAsset$(e,t.control)})))}));return n.combineLatest(o)})),i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.control.value=e[0]}))},r.onRemove=function(e){var t=this;Ks.assetDelete$(this.control.value).pipe(i.first()).subscribe((function(){t.control.value=null,t.input.value=null,t.control.touched=!0}))},r.read$=function(e,t){return n.of(e)},o}(na);Xa.meta={selector:"[control-model]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--model">\n\t\t\t\t<div class="file-name" *if="!control.value" [innerHTML]="\'select_file\' | label"></div>\n\t\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t\t\t<div class="btn--upload"><input type="file"><span [innerHTML]="\'browse\' | label"></span></div>\n\t\t\t\t<div class="btn--remove" *if="control.value" (click)="onRemove($event)"><span [innerHTML]="\'remove\' | label"></span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Ya=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1},n.updateValue=function(e){this.control.value=e},t}(ta);Ya.meta={selector:"[control-number]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--number">\n\t\t\t\t<input-value label="" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value" (update)="updateValue($event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Za=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onInit=function(){this.label=this.label||"label"},t}(ta);Za.meta={selector:"[control-password]",inputs:["control","label"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="password" class="control--text" [formControl]="control" [placeholder]="label" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Ja=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onInit=function(){this.label=this.label||"label"},t}(ta);Ja.meta={selector:"[control-select]",inputs:["control","label"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<select class="control--select" [formControl]="control" required>\n\t\t\t\t<option [value]="null" [innerHTML]="\'select\' | label"></option>\n\t\t\t\t<option [value]="item.id" *for="let item of control.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Qa=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onInit=function(){this.label=this.label||"label",this.disabled=this.disabled||!1},t}(ta);Qa.meta={selector:"[control-text]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var eu=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.onInit=function(){this.label=this.label||"label",this.disabled=this.disabled||!1},t}(ta);eu.meta={selector:"[control-textarea]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form--textarea" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<textarea class="control--text" [formControl]="control" [placeholder]="label" [innerHTML]="label" rows="4" [disabled]="disabled"></textarea>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var tu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1},n.updateValue=function(e,t){var n=this.control.value;n[e]=t,this.control.value=n.slice()},t}(ta);tu.meta={selector:"[control-vector]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--vector">\n\t\t\t\t<input-value label="x" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[0]" (update)="updateValue(0, $event)"></input-value>\n\t\t\t\t<input-value label="y" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[1]" (update)="updateValue(1, $event)"></input-value>\n\t\t\t\t<input-value label="z" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[2]" (update)="updateValue(2, $event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var nu=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onChanges=function(){var t=e.getContext(this).node;!0===this.disabled?(t.disabled=this.disabled,t.setAttribute("disabled",this.disabled)):(delete t.disabled,t.removeAttribute("disabled"))},n}(e.Directive);nu.meta={selector:"input[disabled],textarea[disabled]",inputs:["disabled"]};var iu=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.prototype.getLabel=function(e,t){return vt.transform("error_"+e)},t}(ta);iu.meta={selector:"errors-component",inputs:["control"],template:'\n\t<div class="inner" [style]="{ display: control.invalid && control.touched ? \'block\' : \'none\' }">\n\t\t<div class="error" *for="let [key, value] of control.errors">\n\t\t\t<span [innerHTML]="getLabel(key, value)"></span>\n\t\t\t\x3c!-- <span class="key" [innerHTML]="key"></span> <span class="value" [innerHTML]="value | json"></span> --\x3e\n\t\t</div>\n\t</div>\n\t'};var ou=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.value=this.value||0,this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.increment$(".btn--more",1).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.value+=e,t.update.next(t.value),t.pushChanges()})),this.increment$(".btn--less",-1).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.value+=e,t.update.next(t.value),t.pushChanges()}));var o=e.getContext(this).node,r=this.input=o.querySelector("input");n.merge(n.fromEvent(r,"input")).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidChange(e)})),n.merge(n.fromEvent(r,"blur"),n.fromEvent(r,"keydown").pipe(i.filter((function(e){return"Enter"===e.key||13===e.keyCode})))).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidBlur(e)}))},r.onInputDidChange=function(e){e.target.value=e.target.value.replace(/[^\d|\.|-]/g,"")},r.onInputDidBlur=function(e){var t=parseFloat(this.input.value);this.value!==t&&(NaN!==t?(this.value=t,this.update.next(this.value)):this.input.value=this.getValue())},r.increment$=function(t,o){var r,s,a=this,u=e.getContext(this).node.querySelector(t);return n.race(n.fromEvent(u,"mousedown"),n.fromEvent(u,"touchstart")).pipe(i.tap((function(){s=a.increment,r=16})),i.switchMap((function(e){return n.interval(30).pipe(i.filter((function(e){return e%r==0})),i.map((function(){var e=s*o;return r=Math.max(1,Math.floor(.85*r)),e})),i.takeUntil(n.race(n.fromEvent(u,"mouseup"),n.fromEvent(u,"touchend"))))})))},r.getValue=function(){return this.value.toFixed(this.precision)},r.setValue=function(e){this.value+=this.increment*e,this.update.next(this.value),this.pushChanges()},o}(e.Component);ou.meta={selector:"input-value",outputs:["update"],inputs:["value","label","precision","increment","disabled"],template:'\n\t\t<div class="group--control" [class]="{ disabled: disabled }">\n\t\t\t<input type="text" class="control--text" [placeholder]="label" [value]="getValue()" [disabled]="disabled" />\n\t\t\t<div class="control--trigger">\n\t\t\t\t<div class="btn--more" (click)="setValue(1)">+</div>\n\t\t\t\t<div class="btn--less" (click)="setValue(-1)">-</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var ru=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){this.env=w},n.onTest=function(e){this.test.next(e)},n.onReset=function(e){this.reset.next(e)},t}(e.Component);ru.meta={selector:"test-component",inputs:["form"],outputs:["test","reset"],template:'\n\t<div class="group--form--results" *if="env.DEVELOPMENT">\n\t\t<code [innerHTML]="form.value | json"></code>\n\t\t<button type="button" class="btn--mode" (click)="onTest($event)"><span>test</span></button>\n\t\t<button type="button" class="btn--mode" (click)="onReset($event)"><span>reset</span></button>\n\t</div>\n\t'};var su=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node;n.value=this.value,n.setAttribute("value",this.value)},n}(e.Directive);su.meta={selector:"[value]",inputs:["value"]};var au=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){if(e){e=e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t))}));var t=['"',"&","'","<",">"," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","×","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ","&","•","°","∞","‰","⋅","±","†","—","¬","µ","⊥","∥","€","£","¥","¢","©","®","™","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],n=new RegExp("(&"+["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")+";)","g");return e=e.replace(n,(function(){for(var e=1;e<arguments.length;e++)if(arguments[e])return t[e-1]}))}},t}(e.Pipe);au.meta={name:"html"};var uu=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.onChanges=function(){e.getContext(this).node.setAttribute("id",this.id)},n}(e.Directive);uu.meta={selector:"[id]",inputs:["id"]};var cu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){this.showLanguages=!1,this.languageService=Sn},n.setLanguage=function(e){var t=this;this.languageService.setLanguage$(e).pipe(i.first()).subscribe((function(e){t.showLanguages=!1,t.pushChanges(),t.set.next()}))},n.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},t}(e.Component);cu.meta={selector:"[language]",outputs:["set"],template:'\n\t\t<button type="button" class="btn--language" (click)="toggleLanguages()" *if="languageService.hasLanguages"><span [innerHTML]="languageService.activeLanguage.title"></span> <svg viewBox="0 0 8 5"><use xlink:href="#caret-down"></use></svg></button>\n\t\t<ul class="nav--language" *if="showLanguages">\n\t\t\t<li (click)="setLanguage(language)" *for="let language of languageService.languages"><span [innerHTML]="language.title"></span></li>\n\t\t</ul>\n\t'};var lu=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var e=this,t=this.meetingUrl.embedViewId;this.state={status:M.get("status")||q,role:M.get("role")||C.Publisher,membersCount:3,controlling:!1,spying:!1,silencing:!1,hosted:!0,chat:!1,chatDirty:!0,name:"Jhon Appleseed",uid:"7341614597544882",showNavInfo:!0},this.state.live=this.state.role!==C.SelfService&&this.state.role!==C.Embed&&!m,this.state.navigable=null==t,this.state.mode=qe.getMode(this.state.role),this.view={likes:41},this.local={},this.screen=null,this.remoteScreen_=null,this.media=null,this.hasScreenViewItem=!1,this.media=!0,this.remotes=new Array(8).fill(0).map((function(e,t){return{id:t+1}})),this.languageService=Sn,this.showLanguages=!1,I.patchState(this.state),this.fullscreen$().pipe(i.takeUntil(this.unsubscribe$)).subscribe();this.vrService=eo.getService();console.log("LayoutComponent",this),setTimeout((function(){var t=tn;switch(t){case Qt:un.open$({message:vt.transform("bhere_support_request_sent")}).pipe(i.takeUntil(e.unsubscribe$)).subscribe((function(e){e instanceof sn&&console.log("ToastResolveEvent",e)}));break;case en:un.open$({message:vt.transform("bhere_support_request_sent"),type:t,position:on}).pipe(i.takeUntil(e.unsubscribe$)).subscribe((function(e){e instanceof sn?console.log("ToastResolveEvent",e):e instanceof an&&console.log("ToastRejectEvent",e)}));break;case tn:un.open$({message:vt.transform("bhere_support_request_dialog"),acceptMessage:vt.transform("bhere_support_request_dialog_accept"),rejectMessage:vt.transform("bhere_support_request_dialog_reject"),type:t,position:on}).pipe(i.takeUntil(e.unsubscribe$)).subscribe((function(e){e instanceof sn?console.log("ToastResolveEvent",e):e instanceof an&&console.log("ToastRejectEvent",e)}))}}),3e3)},r.setLanguage=function(e){var t=this;this.languageService.setLanguage$(e).pipe(first()).subscribe((function(e){t.showLanguages=!1,t.pushChanges()}))},r.toggleLanguages=function(){this.showLanguages=!this.showLanguages,this.pushChanges()},r.patchState=function(e){this.state=Object.assign({},this.state,e),this.screen=this.state.screen||null,this.remoteScreen=this.screen,this.pushChanges()},r.toggleCamera=function(){this.patchState({cameraMuted:!this.state.cameraMuted})},r.toggleAudio=function(){this.patchState({audioMuted:!this.state.audioMuted})},r.toggleScreen=function(){this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))},r.toggleVolume=function(){this.patchState({volumeMuted:!this.state.volumeMuted})},r.toggleMode=function(){var e=this.state.mode===Le?Pe:Le;this.patchState({mode:e})},r.toggleFullScreen=function(){var t=e.getContext(this).node;!this.state.fullScreen?t.requestFullscreen?t.requestFullscreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()},r.fullscreen$=function(){var e=this;return n.fromEvent(document,"fullscreenchange").pipe(i.tap((function(t){var n=null!=document.fullscreenElement;e.patchState({fullScreen:n})})))},r.toggleChat=function(){this.patchState({chat:!this.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))},r.toggleNavInfo=function(){this.patchState({showNavInfo:!this.state.showNavInfo})},r.onBack=function(){console.log("LayoutComponent.onBack")},r.onChatClose=function(){this.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))},r.onToggleControl=function(e){var t=this.state.controlling===e?null:e;this.patchState({controlling:t,spying:!1})},r.onToggleSilence=function(){this.patchState({silencing:!this.state.silencing})},r.onToggleSpy=function(e){var t=this.state.spying===e?null:e;this.patchState({spying:t,controlling:!1})},r.addLike=function(){this.view.liked=!0,this.showLove(this.view)},r.showLove=function(e){var t=this;if(e&&this.view.id===e.id){var n=this.view.showLove;this.view.likes=e.likes,this.view.showLove=!0,this.pushChanges(),n||setTimeout((function(){t.view.showLove=!1,t.pushChanges()}),3100)}},r.disconnect=function(){},u(o,[{key:"meetingUrl",get:function(){return this.meetingUrl_||(this.meetingUrl_=new L),this.meetingUrl_}},{key:"isVirtualTourUser",get:function(){return-1!==[C.Publisher,C.Attendee,C.Streamer,C.Viewer].indexOf(this.state.role)}},{key:"isEmbed",get:function(){return-1!==window.location.href.indexOf(k.url.embed)}},{key:"isNavigable",get:function(){return null==this.meetingUrl.embedViewId}},{key:"showNavInfoToggler",get:function(){return k.flags.hideNavInfo&&this.state.mode!==Pe}},{key:"uiClass",get:function(){var e={};return e[this.state.role]=!0,e.chat=this.state.chat,e.remotes=this.state.mode===Pe,e.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,e.media=!e.remotes&&this.media,e.locked=this.locked,e}},{key:"remoteClass",get:function(){return"group--remote--"+Math.min(9,this.remotes.length)}},{key:"controlled",get:function(){return this.state.controlling&&this.state.controlling!==this.state.uid}},{key:"controlling",get:function(){return this.state.controlling&&this.state.controlling===this.state.uid}},{key:"silencing",get:function(){return I.state.silencing}},{key:"silenced",get:function(){return I.state.silencing&&I.state.role===C.Streamer}},{key:"spyed",get:function(){return this.state.spying&&this.state.spying===this.state.uid}},{key:"spying",get:function(){return this.state.spying&&this.state.spying!==this.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"remoteScreen",get:function(){return this.remoteScreen_},set:function(e){this.remoteScreen_!==e&&(this.remoteScreen_=e,window.dispatchEvent(new Event("resize")))}}]),o}(e.Component);lu.meta={selector:"[layout-component]"};var du=function(){function e(){}return e.observer=function(){var e=this;return this.observer_||(this.readySubject_=new n.BehaviorSubject(!1),this.observerSubject_=new n.Subject,this.observer_=new IntersectionObserver((function(t){e.observerSubject_.next(t)}))),this.observer_},e.intersection$=function(e){if("IntersectionObserver"in window){var t=this.observer();return t.observe(e),this.observerSubject_.pipe(i.map((function(t){return t.find((function(t){return t.target===e}))})),i.filter((function(e){return void 0!==e&&e.isIntersecting})),i.first(),i.finalize((function(){return t.unobserve(e)})))}return n.of({target:e})},e}(),hu=function(){function e(){}return e.get=function(e){return this.cache[e]},e.set=function(e,t){this.cache[e]=t;var n=Object.keys(this.cache);n.length>100&&this.remove(n[0])},e.remove=function(e){delete this.cache[e]},u(e,null,[{key:"cache",get:function(){return this.cache_||(this.cache_={}),this.cache_}}]),e}(),pu=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=this,o=e.getContext(this).node;o.classList.add("lazy"),this.input$=(new n.Subject).pipe(i.distinctUntilChanged(),i.switchMap((function(e){var i=hu.get(e);return i?n.of(i):(o.classList.remove("lazyed"),t.lazy$(e))})),i.takeUntil(this.unsubscribe$)),this.input$.subscribe((function(e){hu.set(t.lazy,e),o.setAttribute("src",e),o.classList.add("lazyed")}))},r.onChanges=function(){this.input$.next(this.lazy)},r.lazy$=function(t){var n=this,o=e.getContext(this).node;return du.intersection$(o).pipe(i.switchMap((function(){return Di.load$(t,n.size)})),i.first())},o}(e.Directive);pu.meta={selector:"[lazy],[[lazy]]",inputs:["lazy","size"]};var fu=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.transform=function(e){var n=t.urlify(e);return n=t.breakLines(n)},t.urlify=function(e){return e.replace(/(?:(?:https?|ftp):\/\/|\b(?:[a-z\d]+\.))(?:(?:[^\s()<>]+|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))?\))+(?:\((?:[^\s()<>]+|(?:\(?:[^\s()<>]+\)))?\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))?/gim,(function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"}))},t.breakLines=function(e){return e.replace(/\n/gm,(function(e){return"<br>"}))},t}(e.Pipe);fu.meta={name:"message"};var mu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){var t=e.getContext(this).parentInstance;t instanceof cn&&(this.data=t.modal.data)},i.onClose=function(){mt.reject()},n}(e.Component);mu.meta={selector:"[modal]"};var vu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this);var n=e.getContext(this).parentInstance;n instanceof cn&&(this.data=n.modal.data)},i.onAccept=function(e){mt.resolve()},i.onReject=function(e){mt.reject()},i.onClose=function(){mt.reject()},n}(e.Component);vu.meta={selector:"[support-request-modal]"};var gu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){this.update()},i.onChanges=function(){this.update()},i.update=function(){if(this.name_!==this.name){this.name_=this.name;var t=e.getContext(this).node;if(t.parentNode){var n,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=this.width||24,r=this.height||24;i.setAttribute("class","icon--"+this.name),i.setAttributeNS(null,"viewBox","0 0 "+o+" "+r),i.innerHTML='<use xlink:href="#'+this.name+'"></use>',i.rxcompId=t.rxcompId,(n=i.classList).add.apply(n,t.classList),t.parentNode.replaceChild(i,t)}}},n}(e.Structure);gu.meta={selector:"svg-icon",inputs:["name","width","height"]};var yu=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),u(n,[{key:"title",set:function(t){if(this.title_!==t){this.title_=t;var n=e.getContext(this).node;t?n.setAttribute("title",t):n.removeAttribute("title")}},get:function(){return this.title_}}]),n}(e.Directive);yu.meta={selector:"[[title]]",inputs:["title"]};var bu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var t=this;this.platform=nt.platform,this.missingAr=!1,this.missingUsdz=!1,this.missingGltf=!1;var n=this.viewId=this.getViewId();n&&kn.viewById$(n).pipe(i.first()).subscribe((function(n){if(!n.ar)return t.missingAr=!0,void t.pushChanges();if(t.platform===Je){var i=t.getUsdzSrc(n);i?window.location.href=i:(t.missingUsdz=!0,t.pushChanges())}else if(null!==t.getGltfSrc(n)){var o=t.getModelViewerNode(n);e.getContext(t).node.appendChild(o)}else t.missingGltf=!0,t.pushChanges()}))},o.getUsdzSrc=function(e){return e.ar&&e.ar.usdz?k.getPath(e.ar.usdz.folder+e.ar.usdz.file):null},o.getGltfSrc=function(e){return e.ar&&e.ar.gltf?k.getPath(e.ar.gltf.folder+e.ar.gltf.file):null},o.getViewId=function(){var e=new L,t=null;return e.viewId&&(t=parseInt(e.viewId)),t},o.getModelViewerNode=function(e){var t=k.getPath(e.asset.folder+e.asset.file),n=this.getUsdzSrc(e),i=this.getGltfSrc(e),o='\n\t\t\t<model-viewer alt="'+e.name+'" skybox-image="'+t+'" ios-src="'+n+'" src="'+i+'" ar ar-modes="webxr scene-viewer quick-look" ar-scale="auto" camera-controls></model-viewer>\n\t\t',r=document.createElement("div");return r.innerHTML=o,r.firstElementChild},n}(e.Component);bu.meta={selector:"[try-in-ar]"};var wu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var o=t.prototype;return o.onInit=function(){var e=this;null===this.item.preview&&this.read$(this.item.file).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){e.item.preview=t,e.pushChanges()}))},o.read$=function(e){var t=this,o=new FileReader,r=n.fromEvent(o,"load").pipe(i.switchMap((function(e){var i=e.target.result;return t.item.type.name===fn.Image.name?t.resize$(i):n.of(i)})));return o.readAsDataURL(e),r},o.resize$=function(e){return new Promise((function(t,n){var i=document.createElement("img");i.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d"),o=i.width,r=i.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,n.drawImage(i,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},i.onerror=function(e){n(e)},i.src=e}))},o.onPause=function(){this.pause.next(this.item)},o.onResume=function(){this.resume.next(this.item)},o.onCancel=function(){this.cancel.next(this.item)},o.onRemove=function(){this.remove.next(this.item)},t}(e.Component);wu.meta={selector:"[upload-item]",outputs:["pause","resume","cancel","remove"],inputs:["item"],template:'\n\t<div class="upload-item" [class]="{ \'error\': item.error, \'success\': item.success }">\n\t\t<div class="picture">\n\t\t\t<img [lazy]="item.preview" [size]="{ width: 320, height: 240 }" *if="item.preview && item.type.name === \'image\'" />\n\t\t\t<video [src]="item.preview" *if="item.preview && item.type.name === \'video\'"></video>\n\t\t\t<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" [class]="{ uploading: item.uploading }" *if="item.uploading"><use xlink:href="#spinner"></use></svg>\n\t\t</div>\n\t\t<div class="name">{{item.name}}</div>\n\t\t\x3c!--\n\t\t<div class="group--info">\n\t\t\t<div>progress: {{item.progress}}</div>\n\t\t\t<div>size: {{item.size}} bytes</div>\n\t\t\t<div>current speed: {{item.currentSpeed}} bytes/s</div>\n\t\t\t<div>average speed: {{item.averageSpeed}} bytes/s</div>\n\t\t\t<div>time ramining: {{item.timeRemaining}}s</div>\n\t\t\t<div>paused: {{item.paused}}</div>\n\t\t\t<div>success: {{item.success}}</div>\n\t\t\t<div>complete: {{item.complete}}</div>\n\t\t\t<div>error: {{item.error}}</div>\n\t\t</div>\n\t\t--\x3e\n\t\t\x3c!--\n\t\t<div class="group--cta" *if="!item.complete && item.uploading">\n\t\t\t<div class="btn--pause" (click)="onPause()">pause</div>\n\t\t\t<div class="btn--resume" (click)="onResume()">resume</div>\n\t\t\t<div class="btn--cancel" (click)="onCancel()">cancel</div>\n\t\t</div>\n\t\t--\x3e\n\t\t<div class="group--cta">\n\t\t\t<div class="btn--remove" (click)="onRemove()" *if="!item.complete">remove</div>\n\t\t</div>\n\t</div>\n\t'};var xu=function(t){function n(){return t.apply(this,arguments)||this}return d(n,t),n.prototype.play=function(t){var n=e.getContext(this).node;if(Hls.isSupported()){var i=new Hls;i.attachMedia(n),i.on(Hls.Events.MEDIA_ATTACHED,(function(){i.loadSource(t),i.on(Hls.Events.MANIFEST_PARSED,(function(e,t){n.play()}))}))}},u(n,[{key:"hls",set:function(e){this.hls_!==e&&(this.hls_=e,this.play(e))},get:function(){return this.hls_}}]),n}(e.Directive);xu.meta={selector:"[[hls]]",inputs:["hls"]};var Eu=function(e){function t(t,n,i,o,r,s,a){var u;return(u=e.call(this,a)||this)[t]=n,u[i]=o,u.index=r,u.count=s,u}return d(t,e),u(t,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),t}(e.Context),Su=1,Tu=2,ku=3,Mu=4,Iu=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var t=e.getContext(this),o=t.module,r=t.node,s=r.firstElementChild,a=r.getAttribute("*virtual");r.removeAttribute("*virtual"),r.removeChild(s);var u=this.tokens=this.getExpressionTokens(a);this.virtualFunction=o.makeFunction(u.iterable),this.container=r,this.template=s,this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.reverse=!0===this.reverse,this.options={width:this.width,gutter:this.gutter,reverse:this.reverse,containerWidth:0,containerHeight:0,top:0,cols:[0]},this.cachedRects={},this.cachedInstances=[],this.cacheNodes=[],this.items$=new n.BehaviorSubject([]),this.update$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){}))},r.onChanges=function(t){var n=e.getContext(this),i=n.module.resolve(this.virtualFunction,n.parentInstance,this)||[];this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.options.width=this.width,this.updateView(!0),this.items$.next(i)},r.update$=function(){var e=this;return this.updateView(!0),n.merge(this.scroll$(),this.resize$(),this.items$.pipe(i.distinctUntilChanged())).pipe(i.map((function(t){return e.updateForward()})))},r.updateForward=function(){var e=this,t=this.options,n=this.items$.getValue(),i=n.length;this.container.position="relative";for(var o=0,r=this.getWidth(),s=this.getGutter(r),a=[],u=0,c=n.length;u<c;u++){var l,d=n[u],h=void 0,p=void 0,f=void 0,m=void 0,v=this.cachedRects[u];if(v?(h=v.col,p=v.height,f=v.left):(h=this.getCol(),p=this.getHeight(r,d)),l=t.cols[h],this.intersect(l+t.top,l+p+t.top,0,t.containerHeight)){v||(f=this.getLeft(h,r,s));var g=this.cachedNode(u,u,d,i);g.style.position="absolute",g.style.top=l+"px",g.style.left=f+"px",g.style.width=r+"px",p!==g.offsetHeight&&(p=g.offsetHeight),m=l+p+t.gutter,o=Math.max(o,m),t.cols[h]=m,v?(v.height=p,v.bottom=m):this.cachedRects[u]={col:h,width:r,height:p,left:f,top:l,bottom:m},a.push(d)}else this.removeNode(u),m=l+p+t.gutter,t.cols[h]=m,o=Math.max(o,m)}for(var y=n.length;y<this.cacheNodes.length;)this.removeNode(y),y++;this.cacheNodes.length=n.length;var b=this.container.parentNode;if(this.reverse&&o<b.offsetHeight-1){var w=b.offsetHeight-1-o;n.forEach((function(t,n){if(-1!==a.indexOf(t)){var o=e.cachedRects[n];e.cachedNode(n,n,t,i).style.top=o.top+w+"px"}})),this.container.style.height=b.offsetHeight-1+"px"}else this.container.style.height=o+"px";return a},r.getCols=function(){var e=this.options,t=Math.floor((e.containerWidth+e.gutter)/(e.width+e.gutter))||1;return new Array(t).fill(0)},r.getCol=function(){var e,t=this.options;switch(this.mode){case Tu:case ku:case Su:e=t.cols.reduce((function(e,t,n,i){return t<i[e]?n:e}),0);break;case Mu:default:e=0}return e},r.getWidth=function(){var e,t=this.options;switch(this.mode){case Tu:case ku:e=t.width;break;case Su:e=(t.containerWidth-(t.cols.length-1)*t.gutter)/t.cols.length;break;case Mu:default:e=t.containerWidth}return e},r.getHeight=function(e,t){var n,i=this.options;switch(this.mode){case Tu:case ku:case Su:n=i.width;break;case Mu:default:n=80}return n},r.getGutter=function(e){var t,n=this.options;switch(this.mode){case Tu:case ku:t=n.gutter;break;case Su:t=(n.containerWidth-n.cols.length*e)/(n.cols.length-1);break;case Mu:default:t=0}return t},r.getLeft=function(e,t,n){var i,o=this.options;switch(this.mode){case Tu:case Su:i=e*(t+n);break;case ku:i=(o.containerWidth-o.cols.length*(t+n)+n)/2+e*(t+n);break;case Mu:default:i=0}return i},r.cachedNode=function(e,t,n,i){return this.cacheNodes[e]?this.updateNode(e,t,n):this.createNode(e,t,n,i)},r.createNode=function(t,n,i,o){var r=this.template.cloneNode(!0);delete r.rxcompId,this.container.appendChild(r),this.cacheNodes[t]=r;var s=e.getContext(this),a=s.module,u=this.tokens,c=[u.key,n,u.value,i,n,o,s.parentInstance],l=a.makeInstance(r,Eu,s.selector,s.parentInstance,c),d=e.getContext(l);return a.compile(r,d.instance),this.cachedInstances[t]=l,r},r.updateNode=function(e,t,n){var i=this.cachedInstances[e],o=this.tokens;return i[o.key]!==t&&(i[o.key]=t,i[o.value]=n,i.pushChanges()),this.cacheNodes[e]},r.removeNode=function(t){this.cachedInstances[t]=void 0;var n=this.cacheNodes[t];if(n){var i=e.getContext(this).module;n.parentNode.removeChild(n),i.remove(n)}return this.cacheNodes[t]=void 0,n},r.intersect=function(e,t,n,i){return n<t&&i>e},r.resize$=function(){var e=this;return n.fromEvent(window,"resize").pipe(i.startWith((function(e){return null})),i.auditTime(100),i.tap((function(){return e.updateView(!0)})))},r.scroll$=function(){var t=this,o=e.getContext(this).node;return o.parentNode&&"auto"===getComputedStyle(o.parentNode).overflowY?n.fromEvent(o.parentNode,"scroll").pipe(i.tap((function(){t.updateView()}))):n.fromEvent(window,"scroll").pipe(i.tap((function(){return t.updateView()})))},r.updateView=function(e){var t=this.container.getBoundingClientRect(),n=this.options;n.top=t.top,n.containerWidth=t.width,n.containerHeight=this.container.parentNode.offsetHeight,n.cols=this.getCols(),e&&(this.cachedRects={})},r.getExpressionTokens=function(e){if(null===e)throw new Error("invalid virtual");if(-1===e.trim().indexOf("let ")||-1===e.trim().indexOf(" of "))throw new Error("invalid virtual");var t=e.split(";").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=t[0].split(" of ").map((function(e){return e.trim()})),i=n[0].replace(/\s*let\s*/,""),o=n[1],r="index",s=i.match(/\[(.+)\s*,\s*(.+)\]/);if(s&&(r=s[1],i=s[2]),t.length>1){var a=t[1].split(/\s*let\s*|\s*=\s*index/).map((function(e){return e.trim()}));3===a.length&&(r=a[1])}return{key:r,value:i,iterable:o}},o}(e.Structure);Iu.meta={selector:"[*virtual]",inputs:["mode","width","gutter","reverse"]};var Cu=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){this.playing=!1,this.progress=0,this.media$().pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.drag$().pipe(i.takeUntil(this.unsubscribe$)).subscribe()},o.media$=function(){var t=this,n=e.getContext(this).node,o=document.querySelector(".page");return Un.events$.pipe(i.tap((function(e){e instanceof Ln?(t.media=e.loader,t.playing=!0,n.classList.add("active"),o.classList.add("media-player-active"),t.pushChanges()):t.media===e.loader&&(e instanceof Pn?(t.playing=!1,t.pushChanges()):e instanceof On?t.dragging||(t.progress=t.media.progress,t.pushChanges()):e instanceof $n&&(t.media=null,n.classList.remove("active"),o.classList.remove("media-player-active"),t.pushChanges()))})))},o.drag$=function(){var t,n=this,o=e.getContext(this).node.querySelector(".track");return Ti.observe$(o).pipe(i.filter((function(e){return n.media})),i.tap((function(e){if(e instanceof xi){var i=o.getBoundingClientRect();t=Math.max(0,Math.min(1,(e.down.x-i.left)/i.width)),n.dragging=!0}else if(e instanceof Ei){var r=o.getBoundingClientRect(),s=Math.max(0,Math.min(1,t+e.distance.x/r.width));n.progress=s,n.pushChanges()}else e instanceof Si&&(n.media.progress=n.progress,n.dragging=!1)})))},o.onPlay=function(){this.media.play()},o.onPause=function(){this.media.pause()},o.onTrack=function(e){var t=e.currentTarget.getBoundingClientRect(),n=(e.screenX-t.left)/t.width;this.media.progress=n},n}(e.Component);Cu.meta={selector:"[media-player]"};var Ru=100.99,Au=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onChanges=function(){this.title=this.item.title},n.createBanner=function(){var e=this;this.getCanvasTexture().then((function(t){var n=t.texture;n.wrapS=n.wrapY=THREE.RepeatWrapping,n.repeat.x=24,n.encoding=THREE.sRGBEncoding;var i=24*t.width/t.height,o=Math.PI/180*360,r=Ru*o/i,s=new THREE.CylinderBufferGeometry(Ru,Ru,r,80,2,!0,0,o);s.scale(-1,1,1);var a=new THREE.MeshBasicMaterial({map:n,transparent:!0,opacity:0}),u=e.mesh;(e.banners=new Array(1).fill(0).map((function(e){return new THREE.Mesh(s,a)}))).forEach((function(e,t){e.rotation.y=Math.PI/2*t}));var c={value:0};gsap.to(c,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){a.opacity=c.value,a.needsUpdate=!0}}),u.userData={render:function(){u.rotation.y+=Math.PI/180*.02,a.needsUpdate=!0}}}))},n.updateBanner=function(){this.getCanvasTexture().then((function(e){}))},n.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},n.getCanvasTexture=function(){var e=this;return new Promise((function(t,n){var i,o=512,r=128,s=Math.floor(102.4),a=Math.floor(9.6);(i=e.canvas?e.canvas:e.canvas=document.createElement("canvas")).width=o,i.height=r;var u,c=e.item.title,l=i.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.font=s+"px "+k.fontFamily,o=l.measureText(c).width+8,o=Math.max(512,Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))),i.width=o,l.clearRect(0,0,o,r),l.fillStyle="#0000005A",l.fillRect(0,0,o,r),l.font=s+"px "+k.fontFamily,l.textAlign="center",l.textBaseline="middle",l.strokeStyle="rgba(0, 0, 0, 0.5)",l.lineWidth=a,l.lineJoin="round",l.miterLimit=2,l.strokeText(c,o/2,64),l.fillStyle="white",l.fillText(c,o/2,64,o),e.texture?(u=e.texture).needsUpdate=!0:u=e.texture=new THREE.CanvasTexture(i),t({texture:u,width:o,height:r})}))},u(t,[{key:"title",get:function(){return this.title_},set:function(e){if(this.title_!==e){var t=null!=this.title_;this.title_=e,t?this.updateBanner():this.createBanner()}}}]),t}(Ts);Au.meta={selector:"[model-banner]",hosts:{host:Ss},inputs:["item"]};var _u=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onChanges=function(){var e=this.item.selected;this.editing=e,this.mesh&&(this.mesh.editing=e)},n.onCreate=function(e,t){var n,o,r=this,s=this.item,a=this.view,u=(a.items,this.getCurvedPanelGeometry(s));this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),yi.getStreamId$(s).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(c){r.streamId!==c&&(r.streamId=c,o&&(o.unsubscribe(),o=null),c||!s.asset?(s.streamId=c,(n=r.disposableMesh=new yi(s,a,u,r.host)).updateFromItem(s),n.name="curved-plane",n.load((function(){r.disposableMesh=null,"function"==typeof e&&e(n,s),o=n.events$().pipe(i.takeUntil(r.unsubscribe$)).subscribe((function(){}))})),r.addMeshListeners(n)):r.mesh&&t(r.mesh,s))}))},n.addMeshListeners=function(e){e.on("down",this.onMeshDown),e.on("playing",this.onMeshPlaying),e.on("zoomed",this.onMeshZoomed),e.on("currentTime",this.onMeshCurrentTime)},n.removeMeshListeners=function(e){e.off("down",this.onMeshDown),e.off("playing",this.onMeshPlaying),e.off("zoomed",this.onMeshZoomed),e.off("currentTime",this.onMeshCurrentTime)},n.onMeshDown=function(){this.down.next(this)},n.onMeshPlaying=function(e){this.play.next({itemId:this.item.id,playing:e})},n.onMeshZoomed=function(e){this.zoom.next({itemId:this.item.id,zoomed:e})},n.onMeshCurrentTime=function(e){this.currentTime.next({itemId:this.item.id,currentTime:e})},n.onDestroy=function(){e.prototype.onDestroy.call(this),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())},n.onUpdate=function(e,t){if(e.radius!==this.radius_||e.height!==this.height_||e.arc!==this.arc_){t.geometry.dispose();var n=this.getCurvedPanelGeometry(e);t.geometry=n}t.updateFromItem(e),this.updateHelper()},n.onUpdateAsset=function(e,t){t.updateByItem(e),yi.getStreamId$(e).pipe(i.filter((function(e){return null!==e})),i.take(1)).subscribe((function(n){e.streamId=n,t.load((function(){}))}))},n.onDragMove=function(e,t,n){var i=this.item,o=this.mesh;i.showPanel=!1,this.editing=!0,o.position.set(e.x,e.y,e.z),n?(e.normalize().multiplyScalar(20),o.lookAt(Fn.origin)):(o.position.set(0,0,0),o.lookAt(t),o.position.set(e.x,e.y,e.z),o.position.add(t.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var e=this.item,t=this.mesh;e.position=t.position.toArray(),e.rotation=t.rotation.toArray(),e.scale=t.scale.toArray(),t.updateFromItem(e),this.editing=!1},n.getCurvedPanelGeometry=function(e){this.radius_=e.radius,this.height_=e.height,this.arc_=e.arc;var t=Math.PI/180*e.arc,n=new THREE.CylinderBufferGeometry(e.radius,e.radius,e.height,36,2,!0,0,t);return n.rotateY(-Math.PI-t/2),n.scale(-1,1,1),n},t}(ks);_u.textures={},_u.meta={selector:"[model-curved-plane]",hosts:{host:Ss},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};var Lu=function(){function e(){if(e.service_)throw"DebugService is a singleton class!";this.message$=new n.BehaviorSubject(null)}return e.getService=function(){return this.service_||(this.service_=new e),this.service_},u(e,[{key:"message",get:function(){return this.message$.getValue()}}]),e.prototype.setMessage=function(e){this.message!==e&&this.message$.next(e)},e}(),Pu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.FontLoader)},t.getFontLoader=function(e){return t.fontLoader||(t.fontLoader=t.getLoader().load(k.getPath("fonts/helvetiker/helvetiker_regular.typeface.json"),e))};var n=t.prototype;return n.onInit=function(){var t=this;e.prototype.onInit.call(this),(this.vrService=eo.getService()).session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){e?t.text&&t.textGroup.add(t.text):t.text&&t.text.parent.remove(t.text)})),(this.debugService=Lu.getService()).message$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.message=e}))},n.createText=function(){var e=document.createElement("canvas");e.width=t.W,e.height=t.H;var n=new THREE.CanvasTexture(e);n.encoding=THREE.sRGBEncoding,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.needsUpdate=!0;var i=new THREE.PlaneBufferGeometry(4,1,2,2),o=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:n,color:16777215,transparent:!0,opacity:1}),r=new THREE.Mesh(i,o);return r.renderOrder=k.renderOrder.debug,r.position.y=0,r},n.loadFont=function(){var e=this;this.fontLoader=t.getFontLoader((function(t){e.font=t,e.message_&&e.setText(e.message_)}))},n.onCreate=function(e,t){var n=this.textGroup=new THREE.Group;this.material=new THREE.MeshBasicMaterial({depthTest:!1,color:16777215,transparent:!0,opacity:1,side:THREE.DoubleSide}),this.text=this.createText();"function"==typeof e&&e(n)},n.render=function(e,t){var n=this.group,i=this.host.camera,o=this.position;this.host.renderer.xr.isPresenting&&(i=this.host.renderer.xr.getCamera(i)),i.getWorldDirection(o),o.multiplyScalar(3),n.position.copy(o),n.lookAt(Fn.origin)},n.setText=function(e){var n=this.text;if(n)if(this.host.renderer.xr.isPresenting&&null!=e){var i=n.material.map.image.getContext("2d");i.clearRect(0,0,t.W,t.H),i.font="30px "+k.fontFamily,i.textBaseline="middle",i.textAlign="center",i.fillStyle="#FFFFFF",i.strokeStyle="#000000",i.lineWidth=5,i.fillText(e,t.W/2,t.H/2,t.W-20),n.material.map.needsUpdate=!0,this.textGroup.add(n)}else n.parent&&n.parent.remove(n)},u(t,[{key:"message",get:function(){return this.message_},set:function(e){e=e&&""!==e?e:null,this.message_!==e&&(this.message_=e,this.setText(e))}}]),t}(Ts);Pu.W=1024,Pu.H=256,Pu.meta={selector:"[model-debug]",hosts:{host:Ss}};var $u=function(e){function t(){return e.apply(this,arguments)||this}d(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTexture=function(){return t.texture||(t.texture=t.getLoader().load(k.getPath("textures/ui/floor-nav.png")))},t.getOverTexture=function(){return t.textureOver||(t.textureOver=t.getLoader().load(k.getPath("textures/ui/floor-nav-over.png")))};var n=t.prototype;return n.getCoords=function(e){var n=t.RADIUS/10,i=Math.ceil((e.x+n/2)/n)-1,o=Math.ceil((e.z+n/2)/n)-1,r=Math.floor(t.COLS/2),s=Math.floor(t.ROWS/2),a=Math.min(r,Math.abs(i))*(i?Math.abs(i)/i:1),u=Math.min(s,Math.abs(o))*(o?Math.abs(o)/o:1);if(this.view.hasTile(this.indices.x+a,this.indices.y+u))return new THREE.Vector2(a,u)},n.onInit=function(){var t=this;e.prototype.onInit.call(this),this.indices=new THREE.Vector2,this.view.index$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){t.moveToIndex(e)}))},n.addTiles=function(e){var n=this,i=t.RADIUS/10,o=.9*i,r=new THREE.PlaneBufferGeometry(o,o,2,2);r.rotateX(-Math.PI/2);var s=t.getTexture();s.disposable=!1,s.encoding=THREE.sRGBEncoding;var a=t.getOverTexture();a.disposable=!1,a.encoding=THREE.sRGBEncoding;var u=this.tileMap={};this.tiles=new Array(t.COLS*t.ROWS).fill(0).map((function(o,c){var l=new THREE.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform float opacity;\nuniform float tween;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = mix(colorA, colorB, tween);\n\tcolor.a = clamp(color.a * opacity, 0.0, 1.0);\n\tcolor.rgb /= color.a;\n\tgl_FragColor = color;\n}\n",uniforms:{textureA:{type:"t",value:s},textureB:{type:"t",value:a},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}}),d=new THREE.Mesh(r,l),h=Math.floor(t.COLS/2),p=Math.floor(t.ROWS/2),f=Math.floor(c/t.COLS),m=-h+c%t.COLS,v=-p+f;d.position.set(m*i,.15*-t.RADIUS,v*i),d.name=n.getName("tile_"+m+"_"+v);d.uniforms={tween:0,opacity:0,ci:m,ri:v};return u[m+"_"+v]=d,e.add(d),d}));this.showTiles()},n.showTiles=function(){var e=this;this.tiles.forEach((function(t,n){var i=e.indices?e.indices.x:0,o=e.indices?e.indices.y:0,r=e.view.hasTile(i+t.uniforms.ci,o+t.uniforms.ri),s=t.uniforms;gsap.to(s,{opacity:r?1:0,duration:.4,ease:Power2.easeInOut,onUpdate:function(){t.material.uniforms.opacity.value=s.opacity,t.material.needsUpdate=!0}})}))},n.addHitArea=function(e){this.onGroundOver=this.onGroundOver.bind(this),this.onGroundMove=this.onGroundMove.bind(this),this.onGroundDown=this.onGroundDown.bind(this),this.onGroundOut=this.onGroundOut.bind(this);var n=new THREE.PlaneBufferGeometry(t.RADIUS,t.RADIUS,8,8);n.rotateX(-Math.PI/2);var i=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0}),o=this.ground=new Nn(n,i);o.name=this.getName("ground"),o.position.set(0,.15*-t.RADIUS,0),o.on("over",this.onGroundOver),o.on("move",this.onGroundMove),o.on("out",this.onGroundOut),o.on("down",this.onGroundDown),e.add(o)},n.onGroundOver=function(){var e=this.ground,t=this.getCoords(e.intersection.point);this.coords=t},n.onGroundMove=function(){var e=this.ground,t=this.getCoords(e.intersection.point);this.coords=t},n.onGroundDown=function(){var e=this.ground,t=this.getCoords(e.intersection.point);if(this.coords=t,t){var n=this.view.getTileIndex(this.indices.x+t.x,this.indices.y+t.y);this.view.index=n,this.nav.next(n)}},n.onGroundOut=function(){this.coords=null},n.moveToIndex=function(e){this.coords=null;var n=this.view.tiles[e],i=new THREE.Vector2(n.indices.x-this.indices.x,n.indices.y-this.indices.y);this.indices.x=n.indices.x,this.indices.y=n.indices.y,this.showTiles();var o=t.RADIUS/10;this.move.next({indices:this.indices,coords:i,position:i.clone().multiplyScalar(o)})},n.onCreate=function(e,t){var n=new THREE.Group;this.addTiles(n),this.addHitArea(n),"function"==typeof e&&e(n)},n.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this.ground;t.off("over",this.onGroundOver),t.off("move",this.onGroundMove),t.off("down",this.onGroundDown),t.off("out",this.onGroundOut)},u(t,[{key:"coords",set:function(e){if(!e&&this.coords_!==e||!this.coords_||e.x!==this.coords_.x||e.y!==this.coords_.y){var t=this.tileMap;if(this.coords_){var n=t[this.coords_.x+"_"+this.coords_.y],i=n.uniforms;gsap.to(i,{tween:0,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:function(){n.material.uniforms.tween.value=i.tween,n.material.needsUpdate=!0}})}if(e){var o=this.currentTile=t[e.x+"_"+e.y],r=o.uniforms;gsap.to(r,{tween:1,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:function(){o.material.uniforms.tween.value=r.tween,o.material.needsUpdate=!0}})}this.coords_=e}}},{key:"coords__",set:function(e){if(!e&&this.coords_!==e||!this.coords_||e.x!==this.coords_.x||e.y!==this.coords_.y){var t=this.tileMap;if(this.coords_){var n=t[this.coords_.x+"_"+this.coords_.y],i={tween:1};gsap.to(i,{duration:.4,tween:0,delay:0,ease:Power2.easeInOut,onUpdate:function(){n.material.opacity=i.tween}})}if(e){var o=this.currentTile=t[e.x+"_"+e.y],r={tween:0};gsap.to(r,{duration:.4,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){o.material.opacity=r.tween}})}this.coords_=e}}}]),t}(Ts);$u.RADIUS=101,$u.COLS=11,$u.ROWS=11,$u.meta={selector:"[model-grid]",hosts:{host:Ss},outputs:["move","nav"],inputs:["view"]};var Ou=function(e){function t(n,i,o){var r,s=t.geometry,a=t.material;(r=e.call(this,s,a)||this).renderOrder=k.renderOrder.menu,r.name=n.name,r.item=n,r.index=i,r.total=o,r.tween=0,r.opacity=0;var u=r.textureA=r.getTextureA(n.name);a.uniforms.textureA.value=u,a.uniforms.resolutionA.value=new THREE.Vector2(u.width,u.height);var c=r.textureB=r.getTextureB(n.name);return a.uniforms.textureB.value=c,a.uniforms.resolutionA.value=new THREE.Vector2(c.width,c.height),a.uniforms.tween.value=r.tween,a.uniforms.opacity.value=r.opacity,a.needsUpdate=!0,r.position.set(t.getX(i,o),t.getY(i,o),0),r.onOver=r.onOver.bind(h(r)),r.onOut=r.onOut.bind(h(r)),r}d(t,e),t.getGrid=function(e){var n=Math.ceil(e/t.ROWS);return[Math.ceil(e/n),n]},t.getX=function(e,n){var i=Math.ceil(n/t.ROWS),o=e%i,r=1/t.W*(t.W+t.G);return r/2-i*r/2+o*r},t.getY=function(e,n){var i=Math.ceil(n/t.ROWS),o=Math.ceil(n/i),r=Math.floor(e/i),s=1/t.W*(t.H+t.G);return o*s/2-s/2+r*-s},u(t,null,[{key:"geometry",get:function(){if(this.geometry_)return this.geometry_;var e=new THREE.PlaneBufferGeometry(1,1/t.W*t.H,2,2);return this.geometry_=e,e}},{key:"material",get:function(){return new THREE.ShaderMaterial({depthTest:!1,transparent:!0,vertexShader:Uu.VERTEX_SHADER,fragmentShader:Uu.FRAGMENT_SHADER,uniforms:{textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}})}}]);var n=t.prototype;return n.getTextureA=function(e){var n=t.W,i=t.H,o=document.createElement("canvas");o.width=n,o.height=i;var r=o.getContext("2d");r.fillStyle=k.colors.menuBackground,r.fillRect(0,0,n,i),r.font="20px "+k.fontFamily,r.fillStyle=k.colors.menuForeground,r.fillText(e,10,50,n-20);var s=new THREE.CanvasTexture(o);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.mapping=THREE.UVMapping,s.encoding=THREE.sRGBEncoding,s.needsUpdate=!0,s},n.getTextureB=function(e){var n=t.W,i=t.H,o=document.createElement("canvas");o.width=n,o.height=i;var r=o.getContext("2d");r.fillStyle=k.colors.menuOverBackground,r.fillRect(0,0,n,i),r.font="20px "+k.fontFamily,r.fillStyle=k.colors.menuOverForeground,r.fillText(e,10,50,n-20);var s=new THREE.CanvasTexture(o);return s.encoding=THREE.sRGBEncoding,s.magFilter=THREE.LinearFilter,s.needsUpdate=!0,s},n.onOver=function(){var e=this;gsap.to(this,{duration:.4,tween:1,ease:Power2.easeOut,onUpdate:function(){e.position.z=.1*e.tween,e.material.uniforms.tween.value=e.tween,e.material.needsUpdate=!0}})},n.onOut=function(){var e=this;gsap.to(this,{duration:.4,tween:0,ease:Power2.easeOut,onUpdate:function(){e.position.z=.1*e.tween,e.material.uniforms.tween.value=e.tween,e.material.needsUpdate=!0}})},n.dispose=function(){Vn.dispose(this),this.textureA.dispose(),this.textureB.dispose(),this.material.dispose(),this.geometry.dispose()},t}(Nn);Ou.W=256,Ou.H=64,Ou.G=2,Ou.ROWS=6;var Hu=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}d(t,e);var n=t.prototype;return n.getTextureA=function(e){var t=Ou.W,n=Ou.H,i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d");o.fillStyle=k.colors.menuBackBackground,o.fillRect(0,0,t,n),o.font="20px "+k.fontFamily,o.fillStyle=k.colors.menuBackForeground,o.fillText(e,10,50,t-20);var r=new THREE.CanvasTexture(i);return r.minFilter=THREE.LinearFilter,r.magFilter=THREE.LinearFilter,r.mapping=THREE.UVMapping,r.needsUpdate=!0,r},n.getTextureB=function(e){var t=Ou.W,n=Ou.H,i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d");o.fillStyle=k.colors.menuBackOverBackground,o.fillRect(0,0,t,n),o.font="20px "+k.fontFamily,o.fillStyle=k.colors.menuBackOverForeground,o.fillText(e,10,50,t-20);var r=new THREE.CanvasTexture(i);return r.encoding=THREE.sRGBEncoding,r.magFilter=THREE.LinearFilter,r.needsUpdate=!0,r},t}(Ou),Uu=function(t){function o(){return t.apply(this,arguments)||this}d(o,t);var r=o.prototype;return r.onInit=function(){var n=this;t.prototype.onInit.call(this),this.onDown=this.onDown.bind(this),this.onToggle=this.onToggle.bind(this);var o=e.getContext(this).node;this.progressIndicator=o.querySelector(".progress circle"),qn.progress$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){n.loading=e.count>0;var t=144.51;e.count&&(t=144.51*(1-e.value)),gsap.set(n.progressIndicator,{strokeDashoffset:t})})),Ye.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case Ie:n.onToggle()}}))},r.onDestroy=function(){this.buttons&&this.buttons.forEach((function(e){return Vn.dispose(e)})),t.prototype.onDestroy.call(this)},r.getContainer=function(){return this.host.cameraGroup},r.onCreate=function(e,t){var n=this.menuGroup=new THREE.Group;"function"==typeof e&&e(n)},r.render=function(e,t){var n=this.group,i=(this.host.cameraGroup,this.host.camera),o=this.position;if(this.host.renderer.xr.isPresenting)(i=this.host.renderer.xr.getCamera(i)).getWorldDirection(o),o.y+=.5,o.multiplyScalar(3),this.host.cameraGroup.worldToLocal(o),o.y+=this.host.cameraGroup.position.y,n.position.copy(o),n.scale.set(1,1,1),n.lookAt(Fn.origin);else{i.getWorldDirection(o),$i.mode===Mi?o.multiplyScalar(.01):o.multiplyScalar(3),n.position.copy(o);var r=1/i.zoom;n.scale.set(r,r,r),n.lookAt(Fn.origin)}},r.items$=function(e){var t=this;return void 0===e&&(e=null),e?n.of(e.items):this.rootItems?n.of(this.rootItems):Qs.getModelMenu$(this.views,this.editor).pipe(i.first(),i.tap((function(e){t.editor||(t.rootItems=e)})))},r.addMenu=function(e){var t=this;void 0===e&&(e=null),this.removeMenu(),e&&"menu-group"!==e.type.name?this.nav.next(e):(Qs.active=!0,this.items$(e).pipe(i.first()).subscribe((function(n){if(n){n=n.slice();var i={type:{name:"back"},name:e?"Back":"Close",backItem:e};n.push(i);var o=t.buttons=n.map((function(t,n,i){return t.backItem=e,"back"===t.type.name?new Hu(t,n,i.length):new Ou(t,n,i.length)}));o.forEach((function(e){e.depthTest=!1,e.on("over",e.onOver),e.on("out",e.onOut),e.on("down",t.onDown),t.menuGroup.add(e)})),gsap.to(o,{duration:.3,opacity:.8,ease:Power2.easeOut,stagger:{grid:Ou.getGrid(o.length),from:0,amount:.02*o.length},onUpdate:function(){o.forEach((function(e){e.material.uniforms.opacity.value=e.opacity*(e.item.hidden?.5:1)}))}})}})))},r.removeMenu=function(){Qs.active=!1,this.removeButtons(),this.removeToggler()},r.removeButtons=function(){var e=this,t=this.buttons;t&&t.forEach((function(t){e.menuGroup.remove(t),t.off("over",t.onOver),t.off("out",t.onOut),t.off("down",e.onDown),t.dispose()})),this.buttons=null},r.addToggler=function(){this.removeMenu();var e=this.toggler=new Ou({type:{name:"menu"},name:"Menu"},0,1);e.opacity=.8,e.material.uniforms.opacity.value=e.opacity,e.material.needsUpdate=!0,e.on("over",e.onOver),e.on("out",e.onOut),e.on("down",this.onToggle),this.menuGroup.add(e)},r.removeToggler=function(){var e=this.toggler;e&&(this.menuGroup.remove(e),e.off("over",e.onOver),e.off("out",e.onOut),e.off("down",this.onToggle),e.dispose()),this.toggler=null},r.onDown=function(e){e.item&&"back"===e.item.type.name?(this.removeMenu(),e.item.backItem?this.addMenu(e.item.backItem.backItem):this.toggle.next()):this.addMenu(e.item)},r.onToggle=function(e){e&&(e.preventDefault(),e.stopImmediatePropagation()),this.locked||(Qs.active?(this.removeMenu(),this.toggle.next()):(this.addMenu(),this.toggle.next(this)))},u(o,[{key:"controlled",get:function(){return I.state.controlling&&I.state.controlling!==I.state.uid}},{key:"controlling",get:function(){return I.state.controlling&&I.state.controlling===I.state.uid}},{key:"silencing",get:function(){return I.state.silencing}},{key:"silenced",get:function(){return I.state.silencing&&I.state.role===C.Streamer}},{key:"spyed",get:function(){return I.state.spying&&I.state.spying===I.state.uid}},{key:"spying",get:function(){return I.state.spying&&I.state.spying!==I.state.uid}},{key:"locked",get:function(){return this.controlled||this.spying}},{key:"loading",get:function(){return this.loading_},set:function(t){this.loading_!==t&&(this.loading_=t,e.getContext(this).node.querySelector(".btn--menu").classList.toggle("loading",t))}}]),o}(Ts);Uu.VERTEX_SHADER="\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",Uu.FRAGMENT_SHADER="\nvarying vec2 vUv;\nuniform float opacity;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = vec4(mix(colorA.rgb, colorB.rgb, tween), opacity);\n\tgl_FragColor = color;\n}\n",Uu.meta={selector:"[model-menu]",hosts:{host:Ss},outputs:["nav","toggle"],inputs:["views","editor"]};var Du=THREE,Fu=Du.BufferAttribute,Vu=Du.BufferGeometry,ju=Du.FileLoader,Bu=Du.Loader,Nu=new WeakMap,zu=function(e){function t(t){var n;return(n=e.call(this,t)||this).decoderPath="",n.decoderConfig={},n.decoderBinary=null,n.decoderPending=null,n.workerLimit=4,n.workerPool=[],n.workerNextTaskID=1,n.workerSourceURL="",n.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},n.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"},n}d(t,e);var n=t.prototype;return n.setDecoderPath=function(e){return this.decoderPath=e,this},n.setDecoderConfig=function(e){return this.decoderConfig=e,this},n.setWorkerLimit=function(e){return this.workerLimit=e,this},n.load=function(e,t,n,i){var o=this,r=new ju(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer"),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(e){var n={attributeIDs:o.defaultAttributeIDs,attributeTypes:o.defaultAttributeTypes,useUniqueIDs:!1};o.decodeGeometry(e,n).then(t).catch(i)}),n,i)},n.decodeDracoFile=function(e,t,n,i){var o={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(e,o).then(t)},n.decodeGeometry=function(e,t){var n=this;for(var i in t.attributeTypes){var o=t.attributeTypes[i];void 0!==o.BYTES_PER_ELEMENT&&(t.attributeTypes[i]=o.name)}var r,s=JSON.stringify(t);if(Nu.has(e)){var a=Nu.get(e);if(a.key===s)return a.promise;if(0===e.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}var u=this.workerNextTaskID++,c=e.byteLength,l=this._getWorker(u,c).then((function(n){return r=n,new Promise((function(n,i){r._callbacks[u]={resolve:n,reject:i},r.postMessage({type:"decode",id:u,taskConfig:t,buffer:e},[e])}))})).then((function(e){return n._createGeometry(e.geometry)}));return l.catch((function(){return!0})).then((function(){r&&u&&n._releaseTask(r,u)})),Nu.set(e,{key:s,promise:l}),l},n._createGeometry=function(e){var t=new Vu;e.index&&t.setIndex(new Fu(e.index.array,1));for(var n=0;n<e.attributes.length;n++){var i=e.attributes[n],o=i.name,r=i.array,s=i.itemSize;t.setAttribute(o,new Fu(r,s))}return t},n._loadLibrary=function(e,t){var n=new ju(this.manager);return n.setPath(this.decoderPath),n.setResponseType(t),n.setWithCredentials(this.withCredentials),new Promise((function(t,i){n.load(e,t,void 0,i)}))},n.preload=function(){return this._initDecoder(),this},n._initDecoder=function(){var e=this;if(this.decoderPending)return this.decoderPending;var t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,n=[];return t?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then((function(n){var i=n[0];t||(e.decoderConfig.wasmBinary=n[1]);var o=Gu.toString(),r=["/* draco decoder */",i,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join("\n");e.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending},n._getWorker=function(e,t){var n=this;return this._initDecoder().then((function(){if(n.workerPool.length<n.workerLimit){var i=new Worker(n.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:n.decoderConfig}),i.onmessage=function(e){var t=e.data;switch(t.type){case"decode":i._callbacks[t.id].resolve(t);break;case"error":i._callbacks[t.id].reject(t);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+t.type+'"')}},n.workerPool.push(i)}else n.workerPool.sort((function(e,t){return e._taskLoad>t._taskLoad?-1:1}));var o=n.workerPool[n.workerPool.length-1];return o._taskCosts[e]=t,o._taskLoad+=t,o}))},n._releaseTask=function(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]},n.debug=function(){console.log("Task load: ",this.workerPool.map((function(e){return e._taskLoad})))},n.dispose=function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this},t}(Bu);function Gu(){var e,t;function n(e,t,n,i,o,r){var s=r.num_components(),a=n.num_points()*s,u=a*o.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,o),l=e._malloc(u);t.GetAttributeDataArrayForAllPoints(n,r,c,u,l);var d=new o(e.HEAPF32.buffer,l,a).slice();return e._free(l),{name:i,array:d,itemSize:s}}onmessage=function(i){var o=i.data;switch(o.type){case"init":e=o.decoderConfig,t=new Promise((function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)}));break;case"decode":var r=o.buffer,s=o.taskConfig;t.then((function(e){var t=e.draco,i=new t.Decoder,a=new t.DecoderBuffer;a.Init(new Int8Array(r),r.byteLength);try{var u=function(e,t,i,o){var r,s,a=o.attributeIDs,u=o.attributeTypes,c=t.GetEncodedGeometryType(i);if(c===e.TRIANGULAR_MESH)r=new e.Mesh,s=t.DecodeBufferToMesh(i,r);else{if(c!==e.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");r=new e.PointCloud,s=t.DecodeBufferToPointCloud(i,r)}if(!s.ok()||0===r.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+s.error_msg());var l={index:null,attributes:[]};for(var d in a){var h=self[u[d]],p=void 0,f=void 0;if(o.useUniqueIDs)f=a[d],p=t.GetAttributeByUniqueId(r,f);else{if(-1===(f=t.GetAttributeId(r,e[a[d]])))continue;p=t.GetAttribute(r,f)}l.attributes.push(n(e,t,r,d,h,p))}c===e.TRIANGULAR_MESH&&(l.index=function(e,t,n){var i=3*n.num_faces(),o=4*i,r=e._malloc(o);t.GetTrianglesUInt32Array(n,o,r);var s=new Uint32Array(e.HEAPF32.buffer,r,i).slice();return e._free(r),{array:s,itemSize:1}}(e,t,r));return e.destroy(r),l}(t,i,a,s),c=u.attributes.map((function(e){return e.array.buffer}));u.index&&c.push(u.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:u},c)}catch(e){console.error(e),self.postMessage({type:"error",id:o.id,error:e.message})}finally{t.destroy(a),t.destroy(i)}}))}}}var qu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var t=this;e.prototype.onInit.call(this),this.isPresenting=!1,Qs.active$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.freezed=e}))},n.onChanges=function(){this.editing=this.item.selected},n.onCreate=function(e,t){var n=this;this.loadGlb(k.getPath(this.item.asset.folder),this.item.asset.file,(function(i,o){n.onGlbLoaded(i,o,e,t)}))},n.loadGlb=function(e,t,n){this.host.renderer;var i=qn.getRef(),o=(new fr).setPath(e),r=k.assets+"js/draco/",s=new zu;s.setDecoderPath(r),o.setDRACOLoader(s),o.load(t,(function(e){"function"==typeof n&&n(e.scene,e.animations),qn.setProgress(i,1)}),(function(e){qn.setProgress(i,e.loaded,e.total)}))},n.onGlbLoaded=function(e,t,n,i){var o=this;this.parseAnimations(e,t);var r,s=(new THREE.Box3).setFromObject(e),a=s.max.clone().sub(s.min),u=2/Math.max(a.x,a.y,a.z);e.scale.set(u,u,u);var c=this.view,l=this.item;if(c.type.name===$t.Model.name){(r=new THREE.Group).add(e),s.setFromObject(r);var d=s.getCenter(new THREE.Vector3);r.position.set(e.position.x-d.x,e.position.y-d.y,e.position.z-d.z+(this.host.renderer.xr.isPresenting?-2:0));var h=r.position.y,p={tween:1},f=function(){r.position.y=h+3*p.tween,r.rotation.y=0+Math.PI*p.tween};f(),this.makeInteractive(e),gsap.to(p,{duration:1.5,tween:0,delay:.1,ease:Power2.easeInOut,onUpdate:f,onComplete:function(){o.updateHelper()}})}else{s.setFromObject(e);var m=s.getCenter(new THREE.Vector3);e.position.set(-m.x,-m.y,-m.z),(r=new THREE.Group).add(e),l.position&&r.position.fromArray(l.position),l.rotation&&r.rotation.fromArray(l.rotation),l.scale&&r.scale.fromArray(l.scale),this.makeInteractive(e),this.updateHelper()}"function"==typeof n&&(n(r,this.item),this.freezed=Qs.active)},n.parseAnimations=function(e,t){this.actionIndex=-1;var n=this.actions=[];if(t&&t.length){this.clock=new THREE.Clock;var i=this.mixer=new THREE.AnimationMixer(e);i.timeScale=1,t.forEach((function(e){var t=i.clipAction(e);t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1),t.setLoop(THREE.LoopRepeat),n.push(t)}))}},n.onClipToggle=function(){var e,t=this.actions;1===t.length?(e=-1===this.actionIndex?0:-1,this.setSingleAction(e)):t.length>1&&((e=this.actionIndex+1)===t.length&&(e=-1),this.setMultiAction(e)),this.play.next({itemId:this.item.id,actionIndex:e})},n.setSingleAction=function(e){if(this.actionIndex!==e){this.actionIndex=e;var t=this.actions[0];0===e?t.paused||0===t.timeScale?t.paused=!1:t.play():-1===e&&t.halt(.3)}},n.setMultiAction=function(e){if(this.actionIndex!==e){var t=this.actions,n=this.actionIndex>-1?t[this.actionIndex]:null;if(this.actionIndex=e,n&&n.halt(.3),e>-1){var i=t[e];i.paused&&(i.paused=!1),0===i.timeScale&&(i.timeScale=1),i.play()}}},n.onMessage=function(e){switch(e.type){case ge:var t=this.actions;1===t.length?this.setSingleAction(e.actionIndex):t.length>1&&this.setMultiAction(e.actionIndex)}},n.render=function(e,t){var n=this.view,i=(this.item,this.mesh),o=this.host.renderer.xr.isPresenting;this.group;i&&(n.type.name===$t.Model.name?(this.isPresenting!==o&&(this.isPresenting=o,o?(i.position.x=0,i.position.y=0,i.position.z=-2,i.rotation.y=0):(i.position.x=0,i.position.y=0,i.position.z=0,i.rotation.y=0)),o&&(i.rotation.y-=Math.PI/180/60*5)):o&&(i.rotation.y-=Math.PI/180/60*5));var r=this.mixer,s=this.clock;if(r){var a=s.getDelta();r.update(a)}},n.onUpdate=function(e,t){this.view.type.name!==$t.Model.name&&(e.position&&t.position.fromArray(e.position),e.rotation&&t.rotation.fromArray(e.rotation),e.scale&&t.scale.fromArray(e.scale)),this.updateHelper()},n.onUpdateAsset=function(e,t){var n=this;this.loadGlb(k.getPath(e.asset.folder),e.asset.file,(function(e,t){n.onGlbLoaded(e,t,(function(e,t){return n.onMount(e,t)}),(function(e,t){return n.onDismount(e,t)}))}))},n.onDragMove=function(e,t,n){n&&e.normalize().multiplyScalar(4),this.editing=!0,this.view.type.name!==$t.Model.name&&this.mesh.position.set(e.x,e.y,e.z),this.updateHelper()},n.onDragEnd=function(){this.view.type.name!==$t.Model.name&&(this.item.position=this.mesh.position.toArray(),this.item.rotation=this.mesh.rotation.toArray(),this.item.scale=this.mesh.scale.toArray()),this.editing=!1},t.getInteractiveDescriptors=function(){var e=t.interactiveDescriptors;if(!e){var n=Object.getOwnPropertyDescriptors(jn.prototype),i=Object.getOwnPropertyDescriptors(Bn.prototype),o=Object.getOwnPropertyDescriptors(Nn.prototype);e=Object.assign({},n,i,o),t.interactiveDescriptors=e}return e},n.makeInteractive=function(e){var n=this,i=t.getInteractiveDescriptors();e.traverse((function(e){e.isMesh&&(Object.keys(i).forEach((function(t){"constructor"!==t&&Object.defineProperty(e,t,i[t])})),e.freezed=!1,e.events={},e.depthTest=!0,e.over_=!1,e.down_=!1,Vn.items.push(e),e.on("down",(function(){n.onClipToggle(),n.down.next(n)})))}))},u(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){if(this.freezed_!==e){this.freezed_=e;var t=this.mesh;t&&t.traverse((function(t){t.isInteractiveMesh&&(t.freezed=e)}))}}}]),t}(ks);qu.meta={selector:"[model-model]",hosts:{host:Ss},outputs:["down","play"],inputs:["item","view"]};var Wu=function(e){function t(t){var n;return(n=e.call(this,t)||this).depthTest=!0,n.over_=!1,n.down_=!1,Vn.items.push(h(n)),n}return d(t,e),u(t,[{key:"isInteractiveSprite",get:function(){return!0}},{key:"over",get:function(){return this.over_},set:function(e){this.over_!=e&&(this.over_=e,e?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(e){e=e&&this.over,this.down_!=e&&(this.down_=e,e?this.emit("down",this):this.emit("up",this))}}]),t}(function(e){function t(t){var n;return t=t||new THREE.SpriteMaterial({color:16711935}),(n=e.call(this,t)||this).events={},n}d(t,e);var n=t.prototype;return n.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},n.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},n.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t}(function(e){function t(t){var n;return t=t||new THREE.SpriteMaterial({color:16711935}),(n=e.call(this,t)||this).freezed=!1,n}d(t,e),u(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){this.freezed_=e,this.children.filter((function(e){return e.__lookupGetter__("freezed")})).forEach((function(t){return t.freezed=e}))}}]);var n=t.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},t}(THREE.Sprite))),Ku=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this)},i.onView=function(){var t=this;if(!this.viewed){this.viewed=!0;var i=e.getContext(this).node;this.getCanvasTexture(i).then((function(e){if(t.mesh){var o=.2*(t.item.asset?1.5:1),r=e.width/e.height,s=n.PANEL_RADIUS*o,a=n.PANEL_RADIUS*o/r,u=.25*s,c=t.item.mesh.position.normalize().multiplyScalar(n.PANEL_RADIUS),l=new THREE.SpriteMaterial({depthTest:!1,transparent:!0,opacity:0,map:e.map,sizeAttenuation:!1}),d=t.panel=new Wu(l);d.renderOrder=k.renderOrder.panel,d.scale.set(.02*s,.02*a,1),d.position.set(c.x,c.y+(a+2*u),c.z),d.on("down",(function(e){var n={x:parseInt(e.intersection.uv.x*i.offsetWidth),y:parseInt((1-e.intersection.uv.y)*i.offsetHeight)},o=Array.prototype.slice.call(i.querySelectorAll(".panel__link")).find((function(e){return n.x>=e.offsetLeft&&n.y>=e.offsetTop&&n.x<=e.offsetLeft+e.offsetWidth&&n.y<=e.offsetTop+e.offsetHeight}));if(o){t.down.next(t.item);var r=i.getBoundingClientRect(),s=new MouseEvent("mouseup",{button:0,buttons:0,clientX:n.x+r.left,clientY:n.y+r.top,movementX:0,movementY:0,relatedTarget:o,screenX:n.x,screenY:n.y});o.dispatchEvent(s),setTimeout((function(){Ti.dismissEvent(s,Ti.events$,Ti.dismiss$,Ti.downEvent)}),1)}})),t.mesh.add(d);var h={value:0};gsap.to(h,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){d.position.set(c.x,c.y+(a+2*u)-u*h.value,c.z),d.lookAt(Fn.origin),d.material.opacity=h.value,d.material.needsUpdate=!0}})}}),(function(e){console.log("ModelPanelComponent.getCanvasTexture.error",e)}))}},i.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},i.onDestroy=function(){t.prototype.onDestroy.call(this)},i.imagesLoaded=function(){var t=e.getContext(this).node;if(t){var n=Array.prototype.slice.call(t.querySelectorAll("img")).map((function(e){return new Promise((function(t,n){var i=e.src&&-1===e.src.indexOf(location.origin);if(e.complete)return setTimeout((function(){t(i)}),10);var o=function(){e.removeEventListener("load",r),e.removeEventListener("error",s)},r=function(){o(),setTimeout((function(){t(i)}),10)},s=function(){o(),t(!1)};e.addEventListener("load",r),e.addEventListener("error",s)}))}));return n.length?Promise.all(n):Promise.resolve()}},i.getCanvasTexture=function(t){var n=this;return new Promise((function(i,r){setTimeout((function(){n.item.panelTexture?i(n.item.panelTexture):n.imagesLoaded().then((function(s){var a=e.getContext(n);if(a&&a.node){t=a.node;var u=s&&null!=s.find((function(e){return!0===e}));o(t,{backgroundColor:"#ffffff00",scale:2,useCORS:u}).then((function(e){var t=new THREE.CanvasTexture(e);n.item.panelTexture={map:t,width:e.width,height:e.height},i(n.item.panelTexture)}),(function(e){r(e)}))}}))}),1)}))},n}(Ts);Ku.PANEL_RADIUS=99,Ku.meta={selector:"[model-panel]",hosts:{host:Ss},outputs:["over","out","down"],inputs:["item"]};var Xu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},t}(Ts);Xu.meta={selector:"[model-picture]",hosts:{host:Ss},inputs:["item"]};var Yu=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onChanges=function(){var e=this.item.selected;this.editing=e,this.mesh&&(this.mesh.editing=e)},n.onCreate=function(e,t){var n,o,r=this,s=this.item,a=this.view,u=(a.items,Dn.planeGeometry);this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),yi.getStreamId$(s).pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(c){r.streamId!==c&&(r.streamId=c,o&&(o.unsubscribe(),o=null),c||!s.asset?(s.streamId=c,(n=r.disposableMesh=new yi(s,a,u,r.host)).updateFromItem(s),n.name="plane",n.load((function(){r.disposableMesh=null,"function"==typeof e&&e(n,s),o=n.events$().pipe(i.takeUntil(r.unsubscribe$)).subscribe((function(){}))})),r.addMeshListeners(n)):r.mesh&&t(r.mesh,s))}))},n.addMeshListeners=function(e){e.on("down",this.onMeshDown),e.on("playing",this.onMeshPlaying),e.on("zoomed",this.onMeshZoomed),e.on("currentTime",this.onMeshCurrentTime)},n.removeMeshListeners=function(e){e.off("down",this.onMeshDown),e.off("playing",this.onMeshPlaying),e.off("zoomed",this.onMeshZoomed),e.off("currentTime",this.onMeshCurrentTime)},n.onMeshDown=function(){this.down.next(this)},n.onMeshPlaying=function(e){this.play.next({itemId:this.item.id,playing:e})},n.onMeshZoomed=function(e){this.zoom.next({itemId:this.item.id,zoomed:e})},n.onMeshCurrentTime=function(e){this.currentTime.next({itemId:this.item.id,currentTime:e})},n.onDestroy=function(){e.prototype.onDestroy.call(this),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())},n.onUpdate=function(e,t){t.updateFromItem(e),this.updateHelper()},n.onUpdateAsset=function(e,t){t.updateByItem(e),yi.getStreamId$(e).pipe(i.filter((function(e){return null!==e})),i.take(1)).subscribe((function(n){e.streamId=n,t.load((function(){}))}))},n.onDragMove=function(e,t,n){var i=this.item,o=this.mesh;i.showPanel=!1,this.editing=!0,n?(e.normalize().multiplyScalar(20),o.position.set(e.x,e.y,e.z),o.lookAt(Fn.origin)):(o.position.set(0,0,0),o.lookAt(t),o.position.set(e.x,e.y,e.z),o.position.add(t.multiplyScalar(.01))),this.updateHelper()},n.onDragEnd=function(){var e=this.item,t=this.mesh;e.position=t.position.toArray(),e.rotation=t.rotation.toArray(),e.scale=t.scale.toArray(),t.updateFromItem(e),this.editing=!1},t}(ks);Yu.textures={},Yu.meta={selector:"[model-plane]",hosts:{host:Ss},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};var Zu={title:vt.transform("loading")},Ju={title:vt.transform("waiting_host")},Qu=100.99,ec=function(t){function n(){return t.apply(this,arguments)||this}d(n,t);var o=n.prototype;return o.onInit=function(){var e=this;this.title_="",this.visible_=this.host.renderer.xr.isPresenting,t.prototype.onInit.call(this),(this.vrService=eo.getService()).session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.visible=null!=t}))},o.onCreate=function(t,n){var o=this,r=e.getContext(this).node,s=r.querySelector(".inner");this.getCanvasTexture().then((function(e){var n=o.createMesh(e);"function"==typeof t&&t(n),qn.progress$.pipe(i.takeUntil(o.unsubscribe$)).subscribe((function(e){e.count>0?r.classList.add("active"):r.classList.remove("active"),s.style.width=100*e.value+"%",e.count?o.title=0===e.value?Zu.title:e.title:o.title=o.getTitle()}))}))},o.getTitle=function(){return this.view&&this.view.type.name===$t.WaitingRoom.name?Ju.title:""},o.show=function(){this.mesh.add(this.banner),this.material.opacity=1,this.material.needsUpdate=!0},o.hide=function(){this.mesh.remove(this.banner),this.material.opacity=0,this.material.needsUpdate=!0},o.createMesh=function(e){var t=new THREE.Group,n=Math.PI/180*360,i=Qu*n,o=i/360*2.4,r=i/(e.width*o/e.height),s=new THREE.CylinderBufferGeometry(Qu,Qu,o,80,2,!0,0,n);s.scale(-1,1,1);var a=e.texture;a.wrapS=a.wrapY=THREE.RepeatWrapping,a.repeat.x=r,a.encoding=THREE.sRGBEncoding;var u=this.material=new THREE.MeshBasicMaterial({map:a,transparent:!0,opacity:0});this.banner=new THREE.Mesh(s,u);return t.userData={render:function(){t.rotation.y+=Math.PI/180*.02}},t},o.updateProgress=function(){var e=this;this.getCanvasTexture().then((function(t){var n=Math.PI/180*360,i=Qu*n,o=i/360*2.4,r=i/(t.width*o/t.height);e.texture.repeat.x=r}))},o.getCanvasTexture=function(){var e=this;return new Promise((function(t,n){var i,o=512,r=64,s=Math.floor(48),a=Math.floor(3.2);(i=e.canvas?e.canvas:e.canvas=document.createElement("canvas")).width=o,i.height=r;var u,c=e.title_,l=i.getContext("2d");l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.font="300 "+s+"px "+k.fontFamily,o=l.measureText(c).width+8,o=Math.max(512,Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))),i.width=o,l.clearRect(0,0,o,r),l.fillStyle="#0000005A",l.fillRect(0,0,o,r),l.font="300 "+s+"px "+k.fontFamily,l.textAlign="center",l.textBaseline="middle",l.strokeStyle="rgba(0, 0, 0, 0.35)",l.lineWidth=a,l.lineJoin="round",l.miterLimit=2,l.strokeText(c,o/2,32),l.fillStyle="white",l.fillText(c,o/2,32,o),e.texture?(u=e.texture).needsUpdate=!0:u=e.texture=new THREE.CanvasTexture(i),t({texture:u,width:o,height:r})}))},u(n,[{key:"title",get:function(){return this.title_},set:function(e){this.title_!==e&&(this.title_=e,e===Ju.title||""!==e&&this.visible_?(this.updateProgress(),this.show()):this.hide())}},{key:"visible",get:function(){return this.visible_},set:function(e){this.visible_!==e&&(this.visible_=e,e&&""!==this.title_?(this.updateProgress(),this.show()):this.hide())}}]),n}(Ts);ec.meta={selector:"[model-progress]",hosts:{host:Ss},inputs:["view"]};var tc=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){var t=this;e.prototype.onInit.call(this),this.isPresenting=!1,Qs.active$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.freezed=e}))},n.onChanges=function(){this.editing=this.view.selected},n.onCreate=function(e,t){var n=this;this.loadGlb(k.getPath(this.view.asset.folder),this.view.asset.file,(function(i,o){n.onGlbLoaded(i,o,e,t)}))},n.loadGlb=function(e,t,n){this.host.renderer;var i=qn.getRef(),o=(new fr).setPath(e),r=k.assets+"js/draco/",s=new zu;s.setDecoderPath(r),o.setDRACOLoader(s),o.load(t,(function(e){"function"==typeof n&&n(e.scene,e.animations),qn.setProgress(i,1)}),(function(e){qn.setProgress(i,e.loaded,e.total)}))},n.onGlbLoaded=function(e,t,n,i){var o=this,r=this.view;e.position.set(0,-1.76,0);var s,a=[];e.traverse((function(e){e.isMesh&&a.push(e),"nav"===e.name&&(r.navIntersectObjects=[e],o.makeTransparent(e))})),r.intersectObjects=a,(s=new THREE.Group).add(e),"function"==typeof n&&n(s,this.view)},n.makeTransparent=function(e){e.isMesh&&(e.material=t.transparentMaterial),e.traverse((function(e){e.isMesh&&(e.material=t.transparentMaterial)}))},n.onUpdateAsset=function(e,t){var n=this;this.loadGlb(k.getPath(e.asset.folder),e.asset.file,(function(e,t){n.onGlbLoaded(e,t,(function(e,t){return n.onMount(e,t)}),(function(e,t){return n.onDismount(e,t)}))}))},u(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){if(this.freezed_!==e){this.freezed_=e;var t=this.mesh;t&&t.traverse((function(t){t.isInteractiveMesh&&(t.freezed=e)}))}}}],[{key:"transparentMaterial",get:function(){return this.transparentMaterial_||(this.transparentMaterial_=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:0})),this.transparentMaterial_}}]),t}(Ts);tc.meta={selector:"[model-room]",hosts:{host:Ss},inputs:["view"]};var nc=function(e){function t(){return e.apply(this,arguments)||this}d(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},t}(Ts);nc.meta={selector:"[model-text]",hosts:{host:Ss},inputs:["item"]};var ic=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(e.Module);ic.meta={imports:[e.CoreModule,t.FormModule,$a],declarations:[P,We,lt,Xe,dt,wt,$s,xt,Tt,St,At,_t,Lt,Pt,Vs,na,za,Ga,qa,Wa,Ka,ia,Xa,Ya,Za,js,$,Ja,eu,Qa,tu,nu,Bs,zs,Gs,Ha,iu,Ua,xu,au,Oa,uu,ou,vt,cu,lu,pu,Cu,fu,mu,cn,Au,Ts,_u,Pu,$u,Uu,qu,Ps,Ku,Xu,Yu,ec,tc,nc,Rt,vu,gu,ru,yu,bu,ln,wu,su,Iu,Ss],bootstrap:Os},e.Browser.bootstrap(ic)}));
//# sourceMappingURL=main.min.js.map