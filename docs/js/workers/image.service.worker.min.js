/**
 * @license b-here v1.0.0
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var e="progress",t="complete",n={};function o(e,n,o){if(!self.createImageBitmap||!self.OffscreenCanvas)return r(t,e,n);self.createImageBitmap(n).then((function(n){var o=n.width,i=n.height;o>i?o>320&&(i*=320/o,o=320):i>240&&(o*=240/i,i=240);var a=new OffscreenCanvas(o,i),s=a.getContext("2d");a.width=o,a.height=i,s.drawImage(n,0,0,o,i),a.convertToBlob().then((function(n){r(t,e,n)}))}))}function r(e,t,n){self.postMessage({type:e,src:t,data:n})}self.addEventListener("message",(function(a){var s=a.data.id,f=a.data.src,l=a.data.size;if(!s||f){var u,c,d,h,v,g,p,m,b,w,y,S={mode:"cors"};if("function"==typeof fetch){if(self.AbortController){var C=new AbortController;S.signal=C.signal,n[s]=C}fetch(f,S).then((u={onProgress:function(t){r(e,f,t)}},c=u.defaultSize,d=void 0===c?0:c,h=u.emitDelay,v=void 0===h?10:h,g=u.onProgress,p=void 0===g?function(){return null}:g,m=u.onComplete,b=void 0===m?function(){return null}:m,w=u.onError,y=void 0===w?function(){return null}:w,function(e){if("undefined"==typeof Response||"undefined"==typeof ReadableStream)return e;var t=e.body,n=e.headers,o=e.status,r=n.get("content-length")||d,a=new i(r,v),s=t.getReader(),f=new ReadableStream({start:function(e){function t(){s.read().then((function(n){var o=n.done,r=n.value;if(o)return b({}),void e.close();r&&a.next(r,p),e.enqueue(r),t()})).catch((function(e){y(e)}))}t()}});return new Response(f,{headers:n,status:o})})).then((function(e){return e.blob()}),(function(e){console.log("ImageServiceWorker.error",e)})).then((function(e){delete n[s],"object"==typeof l?o(f,e):r(t,f,e)}),(function(e){console.log("ImageServiceWorker.error",e)}))}else{var D=new XMLHttpRequest;D.open("GET",f,!0),D.responseType="blob",D.withCredentials=!0,D.onload=function(){D.status<300&&("object"==typeof l?o(f,this.response):r(t,f,this.response))},D.onprogress=function(t){r(e,f,t)},D.onerror=function(){},D.send()}}else{var I=n[s];I&&I.abort()}}));var i=function(){function e(e,t){void 0===t&&(t=1e3),this.eventStart=0,this.loaded=0,this.length=parseInt(e,10)||0,this.emitDelay=t}return e.prototype.next=function(e,t){var n=e.length;(this.loaded+=n,this.eventStart=this.eventStart||Date.now(),this.length>=this.loaded||Date.now()-this.eventStart>this.emitDelay)&&(this.eventStart=Date.now(),t({total:this.length,loaded:this.loaded}))},e}()}));
//# sourceMappingURL=image.service.worker.min.js.map