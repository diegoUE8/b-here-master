{"version":3,"sources":["src/js/prefetch/prefetch.service.worker.js","../../src/js/prefetch/prefetch.service.worker.js"],"names":["f","define","amd","_arrayLikeToArray","arr","len","length","i","arr2","Array","_createForOfIteratorHelperLoose","o","allowArrayLike","it","Symbol","iterator","isArray","minLen","n","Object","prototype","toString","call","slice","constructor","name","from","test","_unsupportedIterableToArray","done","value","TypeError","next","bind","PrefetchServiceWorkerEvent","prefetched","controllers","sendMessage","type","assets","data","self","postMessage","addEventListener","event","id","Promise","fetch","options","mode","AbortController","controller","signal","promises","onProgress","total","loaded","_step","_iterator","then","all","PromiseAllProgress","map","url","resolve","reject","_","error","Prefetch","progress","catch","console","log","abort"],"mappings":"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","file":"docs\\js\\workers\\prefetch.service.worker.min.js","sourcesContent":[null,"\r\nconst PrefetchServiceWorkerEvent = {\r\n\tProgress: 'progress',\r\n\tComplete: 'complete',\r\n};\r\n\r\nconst prefetched = {};\r\nconst controllers = {};\r\n\r\nfunction sendMessage(type, assets, data) {\r\n\tself.postMessage({\r\n\t\ttype: type,\r\n\t\tassets: assets,\r\n\t\tdata: data\r\n\t});\r\n}\r\n\r\nfunction onMessage(event) {\r\n\tconst id = event.data.id;\r\n\tconst assets = event.data.assets;\r\n\t// console.log('PrefetchServiceWorker.onMessage', id, assets);\r\n\tif (!id) {\r\n\t\treturn;\r\n\t}\r\n\tif (id && !assets) {\r\n\t\tconst controller = controllers[id];\r\n\t\tif (controller) {\r\n\t\t\t// console.log('PrefetchServiceWorker.Aborting', id);\r\n\t\t\tcontroller.abort();\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\tif (!assets.length) {\r\n\t\treturn;\r\n\t}\r\n\tif (typeof Promise === 'undefined') {\r\n\t\treturn;\r\n\t}\r\n\tif (typeof fetch !== 'function') {\r\n\t\treturn;\r\n\t}\r\n\tconst options = {\r\n\t\tmode: 'cors', // no-cors, *cors, same-origin\r\n\t};\r\n\tif (self.AbortController) {\r\n\t\tconst controller = new AbortController();\r\n\t\toptions.signal = controller.signal;\r\n\t\tcontrollers[id] = controller;\r\n\t\t// console.log('AbortController', id);\r\n\t}\r\n\treturn PromiseAllProgress(assets.map(url => Prefetch(url, options)), function(progress) {\r\n\t\t// console.log('PrefetchServiceWorker.onMessage.Progress', progress);\r\n\t\tsendMessage(PrefetchServiceWorkerEvent.Progress, assets, progress);\r\n\t}).then(function(_) {\r\n\t\tdelete controllers[id];\r\n\t\t// console.log('PrefetchServiceWorker.onMessage.Complete', assets);\r\n\t\tsendMessage(PrefetchServiceWorkerEvent.Complete, assets);\r\n\t}).catch(function(error) {\r\n\t\tconsole.log('PrefetchServiceWorker.onMessage.error', error);\r\n\t});\r\n}\r\n\r\nself.addEventListener('message', onMessage);\r\n\r\nfunction Prefetch(url, options) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst resolved = prefetched[url];\r\n\t\tif (resolved) {\r\n\t\t\tresolve(url);\r\n\t\t} else {\r\n\t\t\tfetch(url, options).then(function(_) {\r\n\t\t\t\tprefetched[url] = true;\r\n\t\t\t\tresolve(url);\r\n\t\t\t}, function(error) {\r\n\t\t\t\t// console.log('PrefetchServiceWorker.Prefetch.error', error);\r\n\t\t\t\treject(error);\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction PromiseAllProgress(promises, onProgress) {\r\n\tconst total = promises.length;\r\n\tlet loaded = 0;\r\n\tif (typeof onProgress === 'function') {\r\n\t\tonProgress({ loaded, total });\r\n\t}\r\n\tfor (const promise of promises) {\r\n\t\tpromise.then(() => {\r\n\t\t\tloaded++;\r\n\t\t\tif (typeof onProgress === 'function') {\r\n\t\t\t\tonProgress({ loaded, total });\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn Promise.all(promises);\r\n}\r\n"]}